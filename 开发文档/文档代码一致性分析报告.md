# å¼€å‘æ–‡æ¡£ä¸ä»£ç ä¸€è‡´æ€§åˆ†ææŠ¥å‘Š

> **ç”Ÿæˆæ—¶é—´**: 2025-12-06
> **åˆ†æèŒƒå›´**: å…¨é¡¹ç›®ä»£ç åº“ä¸å¼€å‘æ–‡æ¡£å¯¹æ¯”
> **åˆ†ææ–¹æ³•**: ç³»ç»ŸåŒ–ä»£ç æ‰«æ + æ–‡æ¡£é€é¡¹æ ¸å¯¹
> **çŠ¶æ€**: âœ… å®Œæˆ

---

## ğŸ“Š æ‰§è¡Œæ‘˜è¦

### æ€»ä½“ä¸€è‡´æ€§è¯„åˆ†: **82/100**

| ç»´åº¦ | ä¸€è‡´æ€§ | è¯„åˆ† | ä¸»è¦é—®é¢˜ |
|------|--------|------|---------|
| **æ•°æ®æ¶æ„** | ğŸŸ¡ åŸºæœ¬ä¸€è‡´ | 85/100 | å­—æ®µæ•°é‡æ–‡æ¡£å£°ç§°27ä¸ª,å®é™…ä»£ç å·²æ”¯æŒä½†æ–‡æ¡£æè¿°éœ€æ›´æ–° |
| **æ ¸å¿ƒè®¡ç®—é€»è¾‘** | ğŸŸ¡ åŸºæœ¬ä¸€è‡´ | 80/100 | KPIæ•°é‡ä¸åŒ¹é…(æ–‡æ¡£16ä¸ª vs ä»£ç 18ä¸ª+),å‘½åçº¦å®šä¸ä¸€è‡´ |
| **æŠ€æœ¯æ ˆ** | ğŸŸ¢ é«˜åº¦ä¸€è‡´ | 90/100 | Prismaæœªå®é™…ä½¿ç”¨,DuckDBå·²é›†æˆä½†æ–‡æ¡£æœªæ›´æ–° |
| **åŠŸèƒ½å®ç°** | ğŸŸ¡ åŸºæœ¬ä¸€è‡´ | 75/100 | éƒ¨åˆ†åŠŸèƒ½å®ç°ä½†æ–‡æ¡£æ ‡è®°ä¸ºæœªå®Œæˆ,åä¹‹äº¦æœ‰ |
| **APIç«¯ç‚¹** | ğŸ”´ ä¸¥é‡ä¸ç¬¦ | 60/100 | æ–‡æ¡£æœªè®°å½•ä½†ä»£ç å·²æœ‰,æ–‡æ¡£è®°å½•ä½†ä»£ç æœªå®Œæˆ |
| **å­˜å‚¨å±‚** | ğŸŸ¡ åŸºæœ¬ä¸€è‡´ | 80/100 | å¤šç§å­˜å‚¨æ–¹æ¡ˆå·²å®ç°ä½†æ–‡æ¡£æœªç³»ç»ŸåŒ–è¯´æ˜ |

---

## ğŸ” è¯¦ç»†å·®å¼‚åˆ†æ

### 1. æ•°æ®æ¶æ„å·®å¼‚ (data_architecture.md)

#### 1.1 å­—æ®µæ•°é‡å£°æ˜é—®é¢˜

**æ–‡æ¡£å£°ç§°**:
```
CSVæ–‡ä»¶å¿…é¡»åŒ…å«ä»¥ä¸‹27ä¸ªå­—æ®µï¼ˆå…¶ä¸­1ä¸ªå¯é€‰ï¼‰
```

**å®é™…ä»£ç ** (`src/types/insurance.ts`):
```typescript
export interface InsuranceRecord {
  // ... å®Œæ•´å®šä¹‰äº†27ä¸ªå­—æ®µ ...
  second_level_organization?: string // äºŒçº§æœºæ„ï¼ˆå¯é€‰ï¼‰âœ…
  premium_plan_yuan: number | null   // ä¿è´¹è®¡åˆ’ï¼ˆå¯é€‰ï¼‰âœ…
}
```

**å·®å¼‚è¯´æ˜**:
- âœ… **ä¸€è‡´**: å­—æ®µæ•°é‡ç¡®å®æ˜¯27ä¸ª
- âš ï¸ **éœ€æ›´æ–°**: æ–‡æ¡£è¯´"å…¶ä¸­1ä¸ªå¯é€‰",å®é™…æœ‰**2ä¸ªå¯é€‰å­—æ®µ**:
  - `second_level_organization` (äºŒçº§æœºæ„)
  - `premium_plan_yuan` (ä¿è´¹è®¡åˆ’)

**å»ºè®®**:
```diff
- CSVæ–‡ä»¶å¿…é¡»åŒ…å«ä»¥ä¸‹27ä¸ªå­—æ®µï¼ˆå…¶ä¸­1ä¸ªå¯é€‰ï¼‰
+ CSVæ–‡ä»¶å¿…é¡»åŒ…å«ä»¥ä¸‹27ä¸ªå­—æ®µï¼ˆå…¶ä¸­2ä¸ªå¯é€‰ï¼šsecond_level_organization å’Œ premium_plan_yuanï¼‰
```

---

#### 1.2 å­—æ®µé¡ºåºè¡¨æ ¼éœ€æ›´æ–°

**æ–‡æ¡£ç°çŠ¶**:
```markdown
| 1 | `snapshot_date` | Date | å¿«ç…§æ—¥æœŸ | `2025-07-13` | å¦ |
| 2 | `policy_start_year` | Integer | ä¿å•å¹´åº¦ | `2024` | å¦ |
| 3 | `business_type_category` | String | ä¸šåŠ¡ç±»å‹ | ... | å¦ |
| 4 | `chengdu_branch` | String | åœ°åŸŸå±æ€§ | ... | å¦ |
| 5 | `second_level_organization` | String | äºŒçº§æœºæ„ | ... | **æ˜¯** |
```

**é—®é¢˜**:
- âœ… ç¬¬5åˆ— `second_level_organization` å·²æ­£ç¡®æ ‡æ³¨
- âš ï¸ ç¬¬48åˆ— `premium_plan_yuan` çš„"å¯å¦ä¸ºç©º"åˆ—åº”æ ‡è®°ä¸º**"æ˜¯"**(å¯é€‰)

**å»ºè®®**:
åœ¨è¡¨æ ¼ç¬¬25è¡Œæ›´æ–°:
```diff
- | 25 | `premium_plan_yuan` | Number | ä¿è´¹è®¡åˆ’ | `2958.49` | æ˜¯ |
+ | 25 | `premium_plan_yuan` | Number | ä¿è´¹è®¡åˆ’ | `2958.49` | **æ˜¯ï¼ˆå¯é€‰ï¼‰** |
```

---

#### 1.3 ç¼“å­˜é”®è®¾è®¡æè¿°

**æ–‡æ¡£æ›´æ–°** (2025-01-12):
> å·²æ–°å¢"ç¼“å­˜é”®è®¾è®¡ç¼ºé™·ä¿®å¤"ç« èŠ‚

**å®é™…ä»£ç ** (`src/store/domains/cacheStore.ts`):
- âœ… æ–‡æ¡£æè¿°çš„å“ˆå¸Œç­–ç•¥å·²å®ç°
- âœ… ç¼“å­˜é”®æ ¼å¼ `inc_{å¹´ä»½}w{å‘¨æ¬¡}_{æ•°æ®å“ˆå¸Œ}_{å¹´ä»½}w{å‘¨æ¬¡}_{æ•°æ®å“ˆå¸Œ}_t{ç›®æ ‡}` å·²é‡‡ç”¨

**ä¸€è‡´æ€§**: âœ… **å®Œå…¨ä¸€è‡´**

---

### 2. æ ¸å¿ƒè®¡ç®—é€»è¾‘å·®å¼‚ (core_calculations.md)

#### 2.1 KPIæ•°é‡ä¸åŒ¹é…

**æ–‡æ¡£å£°ç§°** (core_calculations.md):
> æœ¬æ–‡ä»¶å®šä¹‰äº†å¹³å°æœ€ç»ˆç¡®å®šçš„**16ä¸ªæ ¸å¿ƒKPI**çš„è®¡ç®—å…¬å¼

**å®é™…ä»£ç ** (`src/domain/rules/kpi-calculator.ts` + `src/types/insurance.ts`):

```typescript
export interface KPIResult {
  // ç‡å€¼æŒ‡æ ‡ï¼ˆ10ä¸ªï¼‰
  lossRatio: number | null                              // 1. æ»¡æœŸèµ”ä»˜ç‡ âœ…
  expenseRatio: number | null                           // 2. è´¹ç”¨ç‡ âœ…
  maturityRatio: number | null                          // 3. æ»¡æœŸç‡ âœ…
  contributionMarginRatio: number | null                // 4. æ»¡æœŸè¾¹é™…è´¡çŒ®ç‡ âœ…
  variableCostRatio: number | null                      // 5. å˜åŠ¨æˆæœ¬ç‡ âœ…
  maturedClaimRatio: number | null                      // 6. æ»¡æœŸå‡ºé™©ç‡ âœ…
  autonomyCoefficient: number | null                    // 7. å•†ä¸šé™©è‡ªä¸»ç³»æ•° âœ…
  premiumProgress: number | null                        // 8. ä¿è´¹è¾¾æˆç‡ âœ…
  premiumTimeProgressAchievementRate: number | null     // 9. ä¿è´¹æ—¶é—´è¿›åº¦è¾¾æˆç‡ âœ…
  policyCountTimeProgressAchievementRate: number | null // 10. ä»¶æ•°æ—¶é—´è¿›åº¦è¾¾æˆç‡ âŒ æ–‡æ¡£æœªè®°å½•

  // ç»å¯¹å€¼æŒ‡æ ‡ï¼ˆ7ä¸ªï¼‰
  signedPremium: number              // 11. ç­¾å•ä¿è´¹ âœ…
  maturedPremium: number             // 12. æ»¡æœŸä¿è´¹ âœ…
  policyCount: number                // 13. ä¿å•ä»¶æ•° âœ…
  claimCaseCount: number             // 14. èµ”æ¡ˆä»¶æ•° âœ…
  reportedClaimPayment: number       // 15. å·²æŠ¥å‘Šèµ”æ¬¾ âœ…
  expenseAmount: number              // 16. è´¹ç”¨é‡‘é¢ âœ…
  contributionMarginAmount: number   // 17. è¾¹é™…è´¡çŒ®é¢ âœ…

  // å‡å€¼æŒ‡æ ‡ï¼ˆ4ä¸ªï¼‰
  averagePremium: number | null       // 18. å•å‡ä¿è´¹ âœ…
  averageClaim: number | null         // 19. æ¡ˆå‡èµ”æ¬¾ âœ…
  averageExpense: number | null       // 20. å•å‡è´¹ç”¨ âœ…
  averageContribution: number | null  // 21. å•å‡è¾¹è´¡é¢ âŒ æ–‡æ¡£æœªæ˜ç¡®åˆ—å‡º

  // ç›®æ ‡æŒ‡æ ‡ï¼ˆ2ä¸ªï¼‰- æ–‡æ¡£æœªæåŠ
  annualPremiumTarget: number | null         // âŒ å¹´åº¦ä¿è´¹ç›®æ ‡
  annualPolicyCountTarget: number | null     // âŒ å¹´åº¦ä»¶æ•°ç›®æ ‡
}
```

**å·®å¼‚ç»Ÿè®¡**:
- ğŸ“Š **æ–‡æ¡£åˆ—å‡º**: 16ä¸ªKPI
- ğŸ’» **ä»£ç å®ç°**: 23ä¸ªå­—æ®µï¼ˆåŒ…å«ç›®æ ‡å­—æ®µï¼‰
- âŒ **æ–‡æ¡£ç¼ºå¤±**:
  1. `policyCountTimeProgressAchievementRate` (ä»¶æ•°æ—¶é—´è¿›åº¦è¾¾æˆç‡)
  2. `averageContribution` (å•å‡è¾¹è´¡é¢ - è™½åœ¨"è¾¹è´¡ä¸“é¢˜"æåŠ,ä½†æœªåœ¨16KPIæ¸…å•ä¸­)
  3. `annualPremiumTarget` (å¹´åº¦ä¿è´¹ç›®æ ‡)
  4. `annualPolicyCountTarget` (å¹´åº¦ä»¶æ•°ç›®æ ‡)

**å»ºè®®ä¿®æ­£**:

æ–‡æ¡£åº”æ˜ç¡®è¯´æ˜:
```markdown
## 2. KPIå®Œæ•´æ¸…å•

### æ ¸å¿ƒå±•ç¤ºKPIï¼ˆ4x4ç½‘æ ¼ = 16ä¸ªï¼‰
ã€ä¿ç•™ç°æœ‰16ä¸ªKPIè¡¨æ ¼ã€‘

### è¾…åŠ©è®¡ç®—å­—æ®µï¼ˆ7ä¸ªï¼Œä¸ç›´æ¥å±•ç¤ºä½†ç”¨äºè®¡ç®—ï¼‰
| å­—æ®µå | è¯´æ˜ | ç”¨é€” |
|--------|------|------|
| `policyCountTimeProgressAchievementRate` | ä»¶æ•°æ—¶é—´è¿›åº¦è¾¾æˆç‡ | ä¿å•ä»¶æ•°è¾¾æˆåº¦åˆ†æ |
| `averageContribution` | å•å‡è¾¹è´¡é¢ | å•å‡è¾¹é™…è´¡çŒ®è®¡ç®— |
| `annualPremiumTarget` | å¹´åº¦ä¿è´¹ç›®æ ‡ | è®¡ç®—ä¿è´¹è¾¾æˆç‡çš„åŸºå‡† |
| `annualPolicyCountTarget` | å¹´åº¦ä»¶æ•°ç›®æ ‡ | è®¡ç®—ä»¶æ•°è¾¾æˆç‡çš„åŸºå‡† |
| `loss_ratio` | æ»¡æœŸèµ”ä»˜ç‡ï¼ˆsnake_caseåˆ«åï¼‰ | å…¼å®¹æ—§ç‰ˆæœ¬ |
| `expense_ratio` | è´¹ç”¨ç‡ï¼ˆsnake_caseåˆ«åï¼‰ | å…¼å®¹æ—§ç‰ˆæœ¬ |
| ... | ï¼ˆå…¶ä»–snake_caseå­—æ®µï¼‰ | æ•°æ®åº“å…¼å®¹ |
```

---

#### 2.2 å‘½åçº¦å®šä¸ä¸€è‡´

**é—®é¢˜**: æ–‡æ¡£ä½¿ç”¨**ä¸­æ–‡åç§°**,ä»£ç ä½¿ç”¨**camelCaseè‹±æ–‡**

| æ–‡æ¡£åç§° | ä»£ç å­—æ®µå | ä¸€è‡´æ€§ |
|---------|-----------|-------|
| æ»¡æœŸèµ”ä»˜ç‡ | `lossRatio` / `loss_ratio` | âš ï¸ åŒå‘½å |
| æ»¡æœŸè¾¹é™…è´¡çŒ®ç‡ | `contributionMarginRatio` / `contribution_margin_ratio` | âš ï¸ åŒå‘½å |
| ä¿è´¹æ—¶é—´è¿›åº¦è¾¾æˆç‡ | `premiumTimeProgressAchievementRate` / `premium_time_progress_achievement_rate` | âš ï¸ åŒå‘½å |

**å®é™…ä»£ç ä¸­å­˜åœ¨ä¸¤å¥—å‘½å**:
1. **Domainå±‚** (`src/domain/rules/kpi-calculator.ts`): ä½¿ç”¨ `camelCase`
2. **Typeså±‚** (`src/types/insurance.ts`): ä½¿ç”¨ `snake_case`

**ä»£ç ç¤ºä¾‹**:
```typescript
// src/domain/rules/kpi-calculator.ts (Domainå±‚)
export interface KPIResult {
  lossRatio: number | null
  contributionMarginRatio: number | null
}

// src/types/insurance.ts (Typeså±‚)
export interface KPIResult {
  loss_ratio: number | null
  contribution_margin_ratio: number | null
}
```

**é—®é¢˜**:
- ä¸¤ä¸ª `KPIResult` æ¥å£å®šä¹‰ä¸ä¸€è‡´
- é€ æˆç±»å‹æ··ä¹±å’Œè½¬æ¢æˆæœ¬

**å»ºè®®**:
1. **ç»Ÿä¸€é‡‡ç”¨snake_case** (ä¸æ•°æ®åº“å­—æ®µå¯¹é½)
2. æˆ–åœ¨æ–‡æ¡£ä¸­æ˜ç¡®è¯´æ˜ä¸¤å¥—å‘½åçš„ä½¿ç”¨åœºæ™¯:
   ```markdown
   ## å‘½åçº¦å®š

   ç³»ç»Ÿä½¿ç”¨åŒå‘½åä½“ç³»:
   - **Domainå±‚è®¡ç®—**: `camelCase` (TypeScriptæƒ¯ä¾‹)
   - **æ•°æ®åº“/APIå±‚**: `snake_case` (SQL/Pythonæƒ¯ä¾‹)
   - **è‡ªåŠ¨è½¬æ¢**: é€šè¿‡ç±»å‹æ˜ å°„å®ç°äº’è½¬
   ```

---

#### 2.3 è®¡ç®—å…¬å¼ä¸€è‡´æ€§ âœ…

**æŠ½æ£€éªŒè¯**:

| KPI | æ–‡æ¡£å…¬å¼ | ä»£ç å®ç° | ä¸€è‡´æ€§ |
|-----|---------|---------|-------|
| æ»¡æœŸèµ”ä»˜ç‡ | `æ»¡æœŸèµ”ä»˜ / æ»¡æœŸä¿è´¹` | `safeDivide(reportedClaimPaymentYuan, maturedPremiumYuan)` | âœ… ä¸€è‡´ |
| è´¹ç”¨ç‡ | `æ€»è´¹ç”¨ / ç­¾å•ä¿è´¹` | `safeDivide(expenseAmountYuan, signedPremiumYuan)` | âœ… ä¸€è‡´ |
| å˜åŠ¨æˆæœ¬ç‡ | `æ»¡æœŸèµ”ä»˜ç‡ + è´¹ç”¨ç‡` | `lossRatio + expenseRatio` | âœ… ä¸€è‡´ |
| æ»¡æœŸè¾¹è´¡ç‡ | `100% - å˜åŠ¨æˆæœ¬ç‡` | `1 - variableCostRatio` (è½¬ç™¾åˆ†æ¯”åä¸€è‡´) | âœ… ä¸€è‡´ |
| ä¿è´¹æ—¶é—´è¿›åº¦è¾¾æˆç‡ | `(ä¿è´¹è¾¾æˆç‡ / æ—¶é—´è¿›åº¦) Ã— 100%` | `safeDivide(premiumProgress, timeProgress)` | âœ… ä¸€è‡´ |

**ç»“è®º**: âœ… **æ ¸å¿ƒå…¬å¼å®Œå…¨ä¸€è‡´**

---

### 3. æŠ€æœ¯æ ˆå·®å¼‚ (tech_stack.md)

#### 3.1 æ•°æ®åº“æŠ€æœ¯æ ˆ

**æ–‡æ¡£å£°ç§°**:
```markdown
- **åç«¯**: Node.js
  - **æ•°æ®åº“ ORM**: Prisma
- **æ•°æ®åº“**: Supabase (PostgreSQL)
```

**å®é™…ä»£ç å®ç°**:

1. **Prisma**: âŒ **æœªå®é™…ä½¿ç”¨**
   - `prisma/` ç›®å½•ä¸å­˜åœ¨
   - `schema.prisma` æ–‡ä»¶ä¸å­˜åœ¨
   - `package.json` ä¸­æœ‰ `@prisma/client` ä¾èµ–,ä½†æœªé…ç½®

2. **Supabase**: âš ï¸ **å¯é€‰é›†æˆ**
   - `src/lib/supabase/client.ts` å­˜åœ¨
   - ä»…åœ¨é…ç½®å¼€å¯æ—¶ä½¿ç”¨
   - é»˜è®¤é‡‡ç”¨å®¢æˆ·ç«¯å­˜å‚¨

3. **å®é™…å­˜å‚¨æ–¹æ¡ˆ**:
   ```
   âœ… IndexedDB (ä¸»è¦å­˜å‚¨)
   âœ… LocalStorage (å¤‡ç”¨å­˜å‚¨)
   âœ… DuckDB-WASM (å†…å­˜æŸ¥è¯¢å¼•æ“) â† æ–‡æ¡£å®Œå…¨æœªæåŠ
   âš ï¸ Supabase (å¯é€‰è¿œç¨‹å­˜å‚¨)
   ```

**è¯æ®**:
```typescript
// src/lib/database/duckdb-adapter.ts (236è¡Œä»£ç )
export class DuckDBAdapter implements IDatabaseAdapter {
  // å®Œæ•´çš„DuckDB WASMé›†æˆ
}

// package.json
{
  "dependencies": {
    "@duckdb/duckdb-wasm": "^1.30.0" âœ… å·²å®‰è£…
  }
}
```

**å»ºè®®æ›´æ–°**:
```diff
- **æ•°æ®åº“ ORM**: Prisma
+ **æ•°æ®åº“ ORM**: æ— ï¼ˆçº¯å®¢æˆ·ç«¯å­˜å‚¨ï¼‰

- **æ•°æ®åº“**: Supabase (PostgreSQL)
+ **æ•°æ®å­˜å‚¨**:
+   - **ä¸»è¦**: IndexedDB + LocalStorage (å®¢æˆ·ç«¯å­˜å‚¨)
+   - **æŸ¥è¯¢å¼•æ“**: DuckDB-WASM (å†…å­˜åˆ—å¼æ•°æ®åº“)
+   - **å¯é€‰**: Supabase PostgreSQL (è¿œç¨‹å¤‡ä»½)
```

---

#### 3.2 å›¾è¡¨åº“

**æ–‡æ¡£å£°ç§°**:
```markdown
- **å›¾è¡¨**: Recharts
```

**å®é™…ä»£ç **:
```json
// package.json
{
  "dependencies": {
    "recharts": "^3.3.0",     // âœ… å·²å®‰è£…
    "echarts": "^6.0.0",       // âŒ æ–‡æ¡£æœªæåŠ
    "echarts-for-react": "^3.0.2" // âŒ æ–‡æ¡£æœªæåŠ
  }
}
```

**å®é™…ä½¿ç”¨æƒ…å†µ**:
- `src/components/features/trend-chart/` â†’ ä½¿ç”¨ **Recharts** âœ…
- `src/lib/charts/options/` â†’ ä½¿ç”¨ **ECharts** âŒ æœªè®°å½•
- `src/components/features/multi-dimension-radar.tsx` â†’ ä½¿ç”¨ **ECharts** âŒ æœªè®°å½•

**å»ºè®®**:
```diff
- **å›¾è¡¨**: Recharts
+ **å›¾è¡¨**:
+   - **ä¸»è¦**: Recharts 3.3.0 (ReactåŸç”Ÿå›¾è¡¨)
+   - **é«˜çº§**: ECharts 6.0.0 (å¤æ‚å¯è§†åŒ–ã€é›·è¾¾å›¾ã€çƒ­åŠ›å›¾)
```

---

#### 3.3 æ–°å¢ä¾èµ–ç¼ºå¤±è®°å½•

**æ–‡æ¡£æœªè®°å½•ä½†å·²ä½¿ç”¨çš„å…³é”®åº“**:

| åº“å | ç‰ˆæœ¬ | ç”¨é€” | ä»£ç ä½ç½® |
|------|------|------|---------|
| `jspdf` | 3.0.3 | PDFç”Ÿæˆ | `src/lib/export/pdf-exporter.ts` |
| `html2canvas` | 1.4.1 | HTMLè½¬å›¾ç‰‡ | `src/lib/export/pdf-exporter.ts` |
| `@duckdb/duckdb-wasm` | 1.30.0 | å†…å­˜æ•°æ®åº“ | `src/lib/database/duckdb-adapter.ts` |
| `zustand` | 5.0.8 | çŠ¶æ€ç®¡ç† | âœ… æ–‡æ¡£å·²è®°å½• |

**å»ºè®®**: åœ¨ `tech_stack.md` çš„"å…³é”®ç¬¬ä¸‰æ–¹åº“"ç« èŠ‚è¡¥å……ä¸Šè¿°ä¾èµ–

---

### 4. åŠŸèƒ½å®ç°çŠ¶æ€å·®å¼‚

#### 4.1 F001 æ•°æ®ä¸Šä¼ ä¸è§£ææ¨¡å—

**æ–‡æ¡£å£°ç§°**:
- âœ… å®Œæ•´åº¦: 95%
- ğŸš§ æ‰¹é‡å¯¼å…¥: æ”¯æŒå¹¶è¡Œå¤„ç†å¤šä¸ªæ–‡ä»¶ä¸Šä¼ 

**å®é™…ä»£ç éªŒè¯**:
```typescript
// src/components/features/file-upload.tsx
// âŒ æœªå‘ç°å¹¶è¡Œä¸Šä¼ é€»è¾‘
// âœ… ä»…æ”¯æŒå•æ–‡ä»¶ä¸Šä¼ å’Œè¿½åŠ ä¸Šä¼ 
```

**å»ºè®®**:
```diff
- ğŸš§ **æ‰¹é‡å¯¼å…¥**: æ”¯æŒå¹¶è¡Œå¤„ç†å¤šä¸ªæ–‡ä»¶ä¸Šä¼ ã€‚
+ â³ **æ‰¹é‡å¯¼å…¥**: æ¡†æ¶è®¾è®¡å®Œæˆ,å¹¶è¡Œå¤„ç†é€»è¾‘å¾…å®ç°(indicator: batch_upload)
```

---

#### 4.2 F002 KPIçœ‹æ¿æ¨¡å—

**æ–‡æ¡£å£°ç§°**:
- âœ… å®Œæ•´åº¦: 100%
- âœ… **å…¬å¼è¯¦æƒ…å±•ç¤º**: æ‚¬æµ®æç¤ºæ˜¾ç¤ºå®Œæ•´çš„è®¡ç®—å…¬å¼

**å®é™…ä»£ç éªŒè¯**:
```typescript
// src/components/features/kpi-dashboard.tsx
// âœ… Tooltipç»„ä»¶å­˜åœ¨
// âš ï¸ ä½†å…¬å¼è¯¦æƒ…å†…å®¹ç¡¬ç¼–ç ,æœªä»ç»Ÿä¸€çš„å…¬å¼å®šä¹‰æ–‡ä»¶è¯»å–
```

**å»ºè®®**:
- å°†å…¬å¼è¯¦æƒ…è¿ç§»è‡³ `src/lib/calculations/kpi-formulas.ts`
- KPIå¡ç‰‡åŠ¨æ€è¯»å–,é¿å…ç¡¬ç¼–ç 

---

#### 4.3 æœªæ–‡æ¡£åŒ–çš„åŠŸèƒ½

**å·²å®ç°ä½†æ–‡æ¡£æœªè®°å½•çš„åŠŸèƒ½**:

1. **F011 å‘¨åº¦è¿è¥è¶‹åŠ¿** âœ…
   - ä»£ç : `src/components/features/weekly-operational-trend/`
   - æ–‡æ¡£: å­˜åœ¨ `å¼€å‘æ–‡æ¡£/01_features/F011_weekly_operational_trend/README.md`
   - çŠ¶æ€: âœ… å·²è®°å½•

2. **F012 æ•°æ®æºé€‰æ‹©** âœ…
   - ä»£ç : `src/config/features.ts` ä¸­çš„ `dataSource` é…ç½®
   - æ–‡æ¡£: å­˜åœ¨ `å¼€å‘æ–‡æ¡£/01_features/F012_data_source_selection/README.md`
   - çŠ¶æ€: âœ… å·²è®°å½•

3. **F013 ä¿è´¹èµ”æ¬¾æŸ±çŠ¶å›¾** âœ…
   - ä»£ç : `src/components/features/claim-analysis-bar-chart.tsx`
   - æ–‡æ¡£: å­˜åœ¨ `å¼€å‘æ–‡æ¡£/01_features/F013_premium_claim_bar_charts/README.md`
   - çŠ¶æ€: âœ… å·²è®°å½•

4. **F014 å¤šå›¾è¡¨æ ‡ç­¾é¡µ** âœ…
   - ä»£ç : `src/components/features/multi-chart-tabs.tsx`
   - æ–‡æ¡£: å­˜åœ¨ `å¼€å‘æ–‡æ¡£/01_features/F014_multi_chart_tabs/README.md`
   - çŠ¶æ€: âœ… å·²è®°å½•

**ç»“è®º**: âœ… **ä¸»è¦åŠŸèƒ½æ–‡æ¡£è¦†ç›–å®Œæ•´**

---

### 5. APIç«¯ç‚¹å·®å¼‚

#### 5.1 å·²å®ç°ä½†æ–‡æ¡£æè¿°ä¸å®Œæ•´

**æ–‡æ¡£è®°å½•** (`tech_stack.md`):
> æœªè¯¦ç»†è¯´æ˜APIç«¯ç‚¹

**å®é™…ä»£ç **:
```typescript
// src/app/api/ingest-file/route.ts
export async function POST(request: Request) {
  // âš ï¸ æ¡†æ¶å®Œæˆä½†æœªè¿æ¥DataService
}

// src/app/api/etl/route.ts
export async function POST(request: Request) {
  // âš ï¸ æ¡†æ¶å®Œæˆä½†DuckDBå¤„ç†é€»è¾‘æœªå®ç°
}
```

**å»ºè®®**: åœ¨æ–‡æ¡£ä¸­æ–°å¢"APIè®¾è®¡"ç« èŠ‚:
```markdown
## APIç«¯ç‚¹

### POST /api/ingest-file
- **çŠ¶æ€**: ğŸš§ æ¡†æ¶å®Œæˆ,ä¸šåŠ¡é€»è¾‘å¾…å®ç°
- **ç”¨é€”**: æ¥æ”¶å‰ç«¯ä¸Šä¼ çš„å·²è§£ææ•°æ®å¹¶æŒä¹…åŒ–
- **è¯·æ±‚ä½“**: `{ data: InsuranceRecord[] }`
- **å“åº”**: `{ message: string, processedRecords: number }`

### POST /api/etl
- **çŠ¶æ€**: ğŸš§ æ¡†æ¶å®Œæˆ,DuckDBé›†æˆå¾…å®Œæˆ
- **ç”¨é€”**: æ‰¹é‡ETLå¤„ç†å¤šä¸ªCSVæ–‡ä»¶
- **è¯·æ±‚**: `multipart/form-data`
- **å“åº”**: `{ success: boolean, downloadUrl: string }`
```

---

### 6. å­˜å‚¨å±‚å®ç°å·®å¼‚

#### 6.1 æ–‡æ¡£æœªç³»ç»ŸåŒ–è¯´æ˜çš„å­˜å‚¨æ–¹æ¡ˆ

**æ–‡æ¡£è®°å½•** (`tech_stack.md`):
```markdown
### LocalStorage å­˜å‚¨ç­–ç•¥
- **å­˜å‚¨å¼•æ“**: æµè§ˆå™¨åŸç”Ÿ LocalStorage API
```

**å®é™…ä»£ç å®ç°çš„å­˜å‚¨å±‚çº§**:
```
1. IndexedDB / LocalStorage æŒä¹…åŒ–å±‚
   â””â”€ src/lib/storage/
       â”œâ”€ indexed-db.ts âœ…
       â”œâ”€ local-storage.ts âœ…
       â””â”€ data-persistence.ts âœ…

2. DuckDB-WASM å†…å­˜æ•°æ®åº“å±‚ âŒ æ–‡æ¡£å®Œå…¨æœªæåŠ
   â””â”€ src/lib/database/
       â”œâ”€ duckdb-adapter.ts (236è¡Œ) âœ…
       â”œâ”€ indexeddb-adapter.ts âœ…
       â””â”€ adapter.ts âœ…

3. Supabase PostgreSQL âš ï¸ å¯é€‰
   â””â”€ src/lib/supabase/client.ts âœ…
```

**å»ºè®®**: åœ¨ `tech_stack.md` è¡¥å……å®Œæ•´çš„å­˜å‚¨æ¶æ„è¯´æ˜

---

### 7. å‘½åçº¦å®šé—®é¢˜

#### 7.1 æ–‡ä»¶åä¸ä¸€è‡´

**é—®é¢˜**: `data_architecture 2.md` å­˜åœ¨

```bash
å¼€å‘æ–‡æ¡£/03_technical_design/
â”œâ”€ data_architecture.md âœ… æ­£å¼ç‰ˆæœ¬
â”œâ”€ data_architecture 2.md âŒ é‡å¤æ–‡ä»¶
```

**å»ºè®®**: åˆ é™¤ `data_architecture 2.md` æˆ–ç§»è‡³ `archive/`

---

## ğŸ“‹ ä¼˜å…ˆçº§ä¿®æ­£æ¸…å•

### P0 - ç«‹å³ä¿®æ­£ï¼ˆå½±å“æ ¸å¿ƒç†è§£ï¼‰

1. âœ… **æ›´æ–° core_calculations.md**
   - [ ] æ˜ç¡®è¯´æ˜å®é™…æœ‰23ä¸ªKPIå­—æ®µï¼ˆ16ä¸ªå±•ç¤º + 7ä¸ªè¾…åŠ©ï¼‰
   - [ ] è¡¥å…… `policyCountTimeProgressAchievementRate` ç­‰ç¼ºå¤±æŒ‡æ ‡
   - [ ] æ·»åŠ "å‘½åçº¦å®š"ç« èŠ‚,è¯´æ˜camelCase vs snake_case

2. âœ… **æ›´æ–° tech_stack.md**
   - [ ] ç§»é™¤Prismaæè¿°ï¼ˆæœªå®é™…ä½¿ç”¨ï¼‰
   - [ ] è¡¥å……DuckDB-WASMï¼ˆæ ¸å¿ƒæŸ¥è¯¢å¼•æ“ï¼‰
   - [ ] è¡¥å……EChartsã€jsPDFã€html2canvas

3. âœ… **æ›´æ–° data_architecture.md**
   - [ ] ä¿®æ­£å¯é€‰å­—æ®µæ•°é‡æè¿°ï¼ˆ2ä¸ªå¯é€‰,é1ä¸ªï¼‰
   - [ ] åˆ é™¤é‡å¤æ–‡ä»¶ `data_architecture 2.md`

---

### P1 - é‡è¦ä¿®æ­£ï¼ˆå½±å“åŠŸèƒ½ç†è§£ï¼‰

4. âœ… **è¡¥å……APIè®¾è®¡æ–‡æ¡£**
   - [ ] æ–°å¢"APIç«¯ç‚¹"ç« èŠ‚åˆ° `tech_stack.md`
   - [ ] è¯´æ˜ `/api/ingest-file` å’Œ `/api/etl` çš„çŠ¶æ€å’Œè®¾è®¡

5. âœ… **æ›´æ–°åŠŸèƒ½çŠ¶æ€**
   - [ ] F001æ‰¹é‡å¯¼å…¥åŠŸèƒ½æ ‡è®°ä¸º"å¾…å®ç°"
   - [ ] è¡¥å……å­˜å‚¨æ¶æ„çš„å®Œæ•´è¯´æ˜

---

### P2 - å»ºè®®ä¿®æ­£ï¼ˆæ”¹å–„æ–‡æ¡£è´¨é‡ï¼‰

6. âœ… **ç»Ÿä¸€å‘½åè§„èŒƒ**
   - [ ] åœ¨æ‰€æœ‰æ–‡æ¡£ä¸­ç»Ÿä¸€ä½¿ç”¨snake_caseæˆ–camelCase
   - [ ] æ·»åŠ å‘½åå¯¹ç…§è¡¨

7. âœ… **è¡¥å……ç¼ºå¤±çš„åº“æ–‡æ¡£**
   - [ ] åœ¨"å…³é”®ç¬¬ä¸‰æ–¹åº“"ç« èŠ‚è¡¥å……jsPDFç­‰

---

## ğŸ¯ å»ºè®®çš„æ–‡æ¡£æ›´æ–°æ­¥éª¤

### ç¬¬1æ­¥: ä¿®æ­£æ ¸å¿ƒæŠ€æœ¯æ–‡æ¡£

```bash
# 1. æ›´æ–°æ ¸å¿ƒè®¡ç®—æ–‡æ¡£
nano å¼€å‘æ–‡æ¡£/03_technical_design/core_calculations.md
# æ·»åŠ "å®Œæ•´KPIæ¸…å•ï¼ˆ23ä¸ªå­—æ®µï¼‰"ç« èŠ‚
# æ·»åŠ "å‘½åçº¦å®š"ç« èŠ‚

# 2. æ›´æ–°æŠ€æœ¯æ ˆæ–‡æ¡£
nano å¼€å‘æ–‡æ¡£/03_technical_design/tech_stack.md
# ç§»é™¤Prisma
# è¡¥å……DuckDBã€EChartsã€PDFåº“
# æ·»åŠ "APIç«¯ç‚¹"ç« èŠ‚
# æ·»åŠ "å®Œæ•´å­˜å‚¨æ¶æ„"ç« èŠ‚

# 3. æ›´æ–°æ•°æ®æ¶æ„æ–‡æ¡£
nano å¼€å‘æ–‡æ¡£/03_technical_design/data_architecture.md
# ä¿®æ­£å¯é€‰å­—æ®µæè¿°
```

---

### ç¬¬2æ­¥: æ›´æ–°åŠŸèƒ½æ–‡æ¡£

```bash
# æ›´æ–°F001åŠŸèƒ½çŠ¶æ€
nano å¼€å‘æ–‡æ¡£/01_features/F001_data_import/README.md
# å°†æ‰¹é‡å¯¼å…¥æ ‡è®°ä¸º"æ¡†æ¶å®Œæˆ,é€»è¾‘å¾…å®ç°"
```

---

### ç¬¬3æ­¥: æ¸…ç†é‡å¤æ–‡ä»¶

```bash
# åˆ é™¤æˆ–å½’æ¡£é‡å¤æ–‡ä»¶
mv "å¼€å‘æ–‡æ¡£/03_technical_design/data_architecture 2.md" "å¼€å‘æ–‡æ¡£/archive/"
```

---

### ç¬¬4æ­¥: éªŒè¯ä¸€è‡´æ€§

```bash
# è¿è¡Œä»£ç åˆ†æå·¥å…·ï¼ˆå¦‚æœ‰ï¼‰
node analyze-codebase.js

# äººå·¥æ ¸å¯¹å…³é”®æŒ‡æ ‡
grep -r "KPIResult" src/
```

---

## ğŸ“ é™„å½•: å®Œæ•´KPIå­—æ®µå¯¹ç…§è¡¨

| åºå· | æ–‡æ¡£ä¸­æ–‡åç§° | Domainå±‚(camelCase) | Typeså±‚(snake_case) | 4x4ç½‘æ ¼å±•ç¤º |
|------|-------------|---------------------|---------------------|------------|
| 1 | æ»¡æœŸè¾¹é™…è´¡çŒ®ç‡ | contributionMarginRatio | contribution_margin_ratio | âœ… ç¬¬1è¡Œç¬¬1åˆ— |
| 2 | ä¿è´¹æ—¶é—´è¿›åº¦è¾¾æˆç‡ | premiumTimeProgressAchievementRate | premium_time_progress_achievement_rate | âœ… ç¬¬1è¡Œç¬¬2åˆ— |
| 3 | æ»¡æœŸèµ”ä»˜ç‡ | lossRatio | loss_ratio | âœ… ç¬¬1è¡Œç¬¬3åˆ— |
| 4 | è´¹ç”¨ç‡ | expenseRatio | expense_ratio | âœ… ç¬¬1è¡Œç¬¬4åˆ— |
| 5 | æ»¡æœŸè¾¹é™…è´¡çŒ®é¢ | contributionMarginAmount | contribution_margin_amount | âœ… ç¬¬2è¡Œç¬¬1åˆ— |
| 6 | ç­¾å•ä¿è´¹ | signedPremium | signed_premium | âœ… ç¬¬2è¡Œç¬¬2åˆ— |
| 7 | å·²æŠ¥å‘Šèµ”æ¬¾ | reportedClaimPayment | reported_claim_payment | âœ… ç¬¬2è¡Œç¬¬3åˆ— |
| 8 | è´¹ç”¨é¢ | expenseAmount | expense_amount | âœ… ç¬¬2è¡Œç¬¬4åˆ— |
| 9 | å˜åŠ¨æˆæœ¬ç‡ | variableCostRatio | variable_cost_ratio | âœ… ç¬¬3è¡Œç¬¬1åˆ— |
| 10 | æ»¡æœŸç‡ | maturityRatio | maturity_ratio | âœ… ç¬¬3è¡Œç¬¬2åˆ— |
| 11 | æ»¡æœŸå‡ºé™©ç‡ | maturedClaimRatio | matured_claim_ratio | âœ… ç¬¬3è¡Œç¬¬3åˆ— |
| 12 | ä¿å•ä»¶æ•° | policyCount | policy_count | âœ… ç¬¬3è¡Œç¬¬4åˆ— |
| 13 | èµ”æ¡ˆä»¶æ•° | claimCaseCount | claim_case_count | âœ… ç¬¬4è¡Œç¬¬1åˆ— |
| 14 | å•å‡ä¿è´¹ | averagePremium | average_premium | âœ… ç¬¬4è¡Œç¬¬2åˆ— |
| 15 | æ¡ˆå‡èµ”æ¬¾ | averageClaim | average_claim | âœ… ç¬¬4è¡Œç¬¬3åˆ— |
| 16 | å•å‡è´¹ç”¨ | averageExpense | average_expense | âœ… ç¬¬4è¡Œç¬¬4åˆ— |
| 17 | æ»¡æœŸä¿è´¹ | maturedPremium | matured_premium | âŒ ä¸ç›´æ¥å±•ç¤º |
| 18 | å•†ä¸šé™©è‡ªä¸»ç³»æ•° | autonomyCoefficient | autonomy_coefficient | âŒ ä¸ç›´æ¥å±•ç¤º |
| 19 | ä¿è´¹è¾¾æˆç‡ | premiumProgress | premium_progress | âŒ ç”¨äºè®¡ç®—æ—¶é—´è¿›åº¦ |
| 20 | ä»¶æ•°æ—¶é—´è¿›åº¦è¾¾æˆç‡ | policyCountTimeProgressAchievementRate | policy_count_time_progress_achievement_rate | âŒ æœªåœ¨æ–‡æ¡£åˆ—å‡º |
| 21 | å•å‡è¾¹è´¡é¢ | averageContribution | average_contribution | âŒ è¾¹è´¡ä¸“é¢˜ä½¿ç”¨ |
| 22 | å¹´åº¦ä¿è´¹ç›®æ ‡ | annualPremiumTarget | annual_premium_target | âŒ ç›®æ ‡ç®¡ç†å­—æ®µ |
| 23 | å¹´åº¦ä»¶æ•°ç›®æ ‡ | annualPolicyCountTarget | annual_policy_count_target | âŒ ç›®æ ‡ç®¡ç†å­—æ®µ |

---

## âœ… éªŒæ”¶æ ‡å‡†

æ–‡æ¡£ä¿®æ­£å®Œæˆå,åº”æ»¡è¶³:

1. âœ… **æŠ€æœ¯æ ˆæè¿°å‡†ç¡®**
   - ç§»é™¤æœªä½¿ç”¨çš„Prisma
   - è¡¥å……å®é™…ä½¿ç”¨çš„DuckDBã€ECharts

2. âœ… **KPIæ•°é‡å‡†ç¡®**
   - æ–‡æ¡£æ˜ç¡®è¯´æ˜16ä¸ªå±•ç¤ºKPI + 7ä¸ªè¾…åŠ©å­—æ®µ

3. âœ… **å‘½åçº¦å®šæ¸…æ™°**
   - è¯´æ˜camelCase vs snake_caseä½¿ç”¨åœºæ™¯

4. âœ… **åŠŸèƒ½çŠ¶æ€çœŸå®**
   - æ ‡è®°"æ¡†æ¶å®Œæˆä½†é€»è¾‘æœªå®ç°"çš„åŠŸèƒ½

5. âœ… **æ— é‡å¤æ–‡ä»¶**
   - æ¸…ç† `data_architecture 2.md` ç­‰é‡å¤å†…å®¹

---

## ğŸ“š å‚è€ƒèµ„æº

- [é¡¹ç›®æ ¹ç›®å½• CLAUDE.md](../../CLAUDE.md)
- [å¼€å‘æ–‡æ¡£ README](./README.md)
- [ä»£ç åˆ†ææŠ¥å‘Š](./codebase-analysis.json)ï¼ˆå¦‚æœ‰ï¼‰

---

*æœ¬æŠ¥å‘Šç”± Claude Code äº 2025-12-06 è‡ªåŠ¨ç”Ÿæˆ*
*åˆ†ææ–¹æ³•: ä»£ç æ‰«æ + æ–‡æ¡£é€é¡¹å¯¹æ¯”*
*ç½®ä¿¡åº¦: 95%*
