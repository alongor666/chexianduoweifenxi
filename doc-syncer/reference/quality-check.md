# 文档质量检查清单 (Quality Check)

> **作用**: 确保文档质量和一致性的自动化验证标准

**版本**: 2.1.0 (与 doc-syncer skill 同步)
**最后更新**: 2025-12-06
**状态**: ✅ 活跃使用
**关联文档**: [SKILL.md](../SKILL.md) - 文档同步智能助手

---

## 🎯 质量检查矩阵

### 维度一: 文档-代码一致性 (权重: 30%)

| 检查项 | 检查方法 | 通过标准 | 工具 |
|-------|---------|---------|------|
| 数据类型一致 | 比对 `types/*.ts` 与 `data_architecture.md` | 100%字段匹配 | Grep + Read |
| KPI公式一致 | 比对 `kpi-calculator.ts` 与 `core_calculations.md` | 所有公式有文档 | Grep + Read |
| 依赖版本一致 | 比对 `package.json` 与 `tech_stack.md` | 版本号完全匹配 | Grep + Read |
| API端点一致 | 比对 `src/app/api/` 与技术文档 | 所有端点有文档 | Glob + Grep |
| 组件Props一致 | 比对组件接口与功能文档 | Props描述准确 | Grep + Read |

**评分公式**:
```
一致性得分 = (匹配项数 / 总检查项数) × 100
```

---

### 维度二: 文档完整性 (权重: 25%)

| 检查项 | 必需内容 | 检查方法 |
|-------|---------|---------|
| 功能文档 (F001-F014) | ✅ 概述、技术实现、使用示例、测试要点 | 章节存在性检查 |
| 技术设计文档 | ✅ 版本号、最后更新日期、状态标识 | 元数据检查 |
| 决策记录 (ADR) | ✅ 背景、决策、后果、替代方案 | 章节存在性检查 |
| 代码示例 | ✅ 可运行、有注释、格式正确 | 语法验证 |
| 变更历史 | ✅ 版本号、日期、变更描述 | 格式检查 |

**必需章节模板**:
```markdown
功能文档必需章节:
- ## 概述
- ## 技术实现
- ## 使用示例
- ## 测试要点

技术设计文档必需元数据:
- 版本: X.Y
- 最后更新: YYYY-MM-DD
- 状态: ✅/📝/⚠️/🗄️
```

---

### 维度三: 链接完整性 (权重: 15%)

#### 内部链接检查

```bash
# 检查所有内部链接是否可访问
find 开发文档 -name "*.md" -exec grep -o '\[.*\](\..*\.md)' {} \; | while read link; do
  # 提取文件路径
  # 验证文件存在
  # 输出断链报告
done
```

| 链接类型 | 检查规则 | 修复建议 |
|---------|---------|---------|
| 相对路径链接 | 文件必须存在 | 更新路径或移除链接 |
| 锚点链接 | 目标章节必须存在 | 更新章节ID或移除链接 |
| 跨文档引用 | 目标文档必须活跃 | 检查doc-registry.md |

**断链容忍度**: 0% (所有链接必须有效)

---

### 维度四: 内容质量 (权重: 20%)

#### 术语一致性检查

| 术语类型 | 标准术语 | 禁用术语 | 检查方法 |
|---------|---------|---------|---------|
| 数据源 | "CSV文件" | "csv"、"文件" | Grep模糊匹配 |
| 状态管理 | "Zustand" | "全局状态"、"store" | 术语表对照 |
| 计算引擎 | "DuckDB-WASM" | "DuckDB"、"数据库" | 精确匹配 |
| KPI | "满期边际贡献率" | "MCR"、"贡献率" | 术语表对照 |

**术语表位置**: `开发文档/00_conventions.md`

#### 代码示例质量

```yaml
code_example_checklist:
  - 语法高亮正确: 使用 ```typescript 或 ```tsx
  - 导入语句完整: 包含所有必需的import
  - 类型注解清晰: TypeScript代码必须有类型
  - 注释充分: 复杂逻辑必须有中文注释
  - 可运行性: 复制粘贴即可运行（或明确标注伪代码）
```

---

### 维度五: 格式规范 (权重: 10%)

#### Markdown格式检查

| 规则 | 检查方法 | 示例 |
|------|---------|------|
| 标题层级连续 | 不允许从 # 直接跳到 ### | ✅ #→##→### ❌ #→### |
| 代码块语言标注 | 所有代码块必须指定语言 | ✅ ```typescript ❌ ``` |
| 表格格式完整 | 必须有表头分隔线 | `\|---\|---\|` |
| 列表缩进一致 | 2空格或4空格，全文统一 | 项目使用2空格 |
| 中文排版 | 中英文间加空格 | ✅ "使用 TypeScript" ❌ "使用TypeScript" |

**自动格式化工具**: Prettier Markdown插件

---

## 🔍 自动化检查流程

### 阶段1: 更新前检查 (Pre-Update Check)

```yaml
pre_update_checklist:
  - step: "读取目标文档"
    action: "获取当前版本号和结构"
    tool: Read
  
  - step: "验证修改必要性"
    action: "确认确实需要更新"
    tool: 人工判断
  
  - step: "检查依赖关系"
    action: "查询 doc-registry.md 找出相关文档"
    tool: Grep
  
  - step: "备份现有内容"
    action: "保存到变量或临时文件"
    tool: Read + 内存缓存
```

---

### 阶段2: 更新中验证 (During-Update Validation)

```yaml
during_update_validation:
  - check: "版本号递增"
    rule: "主版本号 (BREAKING) > 次版本号 (新增) > 修订号 (修复)"
    example: "2.0 → 3.0 (新增7个KPI字段)"
  
  - check: "更新日期标注"
    rule: "必须更新到当天日期 YYYY-MM-DD"
    example: "最后更新: 2025-12-06"
  
  - check: "保持现有结构"
    rule: "不破坏原有章节顺序和锚点"
    action: "使用 Edit 工具而非 Write"
  
  - check: "链接更新"
    rule: "如果文件路径变更，更新所有引用"
    tool: Grep查找引用
```

---

### 阶段3: 更新后验证 (Post-Update Verification)

```yaml
post_update_verification:
  - step: "重新读取文档"
    action: "确认修改已生效"
    tool: Read
  
  - step: "运行质量检查"
    action: "执行本清单所有检查项"
    tool: 自动化脚本
  
  - step: "生成验证报告"
    action: "输出质量得分和问题列表"
    format: "Markdown表格"
  
  - step: "更新doc-registry"
    action: "记录文档修改时间"
    tool: Edit doc-registry.md
```

---

## 📊 质量评分系统

### 综合得分计算

```
总分 = Σ (维度得分 × 权重)

其中:
- 一致性得分 × 30%
- 完整性得分 × 25%  
- 链接完整性得分 × 15%
- 内容质量得分 × 20%
- 格式规范得分 × 10%
```

### 评级标准

| 分数区间 | 评级 | 状态 | 行动 |
|---------|------|------|------|
| 90-100 | 优秀 ✅ | 现行标准 | 保持质量 |
| 75-89 | 良好 📝 | 需要优化 | 改进建议项 |
| 60-74 | 及格 ⚠️ | 建议重审 | 执行P1修复 |
| < 60 | 不及格 ❌ | 必须修复 | 执行P0修复 |

---

## 🚨 质量门禁 (Quality Gate)

### 强制要求 (不满足则拒绝合并)

- [ ] **P0**: 一致性得分 ≥ 80%
- [ ] **P0**: 零断链 (链接完整性 = 100%)
- [ ] **P0**: 版本号已递增
- [ ] **P0**: 更新日期已标注

### 建议要求 (警告但允许合并)

- [ ] **P1**: 完整性得分 ≥ 85%
- [ ] **P1**: 内容质量得分 ≥ 80%
- [ ] **P1**: 格式规范得分 ≥ 90%

---

## 🛠️ 实用检查命令

### 检查所有文档的版本号格式

```bash
grep -r "版本:" 开发文档/ --include="*.md" | grep -v "版本: [0-9]\+\.[0-9]\+"
# 输出不符合 X.Y 格式的版本号
```

### 检查所有代码块是否标注语言

```bash
grep -r "^\`\`\`$" 开发文档/ --include="*.md"
# 输出未标注语言的代码块
```

### 检查断链

```bash
find 开发文档 -name "*.md" -exec grep -H '\[.*\](\..*\.md)' {} \; | while IFS=: read file link; do
  target=$(echo "$link" | sed 's/.*(\(.*\))/\1/')
  if [ ! -f "$target" ]; then
    echo "断链: $file -> $target"
  fi
done
```

### 检查术语一致性

```bash
# 检查是否使用了禁用术语
grep -r "全局状态\|MCR\|数据库" 开发文档/03_technical_design/ --include="*.md"
```

---

## 📋 质量报告模板

```markdown
## 文档质量验证报告

**文档**: 开发文档/03_technical_design/core_calculations.md
**检查时间**: 2025-12-06
**版本**: 3.0

### 评分详情

| 维度 | 得分 | 权重 | 加权得分 |
|------|------|------|----------|
| 一致性 | 95/100 | 30% | 28.5 |
| 完整性 | 90/100 | 25% | 22.5 |
| 链接完整性 | 100/100 | 15% | 15.0 |
| 内容质量 | 88/100 | 20% | 17.6 |
| 格式规范 | 92/100 | 10% | 9.2 |
| **总分** | - | - | **92.8/100** ✅ |

### 发现的问题

**P0 - 必须修复**:
- 无

**P1 - 建议修复**:
- [ ] 补充第5.3节的代码示例
- [ ] 统一"满期边际贡献率"术语（部分使用了"MCR"）

**P2 - 可选优化**:
- [ ] 添加更多图表说明
- [ ] 补充历史版本对比

### 质量门禁结果

✅ **通过** - 所有P0要求已满足

---

*自动生成于 2025-12-06*
```

---

## 🔄 持续改进

### 每月质量审计

- **时间**: 每月1日
- **范围**: 所有活跃文档（参考doc-registry.md）
- **输出**: 质量趋势报告

### 质量指标追踪

```yaml
quality_metrics:
  - metric: "平均一致性得分"
    target: "> 90%"
    frequency: "每周"
  
  - metric: "断链数量"
    target: "= 0"
    frequency: "每次更新后"
  
  - metric: "过时文档数量"
    target: "< 5个"
    frequency: "每月"
```

---

*此清单由 doc-syncer skill 使用*
*最后更新: 2025-12-06*
