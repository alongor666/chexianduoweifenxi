# 代码质量修复指南

本指南用于统一「修复代码质量问题」的准则与流程，避免出现为了通过检查而破坏真实语义的“规避式修复”。

## 核心原则（必须遵守）

### 1. 变量声明与使用一致性

- 规则：变量/函数在声明处的名称必须与使用处完全一致
- 反例：声明 `const _data = xxx`，使用 `data.map()`
- 正例：声明 `const data = xxx`，使用 `data.map()`

### 2. 禁止规避式修复

- 规则：不得为通过某项检查而破坏代码真实语义
- 反例：为消除 `no-unused-vars` 而给实际使用的变量加 `_` 前缀
- 正例：未使用则删除/标记未使用；使用了就保留原名并保证引用一致

### 3. 下划线前缀使用规范

- 唯一合法场景：变量在声明后确实完全未被使用
- 示例：`const _unusedParam = param`（后续无任何引用）
- ES6 解构：`const { used, unused: _unused } = obj`

## 强制验证链（三关）

任何修复完成后，必须按顺序全部通过：

```bash
pnpm lint
pnpm tsc --noEmit
pnpm build
```

推荐使用统一入口：

```bash
pnpm validate
```

## 修复流程（溯源优先）

遇到 lint/类型/构建报错时，必须按以下流程执行：

1. 阅读完整错误信息（不要只看第一行）
2. 定位到具体代码行 + 上下文（不要只看报错行）
3. 理解问题根源（不要做表面修复）
4. 判断变量/逻辑是否真的未使用或无效
5. 根据判断选择删除/保留/重命名，并确保声明与使用一致
6. 跑完整验证链（lint + tsc + build），全部通过才算完成

## 禁止模式清单

- ❌ 为消除 lint 告警而给实际使用的变量加 `_` 前缀
- ❌ 修复 lint 后不跑 `pnpm tsc --noEmit`
- ❌ 修复类型问题后不跑 `pnpm build`
- ❌ 只修复报错行，不理解报错原因

