# **《InsurDash Claude Skills 创建规范 v2.0》**

## **📘 前言：为什么要制定这套标准**

在 InsurDash 的工程体系里，Claude 不只是助手，而是

**项目理解者、代码生成者、数据分析者、风险洞察者、文稿撰写者。**

本规范遵循 **Anthropic 官方最佳实践**，结合车险经营分析业务特点，确保技能的：

* **可发现性** - Claude 能自动识别何时激活技能
* **聚焦性** - 一个技能解决一个核心能力
* **安全性** - 明确的工具权限和业务边界
* **可维护性** - 清晰的文档和版本管理
* **可测试性** - 标准化的测试流程

让 Claude 变成"懂四川车险经营的真正伙伴"。

---

# **🧩 第一章：Skills 体系的核心原则**

> 基于 Anthropic 官方指南 + InsurDash 业务实践

### **原则 1：单一职责（One Skill, One Capability）**

每个 Skill **只解决一个核心能力**，避免功能混杂。

✅ 正确：`kpi-calculator`（计算KPI）、`data-validator`（验证数据）
❌ 错误：`insur-helper`（包罗万象的保险助手）

### **原则 2：精准描述（Specific Description）**

description 字段必须明确说明：
- **做什么**：技能的核心功能
- **何时用**：触发场景和关键词
- **不做什么**：明确边界

### **原则 3：消除歧义（Clarify Before Execute）**

车险领域术语多、口径多、变体多。

Skill 要求 Claude **先澄清、再输出**，避免误判。

### **原则 4：权限最小化（Least Privilege）**

使用 `allowed-tools` 限制工具访问权限：
- 只读分析技能：限制为 `Read, Grep, Glob`
- 数据处理技能：可添加 `Bash, mcp__ide__executeCode`
- **禁止自动写入数据库**

### **原则 5：可测试性（Testability First）**

技能必须能够通过标准化测试：
- 自主激活测试（Claude 自动识别场景）
- 指令遵循测试（按技能文档执行）
- 边界测试（正确拒绝超范围请求）

### **原则 6：版本可控（Versioned Documentation）**

每次更新必须记录版本历史，说明变更原因和影响范围。

---

# **🧱 第二章：技能目录结构（官方标准）**

## **2.1 技能存储位置**

### **项目级技能（推荐用于 InsurDash）**
```
.claude/skills/skill-name/
```
- 随项目代码版本管理
- 团队成员 pull 后自动可用
- 适合业务特定技能（KPI计算、数据验证等）

### **个人级技能**
```
~/.claude/skills/skill-name/
```
- 跨项目可用
- 个人配置，不随项目分发
- 适合通用技能

## **2.2 标准目录结构**

### **最简结构（必需）**
```
skill-name/
└── SKILL.md      # 必需：技能定义文档
```

### **推荐结构（InsurDash 最佳实践）**
```
kpi-calculator/
├── SKILL.md           # 必需：核心定义
├── examples.md        # 推荐：示例场景库
├── reference.md       # 可选：字段映射、公式定义
├── templates/         # 可选：SQL模板、报告模板
│   ├── kpi_query.sql
│   └── report.md
└── scripts/           # 可选：辅助脚本
    └── validate.py
```

**核心原则**：`SKILL.md` 是唯一必需文件，其他文件根据需要添加。

---

# **📄 第三章：SKILL.md 文件格式（官方标准）**

## **3.1 必需的 Frontmatter 字段**

根据 Anthropic 官方规范，SKILL.md 必须包含 YAML frontmatter，包含以下字段：

### **name（必需）**
- 格式：小写字母、数字、连字符
- 长度：最多 64 字符
- 禁止使用下划线和特殊字符

```yaml
name: kpi-calculator
```

### **description（必需）**
- 长度：最多 1024 字符
- 内容：**必须包含 3 个要素**
  1. **做什么**：技能的核心功能
  2. **何时用**：触发场景和关键词
  3. **触发词**：用户可能使用的具体术语

```yaml
description: 验证和调试车险业务16个核心KPI的计算逻辑，包括满期边际贡献率、满期赔付率、单均保费等。当用户提到"KPI"、"计算"、"赔付率"、"边际贡献"、"指标"时使用。
```

❌ **错误示例**（过于宽泛）:
```yaml
description: 帮助处理车险数据
```

✅ **正确示例**（具体明确）:
```yaml
description: 验证车险CSV数据的完整性和正确性，检查26个必需字段，验证数据类型、枚举值和业务规则。当用户提到"验证数据"、"检查数据"、"数据导入"、"CSV"时使用。
```

### **allowed-tools（可选但推荐）**
限制技能可使用的工具，提升安全性：

```yaml
allowed-tools: Read, Grep, Glob
```

常用配置：
- **只读分析**：`Read, Grep, Glob`
- **数据处理**：`Read, Grep, Glob, Bash, mcp__ide__executeCode`
- **文档生成**：`Read, Grep, Glob, Write, Edit`

## **3.2 完整的 SKILL.md 模板**

```markdown
---
name: kpi-calculator
description: 验证和调试车险业务16个核心KPI的计算逻辑，包括满期边际贡献率、满期赔付率、单均保费等。当用户提到"KPI"、"计算"、"赔付率"、"边际贡献"、"指标"时使用。
allowed-tools: Read, Grep, Glob, mcp__ide__executeCode
---

# Instructions

## 核心职责
本技能专注于车险业务 KPI 计算逻辑的验证和调试，确保以下16个核心指标计算正确：
- 满期边际贡献率、满期综合成本率、满期赔付率
- 签单边际贡献率、签单综合成本率、签单赔付率
- 单均保费、件均保费、满期保费、签单保费
- 赔款支出、已决赔款、案均赔款
- 承保件数、出险频度、案件量

## 执行流程

### 1. 需求澄清
在开始计算前，必须确认：
- **口径**：签单口径还是满期口径？
- **维度**：分支机构、车型、时间维度？
- **数据源**：承保清单、周报快照、DuckDB？
- **字段映射**：确认字段名称（中英文）

### 2. 公式验证
使用标准公式定义（参见 `reference.md`）：
```
满期边际贡献率 = (满期保费 - 赔款支出 - 变动成本) / 满期保费
满期赔付率 = 赔款支出 / 满期保费
单均保费 = 满期保费 / 承保件数
```

检查点：
- 分母是否可能为 0？
- 是否需要 COALESCE 处理 NULL？
- 单位是否一致（元、万元）？

### 3. 代码实现
生成 Python/SQL 代码时：
- 添加详细注释说明业务逻辑
- 处理边界情况（NULL、零值、异常值）
- 提供计算结果的合理性检查

### 4. 结果自查
输出前检查：
- 计算逻辑是否符合用户指定的公式？
- 数据类型是否正确？
- 是否有隐藏的除零风险？
- 结果的数量级是否合理？

## 限制与边界
- ❌ 不对业务结论做判断（如"该分支机构经营良好"）
- ❌ 不假设字段名或表结构
- ❌ 不自动调整阈值或标准
- ✅ 仅负责计算逻辑的正确性
- ✅ 遇到歧义必须向用户确认

# Examples

## 示例 1：计算满期赔付率（标准场景）

**用户输入：**
> 帮我计算2024年各分支机构的满期赔付率

**正确处理流程：**
1. 澄清：数据来源是承保清单还是周报快照？
2. 确认：满期赔付率 = 赔款支出 / 满期保费
3. 生成代码：
```python
df['满期赔付率'] = df['赔款支出'].fillna(0) / df['满期保费'].replace(0, np.nan)
df['满期赔付率'] = df['满期赔付率'].round(4)
```
4. 输出风险提示：注意满期保费为0的情况

## 示例 2：字段缺失场景

**用户输入：**
> 计算边际贡献率

**正确处理流程：**
1. 询问用户：
   - 签单口径还是满期口径？
   - 数据中是否有"变动成本"字段？
   - 如没有，是否需要用"变动成本率"计算？
2. 等待用户明确后再生成代码

## 示例 3：公式歧义场景

**用户输入：**
> 计算单均保费

**正确处理流程：**
1. 确认公式：
   - 单均保费 = 满期保费 / 承保件数？
   - 还是 = 签单保费 / 承保件数？
2. 确认后再执行

# Version History

## v1.0 (2025-11-16)
- 初始版本，支持16个核心KPI计算
- 实现公式验证和边界检查

## v1.1 (2025-11-17)
- 添加 DuckDB 支持
- 增强字段映射逻辑
```

## **3.3 关键要点总结**

| 要素 | 官方要求 | InsurDash 实践 |
|------|---------|----------------|
| **name 格式** | 小写+连字符，≤64字符 | `kpi-calculator`, `data-validator` |
| **description** | 具体说明做什么、何时用 | 包含触发词："KPI"、"计算"、"验证" |
| **frontmatter** | 仅 name + description 必需 | 可选添加 `allowed-tools` |
| **内容结构** | Instructions + Examples | 分段清晰，包含流程、限制、示例 |
| **版本管理** | 建议在内容中记录 | 使用 `Version History` 章节 |

---

# **🚀 第四章：命名规范（官方标准）**

根据 Anthropic 官方规范：

### **命名规则**
- ✅ 使用小写字母
- ✅ 使用连字符 `-` 分隔单词
- ✅ 最多 64 字符
- ❌ 禁止使用下划线 `_`
- ❌ 禁止使用特殊字符

### **命名策略**
用业务领域 + 核心功能命名：

```
kpi-calculator          # KPI计算器
data-validator          # 数据验证器
insurance-dashboard     # 保险仪表板
doc-syncer              # 文档同步器
git-sync-checker        # Git同步检查器
```

❌ **避免使用宽泛名称**:
```
helper                  # 太宽泛
insur-tool              # 不明确
general-assistant       # 职责不清
```

---

# **🔍 第五章：测试与调试标准（官方流程）**

根据 Anthropic 官方测试指南，每个技能必须通过以下测试：

## **5.1 自主激活测试（最重要）**

**目标**：验证 Claude 能根据 description 自动识别并激活技能

**测试步骤**：
1. **不使用** `/skill` 命令或显式提及技能名称
2. 使用 description 中提到的触发词提问
3. 观察 Claude 是否自动激活该技能

**示例**：
```
技能: kpi-calculator
Description: "当用户提到'KPI'、'计算'、'赔付率'时使用"

测试问题：
✅ "帮我计算满期赔付率"        → 应自动激活
✅ "这个KPI怎么算？"            → 应自动激活
❌ "分析一下数据"              → 不应激活（无触发词）
```

## **5.2 指令遵循测试**

**目标**：验证技能按照 Instructions 执行

测试内容：
- 是否执行了 Instructions 中定义的流程？
- 是否正确处理了边界条件？
- 是否遵守了 Limitations？

## **5.3 权限边界测试**

如果使用了 `allowed-tools`，测试：
- 是否只使用了允许的工具？
- 尝试使用禁止工具时是否正确拒绝？

## **5.4 多场景测试**

InsurDash 特定测试场景：

### **正常场景**
- 多维度（分支机构、车型、时间）
- 多口径（签单、满期）
- 多数据源（CSV、DuckDB）

### **歧义场景（必测）**
- 字段名未指定
- 口径不明确
- 计算公式模糊

### **错误处理**
- 字段名错误
- 表名不存在
- 数据类型不匹配

## **5.5 调试工具**

### **使用 --debug 模式**
```bash
claude --debug
```
可以看到：
- 技能是否被正确加载
- YAML 语法是否有错误
- 文件路径是否正确

### **常见问题检查清单**
- [ ] YAML frontmatter 格式正确（`---` 开闭）
- [ ] name 符合命名规范（小写+连字符）
- [ ] description 包含触发词
- [ ] 文件路径正确（`.claude/skills/skill-name/SKILL.md`）
- [ ] Instructions 章节存在
- [ ] Examples 章节存在

---

# **🛡 第六章：安全与权限原则**

## **6.1 使用 allowed-tools 控制权限**

### **只读分析技能（推荐）**
```yaml
allowed-tools: Read, Grep, Glob
```
适用于：数据验证、KPI计算、文档查询

### **数据处理技能**
```yaml
allowed-tools: Read, Grep, Glob, Bash, mcp__ide__executeCode
```
适用于：数据转换、SQL执行、脚本运行

### **文档生成技能**
```yaml
allowed-tools: Read, Grep, Glob, Write, Edit
```
适用于：报告生成、文档同步

## **6.2 车险行业安全规范**

### **1. 禁止自动写入数据库**
所有技能默认只读，需要写入时必须：
- 在 Instructions 中明确说明需要用户确认
- 输出："是否允许我执行写入操作？"

### **2. 敏感字段保护**
遇到以下字段必须提示风险：
- 车架号、发动机号
- 身份证号、手机号
- 投保人姓名、地址

### **3. 公式锁定机制**
核心 KPI 公式必须引用标准定义（`reference.md`），禁止自行创造：
- 满期赔付率 = 赔款支出 / 满期保费
- 边际贡献率 = (保费 - 赔款 - 变动成本) / 保费
- 综合成本率 = (赔款 + 费用) / 保费

---

# **🔄 第七章：版本管理与团队协作**

## **7.1 版本记录规范**

在 SKILL.md 的 `Version History` 章节记录：

```markdown
# Version History

## v1.2 (2025-11-17)
**新增**：DuckDB 数据源支持
**修改**：优化字段映射逻辑
**影响**：向后兼容，无破坏性变更

## v1.1 (2025-11-10)
**修复**：修正除零错误处理
**影响**：修复 bug，建议升级

## v1.0 (2025-11-01)
**初始版本**
```

## **7.2 团队分发方式**

### **方式 1：Git 版本控制（推荐）**
```bash
# 将技能提交到项目仓库
git add .claude/skills/kpi-calculator/
git commit -m "feat: 添加 KPI 计算技能"
git push

# 团队成员 pull 后自动可用
git pull
```

### **方式 2：Plugin 分发（高级）**
将技能打包为 plugin，通过 marketplace 分发（未来支持）

## **7.3 冲突处理**

如果多个技能的 description 重叠：
- Claude 可能激活错误的技能
- **解决方案**：使技能更加聚焦，明确边界

---

# **🌈 第八章：InsurDash 技能体系规划**

## **8.1 现有技能**

| 技能名称 | 核心功能 | 触发词 |
|---------|---------|--------|
| kpi-calculator | 验证16个核心KPI计算 | KPI、计算、赔付率 |
| data-validator | 验证CSV数据完整性 | 验证数据、检查数据 |
| insurance-dashboard | 生成业务分析仪表板 | 仪表板、分析、趋势 |
| doc-syncer | 同步开发文档 | 更新文档、同步文档 |
| git-sync-checker | 检查Git同步状态 | 检查同步、切换电脑 |

## **8.2 未来扩展方向**

### **经营分析增强**
- `branch-performance-analyzer` - 分支机构绩效画像
- `nev-risk-evaluator` - 新能源车风险评估
- `pricing-strategy-advisor` - 定价策略建议

### **数据处理增强**
- `duckdb-query-optimizer` - DuckDB 查询优化器
- `multi-week-trend-analyzer` - 多周趋势分析

### **协作增强**
- `knowledge-base-query` - 知识库查询（接入公司文档）
- `regulation-compliance-checker` - 监管合规检查

---

# **📋 附录：快速检查清单**

创建新技能时，使用此清单验证：

## **文件结构**
- [ ] 技能位于 `.claude/skills/skill-name/` 目录
- [ ] 包含 `SKILL.md` 文件
- [ ] (可选) 包含 `examples.md` 或 `reference.md`

## **SKILL.md 格式**
- [ ] YAML frontmatter 格式正确（`---` 开闭）
- [ ] `name` 字段：小写+连字符，≤64字符
- [ ] `description` 字段：≤1024字符，包含触发词
- [ ] (推荐) `allowed-tools` 字段：限制工具权限
- [ ] `# Instructions` 章节存在
- [ ] `# Examples` 章节存在
- [ ] (推荐) `# Version History` 章节存在

## **内容质量**
- [ ] Description 明确说明"做什么"和"何时用"
- [ ] Instructions 包含执行流程
- [ ] Instructions 明确限制和边界
- [ ] Examples 包含至少 2 个真实场景
- [ ] 敏感操作有安全提示

## **测试验证**
- [ ] 自主激活测试通过
- [ ] 指令遵循测试通过
- [ ] 边界测试通过
- [ ] 团队成员测试通过

## **版本管理**
- [ ] 记录版本历史
- [ ] 说明变更原因
- [ ] 标注兼容性影响

---

**规范版本**：v2.0 (2025-11-17)
**基于**：Anthropic Claude Code 官方最佳实践
**适用于**：InsurDash 车险经营分析项目
**维护者**：alongor
