# Data Validator - 参考文档

本文档包含 26 个必需字段的详细定义、数据类型、枚举值和常见问题排查。

---

## 26个必需字段详细定义

### 时间维度（3个字段）

#### snapshot_date - 快照日期
- **类型**：Date
- **格式**：YYYY-MM-DD
- **示例**：`2024-10-28`
- **必填**：是

#### policy_start_year - 保单年度
- **类型**：Integer
- **范围**：2024-2025
- **示例**：`2024`
- **必填**：是

#### week_number - 周序号
- **类型**：Integer
- **范围**：28-105
- **说明**：50周工作制，28为第一周，105为最后一周
- **示例**：`42`
- **必填**：是

### 组织维度（2个字段）

#### chengdu_branch - 地域属性
- **类型**：String (枚举)
- **枚举值**：`成都` 或 `中支`
- **示例**：`成都`
- **必填**：是

#### third_level_organization - 三级机构
- **类型**：String (枚举)
- **枚举值**（13种）：
  - 青羊
  - 金牛
  - 武侯
  - 成华
  - 龙泉驿
  - 新都
  - 温江
  - 双流
  - 郫都
  - 简阳
  - 都江堰
  - 彭州
  - 新津
- **示例**：`青羊`
- **必填**：是

### 客户维度（1个字段）

#### customer_category_3 - 客户类型
- **类型**：String (枚举)
- **枚举值**（11种）：
  - 非营业客车-家用车
  - 非营业客车-党政机关车
  - 非营业客车-企事业车
  - 非营业客车-机关团体车
  - 营业客车
  - 非营业货车-轻型货车
  - 非营业货车-重型货车
  - 营业货车-轻型货车
  - 营业货车-重型货车
  - 特种车
  - 其他
- **示例**：`非营业客车-家用车`
- **必填**：是

### 产品维度（3个字段）

#### insurance_type - 保险类型
- **类型**：String (枚举)
- **枚举值**：`商业险` 或 `交强险`
- **示例**：`商业险`
- **必填**：是

#### business_type_category - 业务类型
- **类型**：String (枚举)
- **枚举值**（16种）：
  - 商业险-主险（不含三者）
  - 商业险-第三者责任保险
  - 商业险-车上人员责任保险-车上乘客
  - 商业险-车上人员责任保险-司机
  - 商业险-盗抢险
  - 商业险-玻璃单独破碎险
  - 商业险-自燃损失险
  - 商业险-涉水险
  - 商业险-划痕险
  - 商业险-指定修理厂险
  - 商业险-机动车损失保险无法找到第三方特约险
  - 商业险-新增加设备损失险
  - 商业险-不计免赔险
  - 商业险-其他险种
  - 交强险
  - 其他
- **示例**：`商业险-主险（不含三者）`
- **必填**：是

#### coverage_type - 险别组合
- **类型**：String (枚举)
- **枚举值**：
  - `主全` - 主险+全险
  - `交三` - 交强险+第三者责任保险
  - `单交` - 仅交强险
- **示例**：`主全`
- **必填**：是

### 业务属性（3个字段）

#### renewal_status - 新续转状态
- **类型**：String (枚举)
- **枚举值**：`新保`、`续保`、`转保`
- **示例**：`续保`
- **必填**：是

#### is_new_energy_vehicle - 是否新能源
- **类型**：Boolean
- **枚举值**：`True` 或 `False`（首字母大写）
- **示例**：`False`
- **必填**：是

#### is_transferred_vehicle - 是否过户车
- **类型**：Boolean
- **枚举值**：`True` 或 `False`（首字母大写）
- **示例**：`False`
- **必填**：是

### 评级维度（4个字段，可为空）

#### vehicle_insurance_grade - 车险评级
- **类型**：String (枚举)
- **枚举值**：A、B、C、D、E、F、G、X（X表示未评级）
- **示例**：`B` 或 `X` 或 ``（空）
- **必填**：否

#### highway_risk_grade - 高速风险等级
- **类型**：String (枚举)
- **枚举值**：A、B、C、D、E、F、X（X表示未评级）
- **示例**：`C` 或 `X` 或 ``（空）
- **必填**：否

#### large_truck_score - 大货车评分
- **类型**：String (枚举)
- **枚举值**：A、B、C、D、E、X（X表示未评级）
- **示例**：`A` 或 `X` 或 ``（空）
- **必填**：否

#### small_truck_score - 小货车评分
- **类型**：String (枚举)
- **枚举值**：A、B、C、D、E、X（X表示未评级）
- **示例**：`D` 或 `X` 或 ``（空）
- **必填**：否

### 渠道维度（1个字段）

#### terminal_source - 终端来源
- **类型**：String (枚举)
- **枚举值**（8种）：
  - 个代
  - 专代
  - 兼代
  - 经代
  - 直销
  - 电销
  - 网销
  - 其他
- **示例**：`个代`
- **必填**：是

### 业务指标（9个字段）

#### signed_premium_yuan - 签单保费
- **类型**：Number
- **单位**：元
- **范围**：≥ 0
- **示例**：`2958.49`
- **必填**：是

#### matured_premium_yuan - 满期保费
- **类型**：Number
- **单位**：元
- **范围**：≥ 0
- **示例**：`1500.00`
- **必填**：是

#### policy_count - 保单件数
- **类型**：Integer
- **范围**：≥ 0
- **示例**：`1`
- **必填**：是

#### claim_case_count - 赔案件数
- **类型**：Integer
- **范围**：≥ 0
- **示例**：`0`
- **必填**：是

#### reported_claim_payment_yuan - 已报告赔款
- **类型**：Number
- **单位**：元
- **范围**：≥ 0
- **示例**：`0.00`
- **必填**：是

#### expense_amount_yuan - 费用金额
- **类型**：Number
- **单位**：元
- **范围**：≥ 0
- **示例**：`450.75`
- **必填**：是

#### commercial_premium_before_discount_yuan - 商业险折前保费
- **类型**：Number
- **单位**：元
- **范围**：≥ 0
- **示例**：`3200.00`
- **必填**：是

#### premium_plan_yuan - 保费计划
- **类型**：Number
- **单位**：元
- **示例**：`5000.00` 或 ``（空）
- **必填**：否

#### marginal_contribution_amount_yuan - 边际贡献额
- **类型**：Number
- **单位**：元
- **范围**：可为负数
- **示例**：`258.50` 或 `-100.00`
- **必填**：是

---

## 常见问题排查

### 问题 1：字段数量不匹配

**原因**：CSV 文件缺少必需字段或字段顺序错误

**检查点**：
- 使用 `Read` 读取 CSV 文件首行
- 对比 26 个标准字段名
- 检查是否有多余字段或缺失字段

### 问题 2：编码问题导致中文乱码

**原因**：CSV 文件不是 UTF-8 编码

**检查点**：
```bash
file -I your_file.csv  # 检查文件编码
```

### 问题 3：Boolean 值格式错误

**原因**：使用了 `true/false` 而非 `True/False`

**检查点**：
- 搜索 `is_new_energy_vehicle` 和 `is_transferred_vehicle` 字段
- 确认值为 `True` 或 `False`（首字母大写）

### 问题 4：数值格式错误

**原因**：包含千分位分隔符或使用逗号作为小数点

**检查点**：
- 数值应为 `2958.49` 而非 `2,958.49` 或 `2958,49`

### 问题 5：日期格式错误

**原因**：使用了非 YYYY-MM-DD 格式

**检查点**：
- 日期应为 `2024-10-28` 而非 `2024/10/28` 或 `28-10-2024`

---

## 验证报告模板

```markdown
# CSV 数据验证报告

## 📊 概览
- 总记录数：1,234
- 验证通过：1,200 条
- 验证失败：34 条
- 错误率：2.75%
- 文件名：`2024保单第42周变动成本明细表.csv`

## ✅ 通过的验证
- 所有26个必需字段存在
- 日期格式符合 YYYY-MM-DD 标准
- 枚举值在允许范围内
- 数值字段类型正确

## ❌ 失败的验证

### 数据类型错误
1. **第 45 行**：`signed_premium_yuan` 为负数 (-1000)，违反业务规则（必须 ≥0）
2. **第 78 行**：`snapshot_date` 格式错误，应为 `YYYY-MM-DD`

### 必填字段缺失
3. **第 156 行**：缺少必填字段 `third_level_organization`

### 枚举值错误
4. **第 203 行**：`insurance_type` 值为 `意外险`，应为 `商业险` 或 `交强险`

### 数值范围错误
5. **第 301 行**：`week_number` 值为 150，超出允许范围（28-105）

## ⚠️ 警告

### 数据异常（不阻止导入，但需人工确认）
- **12 条记录**：`marginal_contribution_amount_yuan` 为负值（合法但需关注）
- **5 条记录**：`claim_case_count` 大于 `policy_count`（不合理但可能是聚合数据）
- **3 条记录**：评级字段全部为 `X`（未评级）

## 📋 建议操作
1. **必须修复**：修复所有数据类型错误和必填字段缺失
2. **建议检查**：确认枚举值错误的数据来源
3. **可选优化**：填充评级字段的空值

## 📁 相关文档
- 数据架构规范：`开发文档/03_technical_design/data_architecture.md`
- TypeScript 类型定义：`src/types/insurance.ts`
```
