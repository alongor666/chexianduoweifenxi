---
name: data-validator
description: 验证车险CSV数据的完整性和正确性，检查26个必需字段，验证数据类型、枚举值和业务规则。当用户提到"验证数据"、"检查数据"、"数据导入"、"CSV"时使用。
allowed-tools: Read, Grep, Bash
---

# Instructions

## 核心职责

本技能用于验证车险业务 CSV 数据的完整性、格式正确性和业务规则合规性。

**职责范围**：
- ✅ 验证 26 字段 CSV 数据完整性
- ✅ 检查数据类型、枚举值、数值范围
- ✅ 生成详细的验证报告
- ❌ 不修改 CSV 文件（只提供修复建议）
- ❌ 不自动修复数据

严格基于 `InsuranceRecord` 26 字段标准。

## 执行流程

### 1. 读取数据架构
```bash
Read 开发文档/03_technical_design/data_architecture.md
Read src/types/insurance.ts
```
了解 26 字段标准。

### 2. 读取 CSV 文件
验证文件可读性和编码（UTF-8）。

### 3. 验证字段完整性
检查 26 个必需字段是否存在：
- 时间维度：3 个字段
- 组织维度：2 个字段
- 客户维度：1 个字段
- 产品维度：3 个字段
- 业务属性：3 个字段
- 评级维度：4 个字段（可选）
- 渠道维度：1 个字段
- 业务指标：9 个字段

### 4. 验证数据类型
- **Date**：YYYY-MM-DD 格式
- **Boolean**：`True` 或 `False`（首字母大写）
- **Number**：使用点号作为小数点，不含千分位分隔符
- **Integer**：整数
- **空值**：可选字段允许空字符串

### 5. 验证业务规则
- `policy_start_year` 范围：2024-2025
- `week_number` 范围：28-105
- 除 `marginal_contribution_amount_yuan` 外，所有金额 ≥ 0
- 枚举字段必须在规范定义的值范围内

### 6. 生成验证报告
必须包含：
- 📊 概览统计（总记录数、通过数、失败数、错误率）
- ✅ 通过的验证项
- ❌ 失败的验证项（具体行号和错误内容）
- ⚠️ 警告信息
- 📋 修复建议

## 限制与边界

- **只读取不修改**：不能修改 CSV 文件
- **不自动修复数据**：所有修复需用户手动执行
- **不创造字段**：严格基于 26 字段标准
- **大文件性能受限**：超过 10000 行建议抽样验证
- **遇到编码问题必须提示**：如文件不是 UTF-8 编码

## 验证模式

- **完整验证**：验证所有记录
- **快速验证**：抽样验证前 100 行（大文件推荐）
- **针对性验证**：只验证特定项（字段完整性/数据类型/业务规则）

详细的字段定义和常见问题请参考 `reference.md`。

# Examples

## 示例 1：完整数据验证

**用户输入**：
> 帮我验证一下 data/week_42.csv 的数据

**正确处理流程**：
1. 读取 `data_architecture.md` 了解 26 字段标准
2. 读取 CSV 文件
3. 检查字段完整性、数据类型、业务规则
4. 生成验证报告：
   ```
   📊 概览
   - 总记录数：1,234
   - 验证通过：1,200 条
   - 验证失败：34 条
   - 错误率：2.75%

   ❌ 失败的验证
   1. 第 45 行：`signed_premium_yuan` 为负数
   2. 第 78 行：`snapshot_date` 格式错误
   ...

   📋 建议操作
   1. 修复数据类型错误
   2. 检查枚举值
   ```
5. 提供修复建议

## 示例 2：快速验证（抽样）

**用户输入**：
> 快速检查一下这个大文件的数据质量

**正确处理流程**：
1. 确认使用抽样模式（前 100 行）
2. 执行验证
3. 生成抽样验证报告
4. 建议：如抽样通过，可进行完整验证

## 示例 3：针对性验证

**用户输入**：
> 检查一下 CSV 的字段是否齐全

**正确处理流程**：
1. 确认仅验证字段完整性
2. 读取 CSV 首行
3. 对比 26 个标准字段
4. 报告缺失或多余的字段

# Version History

## v1.0 (2025-11-17)
- 初始版本，支持 26 字段 CSV 数据验证
- 实现完整验证和抽样验证模式
- 添加详细的错误报告和修复建议
- 遵循 Anthropic 官方 Skills 最佳实践
