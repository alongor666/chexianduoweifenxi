---
description: 对未提交更改进行安全和质量审查
---

# 代码审查命令 (/code-review)

对未提交的更改进行全面的安全和质量审查。

## 检查步骤

1. 获取更改文件: `git diff --name-only HEAD`

2. 对每个更改的文件检查:

### 安全问题 (严重)
- 硬编码的凭据、API 密钥、令牌
- SQL 注入漏洞
- XSS 漏洞
- 缺少输入验证
- 不安全的依赖
- 路径遍历风险

### 代码质量 (高)
- 函数超过 50 行
- 文件超过 800 行
- 嵌套深度超过 4 层
- 缺少错误处理
- console.log 语句
- TODO/FIXME 注释
- 公共 API 缺少文档

### 最佳实践 (中)
- 可变性模式 (应使用不可变)
- 代码/注释中的表情符号
- 新代码缺少测试

## 项目特定检查

### 护栏违规 (严重)
- 修改了 core_calculations.md 的核心内容
- 修改了 data_architecture.md 的核心内容
- 核心目录改动未在 BACKLOG 登记

### 文档一致性 (高)
- INDEX.md 与实际代码不同步
- 新增文件未在索引中注册

## 输出格式

```
代码审查报告
============

[严重] file.ts:10 - 发现硬编码密钥
  建议: 使用环境变量

[高] file.ts:50 - 函数过长 (85行)
  建议: 拆分为多个小函数

[中] file.ts:100 - 发现 console.log
  建议: 移除或使用正式日志

---
总计: X 严重, Y 高, Z 中
可以提交: [是/否]
```

## 阻断规则

发现以下问题时阻止提交:
- 任何严重级别问题
- 护栏违规
- 安全漏洞

## 使用方式

```
/code-review           # 审查所有未提交更改
/code-review staged    # 仅审查已暂存更改
/code-review file.ts   # 审查特定文件
```
