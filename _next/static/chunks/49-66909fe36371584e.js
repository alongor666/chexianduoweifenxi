"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[49],{88041:function(e,t,r){r.d(t,{r:function(){return l}});var a=r(57306),n=r(22401),i=r(27078);class l{async execute(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,n=Date.now(),i={success:!1,processedRecords:0,successRecords:0,failedRecords:0,skippedRecords:0,errors:[],warnings:[],processingTime:0,fileInfo:{name:e.name,size:e.size,type:e.type}};try{null==r||r({phase:"parsing",percentage:10,processedRows:0,totalRows:0,currentItem:e.name});let l={header:!0,skipEmptyLines:!0,maxErrorRows:t.maxErrorRows||100},o=0,s=0,u=await (0,a.YV)(e,l,t=>{let a=t.totalBytes>0?t.processedBytes/t.totalBytes:0,n=Math.min(29,Math.max(10,10+Math.round(19*a))),i=Date.now();n===o&&i-s<200||(o=n,s=i,null==r||r({phase:"parsing",percentage:n,processedRows:t.processedRows,totalRows:0,currentItem:e.name}))});if(!u.success&&0===u.data.length)return i.errors.push({type:"PARSE_ERROR",message:"CSV解析失败，没有有效数据",severity:"error"}),i;i.processedRecords=u.statistics.totalRows,i.failedRecords=u.statistics.errorRows,i.warnings.push(...u.warnings),i.errors.push(...u.errors.map(e=>({type:e.type,message:e.message,row:e.row,field:e.field,rawData:e.rawValue,severity:"error"}))),null==r||r({phase:"validating",percentage:30,processedRows:u.statistics.successRows,totalRows:u.statistics.totalRows,currentItem:"验证数据格式"});let c=(0,a.DC)(u);c.errors.length>0&&i.errors.push(...c.errors.map(e=>({type:"VALIDATION_ERROR",message:e.message,rawData:e.rawValue,severity:"error"})));let d=c.records;if(i.successRecords=d.length,null==r||r({phase:"transforming",percentage:60,processedRows:d.length,totalRows:u.statistics.totalRows,currentItem:"转换数据格式"}),!t.skipValidation){null==r||r({phase:"validating",percentage:80,processedRows:d.length,totalRows:u.statistics.totalRows,currentItem:"验证业务规则"});let e=await this.validateBusinessRules(d);e.errors.length>0&&i.errors.push(...e.errors),i.warnings.push(...e.warnings)}null==r||r({phase:"storing",percentage:90,processedRows:d.length,totalRows:u.statistics.totalRows,currentItem:"保存数据"});let m=await this.storeData(d,t);m.errors.length>0&&i.errors.push(...m.errors),i.warnings.push(...m.warnings),i.processingTime=Date.now()-n,i.success=0===i.errors.length||i.successRecords>0,null==r||r({phase:"completed",percentage:100,processedRows:i.successRecords,totalRows:u.statistics.totalRows,currentItem:"完成"})}catch(e){i.processingTime=Date.now()-n,i.errors.push({type:"STORAGE_ERROR",message:e instanceof Error?e.message:String(e),severity:"error"}),i.success=!1}return i}async validateBusinessRules(e){let t=[],r=[],a=this.findDuplicateRecords(e);a.length>0&&r.push("发现 ".concat(a.length," 条可能重复的记录"));let n=e.filter(e=>e.weekNumber<1||e.weekNumber>105);n.length>0&&t.push({type:"BUSINESS_ERROR",message:"发现 ".concat(n.length," 条记录的周次超出有效范围(1-105)"),severity:"error"});let i=e.filter(e=>e.policyStartYear<2e3||e.policyStartYear>2100);i.length>0&&t.push({type:"BUSINESS_ERROR",message:"发现 ".concat(i.length," 条记录的年份超出有效范围(2000-2100)"),severity:"error"});let l=e.filter(e=>e.signedPremiumYuan<0||e.maturedPremiumYuan<0||e.expenseAmountYuan<0);return l.length>0&&r.push("发现 ".concat(l.length," 条记录包含负数金额")),{errors:t,warnings:r}}findDuplicateRecords(e){let t=new Set,r=[];for(let a of e){let e="".concat(a.snapshotDate,"_").concat(a.thirdLevelOrganization,"_").concat(a.businessTypeCategory,"_").concat(a.weekNumber);t.has(e)?r.push(a):t.add(e)}return r}async storeData(e,t){let r=[],a=[];try{let r;let i=(this.store.rawData||[]).map(e=>n.R.fromRawData(e));if(!t.overwrite){let t=this.checkDataConflicts(e,i);t.length>0&&a.push("发现 ".concat(t.length," 条数据可能与现有数据冲突"))}if(t.incremental){let t=this.filterNewRecords(e,i);r=[...i,...t],a.push("增量模式：添加 ".concat(t.length," 条新记录，跳过 ").concat(e.length-t.length," 条已存在记录"))}else t.overwrite?(r=this.mergeWithOverwrite(e,i),a.push("覆盖模式：已更新相关数据")):r=[...i,...e];let l=r.map(e=>e.toRawData());this.store.setRawData(l)}catch(e){r.push({type:"STORAGE_ERROR",message:e instanceof Error?e.message:String(e),severity:"error"})}return{errors:r,warnings:a}}checkDataConflicts(e,t){let r=new Set(t.map(e=>"".concat(e.snapshotDate,"_").concat(e.thirdLevelOrganization,"_").concat(e.businessTypeCategory,"_").concat(e.weekNumber)));return e.filter(e=>{let t="".concat(e.snapshotDate,"_").concat(e.thirdLevelOrganization,"_").concat(e.businessTypeCategory,"_").concat(e.weekNumber);return r.has(t)})}filterNewRecords(e,t){let r=new Set(t.map(e=>"".concat(e.snapshotDate,"_").concat(e.thirdLevelOrganization,"_").concat(e.businessTypeCategory,"_").concat(e.weekNumber)));return e.filter(e=>{let t="".concat(e.snapshotDate,"_").concat(e.thirdLevelOrganization,"_").concat(e.businessTypeCategory,"_").concat(e.weekNumber);return!r.has(t)})}mergeWithOverwrite(e,t){let r=new Map(t.map(e=>["".concat(e.snapshotDate,"_").concat(e.thirdLevelOrganization,"_").concat(e.businessTypeCategory,"_").concat(e.weekNumber),e]));for(let t of e){let e="".concat(t.snapshotDate,"_").concat(t.thirdLevelOrganization,"_").concat(t.businessTypeCategory,"_").concat(t.weekNumber);r.set(e,t)}return Array.from(r.values())}static getUploadStatistics(e){let t=e.filter(e=>e.success).length,r=e.reduce((e,t)=>e+t.processedRecords,0),a=e.reduce((e,t)=>e+t.successRecords,0),n=e.reduce((e,t)=>e+t.failedRecords,0),i=e.reduce((e,t)=>e+t.processingTime,0)/e.length;return{totalFiles:e.length,successfulFiles:t,totalRecords:r,successfulRecords:a,failedRecords:n,averageProcessingTime:i}}constructor(){this.store=i.qr.getState()}}},41405:function(e,t,r){r.d(t,{B:function(){return l}});var a=r(36059),n=r(77587);let i=[{value:"data-management",label:"数据管理"},{value:"cockpit",label:"\uD83D\uDE80 驾驶舱 (Beta)"},{value:"kpi",label:"KPI看板"},{value:"trend",label:"周趋势分析"},{value:"thematic",label:"专题分析"},{value:"multichart",label:"多维图表"}];function l(e){let{active:t,onChange:r}=e;return(0,a.jsx)(n.mQ,{value:t,onValueChange:e=>r(e),children:(0,a.jsx)(n.dr,{children:i.map(e=>(0,a.jsx)(n.SP,{value:e.value,children:e.label},e.value))})})}},94258:function(e,t,r){r.d(t,{Cd:function(){return u},X:function(){return c},bZ:function(){return s}});var a=r(36059),n=r(90616),i=r(69754),l=r(26992);let o=(0,i.j)("relative w-full rounded-lg border px-4 py-3 text-sm [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground [&>svg~*]:pl-7",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),s=n.forwardRef((e,t)=>{let{className:r,variant:n,...i}=e;return(0,a.jsx)("div",{ref:t,role:"alert",className:(0,l.cn)(o({variant:n}),r),...i})});s.displayName="Alert";let u=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)("h5",{ref:t,className:(0,l.cn)("mb-1 font-medium leading-none tracking-tight",r),...n})});u.displayName="AlertTitle";let c=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("text-sm [&_p]:leading-relaxed",r),...n})});c.displayName="AlertDescription"},66066:function(e,t,r){r.d(t,{z:function(){return u}});var a=r(36059),n=r(90616),i=r(83353),l=r(69754),o=r(26992);let s=(0,l.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),u=n.forwardRef((e,t)=>{let{className:r,variant:n,size:l,asChild:u=!1,...c}=e,d=u?i.g7:"button";return(0,a.jsx)(d,{className:(0,o.cn)(s({variant:n,size:l,className:r})),ref:t,...c})});u.displayName="Button"},42030:function(e,t,r){r.d(t,{Ol:function(){return o},SZ:function(){return u},Zb:function(){return l},aY:function(){return c},ll:function(){return s}});var a=r(36059),n=r(90616),i=r(26992);let l=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,i.cn)("rounded-lg border bg-white text-slate-950 shadow-sm",r),...n})});l.displayName="Card";let o=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,i.cn)("flex flex-col space-y-1.5 p-6",r),...n})});o.displayName="CardHeader";let s=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)("h3",{ref:t,className:(0,i.cn)("text-2xl font-semibold leading-none tracking-tight",r),...n})});s.displayName="CardTitle";let u=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)("p",{ref:t,className:(0,i.cn)("text-sm text-slate-500",r),...n})});u.displayName="CardDescription";let c=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,i.cn)("p-6 pt-0",r),...n})});c.displayName="CardContent",n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,i.cn)("flex items-center p-6 pt-0",r),...n})}).displayName="CardFooter"},61511:function(e,t,r){r.d(t,{$N:function(){return g},Be:function(){return p},Vq:function(){return s},cZ:function(){return m},fK:function(){return _},hg:function(){return u}});var a=r(36059),n=r(90616),i=r(42332),l=r(33239),o=r(26992);let s=i.fC,u=i.xz,c=i.h_;i.x8;let d=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)(i.aV,{ref:t,className:(0,o.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",r),...n})});d.displayName=i.aV.displayName;let m=n.forwardRef((e,t)=>{let{className:r,children:n,...s}=e;return(0,a.jsxs)(c,{children:[(0,a.jsx)(d,{}),(0,a.jsxs)(i.VY,{ref:t,className:(0,o.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",r),...s,children:[n,(0,a.jsxs)(i.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,a.jsx)(l.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});m.displayName=i.VY.displayName;let _=e=>{let{className:t,...r}=e;return(0,a.jsx)("div",{className:(0,o.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...r})};_.displayName="DialogHeader";let g=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)(i.Dx,{ref:t,className:(0,o.cn)("text-lg font-semibold leading-none tracking-tight",r),...n})});g.displayName=i.Dx.displayName;let p=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)(i.dk,{ref:t,className:(0,o.cn)("text-sm text-muted-foreground",r),...n})});p.displayName=i.dk.displayName},13344:function(e,t,r){r.d(t,{I:function(){return l}});var a=r(36059),n=r(90616),i=r(26992);let l=n.forwardRef((e,t)=>{let{className:r,type:n="text",...l}=e;return(0,a.jsx)("input",{type:n,className:(0,i.cn)("flex h-9 w-full rounded-md border border-slate-300 bg-white px-3 py-1 text-sm text-slate-900 shadow-sm transition-colors","placeholder:text-slate-400 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-0","disabled:cursor-not-allowed disabled:opacity-60",r),ref:t,...l})});l.displayName="Input"},57040:function(e,t,r){r.d(t,{J2:function(){return o},xo:function(){return s},yk:function(){return u}});var a=r(36059),n=r(90616),i=r(49164),l=r(26992);let o=i.fC,s=i.xz;i.ee;let u=n.forwardRef((e,t)=>{let{className:r,align:n="center",sideOffset:o=4,...s}=e;return(0,a.jsx)(i.h_,{children:(0,a.jsx)(i.VY,{ref:t,align:n,sideOffset:o,className:(0,l.cn)("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]",r),...s})})});u.displayName=i.VY.displayName},77587:function(e,t,r){r.d(t,{SP:function(){return u},dr:function(){return s},mQ:function(){return o},nU:function(){return c}});var a=r(36059),n=r(90616),i=r(54320),l=r(26992);let o=i.fC,s=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)(i.aV,{ref:t,className:(0,l.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",r),...n})});s.displayName=i.aV.displayName;let u=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)(i.xz,{ref:t,className:(0,l.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",r),...n})});u.displayName=i.xz.displayName;let c=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)(i.VY,{ref:t,className:(0,l.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",r),...n})});c.displayName=i.VY.displayName},60373:function(e,t,r){r.d(t,{AL:function(){return m},Dm:function(){return s},SO:function(){return d},W4:function(){return u},Xs:function(){return i},gW:function(){return y},gX:function(){return h},iZ:function(){return a},p7:function(){return n},qP:function(){return f},rG:function(){return l},rj:function(){return o}});let a=["挂车","摩托车","特种车","营业公路客运","营业出租租赁","营业城市公交","营业货车","非营业个人客车","非营业企业客车","非营业机关客车","非营业货车"],n=["非营业客车新车","非营业客车旧车非过户","非营业客车旧车过户","1吨以下非营业货车","1–2吨非营业货车","2吨以下营业货车","2–9吨营业货车","9–10吨营业货车","10吨以上营业货车（普货）","10吨以上营业货车（牵引）","自卸车","特种车","其他营业货车","摩托车","出租车","网约车"],i=["商业险","交强险"],l=["主全","交三","单交"],o=["新保","续保","转保"],s=["0101柜面","0106移动展业(App)","0107B2B","0110融合销售","0112AI出单","0201PC","0202APP","0301电销"],u=["本部","达州","德阳","高新","乐山","泸州","青羊","天府","武侯","新都","宜宾","资阳","自贡"],c={非营业客车新车:"非营客-新",非营业客车旧车非过户:"非营客-旧",非营业客车旧车过户:"非营客-过户",非营业客车旧车过户车:"非营客-过户","1吨以下非营业货车":"非营货-<1t","1–2吨非营业货车":"非营货-1–2t",非营业货车新车:"非营货-1–2t",非营业货车旧车:"非营货-1–2t","2吨以下营业货车":"营货-<2t","2-9吨营业货车":"营货-2–9t","2–9吨营业货车":"营货-2–9t","9-10吨营业货车":"营货-9–10t","9–10吨营业货车":"营货-9–10t","10吨以上营业货车（普货）":"营货-≥10t普","10吨以上-普货":"营货-≥10t普","10吨以上普货":"营货-≥10t普","10吨以上营业货车（牵引）":"营货-≥10t牵","10吨以上-牵引":"营货-≥10t牵","10吨以上牵引":"营货-≥10t牵",自卸车:"营货-≥10t卸",自卸:"营货-≥10t卸",特种车:"营货-≥10t特",其他营业货车:"营货-其他",摩托车:"摩托",出租车:"营客-出租",网约车:"营客-网约",车险整体:"车险整体",其他:"营货-其他"};function d(e){let t=String(e||"").trim();if(!t)return"";let r=c[t];if(r)return r;let a=t;return(a=(a=(a=(a=(a=(a=(a=(a=a.replace(/非营业/g,"非营").replace(/营业/g,"营")).replace(/车/g,"")).replace(/新车/g,"新").replace(/旧车/g,"旧").replace(/过户车/g,"过户")).replace(/吨/g,"t")).replace(/以上/g,"＞")).replace(/以下/g,"＜")).replace(/＞10t-普货/g,"＞10t普")).replace(/＞10t-牵引/g,"＞10t牵")).replace(/2-9t营货/g,"营货2-9t")}let m=["non_pc_new","non_pc_used","non_pc_transfer","non_truck_lt1","non_truck_1_2","biz_truck_lt2","biz_truck_2_9","biz_truck_9_10","biz_truck_10_plus","biz_truck_10_plus_trac","biz_truck_10_plus_dump","biz_truck_10_plus_special","biz_truck_other","motorcycle","biz_pc_taxi","biz_pc_ridehailing"],_={非营业客车新车:"non_pc_new",非营业客车旧车非过户:"non_pc_used",非营业客车旧车过户:"non_pc_transfer",非营业客车旧车过户车:"non_pc_transfer","1吨以下非营业货车":"non_truck_lt1","1–2吨非营业货车":"non_truck_1_2",非营业货车新车:"non_truck_1_2",非营业货车旧车:"non_truck_1_2","2吨以下营业货车":"biz_truck_lt2","2-9吨营业货车":"biz_truck_2_9","2–9吨营业货车":"biz_truck_2_9","9-10吨营业货车":"biz_truck_9_10","9–10吨营业货车":"biz_truck_9_10","10吨以上营业货车（普货）":"biz_truck_10_plus","10吨以上-普货":"biz_truck_10_plus","10吨以上普货":"biz_truck_10_plus","10吨以上营业货车（牵引）":"biz_truck_10_plus_trac","10吨以上-牵引":"biz_truck_10_plus_trac","10吨以上牵引":"biz_truck_10_plus_trac",自卸车:"biz_truck_10_plus_dump",自卸:"biz_truck_10_plus_dump",特种车:"biz_truck_10_plus_special",其他营业货车:"biz_truck_other",摩托车:"motorcycle",出租车:"biz_pc_taxi",网约车:"biz_pc_ridehailing",其他:"biz_truck_other"},g={non_pc_new:"非营业客车新车",non_pc_used:"非营业客车旧车非过户",non_pc_transfer:"非营业客车旧车过户",non_truck_lt1:"1吨以下非营业货车",non_truck_1_2:"1–2吨非营业货车",biz_truck_lt2:"2吨以下营业货车",biz_truck_2_9:"2–9吨营业货车",biz_truck_9_10:"9–10吨营业货车",biz_truck_10_plus:"10吨以上营业货车（普货）",biz_truck_10_plus_trac:"10吨以上营业货车（牵引）",biz_truck_10_plus_dump:"自卸车",biz_truck_10_plus_special:"特种车",biz_truck_other:"其他营业货车",motorcycle:"摩托车",biz_pc_taxi:"出租车",biz_pc_ridehailing:"网约车",OTHER:"其他"},p={non_pc_new:"非营客-新",non_pc_used:"非营客-旧",non_pc_transfer:"非营客-过户",non_truck_lt1:"非营货-<1t",non_truck_1_2:"非营货-1–2t",biz_truck_lt2:"营货-<2t",biz_truck_2_9:"营货-2–9t",biz_truck_9_10:"营货-9–10t",biz_truck_10_plus:"营货-≥10t普",biz_truck_10_plus_trac:"营货-≥10t牵",biz_truck_10_plus_dump:"营货-≥10t卸",biz_truck_10_plus_special:"营货-≥10t特",biz_truck_other:"营货-其他",motorcycle:"摩托",biz_pc_taxi:"营客-出租",biz_pc_ridehailing:"营客-网约",OTHER:"其他"};function h(e){let t=String(e||"").trim();return t&&(_[t]||_[t.replace(/\s+/g,"").replace(/车/g,"车")])||"OTHER"}function y(e){return p[e]||"其他"}function f(e){return g[e]||"其他"}},22401:function(e,t,r){r.d(t,{R:function(){return a}});class a{validateInvariants(){if(this.weekNumber<1||this.weekNumber>105)throw Error("周序号必须在 1-105 之间，当前值：".concat(this.weekNumber));if(this.policyStartYear<2e3||this.policyStartYear>2100)throw Error("保单年度异常：".concat(this.policyStartYear));for(let e of[{name:"签单保费",value:this.signedPremiumYuan},{name:"满期保费",value:this.maturedPremiumYuan},{name:"保单件数",value:this.policyCount},{name:"赔案件数",value:this.claimCaseCount},{name:"费用金额",value:this.expenseAmountYuan},{name:"商业险折前保费",value:this.commercialPremiumBeforeDiscountYuan}])if(e.value<0)throw Error("".concat(e.name,"不能为负数，当前值：").concat(e.value))}isHighValuePolicy(){return this.signedPremiumYuan>1e4}isCommercialInsurance(){return"商业险"===this.insuranceType}isCompulsoryInsurance(){return"交强险"===this.insuranceType}isNewPolicy(){return"新保"===this.renewalStatus}isRenewalPolicy(){return"续保"===this.renewalStatus}hasClaims(){return this.claimCaseCount>0}hasPremiumPlan(){return null!==this.premiumPlanYuan&&this.premiumPlanYuan>0}getAveragePremium(){return 0===this.policyCount?null:this.signedPremiumYuan/this.policyCount}getAverageClaimPayment(){return 0===this.claimCaseCount?null:this.reportedClaimPaymentYuan/this.claimCaseCount}getAverageExpense(){return 0===this.policyCount?null:this.expenseAmountYuan/this.policyCount}getAverageContribution(){return 0===this.policyCount?null:this.marginalContributionAmountYuan/this.policyCount}isMatured(){return this.maturedPremiumYuan>0}hasClaimed(){return this.reportedClaimPaymentYuan>0}toRawData(){var e,t,r,a;return{snapshot_date:this.snapshotDate,policy_start_year:this.policyStartYear,week_number:this.weekNumber,chengdu_branch:this.chengduBranch,third_level_organization:this.thirdLevelOrganization,customer_category_3:this.customerCategory,insurance_type:this.insuranceType,business_type_category:this.businessTypeCategory,coverage_type:this.coverageType,renewal_status:this.renewalStatus,is_new_energy_vehicle:this.isNewEnergyVehicle,is_transferred_vehicle:this.isTransferredVehicle,vehicle_insurance_grade:null!==(e=this.vehicleInsuranceGrade)&&void 0!==e?e:void 0,highway_risk_grade:null!==(t=this.highwayRiskGrade)&&void 0!==t?t:void 0,large_truck_score:null!==(r=this.largeTruckScore)&&void 0!==r?r:void 0,small_truck_score:null!==(a=this.smallTruckScore)&&void 0!==a?a:void 0,terminal_source:this.terminalSource,signed_premium_yuan:this.signedPremiumYuan,matured_premium_yuan:this.maturedPremiumYuan,policy_count:this.policyCount,claim_case_count:this.claimCaseCount,reported_claim_payment_yuan:this.reportedClaimPaymentYuan,expense_amount_yuan:this.expenseAmountYuan,commercial_premium_before_discount_yuan:this.commercialPremiumBeforeDiscountYuan,premium_plan_yuan:this.premiumPlanYuan,marginal_contribution_amount_yuan:this.marginalContributionAmountYuan}}static fromRawData(e){var t,r,n,i,l;return new a(e.snapshot_date,e.policy_start_year,e.week_number,e.chengdu_branch,e.third_level_organization,e.customer_category_3,e.insurance_type,e.business_type_category,e.coverage_type,e.renewal_status,e.is_new_energy_vehicle,e.is_transferred_vehicle,null!==(t=e.vehicle_insurance_grade)&&void 0!==t?t:null,null!==(r=e.highway_risk_grade)&&void 0!==r?r:null,null!==(n=e.large_truck_score)&&void 0!==n?n:null,null!==(i=e.small_truck_score)&&void 0!==i?i:null,e.terminal_source,e.signed_premium_yuan,e.matured_premium_yuan,e.policy_count,e.claim_case_count,e.reported_claim_payment_yuan,e.expense_amount_yuan,e.commercial_premium_before_discount_yuan,null!==(l=e.premium_plan_yuan)&&void 0!==l?l:null,e.marginal_contribution_amount_yuan,e.second_level_organization)}constructor(e,t,r,a,n,i,l,o,s,u,c,d,m,_,g,p,h,y,f,v,b,w,S,x,R,k,T){this.snapshotDate=e,this.policyStartYear=t,this.weekNumber=r,this.chengduBranch=a,this.thirdLevelOrganization=n,this.customerCategory=i,this.insuranceType=l,this.businessTypeCategory=o,this.coverageType=s,this.renewalStatus=u,this.isNewEnergyVehicle=c,this.isTransferredVehicle=d,this.vehicleInsuranceGrade=m,this.highwayRiskGrade=_,this.largeTruckScore=g,this.smallTruckScore=p,this.terminalSource=h,this.signedPremiumYuan=y,this.maturedPremiumYuan=f,this.policyCount=v,this.claimCaseCount=b,this.reportedClaimPaymentYuan=w,this.expenseAmountYuan=S,this.commercialPremiumBeforeDiscountYuan=x,this.premiumPlanYuan=R,this.marginalContributionAmountYuan=k,this.secondLevelOrganization=T,this.validateInvariants()}}},57306:function(e,t,r){r.d(t,{Rm:function(){return a.R},tv:function(){return d},u_:function(){return n.u_},Qt:function(){return n.Qt},lE:function(){return m},DC:function(){return b},YV:function(){return v}});var a=r(22401),n=r(1207),i=r(97830);r(6479);var l=r(42959);let o=(0,l.w9)([{min:12,max:1/0,minScore:95,maxScore:100,level:"excellent",label:"优秀"},{min:8,max:12,minScore:86,maxScore:94,level:"good",label:"良好"},{min:6,max:8,minScore:70,maxScore:85,level:"medium",label:"中等"},{min:4,max:6,minScore:40,maxScore:69,level:"warning",label:"一般"},{min:0,max:4,minScore:20,maxScore:39,level:"warning",label:"较差"},{min:-5,max:0,minScore:0,maxScore:19,level:"danger",label:"严重"},{min:-1/0,max:-5,minScore:0,maxScore:0,level:"danger",label:"严重"}],!0),s=(0,l.w9)([{min:110,max:1/0,minScore:95,maxScore:100,level:"excellent",label:"卓越"},{min:100,max:110,minScore:86,maxScore:94,level:"good",label:"健康"},{min:90,max:100,minScore:70,maxScore:85,level:"medium",label:"预警"},{min:80,max:90,minScore:40,maxScore:69,level:"warning",label:"危险"},{min:50,max:80,minScore:0,maxScore:39,level:"danger",label:"高危"},{min:-1/0,max:50,minScore:0,maxScore:0,level:"danger",label:"高危"}],!0),u=(0,l.w9)([{min:0,max:50,minScore:95,maxScore:100,level:"excellent",label:"优秀"},{min:50,max:60,minScore:86,maxScore:94,level:"good",label:"良好"},{min:60,max:70,minScore:70,maxScore:85,level:"medium",label:"中等"},{min:70,max:80,minScore:40,maxScore:69,level:"warning",label:"预警"},{min:80,max:120,minScore:0,maxScore:39,level:"danger",label:"高危"},{min:120,max:1/0,minScore:0,maxScore:0,level:"danger",label:"高危"}],!1),c=(0,l.w9)([{min:0,max:7.5,minScore:95,maxScore:100,level:"excellent",label:"优秀"},{min:7.5,max:12.5,minScore:86,maxScore:94,level:"good",label:"良好"},{min:12.5,max:17.5,minScore:70,maxScore:85,level:"medium",label:"中等"},{min:17.5,max:22.5,minScore:40,maxScore:69,level:"warning",label:"一般"},{min:22.5,max:35,minScore:0,maxScore:39,level:"danger",label:"较差"},{min:35,max:1/0,minScore:0,maxScore:0,level:"danger",label:"较差"}],!1),d=[{key:"contribution_margin_ratio",label:"满期边际贡献率",shortLabel:"边贡率",description:"反映业务盈利能力的核心指标",unit:"%",scoringConfig:o},{key:"premium_time_progress_achievement_rate",label:"时间进度达成率",shortLabel:"进度达成",description:"保费目标完成进度与时间进度的匹配度",unit:"%",scoringConfig:s},{key:"loss_ratio",label:"满期赔付率",shortLabel:"赔付率",description:"赔款支出占保费收入的比例",unit:"%",scoringConfig:u},{key:"matured_claim_ratio",label:"满期出险率",shortLabel:"出险率",description:"出险保单占总保单的比例",unit:"%",scoringConfig:(0,l.w9)([{min:0,max:15,minScore:95,maxScore:100,level:"excellent",label:"优秀"},{min:15,max:25,minScore:86,maxScore:94,level:"good",label:"良好"},{min:25,max:35,minScore:70,maxScore:85,level:"medium",label:"中等"},{min:35,max:50,minScore:40,maxScore:69,level:"warning",label:"预警"},{min:50,max:80,minScore:0,maxScore:39,level:"danger",label:"高危"},{min:80,max:1/0,minScore:0,maxScore:0,level:"danger",label:"高危"}],!1)},{key:"expense_ratio",label:"费用率",shortLabel:"费用率",description:"费用支出占保费收入的比例",unit:"%",scoringConfig:c}];function m(e){let t=new Map;return d.forEach(r=>{let a=function(e,t){let r=(0,l.mB)(e,t.scoringConfig);return r?{...r,dimension:t.key}:null}(null==e?void 0:e[r.key],r);t.set(r.key,a)}),t}var _=r(95138),g=r.n(_),p=r(43875);let h=["snapshot_date","policy_start_year","business_type_category","chengdu_branch","third_level_organization","customer_category_3","insurance_type","is_new_energy_vehicle","coverage_type","is_transferred_vehicle","renewal_status","vehicle_insurance_grade","highway_risk_grade","large_truck_score","small_truck_score","terminal_source","signed_premium_yuan","matured_premium_yuan","policy_count","claim_case_count","reported_claim_payment_yuan","expense_amount_yuan","commercial_premium_before_discount_yuan","premium_plan_yuan","marginal_contribution_amount_yuan","week_number"],y={header:!0,delimiter:"",skipEmptyLines:!0,maxErrorRows:100},f=[{field:"snapshot_date",required:!0,type:"date"},{field:"policy_start_year",required:!0,type:"number"},{field:"week_number",required:!0,type:"number"},{field:"chengdu_branch",required:!0,type:"string"},{field:"third_level_organization",required:!0,type:"string"},{field:"business_type_category",required:!0,type:"string"},{field:"customer_category_3",required:!0,type:"string"},{field:"insurance_type",required:!0,type:"string"},{field:"coverage_type",required:!0,type:"string"},{field:"renewal_status",required:!0,type:"string"},{field:"terminal_source",required:!0,type:"string"},{field:"signed_premium_yuan",required:!0,type:"number"},{field:"matured_premium_yuan",required:!0,type:"number"},{field:"policy_count",required:!0,type:"number"},{field:"claim_case_count",required:!0,type:"number"},{field:"reported_claim_payment_yuan",required:!0,type:"number"},{field:"expense_amount_yuan",required:!0,type:"number"},{field:"commercial_premium_before_discount_yuan",required:!0,type:"number"},{field:"marginal_contribution_amount_yuan",required:!0,type:"number"},{field:"is_new_energy_vehicle",required:!0,type:"boolean"},{field:"is_transferred_vehicle",required:!0,type:"boolean"},{field:"premium_plan_yuan",required:!1,type:"number"},{field:"vehicle_insurance_grade",required:!1,type:"string"},{field:"highway_risk_grade",required:!1,type:"string"},{field:"large_truck_score",required:!1,type:"string"},{field:"small_truck_score",required:!1,type:"string"}];async function v(e){var t;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2?arguments[2]:void 0,n=Date.now(),i={...y,...r},l={success:!1,data:[],errors:[],warnings:[],statistics:{totalRows:0,successRows:0,errorRows:0,emptyRows:0,parseTime:0}},o=null!==(t=i.maxErrorRows)&&void 0!==t?t:100,s=e.size>10485760?262144:65536,u=!1,c=!1;try{await new Promise((t,r)=>{g().parse(e,{header:i.header,delimiter:i.delimiter,skipEmptyLines:i.skipEmptyLines,worker:!0,chunkSize:s,chunk:(t,r)=>{if(!u){let e=t.meta.fields||[];l.errors.push(...function(e){let t=[];if(!e||0===e.length)return t.push({type:"PARSE_ERROR",message:"CSV文件缺少表头，无法识别字段"}),t;for(let r of h)e.includes(r)||t.push({type:"VALIDATION_ERROR",field:r,message:"缺少必填字段：".concat(r)});return t}(e)),u=!0}let n=t.data||[];for(let e=0;e<n.length;e++){let t=l.statistics.totalRows,a=n[e];if(l.statistics.totalRows++,Object.values(a).every(e=>null==e||""===e)){l.statistics.emptyRows++;continue}let i=function(e,t){let r=[];for(let a of f){let n=e[a.field];if(a.required&&(null==n||""===n)){r.push({type:"VALIDATION_ERROR",row:t+1,field:a.field,message:"必填字段为空：".concat(a.field),rawValue:n});continue}if(null!=n&&""!==n){if(a.type){let e=!0;switch(a.type){case"string":e="string"==typeof n;break;case"number":e="number"==typeof n||!isNaN(Number(n));break;case"boolean":e="boolean"==typeof n||["true","false","是","否","1","0"].includes(String(n).toLowerCase());break;case"date":e=!isNaN(Date.parse(n))}e||r.push({type:"VALIDATION_ERROR",row:t+1,field:a.field,message:"字段类型错误：".concat(a.field," 期望 ").concat(a.type," 类型"),rawValue:n})}if(a.validator){let e=a.validator(n);!0!==e&&r.push({type:"VALIDATION_ERROR",row:t+1,field:a.field,message:"string"==typeof e?e:"字段验证失败：".concat(a.field),rawValue:n})}}}return r}(a,t);if(i.length>0){if(l.errors.push(...i),l.statistics.errorRows++,l.statistics.errorRows>=o){l.warnings.push("错误行数超过限制(".concat(o,")，停止处理后续行")),c=!0,r.abort();break}continue}let s=function(e,t){try{return{data:{snapshot_date:(0,p.P9)(e.snapshot_date,{defaultValue:""}).value,policy_start_year:(0,p.AE)(e.policy_start_year).value,week_number:(0,p.AE)(e.week_number).value,chengdu_branch:(0,p.bG)(e.chengdu_branch).value,third_level_organization:(0,p.bG)(e.third_level_organization).value,business_type_category:(0,p.bG)(e.business_type_category).value,customer_category_3:(0,p.bG)(e.customer_category_3).value,insurance_type:(0,p.bG)(e.insurance_type).value,coverage_type:(0,p.bG)(e.coverage_type).value,renewal_status:(0,p.bG)(e.renewal_status).value,terminal_source:(0,p.bG)(e.terminal_source).value,signed_premium_yuan:(0,p.AE)(e.signed_premium_yuan).value,matured_premium_yuan:(0,p.AE)(e.matured_premium_yuan).value,policy_count:(0,p.AE)(e.policy_count).value,claim_case_count:(0,p.AE)(e.claim_case_count).value,reported_claim_payment_yuan:(0,p.AE)(e.reported_claim_payment_yuan).value,expense_amount_yuan:(0,p.AE)(e.expense_amount_yuan).value,commercial_premium_before_discount_yuan:(0,p.AE)(e.commercial_premium_before_discount_yuan).value,marginal_contribution_amount_yuan:(0,p.AE)(e.marginal_contribution_amount_yuan).value,is_new_energy_vehicle:(0,p.t6)(e.is_new_energy_vehicle).value,is_transferred_vehicle:(0,p.t6)(e.is_transferred_vehicle).value,premium_plan_yuan:e.premium_plan_yuan?(0,p.AE)(e.premium_plan_yuan).value:null,vehicle_insurance_grade:e.vehicle_insurance_grade?(0,p.bG)(e.vehicle_insurance_grade).value:null,highway_risk_grade:e.highway_risk_grade?(0,p.bG)(e.highway_risk_grade).value:null,large_truck_score:e.large_truck_score?(0,p.bG)(e.large_truck_score).value:null,small_truck_score:e.small_truck_score?(0,p.bG)(e.small_truck_score).value:null}}}catch(r){return{error:{type:"TRANSFORM_ERROR",row:t+1,message:r instanceof Error?r.message:String(r),rawValue:e}}}}(a,t);if(s.error){if(l.errors.push(s.error),l.statistics.errorRows++,l.statistics.errorRows>=o){l.warnings.push("错误行数超过限制(".concat(o,")，停止处理后续行")),c=!0,r.abort();break}continue}s.data&&(l.data.push(s.data),l.statistics.successRows++)}let i="function"==typeof(null==r?void 0:r.getCharIndex)?r.getCharIndex():0;null==a||a({processedBytes:i,totalBytes:e.size,processedRows:l.statistics.totalRows})},complete:()=>t(),error:e=>r(e)})}),u||l.errors.push({type:"PARSE_ERROR",message:"CSV文件缺少表头，无法识别字段"})}catch(e){c||l.errors.push({type:"PARSE_ERROR",message:e instanceof Error?e.message:String(e)})}finally{l.statistics.parseTime=Date.now()-n,l.success=0===l.errors.length||l.statistics.successRows>0}return l}function b(e){let t=[],r=[];for(let a of e.data)try{let e=(0,i.IT)(a);t.push(e)}catch(e){r.push({type:"TRANSFORM_ERROR",message:e instanceof Error?e.message:String(e),rawValue:a})}return{records:t,errors:r}}r(88041)},97830:function(e,t,r){r.d(t,{IT:function(){return s},Vd:function(){return i},cH:function(){return u}});var a=r(22401),n=r(6479);function i(e){return(0,n.bG)(e,{removeZeroWidth:!0,normalizeSpaces:!0,trim:!0,collapseSpaces:!0}).value}function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(0,n.AE)(e,{defaultValue:t}).value}function o(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(0,n.t6)(e,{defaultValue:t}).value}function s(e){let t=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return(0,n.P9)(e,{defaultValue:t,format:"YYYY-MM-DD",autoFix:!0}).value}(e.snapshot_date,""),r=i(e.third_level_organization),s=i(e.customer_category_3),u=i(e.business_type_category),c=i(e.terminal_source),d=function(e){if(e<2e3||e>2100)throw Error("年份必须在 2000-2100 之间，当前值：".concat(e));return e}(l(e.policy_start_year)),m=function(e){if(e<1||e>105)throw Error("周序号必须在 1-105 之间，当前值：".concat(e));return e}(l(e.week_number)),_=l(e.signed_premium_yuan,0),g=l(e.matured_premium_yuan,0),p=l(e.policy_count,0),h=l(e.claim_case_count,0),y=l(e.reported_claim_payment_yuan,0),f=l(e.expense_amount_yuan,0),v=l(e.commercial_premium_before_discount_yuan,0),b=null!==e.premium_plan_yuan&&void 0!==e.premium_plan_yuan?l(e.premium_plan_yuan,0):null,w=l(e.marginal_contribution_amount_yuan,0),S=o(e.is_new_energy_vehicle,!1),x=o(e.is_transferred_vehicle,!1),R=e.vehicle_insurance_grade?i(e.vehicle_insurance_grade):null,k=e.highway_risk_grade?i(e.highway_risk_grade):null,T=e.large_truck_score?i(e.large_truck_score):null,D=e.small_truck_score?i(e.small_truck_score):null;return new a.R(t,d,m,e.chengdu_branch,r,s,e.insurance_type,u,e.coverage_type,e.renewal_status,S,x,R,k,T,D,c,_,g,p,h,y,f,v,b,w,e.second_level_organization)}function u(e){return e.map(e=>new a.R(e.snapshotDate,e.policyStartYear,e.weekNumber,e.chengduBranch,i(e.thirdLevelOrganization),i(e.customerCategory),e.insuranceType,i(e.businessTypeCategory),e.coverageType,e.renewalStatus,e.isNewEnergyVehicle,e.isTransferredVehicle,e.vehicleInsuranceGrade,e.highwayRiskGrade,e.largeTruckScore,e.smallTruckScore,i(e.terminalSource),e.signedPremiumYuan,e.maturedPremiumYuan,e.policyCount,e.claimCaseCount,e.reportedClaimPaymentYuan,e.expenseAmountYuan,e.commercialPremiumBeforeDiscountYuan,e.premiumPlanYuan,e.marginalContributionAmountYuan,e.secondLevelOrganization))}},1207:function(e,t,r){function a(e,t){return 0!==t&&Number.isFinite(t)&&Number.isFinite(e)?e/t:null}function n(e){return null===e?null:100*e}function i(e){return e?Math.min(e/50,1):Math.min(Math.ceil(Math.floor((Date.now()-new Date(new Date().getFullYear(),0,0).getTime())/864e5)/7)/50,1)}function l(e){return e.reduce((e,t)=>({signed_premium_yuan:e.signed_premium_yuan+t.signedPremiumYuan,matured_premium_yuan:e.matured_premium_yuan+t.maturedPremiumYuan,policy_count:e.policy_count+t.policyCount,claim_case_count:e.claim_case_count+t.claimCaseCount,reported_claim_payment_yuan:e.reported_claim_payment_yuan+t.reportedClaimPaymentYuan,expense_amount_yuan:e.expense_amount_yuan+t.expenseAmountYuan,commercial_premium_before_discount_yuan:e.commercial_premium_before_discount_yuan+t.commercialPremiumBeforeDiscountYuan,marginal_contribution_amount_yuan:e.marginal_contribution_amount_yuan+t.marginalContributionAmountYuan,premium_plan_yuan:0}),{signed_premium_yuan:0,matured_premium_yuan:0,policy_count:0,claim_case_count:0,reported_claim_payment_yuan:0,expense_amount_yuan:0,commercial_premium_before_discount_yuan:0,marginal_contribution_amount_yuan:0,premium_plan_yuan:0})}function o(e,t){return n(a(e,t))}function s(e,t){return n(a(e,t))}function u(e,t){return n(a(e,t))}function c(e,t,r,i){let l=a(e,t),o=a(r,i);return null===l||null===o?null:n(l+o)}function d(e,t){return a(e,t)}function m(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=l(e),d=t.annualTargetYuan?Math.max(0,t.annualTargetYuan):null,m=t.annualPolicyCountTarget?Math.max(0,Math.round(t.annualPolicyCountTarget)):null,_=o(r.reported_claim_payment_yuan,r.matured_premium_yuan),g=s(r.expense_amount_yuan,r.signed_premium_yuan),p=n(a(r.matured_premium_yuan,r.signed_premium_yuan)),h=u(r.marginal_contribution_amount_yuan,r.matured_premium_yuan),y=c(r.reported_claim_payment_yuan,r.matured_premium_yuan,r.expense_amount_yuan,r.signed_premium_yuan),f=n(a(r.claim_case_count,r.policy_count)),v=a(r.signed_premium_yuan,r.commercial_premium_before_discount_yuan),b=i(t.currentWeekNumber),w=a(r.signed_premium_yuan,d),S=null;"increment"===t.mode&&d>0?S=n(a(r.signed_premium_yuan,d/50)):null!==w&&b>0&&(S=w/b*100);let x=null!==m?a(r.policy_count,m):null,R=a(r.signed_premium_yuan,r.policy_count),k=a(r.reported_claim_payment_yuan,r.claim_case_count),T=a(r.expense_amount_yuan,r.policy_count),D=a(r.marginal_contribution_amount_yuan,r.policy_count);return{loss_ratio:_,expense_ratio:g,maturity_ratio:p,contribution_margin_ratio:h,variable_cost_ratio:y,matured_claim_ratio:f,autonomy_coefficient:v,premium_time_progress_achievement_rate:S,policy_count_time_progress_achievement_rate:null!==x&&b>0?x/b*100:null,signed_premium:Math.round(r.signed_premium_yuan/1e4),matured_premium:Math.round(r.matured_premium_yuan/1e4),policy_count:r.policy_count,claim_case_count:r.claim_case_count,reported_claim_payment:Math.round(r.reported_claim_payment_yuan/1e4),expense_amount:Math.round(r.expense_amount_yuan/1e4),contribution_margin_amount:Math.round(r.marginal_contribution_amount_yuan/1e4),average_premium:R,average_claim:k,average_expense:T,average_contribution:D,annual_premium_target:d?Math.round(d/1e4):null,annual_policy_count_target:m}}function _(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(0===e.length)return p();let a=l(e),n=t.length>0?l(t):{signed_premium_yuan:0,matured_premium_yuan:0,policy_count:0,claim_case_count:0,reported_claim_payment_yuan:0,expense_amount_yuan:0,commercial_premium_before_discount_yuan:0,marginal_contribution_amount_yuan:0,premium_plan_yuan:0},i=g({signed_premium_yuan:a.signed_premium_yuan-n.signed_premium_yuan,matured_premium_yuan:a.matured_premium_yuan-n.matured_premium_yuan,policy_count:a.policy_count-n.policy_count,claim_case_count:a.claim_case_count-n.claim_case_count,reported_claim_payment_yuan:a.reported_claim_payment_yuan-n.reported_claim_payment_yuan,expense_amount_yuan:a.expense_amount_yuan-n.expense_amount_yuan,commercial_premium_before_discount_yuan:a.commercial_premium_before_discount_yuan-n.commercial_premium_before_discount_yuan,marginal_contribution_amount_yuan:a.marginal_contribution_amount_yuan-n.marginal_contribution_amount_yuan,premium_plan_yuan:a.premium_plan_yuan-n.premium_plan_yuan},{...r,mode:"increment"}),o=g(a,{...r,mode:"current"});return{loss_ratio:o.loss_ratio,maturity_ratio:o.maturity_ratio,expense_ratio:o.expense_ratio,contribution_margin_ratio:o.contribution_margin_ratio,variable_cost_ratio:o.variable_cost_ratio,matured_claim_ratio:o.matured_claim_ratio,autonomy_coefficient:o.autonomy_coefficient,signed_premium:i.signed_premium,matured_premium:i.matured_premium,policy_count:i.policy_count,claim_case_count:i.claim_case_count,reported_claim_payment:i.reported_claim_payment,expense_amount:i.expense_amount,contribution_margin_amount:i.contribution_margin_amount,average_premium:i.average_premium,average_claim:i.average_claim,average_expense:i.average_expense,average_contribution:i.average_contribution,premium_time_progress_achievement_rate:i.premium_time_progress_achievement_rate,policy_count_time_progress_achievement_rate:i.policy_count_time_progress_achievement_rate,annual_premium_target:i.annual_premium_target,annual_policy_count_target:i.annual_policy_count_target}}function g(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.annualTargetYuan?Math.max(0,t.annualTargetYuan):null,l=t.annualPolicyCountTarget?Math.max(0,Math.round(t.annualPolicyCountTarget)):null,d=null!=r?r:e.premium_plan_yuan,m=o(e.reported_claim_payment_yuan,e.matured_premium_yuan),_=s(e.expense_amount_yuan,e.signed_premium_yuan),g=n(a(e.matured_premium_yuan,e.signed_premium_yuan)),p=u(e.marginal_contribution_amount_yuan,e.matured_premium_yuan),h=c(e.reported_claim_payment_yuan,e.matured_premium_yuan,e.expense_amount_yuan,e.signed_premium_yuan),y=n(a(e.claim_case_count,e.policy_count)),f=a(e.signed_premium_yuan,e.commercial_premium_before_discount_yuan),v=i(t.currentWeekNumber),b=a(e.signed_premium_yuan,d),w=null;"increment"===t.mode&&d>0?w=n(a(e.signed_premium_yuan,d/50)):null!==b&&v>0&&(w=b/v*100);let S=null!==l?a(e.policy_count,l):null,x=a(e.signed_premium_yuan,e.policy_count),R=a(e.reported_claim_payment_yuan,e.claim_case_count),k=a(e.expense_amount_yuan,e.policy_count),T=a(e.marginal_contribution_amount_yuan,e.policy_count);return{loss_ratio:m,expense_ratio:_,maturity_ratio:g,contribution_margin_ratio:p,variable_cost_ratio:h,matured_claim_ratio:y,autonomy_coefficient:f,premium_time_progress_achievement_rate:w,policy_count_time_progress_achievement_rate:null!==S&&v>0?S/v*100:null,signed_premium:Math.round(e.signed_premium_yuan/1e4),matured_premium:Math.round(e.matured_premium_yuan/1e4),policy_count:e.policy_count,claim_case_count:e.claim_case_count,reported_claim_payment:Math.round(e.reported_claim_payment_yuan/1e4),expense_amount:Math.round(e.expense_amount_yuan/1e4),contribution_margin_amount:Math.round(e.marginal_contribution_amount_yuan/1e4),average_premium:x,average_claim:R,average_expense:k,average_contribution:T,annual_premium_target:r?Math.round(r/1e4):null,annual_policy_count_target:l}}function p(){return{loss_ratio:null,expense_ratio:null,maturity_ratio:null,contribution_margin_ratio:null,variable_cost_ratio:null,matured_claim_ratio:null,autonomy_coefficient:null,premium_time_progress_achievement_rate:null,policy_count_time_progress_achievement_rate:null,signed_premium:0,matured_premium:0,policy_count:0,claim_case_count:0,reported_claim_payment:0,expense_amount:0,contribution_margin_amount:0,average_premium:null,average_claim:null,average_expense:null,average_contribution:null,annual_premium_target:null,annual_policy_count_target:null}}r.d(t,{Oc:function(){return d},Qt:function(){return m},bA:function(){return s},nR:function(){return o},oR:function(){return u},u_:function(){return _},vF:function(){return c}});class h{generateCacheKey(e,t,r){return"".concat(t||"current","_").concat(e.length,"_").concat(e.reduce((e,t)=>e+t.signedPremiumYuan,0)).concat(r?"_".concat(Math.round(r)):"")}calculate(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{annualTargetYuan:r=null,useCache:a=!0,mode:n="current",currentWeekNumber:i=null,year:l=null}=t;if(0===e.length)return p();let o=this.generateCacheKey(e,n,r);if(a&&this.cache.has(o))return this.cache.get(o);let s=m(e,{annualTargetYuan:null!=r?r:null,mode:n,currentWeekNumber:i,year:l});return a&&this.cache.set(o,s),s}calculateIncrement(e,t){var r,a,n,i,o,s,u,c;let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{useCache:m=!0,mode:g="increment",annualTargetYuan:h=null,currentWeekNumber:y=null,year:f=null}=d;if(0===e.length)return p();let v=null!==(o=null===(r=e[0])||void 0===r?void 0:r.weekNumber)&&void 0!==o?o:0,b=null!==(s=null===(a=e[0])||void 0===a?void 0:a.policyStartYear)&&void 0!==s?s:0,w=null!==(u=null===(n=t[0])||void 0===n?void 0:n.weekNumber)&&void 0!==u?u:0,S=null!==(c=null===(i=t[0])||void 0===i?void 0:i.policyStartYear)&&void 0!==c?c:0,x=e=>{if(0===e.length)return"0";let t=l(e);return[t.signed_premium_yuan.toFixed(2),t.matured_premium_yuan.toFixed(2),t.policy_count,t.claim_case_count,t.reported_claim_payment_yuan.toFixed(2),t.expense_amount_yuan.toFixed(2)].join("_")},R=x(e),k=x(t),T="inc_".concat(b,"w").concat(v,"_").concat(R,"_").concat(S,"w").concat(w,"_").concat(k).concat(h?"_t".concat(Math.round(h)):"");if(m&&this.cache.has(T))return this.cache.get(T);let D=_(e,t,{mode:g,annualTargetYuan:h,currentWeekNumber:y,year:f});return m&&this.cache.set(T,D),D}clearCache(){this.cache.clear()}constructor(){this.cache=new Map}}new h},6479:function(e,t,r){r.d(t,{AE:function(){return a.AE},P9:function(){return a.P9},bG:function(){return a.bG},t6:function(){return a.t6}}),r(42959);var a=r(43875)},43875:function(e,t,r){function a(e,t){try{let r;if(null==e){if(t.allowNull)return{value:e,success:!0,originalValue:e};return{value:t.defaultValue,success:!0,originalValue:e}}if(r=t.transformer?t.transformer(e):e,t.validationRules)for(let a of t.validationRules){let n=a.validate(r);if(!1===n)return{value:t.defaultValue,success:!1,originalValue:e,error:a.message||"验证失败"};if("string"==typeof n)return{value:t.defaultValue,success:!1,originalValue:e,error:n}}return{value:r,success:!0,originalValue:e}}catch(r){return{value:t.defaultValue,success:!1,originalValue:e,error:r instanceof Error?r.message:String(r)}}}function n(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r={defaultValue:"",removeZeroWidth:!0,normalizeSpaces:!0,trim:!0,collapseSpaces:!0,allowNull:!1,...t};return a(e,{defaultValue:r.defaultValue,allowNull:r.allowNull,transformer:e=>{if("string"!=typeof e)return r.defaultValue;let t=e;return r.removeZeroWidth&&(t=t.replace(/[\u200B-\u200D\uFEFF\uFFFD]/g,"")),r.normalizeSpaces&&(t=t.replace(/\u3000/g," ")),r.trim&&(t=t.trim()),r.collapseSpaces&&(t=t.replace(/\s+/g," ")),r.toLowerCase?t=t.toLowerCase():r.toUpperCase&&(t=t.toUpperCase()),t}})}function i(e){var t,r;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i={defaultValue:0,allowNegative:!0,allowNull:!1,...n};return a(e,{defaultValue:i.defaultValue,allowNull:i.allowNull,transformer:e=>{let t;if("number"==typeof e&&Number.isFinite(e))t=e;else if("string"==typeof e){let r=e.trim();if(""===r)return i.defaultValue;let a=Number(r);if(!Number.isFinite(a))return i.defaultValue;t=a}else{if("boolean"!=typeof e)return i.defaultValue;t=e?1:0}if(void 0!==i.decimals&&"number"==typeof t){let e=Math.pow(10,i.decimals);t=Math.round(t*e)/e}return t},validationRules:void 0!==i.min||void 0!==i.max?[{validate:e=>(void 0===i.min||!(e<i.min))&&(void 0===i.max||!(e>i.max))&&(!!i.allowNegative||!(e<0)),message:"数字必须在".concat(null!==(t=i.min)&&void 0!==t?t:"-∞","到").concat(null!==(r=i.max)&&void 0!==r?r:"∞","之间")}]:void 0})}function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r={defaultValue:!1,allowNull:!1,...t};return a(e,{defaultValue:r.defaultValue,allowNull:r.allowNull,transformer:e=>{if("boolean"==typeof e)return e;if("number"==typeof e)return 0!==e;if("string"==typeof e){let t=e.toLowerCase().trim();if(["true","是","yes","1","on","enabled"].includes(t))return!0;if(["false","否","no","0","off","disabled"].includes(t))return!1}return r.defaultValue}})}function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r={defaultValue:"",format:"YYYY-MM-DD",autoFix:!0,allowNull:!1,...t};return a(e,{defaultValue:r.defaultValue,allowNull:r.allowNull,transformer:e=>{if("string"!=typeof e)return r.defaultValue;let t=e.trim();if("YYYY-MM-DD"===r.format&&/^\d{4}-\d{2}-\d{2}$/.test(t)||"YYYY/MM/DD"===r.format&&/^\d{4}\/\d{2}\/\d{2}$/.test(t))return t;if(r.autoFix){if(/^\d{4}[\/\.]\d{2}[\/\.]\d{2}$/.test(t)){let e=t.replace(/[\/\.]/g,"-");if("YYYY-MM-DD"===r.format)return e}if(/^\d{4}-\d{2}-\d{2}$/.test(t)&&"YYYY/MM/DD"===r.format)return t.replace(/-/g,"/")}return r.defaultValue}})}r.d(t,{AE:function(){return i},P9:function(){return o},bG:function(){return n},t6:function(){return l}})},42959:function(e,t,r){r.d(t,{mB:function(){return n},w9:function(){return i}});let a={excellent:"#2E7D32",good:"#4CAF50",medium:"#1976D2",warning:"#FBC02D",danger:"#D32F2F"};function n(e,t){var r;let a;if(null==e||isNaN(e))return null;let n=t.thresholds.find(t=>e>=t.min&&(t.max===1/0||e<t.max));if(!n)return null;let i=n.max-n.min,l=n.maxScore-n.minScore;if(0===i)a=n.minScore;else{let t=(e-n.min)/i;a=n.minScore+t*l}t.isPositive||(a=n.maxScore-(a-n.minScore)),a=Math.max(0,Math.min(100,a));let o=null!==(r=t.precision)&&void 0!==r?r:1;return{score:a=Math.round(a*Math.pow(10,o))/Math.pow(10,o),rawValue:e,level:n.level,label:n.label,color:n.color}}function i(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return{thresholds:e.map(e=>({...e,color:a[e.level]})),isPositive:t,defaultValue:r,precision:n}}},76066:function(e,t,r){r.d(t,{a:function(){return o}});var a=r(90616),n=r(32522),i=r(27078),l=r(21782);function o(){let e=(0,n.r)(e=>e.filters),t=(0,n.r)(e=>e.updateFilters),r=(0,n.r)(e=>e.resetFilters),o=(0,n.r)(e=>e.setViewMode),s=(0,n.r)(e=>e.setDataViewType),u=(0,n.r)(e=>e.getActiveFilterCount),c=(0,n.r)(e=>e.isFilterActive),d=(0,i.qr)(e=>e.updateFilters),m=(0,i.qr)(e=>e.resetFilters),_=(0,i.qr)(e=>e.setViewMode),g=(0,a.useCallback)(e=>{t(e),d(e)},[t,d]),p=(0,a.useCallback)(()=>{r(),m()},[r,m]),h=(0,a.useCallback)(e=>{o(e),_(e)},[o,_]),y=(0,a.useCallback)(e=>{s(e),d({dataViewType:e})},[s,d]),f=(0,a.useCallback)(e=>{g({years:e})},[g]),v=(0,a.useCallback)(e=>{g({weeks:e})},[g]),b=(0,a.useCallback)(e=>{g({singleModeWeek:e,weeks:null!==e?[e]:[]})},[g]),w=(0,a.useCallback)(e=>{g({organizations:e})},[g]),S=(0,a.useCallback)(e=>{g({businessTypes:e})},[g]),x=(0,a.useCallback)(t=>{if(h(t),"single"===t){var r;let t=null!==(r=e.singleModeWeek)&&void 0!==r?r:e.weeks&&e.weeks.length>0?e.weeks[e.weeks.length-1]:null;g({singleModeWeek:t,weeks:null!==t?[t]:[]})}else{let t=e.trendModeWeeks&&e.trendModeWeeks.length>0?[...e.trendModeWeeks]:e.weeks&&e.weeks.length>0?[...e.weeks]:[];g({trendModeWeeks:t,weeks:t})}},[e,h,g]);return{filters:e,updateFilters:g,resetFilters:p,setViewMode:h,switchViewMode:x,setDataViewType:y,setYears:f,setWeeks:v,setSingleModeWeek:b,setOrganizations:w,setBusinessTypes:S,activeFilterCount:u(),isFilterActive:c,viewMode:e.viewMode,dataViewType:e.dataViewType,currentWeek:e.singleModeWeek,selectedYear:e.years&&e.years.length>0?(0,l.FT)(e.years):new Date().getFullYear()}}},62658:function(e,t,r){r.d(t,{_V:function(){return o}});var a=r(90616),n=r(77911),i=r(32522),l=r(69690);function o(){let e=(0,n.a)(e=>e.rawData),t=(0,n.a)(e=>e.isLoading),r=(0,n.a)(e=>e.error),o=(0,i.r)(e=>e.filters),s=(0,a.useMemo)(()=>l.D.filter(e,o),[e,o]),u=(0,a.useMemo)(()=>l.D.getStatistics(s),[s]),c=(0,a.useMemo)(()=>l.D.getStatistics(e),[e]);return{rawData:e,filteredData:s,stats:u,rawStats:c,isLoading:t,error:r,hasData:e.length>0,filterPercentage:e.length>0?(s.length/e.length*100).toFixed(1):"0"}}},87123:function(e,t,r){r.d(t,{pm:function(){return m}});var a=r(90616);let n=0,i=new Map,l=e=>{if(i.has(e))return;let t=setTimeout(()=>{i.delete(e),c({type:"REMOVE_TOAST",toastId:e})},1e6);i.set(e,t)},o=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:r}=t;return r?l(r):e.toasts.forEach(e=>{l(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===r||void 0===r?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},s=[],u={toasts:[]};function c(e){u=o(u,e),s.forEach(e=>{e(u)})}function d(e){let{...t}=e,r=(n=(n+1)%Number.MAX_SAFE_INTEGER).toString(),a=()=>c({type:"DISMISS_TOAST",toastId:r});return c({type:"ADD_TOAST",toast:{...t,id:r,open:!0,onOpenChange:e=>{e||a()}}}),{id:r,dismiss:a,update:e=>c({type:"UPDATE_TOAST",toast:{...e,id:r}})}}function m(){let[e,t]=a.useState(u);return a.useEffect(()=>(s.push(t),()=>{let e=s.indexOf(t);e>-1&&s.splice(e,1)}),[e]),{...e,toast:d,dismiss:e=>c({type:"DISMISS_TOAST",toastId:e})}}},26992:function(e,t,r){r.d(t,{cn:function(){return i}});var a=r(53413),n=r(83877);function i(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,n.m6)((0,a.W)(t))}},21782:function(e,t,r){function a(e){if(0===e.length)return-1/0;let t=e[0];for(let r=1;r<e.length;r++)e[r]>t&&(t=e[r]);return t}function n(e){if(0===e.length)return{min:1/0,max:-1/0};let t=e[0],r=e[0];for(let a=1;a<e.length;a++){let n=e[a];n<t&&(t=n),n>r&&(r=n)}return{min:t,max:r}}r.d(t,{FT:function(){return a},ku:function(){return n}})},48134:function(e,t,r){function a(e,t){let r=new Date(Date.UTC(e,0,1)).getUTCDay(),a=new Date(Date.UTC(e,0,1+(6===r?0:(6-r+7)%7))),n=new Date(a);return n.setUTCDate(a.getUTCDate()+(t-1)*7),n}function n(e){let t=new Date(Date.UTC(e.getUTCFullYear(),0,1));return Math.ceil((e.getTime()-t.getTime())/864e5)}function i(e,t){return n(a(e,t))/365}r.d(t,{$:function(){return i},iR:function(){return n},ke:function(){return a}})},69690:function(e,t,r){r.d(t,{D:function(){return o}});var a=r(60373),n=r(97830),i=r(57306),l=(r(45293),r(4121));l.env.NEXT_PUBLIC_SUPABASE_URL,l.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;class o{static async fetchAllData(){return console.log("[DataService] 当前使用本地数据模式，不从数据库获取数据"),[]}static filter(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=new Set(r);return e.filter(e=>{if(!i.has("years")&&t.years&&t.years.length>0&&!t.years.includes(e.policy_start_year)||!i.has("weeks")&&t.weeks&&t.weeks.length>0&&!t.weeks.includes(e.week_number)||!i.has("organizations")&&t.organizations&&t.organizations.length>0&&!t.organizations.includes((0,n.Vd)(e.third_level_organization))||!i.has("insuranceTypes")&&t.insuranceTypes&&t.insuranceTypes.length>0&&!t.insuranceTypes.includes(e.insurance_type))return!1;if(!i.has("businessTypes")&&t.businessTypes&&t.businessTypes.length>0){let r=(0,a.gX)(e.business_type_category);if(!t.businessTypes.includes(r))return!1}return(!!i.has("coverageTypes")||!t.coverageTypes||!(t.coverageTypes.length>0)||!!t.coverageTypes.includes(e.coverage_type))&&(!!i.has("customerCategories")||!t.customerCategories||!(t.customerCategories.length>0)||!!t.customerCategories.includes((0,n.Vd)(e.customer_category_3)))&&(!!i.has("vehicleGrades")||!t.vehicleGrades||!(t.vehicleGrades.length>0)||!e.vehicle_insurance_grade||!!t.vehicleGrades.includes(e.vehicle_insurance_grade))&&(!!i.has("terminalSources")||!t.terminalSources||!(t.terminalSources.length>0)||!!t.terminalSources.includes((0,n.Vd)(e.terminal_source)))&&(!!i.has("isNewEnergy")||null===t.isNewEnergy||void 0===t.isNewEnergy||e.is_new_energy_vehicle===t.isNewEnergy)&&(!!i.has("renewalStatuses")||!t.renewalStatuses||!(t.renewalStatuses.length>0)||!!t.renewalStatuses.includes(e.renewal_status))})}static getByWeek(e,t,r){let a={...this.getDefaultFilters(),...r,weeks:[t]};return this.filter(e,a)}static getByWeekRange(e,t,r){let[a,n]=t,i=Array.from({length:n-a+1},(e,t)=>a+t),l={...this.getDefaultFilters(),...r,weeks:i};return this.filter(e,l)}static deduplicate(e){let t=new Set,r=[];for(let a of e){let e="".concat(a.snapshot_date,"_").concat(a.week_number,"_").concat(a.policy_start_year,"_").concat(a.third_level_organization,"_").concat(a.customer_category_3,"_").concat(a.insurance_type,"_").concat(a.business_type_category);t.has(e)||(t.add(e),r.push(a))}return r}static merge(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];let a=t.flat();return this.deduplicate(a)}static groupBy(e,t){let r=new Map;for(let a of e){let e=a[t],n=r.get(e)||[];n.push(a),r.set(e,n)}return r}static getStatistics(e){if(0===e.length)return{totalRecords:0,totalPremium:0,totalPolicyCount:0,uniqueWeeks:[],uniqueOrganizations:[],dateRange:null};let t=e.reduce((e,t)=>e+t.signed_premium_yuan,0),r=e.reduce((e,t)=>e+t.policy_count,0),a=Array.from(new Set(e.map(e=>e.week_number))).sort((e,t)=>e-t),i=Array.from(new Set(e.map(e=>(0,n.Vd)(e.third_level_organization)))).sort(),l=e.map(e=>e.snapshot_date).sort(),o={min:l[0],max:l[l.length-1]};return{totalRecords:e.length,totalPremium:t,totalPolicyCount:r,uniqueWeeks:a,uniqueOrganizations:i,dateRange:o}}static normalize(e){let t=e.map(e=>i.Rm.fromRawData(e));return(0,n.cH)(t).map(e=>e.toRawData())}static getAvailableOptions(e,t,r){let a={...t};delete a[r];let i=this.filter(e,a,[r]),l=new Set;switch(r){case"years":return i.forEach(e=>l.add(e.policy_start_year)),Array.from(l).sort((e,t)=>t-e);case"weeks":return i.forEach(e=>l.add(e.week_number)),Array.from(l).sort((e,t)=>t-e);case"organizations":return i.forEach(e=>l.add((0,n.Vd)(e.third_level_organization))),Array.from(l).sort();case"businessTypes":return i.forEach(e=>l.add((0,n.Vd)(e.business_type_category))),Array.from(l).sort();case"customerCategories":return i.forEach(e=>l.add((0,n.Vd)(e.customer_category_3))),Array.from(l).sort();default:return[]}}static getDefaultFilters(){return{viewMode:"single",dataViewType:"current",years:[],weeks:[],singleModeWeek:null,trendModeWeeks:[],organizations:[],insuranceTypes:[],businessTypes:[],coverageTypes:[],customerCategories:[],vehicleGrades:[],terminalSources:[],isNewEnergy:null,renewalStatuses:[]}}}},77911:function(e,t,r){r.d(t,{a:function(){return d}});var a=r(8798),n=r(5379),i=r(69690);class l extends Error{constructor(e,t,r){super(e),this.code=t,this.originalError=r,this.name="PersistenceError"}}class o{getFullKey(e){return"".concat(this.prefix,"_").concat(e)}async save(e,t){let r=this.getFullKey(e);try{let a=JSON.stringify(t);localStorage.setItem(r,a),console.log("[LocalStorage] 已保存数据: ".concat(e," (").concat(this.formatSize(a.length),")"))}catch(t){if(t instanceof Error){if("QuotaExceededError"===t.name)throw new l("存储空间不足，无法保存数据: ".concat(e),"QUOTA_EXCEEDED",t);if(t.message.includes("circular")||t.message.includes("serialize"))throw new l("数据序列化失败: ".concat(e),"SERIALIZATION_ERROR",t)}throw new l("保存数据失败: ".concat(e),"UNKNOWN",t instanceof Error?t:void 0)}}async load(e){let t=this.getFullKey(e);try{let r=localStorage.getItem(t);if(null===r)return null;let a=JSON.parse(r);return console.log("[LocalStorage] 已加载数据: ".concat(e)),a}catch(t){return console.error("[LocalStorage] 加载数据失败: ".concat(e),t),null}}async remove(e){let t=this.getFullKey(e);localStorage.removeItem(t),console.log("[LocalStorage] 已删除数据: ".concat(e))}async clear(){let e=[];for(let t=0;t<localStorage.length;t++){let r=localStorage.key(t);r&&r.startsWith("".concat(this.prefix,"_"))&&e.push(r)}e.forEach(e=>localStorage.removeItem(e)),console.log("[LocalStorage] 已清空所有数据 (共 ".concat(e.length," 项)"))}async has(e){let t=this.getFullKey(e);return null!==localStorage.getItem(t)}async getStats(){let e,t=0,r=0;for(let e=0;e<localStorage.length;e++){let a=localStorage.key(e);if(a&&a.startsWith("".concat(this.prefix,"_"))){r++;let e=localStorage.getItem(a);e&&(t+=(a.length+e.length)*2)}}try{let t="".concat(this.prefix,"_test_capacity"),r="x".repeat(1048576);localStorage.setItem(t,r),localStorage.removeItem(t),e=1048576}catch(t){e=0}return{totalKeys:r,totalSize:t,availableSpace:e}}formatSize(e){return e<1024?"".concat(e," B"):e<1048576?"".concat((e/1024).toFixed(2)," KB"):"".concat((e/1048576).toFixed(2)," MB")}constructor(e="insuralytics"){this.prefix=e}}let s={RAW_DATA:"raw_data",STORAGE_INFO:"storage_info",UPLOAD_HISTORY:"upload_history",PREMIUM_TARGETS:"premium_targets",FILTER_STATE:"filter_state"};class u{async saveRawData(e){try{let t=this.calculateDataHash(e),r={lastUpdated:new Date().toISOString(),totalRecords:e.length,dataHash:t,version:this.version};await this.adapter.save(s.RAW_DATA,e),await this.adapter.save(s.STORAGE_INFO,r),console.log("[PersistenceService] 数据已保存，共 ".concat(e.length," 条记录"))}catch(e){throw console.error("[PersistenceService] 保存数据失败:",e),e}}async loadRawData(){try{let e=await this.adapter.load(s.RAW_DATA);return e&&console.log("[PersistenceService] 加载数据成功，共 ".concat(e.length," 条记录")),e}catch(e){return console.error("[PersistenceService] 加载数据失败:",e),null}}async getStorageInfo(){return await this.adapter.load(s.STORAGE_INFO)}async addUploadHistory(e,t){try{let r=await this.getUploadHistory(),a=await Promise.all(t.map(async(t,r)=>{var a,n,i;let l=e.results[r],o=await this.calculateFileHash(t);return{name:t.name,size:t.size,hash:o,recordCount:(null==l?void 0:null===(a=l.result)||void 0===a?void 0:a.processedRecords)||0,validRecords:(null==l?void 0:null===(n=l.result)||void 0===n?void 0:n.successRecords)||0,invalidRecords:(null==l?void 0:null===(i=l.result)||void 0===i?void 0:i.failedRecords)||0}})),n={id:"upload_".concat(Date.now(),"_").concat(Math.random().toString(36).slice(2,8)),timestamp:new Date().toISOString(),files:a,totalRecords:e.totalRecords,validRecords:e.validRecords,invalidRecords:e.invalidRecords,status:0===e.failureCount?"success":e.successCount>0?"partial":"failed"};r.unshift(n),r.length>50&&r.splice(50),await this.adapter.save(s.UPLOAD_HISTORY,r),console.log("[PersistenceService] 已添加上传历史记录: ".concat(n.id))}catch(e){console.error("[PersistenceService] 添加上传历史失败:",e)}}async getUploadHistory(){return await this.adapter.load(s.UPLOAD_HISTORY)||[]}async checkFileExists(e){try{let t=await this.calculateFileHash(e);for(let r of(await this.getUploadHistory())){let a=r.files.find(r=>r.hash===t&&r.name===e.name);if(a)return{exists:!0,uploadRecord:r,fileInfo:a}}return{exists:!1}}catch(e){return console.error("[PersistenceService] 检查文件是否存在失败:",e),{exists:!1}}}async savePremiumTargets(e){await this.adapter.save(s.PREMIUM_TARGETS,e)}async loadPremiumTargets(){return await this.adapter.load(s.PREMIUM_TARGETS)}async saveFilterState(e){await this.adapter.save(s.FILTER_STATE,e)}async loadFilterState(){return await this.adapter.load(s.FILTER_STATE)}async clearAll(){await this.adapter.clear(),console.log("[PersistenceService] 已清空所有存储数据")}async getStats(){let e=await this.adapter.getStats(),t=await this.getStorageInfo();return{...e,hasData:null!==t&&t.totalRecords>0,totalRecords:(null==t?void 0:t.totalRecords)||0,lastUpdated:(null==t?void 0:t.lastUpdated)||null,uploadCount:(await this.getUploadHistory()).length}}calculateDataHash(e){let t=JSON.stringify(e.map(e=>({week:e.week_number,year:e.policy_start_year,organization:e.third_level_organization,premium:e.signed_premium_yuan,policy_count:e.policy_count}))),r=0;for(let e=0;e<t.length;e++)r=(r<<5)-r+t.charCodeAt(e),r&=r;return Math.abs(r).toString(36)}calculateFileHash(e){return new Promise(t=>{let r=new FileReader;r.onload=e=>{var r;let a=null===(r=e.target)||void 0===r?void 0:r.result,n=0;for(let e=0;e<a.length;e++)n=(n<<5)-n+a.charCodeAt(e),n&=n;t(Math.abs(n).toString(36))},r.readAsText(e)})}constructor(e){this.version="1.0.0",this.adapter=e||new o("insuralytics")}}let c=new u,d=(0,a.U)()((0,n.mW)((e,t)=>({rawData:[],isLoading:!1,error:null,uploadProgress:0,setData:async function(r){let a=!(arguments.length>1)||void 0===arguments[1]||arguments[1];try{let n=i.D.normalize(r);e({rawData:n,error:null},!1,"setData"),a&&await t().saveToStorage(),console.log("[DataStore] 数据已设置，共 ".concat(n.length," 条记录"))}catch(r){let t=r instanceof Error?r:Error("设置数据失败");throw e({error:t},!1,"setData:error"),t}},appendData:async function(r){let a=!(arguments.length>1)||void 0===arguments[1]||arguments[1];try{let n=t().rawData,l=i.D.normalize(r),o=i.D.merge(n,l);e({rawData:o,error:null},!1,"appendData"),a&&await t().saveToStorage(),console.log("[DataStore] 数据已追加，原有 ".concat(n.length," 条，新增 ").concat(l.length," 条，去重后共 ").concat(o.length," 条"))}catch(r){let t=r instanceof Error?r:Error("追加数据失败");throw e({error:t},!1,"appendData:error"),t}},clearData:async function(){let t=!(arguments.length>0)||void 0===arguments[0]||arguments[0];e({rawData:[],error:null},!1,"clearData"),t&&await c.clearAll(),console.log("[DataStore] 数据已清空")},loadFromStorage:async()=>{try{e({isLoading:!0},!1,"loadFromStorage:start");let r=await c.loadRawData();r&&r.length>0?(await t().setData(r,!1),console.log("[DataStore] 从本地存储加载数据成功")):console.log("[DataStore] 本地存储中没有数据")}catch(t){e({error:t instanceof Error?t:Error("从本地存储加载数据失败")},!1,"loadFromStorage:error"),console.error("[DataStore] 加载数据失败:",t)}finally{e({isLoading:!1},!1,"loadFromStorage:end")}},saveToStorage:async()=>{try{let{rawData:e}=t();await c.saveRawData(e),console.log("[DataStore] 数据已保存到本地存储")}catch(e){throw console.error("[DataStore] 保存数据到本地存储失败:",e),e}},setLoading:t=>{e({isLoading:t},!1,"setLoading")},setError:t=>{e({error:t,isLoading:!1},!1,"setError")},setUploadProgress:t=>{e({uploadProgress:t},!1,"setUploadProgress")},getStats:()=>{let{rawData:e}=t();return i.D.getStatistics(e)},hasData:()=>t().rawData.length>0}),{name:"data-store"}))},32522:function(e,t,r){r.d(t,{r:function(){return o}});var a=r(8798),n=r(5379),i=r(97830);let l={viewMode:"single",dataViewType:"current",years:[],weeks:[],singleModeWeek:null,trendModeWeeks:[],organizations:[],insuranceTypes:[],businessTypes:[],coverageTypes:[],customerCategories:[],vehicleGrades:[],terminalSources:[],isNewEnergy:null,renewalStatuses:[]},o=(0,a.U)()((0,n.mW)((0,n.tJ)((e,t)=>({filters:l,updateFilters:t=>{e(e=>{var r,a,n,l,o,s,u,c;return{filters:{...e.filters,...t,organizations:(null!==(r=t.organizations)&&void 0!==r?r:e.filters.organizations).map(i.Vd),insuranceTypes:(null!==(a=t.insuranceTypes)&&void 0!==a?a:e.filters.insuranceTypes).map(i.Vd),businessTypes:null!==(n=t.businessTypes)&&void 0!==n?n:e.filters.businessTypes,coverageTypes:(null!==(l=t.coverageTypes)&&void 0!==l?l:e.filters.coverageTypes).map(i.Vd),customerCategories:(null!==(o=t.customerCategories)&&void 0!==o?o:e.filters.customerCategories).map(i.Vd),vehicleGrades:(null!==(s=t.vehicleGrades)&&void 0!==s?s:e.filters.vehicleGrades).map(i.Vd),renewalStatuses:(null!==(u=t.renewalStatuses)&&void 0!==u?u:e.filters.renewalStatuses).map(i.Vd),terminalSources:(null!==(c=t.terminalSources)&&void 0!==c?c:e.filters.terminalSources).map(i.Vd)}}},!1,"updateFilters")},resetFilters:()=>{e({filters:l},!1,"resetFilters")},setViewMode:t=>{e(e=>({filters:{...e.filters,viewMode:t}}),!1,"setViewMode")},setDataViewType:t=>{e(e=>({filters:{...e.filters,dataViewType:t}}),!1,"setDataViewType")},getActiveFilterCount:()=>{let{filters:e}=t(),r=0;return e.years&&e.years.length>0&&r++,e.weeks&&e.weeks.length>0&&r++,e.organizations&&e.organizations.length>0&&r++,e.insuranceTypes&&e.insuranceTypes.length>0&&r++,e.businessTypes&&e.businessTypes.length>0&&r++,e.coverageTypes&&e.coverageTypes.length>0&&r++,e.customerCategories&&e.customerCategories.length>0&&r++,e.vehicleGrades&&e.vehicleGrades.length>0&&r++,e.terminalSources&&e.terminalSources.length>0&&r++,null!==e.isNewEnergy&&r++,e.renewalStatuses&&e.renewalStatuses.length>0&&r++,r},isFilterActive:e=>{let{filters:r}=t(),a=r[e];return Array.isArray(a)?a.length>0:"isNewEnergy"===e&&null!==a}}),{name:"filter-store",partialize:e=>({filters:e.filters})}),{name:"filter-store"}))},27078:function(e,t,r){r.d(t,{lz:function(){return p},qr:function(){return T}});var a=r(8798),n=r(5379);let i={DATA:"insuralytics_data",STORAGE_INFO:"insuralytics_storage_info",UPLOAD_HISTORY:"insuralytics_upload_history"};function l(e){return new Promise(t=>{let r=new FileReader;r.onload=e=>{var r;let a=null===(r=e.target)||void 0===r?void 0:r.result,n=0;for(let e=0;e<a.length;e++)n=(n<<5)-n+a.charCodeAt(e),n&=n;t(Math.abs(n).toString(36))},r.readAsText(e)})}async function o(e){try{let t=function(e){let t=JSON.stringify(e.map(e=>({week:e.week_number,year:e.policy_start_year,organization:e.third_level_organization,premium:e.signed_premium_yuan,policy_count:e.policy_count}))),r=0;for(let e=0;e<t.length;e++)r=(r<<5)-r+t.charCodeAt(e),r&=r;return Math.abs(r).toString(36)}(e),r={lastUpdated:new Date().toISOString(),totalRecords:e.length,dataHash:t,uploadHistory:s()};localStorage.setItem(i.DATA,JSON.stringify(e)),localStorage.setItem(i.STORAGE_INFO,JSON.stringify(r)),console.log("[Data Persistence] 数据已保存到本地存储，共 ".concat(e.length," 条记录"))}catch(e){throw console.error("[Data Persistence] 保存数据失败:",e),Error("保存数据到本地存储失败")}}function s(){try{let e=localStorage.getItem(i.UPLOAD_HISTORY);if(!e)return[];return JSON.parse(e)}catch(e){return console.error("[Data Persistence] 获取上传历史失败:",e),[]}}async function u(e,t){try{let r=s(),a=await Promise.all(t.map(async(t,r)=>{var a,n,i;let o=e.results[r],s=await l(t);return{name:t.name,size:t.size,hash:s,recordCount:(null==o?void 0:null===(a=o.result)||void 0===a?void 0:a.processedRecords)||0,validRecords:(null==o?void 0:null===(n=o.result)||void 0===n?void 0:n.successRecords)||0,invalidRecords:(null==o?void 0:null===(i=o.result)||void 0===i?void 0:i.failedRecords)||0}})),n={id:"upload_".concat(Date.now(),"_").concat(Math.random().toString(36).slice(2,8)),timestamp:new Date().toISOString(),files:a,totalRecords:e.totalRecords,validRecords:e.validRecords,invalidRecords:e.invalidRecords,status:0===e.failureCount?"success":e.successCount>0?"partial":"failed"};r.unshift(n),r.length>50&&r.splice(50),localStorage.setItem(i.UPLOAD_HISTORY,JSON.stringify(r)),console.log("[Data Persistence] 已添加上传历史记录: ".concat(n.id))}catch(e){console.error("[Data Persistence] 添加上传历史失败:",e)}}async function c(e){try{let t=await l(e);for(let r of s()){let a=r.files.find(r=>r.hash===t&&r.name===e.name);if(a)return{exists:!0,uploadRecord:r,fileInfo:a}}return{exists:!1}}catch(e){return console.error("[Data Persistence] 检查文件是否存在失败:",e),{exists:!1}}}let d={viewMode:"single",dataViewType:"current",years:[],weeks:[],singleModeWeek:null,trendModeWeeks:[],organizations:[],insuranceTypes:[],businessTypes:[],coverageTypes:[],customerCategories:[],vehicleGrades:[],terminalSources:[],isNewEnergy:null,renewalStatuses:[]};var m=r(57903),_=r(97830),g=r(60373);function p(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=new Set(r);return e.filter(e=>{if(!a.has("years")&&t.years.length>0&&!t.years.includes(e.policy_start_year)||!a.has("weeks")&&t.weeks.length>0&&!t.weeks.includes(e.week_number)||!a.has("organizations")&&t.organizations.length>0&&!t.organizations.includes((0,_.Vd)(e.third_level_organization))||!a.has("insuranceTypes")&&t.insuranceTypes.length>0&&!t.insuranceTypes.includes(e.insurance_type))return!1;if(!a.has("businessTypes")&&t.businessTypes.length>0){let r=(0,g.gX)(e.business_type_category);if(!t.businessTypes.includes(r))return!1}return!!((a.has("coverageTypes")||!(t.coverageTypes.length>0)||t.coverageTypes.includes(e.coverage_type))&&(a.has("customerCategories")||!(t.customerCategories.length>0)||t.customerCategories.includes((0,_.Vd)(e.customer_category_3)))&&(a.has("vehicleGrades")||!(t.vehicleGrades.length>0)||!e.vehicle_insurance_grade||t.vehicleGrades.includes(e.vehicle_insurance_grade))&&(a.has("terminalSources")||!(t.terminalSources.length>0)||t.terminalSources.includes((0,_.Vd)(e.terminal_source)))&&(a.has("isNewEnergy")||null===t.isNewEnergy||e.is_new_energy_vehicle===t.isNewEnergy)&&(a.has("renewalStatuses")||!(t.renewalStatuses.length>0)||t.renewalStatuses.includes(e.renewal_status)))})}var h=r(57306);function y(e){let t=e.map(e=>h.Rm.fromRawData(e));return(0,_.cH)(t).map(e=>e.toRawData())}var f=r(77911);let v=(e,t)=>{let r=y(t);f.a.getState().setData(r,!1).catch(e=>{console.error("[AppStore] 同步数据到 DataStore 失败:",e)});let a=function(e,t){let r=Array.from(new Set(e.map(e=>e.week_number))).sort((e,t)=>t-e),a=r.length>0?r[0]:null;return{...t,years:Array.from(new Set(e.map(e=>e.policy_start_year))).sort((e,t)=>t-e),weeks:a?[a]:[],singleModeWeek:a,trendModeWeeks:a?[a]:[]}}(r,e.filters);return{rawData:r,filters:a,computedKPIs:new Map,error:null}},b=(e,t)=>{let r=y(t),a=[...e.rawData,...r];return f.a.getState().setData(a,!1).catch(e=>{console.error("[AppStore] 同步追加数据到 DataStore 失败:",e)}),{rawData:a,computedKPIs:new Map,error:null}},w=(e,t)=>{let r={...e.hierarchicalFilters.global,...t},a=e.hierarchicalFilters.activeTab,n=e.hierarchicalFilters.tabs[a]||{},i={...d,...r,...n};return{hierarchicalFilters:{...e.hierarchicalFilters,global:r},filters:i,computedKPIs:new Map}},S=(e,t,r)=>{let a={...e.hierarchicalFilters.tabs[t]||{},...r},n={...e.hierarchicalFilters.tabs,[t]:a},i=e.filters;return t===e.hierarchicalFilters.activeTab&&(i={...d,...e.hierarchicalFilters.global,...a}),{hierarchicalFilters:{...e.hierarchicalFilters,tabs:n},filters:i,computedKPIs:new Map}},x=(e,t)=>{let r=e.hierarchicalFilters.tabs[t]||{},a={...d,...e.hierarchicalFilters.global,...r};return{hierarchicalFilters:{...e.hierarchicalFilters,activeTab:t},filters:a,computedKPIs:new Map}},R=e=>{let t=e.hierarchicalFilters.activeTab,r=e.hierarchicalFilters.tabs[t]||{},a={...d,...r};return{hierarchicalFilters:{...e.hierarchicalFilters,global:{}},filters:a,computedKPIs:new Map}},k=(e,t)=>{let r=t||e.hierarchicalFilters.activeTab,a={...e.hierarchicalFilters.tabs,[r]:{}},n=e.filters;return r===e.hierarchicalFilters.activeTab&&(n={...d,...e.hierarchicalFilters.global}),{hierarchicalFilters:{...e.hierarchicalFilters,tabs:a},filters:n,computedKPIs:new Map}};r(90616);let T=(0,a.U)()((0,n.mW)(e=>({rawData:[],isLoading:!1,error:null,uploadProgress:0,filters:d,hierarchicalFilters:{global:{},tabs:{},activeTab:"kpi"},computedKPIs:new Map,viewMode:"single",expandedPanels:new Set,selectedOrganizations:[],premiumTargets:(0,m.h3)(),setRawData:t=>e(e=>v(e,t),!1,"setRawData"),appendRawData:t=>e(e=>b(e,t),!1,"appendRawData"),clearData:()=>e({rawData:[],computedKPIs:new Map,error:null},!1,"clearData"),setLoading:t=>e({isLoading:t},!1,"setLoading"),setError:t=>e({error:t},!1,"setError"),setUploadProgress:t=>e({uploadProgress:t},!1,"setUploadProgress"),updateFilters:t=>e(e=>({filters:{...e.filters,...t},computedKPIs:new Map}),!1,"updateFilters"),resetFilters:()=>e({filters:d,computedKPIs:new Map},!1,"resetFilters"),updateGlobalFilters:t=>e(e=>w(e,t),!1,"updateGlobalFilters"),updateTabFilters:(t,r)=>e(e=>S(e,t,r),!1,"updateTabFilters"),setActiveTab:t=>e(e=>x(e,t),!1,"setActiveTab"),getMergedFilters:()=>{let e=T.getState(),t=e.hierarchicalFilters.activeTab,r=e.hierarchicalFilters.tabs[t]||{};return{...d,...e.hierarchicalFilters.global,...r}},resetGlobalFilters:()=>e(e=>R(e),!1,"resetGlobalFilters"),resetTabFilters:t=>e(e=>k(e,t),!1,"resetTabFilters"),setViewMode:t=>e(e=>({filters:{...e.filters,...function(e,t){if("single"===t){var r;let a=null!==(r=e.singleModeWeek)&&void 0!==r?r:e.weeks.length>0?e.weeks[e.weeks.length-1]:null;return{viewMode:t,singleModeWeek:a,weeks:null!=a?[a]:[]}}let a=e.trendModeWeeks.length>0?[...e.trendModeWeeks]:[...e.weeks];return{viewMode:t,trendModeWeeks:a,weeks:a}}(e.filters,t)}}),!1,"setViewMode"),setPremiumTargets:t=>e(()=>({premiumTargets:(0,m.Ws)(t)}),!1,"setPremiumTargets"),loadPremiumTargets:()=>e(()=>({premiumTargets:(0,m.h3)()}),!1,"loadPremiumTargets"),setKPICache:(t,r)=>e(e=>{let a=new Map(e.computedKPIs);return a.set(t,r),{computedKPIs:a}},!1,"setKPICache"),clearKPICache:()=>e({computedKPIs:new Map},!1,"clearKPICache"),getKPICache:e=>T.getState().computedKPIs.get(e),togglePanel:t=>e(e=>{let r=new Set(e.expandedPanels);return r.has(t)?r.delete(t):r.add(t),{expandedPanels:r}},!1,"togglePanel"),setSelectedOrganizations:t=>e({selectedOrganizations:t},!1,"setSelectedOrganizations"),saveDataToPersistentStorage:async()=>{let e=T.getState();await o(e.rawData)},loadDataFromPersistentStorage:()=>{let t=function(){try{let e=localStorage.getItem(i.DATA);if(!e)return null;let t=JSON.parse(e);return console.log("[Data Persistence] 从本地存储加载数据，共 ".concat(t.length," 条记录")),t}catch(e){return console.error("[Data Persistence] 加载数据失败:",e),null}}();t&&e({rawData:y(t),error:null},!1,"loadDataFromPersistentStorage")},clearPersistentData:()=>{!function(){try{localStorage.removeItem(i.DATA),localStorage.removeItem(i.STORAGE_INFO),localStorage.removeItem(i.UPLOAD_HISTORY),console.log("[Data Persistence] 已清除所有存储的数据")}catch(e){throw console.error("[Data Persistence] 清除数据失败:",e),Error("清除存储数据失败")}}(),e({rawData:[],computedKPIs:new Map,error:null},!1,"clearPersistentData")},getStorageStats:()=>(function(){let e=function(){try{let e=localStorage.getItem(i.STORAGE_INFO);if(!e)return null;return JSON.parse(e)}catch(e){return console.error("[Data Persistence] 获取存储信息失败:",e),null}}(),t=s();return{hasData:null!==e&&e.totalRecords>0,totalRecords:(null==e?void 0:e.totalRecords)||0,lastUpdated:(null==e?void 0:e.lastUpdated)||null,uploadCount:t.length}})(),checkFileForDuplicates:async e=>await c(e),addToUploadHistory:async(e,t)=>{await u(e,t)},getUploadHistoryRecords:()=>s()}),{name:"insurance-analytics-store"}))},57903:function(e,t,r){r.d(t,{oU:function(){return s},h3:function(){return _},Ws:function(){return g}}),(n=i||(i={})).HEADQUARTERS="本部",n.DAZHOU="达州",n.DEYANG="德阳",n.GAOXIN="高新",n.LESHAN="乐山",n.LUZHOU="泸州",n.QINGYANG="青羊",n.TIANFU="天府",n.WUHOU="武侯",n.XINDU="新都",n.YIBIN="宜宾",n.ZIYANG="资阳",n.ZIGONG="自贡";let a=["businessType","thirdLevelOrganization","customerCategory","insuranceType"];var n,i,l=r(97830);let o="insurDashPremiumTargets";function s(){return a.reduce((e,t)=>(e[t]={entries:{},updatedAt:null,versions:[]},e),{})}let u={year:new Date().getFullYear(),overall:0,byBusinessType:{},dimensions:s(),updatedAt:null};function c(e){let t=Number(e);return!Number.isFinite(t)||t<0?0:Math.round(t)}function d(e){if(!e||"object"!=typeof e)return{};let t={};return Object.entries(e).forEach(e=>{let[r,a]=e,n=(0,l.Vd)(r);n&&(t[n]=c(a))}),t}function m(e){return Array.isArray(e)?e.map(e=>{if(!e)return null;let t=e.id||"ver-".concat(Date.now(),"-").concat(Math.random().toString(36).slice(2,8));return{id:t,label:e.label||t,createdAt:e.createdAt||new Date().toISOString(),overall:c(e.overall),entries:d(e.entries),...void 0!==e.note&&{note:e.note}}}).filter(e=>null!==e).sort((e,t)=>new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime()):[]}function _(){try{let e=window.localStorage.getItem(o);if(!e)return u;let t=JSON.parse(e);return function(e){var t;if(!e)return{...u,year:new Date().getFullYear()};let r=e.year||new Date().getFullYear(),n=c(e.overall),i=null!==(t=e.updatedAt)&&void 0!==t?t:null,l=s(),o=d(e.byBusinessType);return a.forEach(t=>{var r,a,n;let s=null===(r=e.dimensions)||void 0===r?void 0:r[t],u="businessType"===t&&Object.keys(o).length>0?o:d(null==s?void 0:s.entries);l[t]={entries:u,updatedAt:null!==(n=null==s?void 0:s.updatedAt)&&void 0!==n?n:"businessType"===t?i:null!==(a=null==s?void 0:s.updatedAt)&&void 0!==a?a:null,versions:m(null==s?void 0:s.versions)}}),{year:r,overall:n,byBusinessType:l.businessType.entries,dimensions:l,updatedAt:i}}(t)}catch(e){return console.warn("[useAppStore] 读取保费目标数据失败，已回退默认值",e),u}}function g(e){var t;let r=null!==(t=e.updatedAt)&&void 0!==t?t:new Date().toISOString(),n=e.year||new Date().getFullYear(),i=c(e.overall),l=s();a.forEach(t=>{var a,n,i;let o=null===(a=e.dimensions)||void 0===a?void 0:a[t],s="businessType"===t?e.byBusinessType:void 0,u=d(null!==(n=null==o?void 0:o.entries)&&void 0!==n?n:s),c=(null==o?void 0:o.entries)!==void 0||"businessType"===t&&Object.keys(u).length>0;l[t]={entries:u,updatedAt:null!==(i=null==o?void 0:o.updatedAt)&&void 0!==i?i:c?r:null,versions:m(null==o?void 0:o.versions)}});let u={year:n,overall:i,byBusinessType:l.businessType.entries,dimensions:l,updatedAt:r};return window.localStorage.setItem(o,JSON.stringify(u)),u}},45860:function(e,t,r){function a(e){return null==e||isNaN(e)?{text:"text-slate-600",bg:"bg-slate-50",progress:"bg-slate-400",border:"border-slate-300",level:"medium",label:"无数据"}:e>=110?{text:"text-green-700",bg:"bg-green-50",progress:"bg-green-600",border:"border-green-300",level:"excellent",label:"卓越"}:e>=100?{text:"text-green-600",bg:"bg-green-50",progress:"bg-green-500",border:"border-green-200",level:"good",label:"健康"}:e>=90?{text:"text-yellow-600",bg:"bg-yellow-50",progress:"bg-yellow-500",border:"border-yellow-200",level:"warning",label:"预警"}:e>=80?{text:"text-orange-600",bg:"bg-orange-50",progress:"bg-orange-500",border:"border-orange-200",level:"warning",label:"危险"}:{text:"text-red-600",bg:"bg-red-50",progress:"bg-red-500",border:"border-red-200",level:"danger",label:"高危"}}function n(e){return null==e||isNaN(e)?{text:"text-slate-600",bg:"bg-slate-50",progress:"bg-slate-400",border:"border-slate-300",level:"medium",label:"无数据"}:e<50?{text:"text-green-700",bg:"bg-green-50",progress:"bg-green-600",border:"border-green-300",level:"excellent",label:"优秀"}:e<60?{text:"text-green-600",bg:"bg-green-50",progress:"bg-green-500",border:"border-green-200",level:"good",label:"良好"}:e<70?{text:"text-blue-600",bg:"bg-blue-50",progress:"bg-blue-500",border:"border-blue-200",level:"medium",label:"中等"}:e<80?{text:"text-yellow-600",bg:"bg-yellow-50",progress:"bg-yellow-500",border:"border-yellow-200",level:"warning",label:"预警"}:{text:"text-red-600",bg:"bg-red-50",progress:"bg-red-500",border:"border-red-200",level:"danger",label:"高危"}}function i(e){return null==e||isNaN(e)?{text:"text-slate-600",bg:"bg-slate-50",progress:"bg-slate-400",border:"border-slate-300",level:"medium",label:"无数据"}:e>12?{text:"text-green-700",bg:"bg-green-50",progress:"bg-green-600",border:"border-green-300",level:"excellent",label:"优秀"}:e>=8?{text:"text-green-600",bg:"bg-green-50",progress:"bg-green-500",border:"border-green-200",level:"good",label:"良好"}:e>=6?{text:"text-blue-600",bg:"bg-blue-50",progress:"bg-blue-500",border:"border-blue-200",level:"medium",label:"中等"}:e>=4?{text:"text-yellow-600",bg:"bg-yellow-50",progress:"bg-yellow-500",border:"border-yellow-200",level:"warning",label:"一般"}:e>=0?{text:"text-orange-600",bg:"bg-orange-50",progress:"bg-orange-500",border:"border-orange-200",level:"warning",label:"较差"}:{text:"text-red-600",bg:"bg-red-50",progress:"bg-red-500",border:"border-red-200",level:"danger",label:"严重"}}function l(e){return null==e||isNaN(e)?"#cbd5e1":e>12?"#2E7D32":e>=8?"#4CAF50":e>=6?"#1976D2":e>=4?"#FBC02D":e>=0?"#F57C00":"#D32F2F"}function o(e){return null==e||isNaN(e)?{text:"text-slate-600",bg:"bg-slate-50",progress:"bg-slate-400",border:"border-slate-300",level:"medium",label:"无数据"}:e<65?{text:"text-green-700",bg:"bg-green-50",progress:"bg-green-600",border:"border-green-300",level:"excellent",label:"优秀"}:e<75?{text:"text-green-600",bg:"bg-green-50",progress:"bg-green-500",border:"border-green-200",level:"good",label:"良好"}:e<85?{text:"text-blue-600",bg:"bg-blue-50",progress:"bg-blue-500",border:"border-blue-200",level:"medium",label:"中等"}:e<95?{text:"text-yellow-600",bg:"bg-yellow-50",progress:"bg-yellow-500",border:"border-yellow-200",level:"warning",label:"预警"}:{text:"text-red-600",bg:"bg-red-50",progress:"bg-red-500",border:"border-red-200",level:"danger",label:"高危"}}r.d(t,{Mc:function(){return n},RP:function(){return o},aV:function(){return i},qB:function(){return a},qj:function(){return l}})},11864:function(e,t,r){function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return null==e||isNaN(e)?"-":e.toLocaleString("zh-CN",{minimumFractionDigits:t,maximumFractionDigits:t})}function n(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return null==e||isNaN(e)?"-":"".concat(e.toFixed(t),"%")}function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return null==e||isNaN(e)?"-":"".concat(a(e,t)," 万元")}function l(e){return null==e||isNaN(e)?"text-slate-500":e>12?"text-green-700":e>=8?"text-green-600":e>=4?"text-yellow-600":e>=0?"text-orange-600":"text-red-600"}r.d(t,{T3:function(){return n},XH:function(){return l},uf:function(){return a},xG:function(){return i}})}}]);