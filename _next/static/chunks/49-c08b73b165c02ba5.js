"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[49],{41405:function(e,t,r){r.d(t,{B:function(){return o}});var a=r(36059),n=r(77587);let s=[{value:"data-management",label:"数据管理"},{value:"kpi",label:"KPI看板"},{value:"trend",label:"周趋势分析"},{value:"thematic",label:"专题分析"}];function o(e){let{active:t,onChange:r}=e;return(0,a.jsx)(n.mQ,{value:t,onValueChange:e=>r(e),children:(0,a.jsx)(n.dr,{children:s.map(e=>(0,a.jsx)(n.SP,{value:e.value,children:e.label},e.value))})})}},94258:function(e,t,r){r.d(t,{Cd:function(){return c},X:function(){return u},bZ:function(){return i}});var a=r(36059),n=r(90616),s=r(69754),o=r(26992);let l=(0,s.j)("relative w-full rounded-lg border px-4 py-3 text-sm [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground [&>svg~*]:pl-7",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),i=n.forwardRef((e,t)=>{let{className:r,variant:n,...s}=e;return(0,a.jsx)("div",{ref:t,role:"alert",className:(0,o.cn)(l({variant:n}),r),...s})});i.displayName="Alert";let c=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)("h5",{ref:t,className:(0,o.cn)("mb-1 font-medium leading-none tracking-tight",r),...n})});c.displayName="AlertTitle";let u=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,o.cn)("text-sm [&_p]:leading-relaxed",r),...n})});u.displayName="AlertDescription"},66066:function(e,t,r){r.d(t,{z:function(){return c}});var a=r(36059),n=r(90616),s=r(83353),o=r(69754),l=r(26992);let i=(0,o.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),c=n.forwardRef((e,t)=>{let{className:r,variant:n,size:o,asChild:c=!1,...u}=e,d=c?s.g7:"button";return(0,a.jsx)(d,{className:(0,l.cn)(i({variant:n,size:o,className:r})),ref:t,...u})});c.displayName="Button"},42030:function(e,t,r){r.d(t,{Ol:function(){return l},SZ:function(){return c},Zb:function(){return o},aY:function(){return u},ll:function(){return i}});var a=r(36059),n=r(90616),s=r(26992);let o=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,s.cn)("rounded-lg border bg-white text-slate-950 shadow-sm",r),...n})});o.displayName="Card";let l=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,s.cn)("flex flex-col space-y-1.5 p-6",r),...n})});l.displayName="CardHeader";let i=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)("h3",{ref:t,className:(0,s.cn)("text-2xl font-semibold leading-none tracking-tight",r),...n})});i.displayName="CardTitle";let c=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)("p",{ref:t,className:(0,s.cn)("text-sm text-slate-500",r),...n})});c.displayName="CardDescription";let u=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,s.cn)("p-6 pt-0",r),...n})});u.displayName="CardContent",n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,s.cn)("flex items-center p-6 pt-0",r),...n})}).displayName="CardFooter"},61511:function(e,t,r){r.d(t,{$N:function(){return f},Be:function(){return _},Vq:function(){return i},cZ:function(){return g},fK:function(){return p},hg:function(){return c}});var a=r(36059),n=r(90616),s=r(42332),o=r(33239),l=r(26992);let i=s.fC,c=s.xz,u=s.h_;s.x8;let d=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)(s.aV,{ref:t,className:(0,l.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",r),...n})});d.displayName=s.aV.displayName;let g=n.forwardRef((e,t)=>{let{className:r,children:n,...i}=e;return(0,a.jsxs)(u,{children:[(0,a.jsx)(d,{}),(0,a.jsxs)(s.VY,{ref:t,className:(0,l.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",r),...i,children:[n,(0,a.jsxs)(s.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,a.jsx)(o.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});g.displayName=s.VY.displayName;let p=e=>{let{className:t,...r}=e;return(0,a.jsx)("div",{className:(0,l.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...r})};p.displayName="DialogHeader";let f=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)(s.Dx,{ref:t,className:(0,l.cn)("text-lg font-semibold leading-none tracking-tight",r),...n})});f.displayName=s.Dx.displayName;let _=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)(s.dk,{ref:t,className:(0,l.cn)("text-sm text-muted-foreground",r),...n})});_.displayName=s.dk.displayName},13344:function(e,t,r){r.d(t,{I:function(){return o}});var a=r(36059),n=r(90616),s=r(26992);let o=n.forwardRef((e,t)=>{let{className:r,type:n="text",...o}=e;return(0,a.jsx)("input",{type:n,className:(0,s.cn)("flex h-9 w-full rounded-md border border-slate-300 bg-white px-3 py-1 text-sm text-slate-900 shadow-sm transition-colors","placeholder:text-slate-400 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-0","disabled:cursor-not-allowed disabled:opacity-60",r),ref:t,...o})});o.displayName="Input"},57040:function(e,t,r){r.d(t,{J2:function(){return l},xo:function(){return i},yk:function(){return c}});var a=r(36059),n=r(90616),s=r(49164),o=r(26992);let l=s.fC,i=s.xz;s.ee;let c=n.forwardRef((e,t)=>{let{className:r,align:n="center",sideOffset:l=4,...i}=e;return(0,a.jsx)(s.h_,{children:(0,a.jsx)(s.VY,{ref:t,align:n,sideOffset:l,className:(0,o.cn)("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]",r),...i})})});c.displayName=s.VY.displayName},77587:function(e,t,r){r.d(t,{SP:function(){return c},dr:function(){return i},mQ:function(){return l},nU:function(){return u}});var a=r(36059),n=r(90616),s=r(54320),o=r(26992);let l=s.fC,i=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)(s.aV,{ref:t,className:(0,o.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",r),...n})});i.displayName=s.aV.displayName;let c=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)(s.xz,{ref:t,className:(0,o.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",r),...n})});c.displayName=s.xz.displayName;let u=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)(s.VY,{ref:t,className:(0,o.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",r),...n})});u.displayName=s.VY.displayName},60373:function(e,t,r){r.d(t,{AL:function(){return u},Dm:function(){return i},W4:function(){return c},Xs:function(){return s},gW:function(){return _},gX:function(){return f},iZ:function(){return a},p7:function(){return n},qP:function(){return m},rG:function(){return o},rj:function(){return l}});let a=["挂车","摩托车","特种车","营业公路客运","营业出租租赁","营业城市公交","营业货车","非营业个人客车","非营业企业客车","非营业机关客车","非营业货车"],n=["非营业客车新车","非营业客车旧车非过户","非营业客车旧车过户","1吨以下非营业货车","1–2吨非营业货车","2吨以下营业货车","2–9吨营业货车","9–10吨营业货车","10吨以上营业货车（普货）","10吨以上营业货车（牵引）","自卸车","特种车","其他营业货车","摩托车","出租车","网约车"],s=["商业险","交强险"],o=["主全","交三","单交"],l=["新保","续保","转保"],i=["0101柜面","0106移动展业(App)","0107B2B","0110融合销售","0112AI出单","0201PC","0202APP","0301电销"],c=["本部","达州","德阳","高新","乐山","泸州","青羊","天府","武侯","新都","宜宾","资阳","自贡"],u=["non_pc_new","non_pc_used","non_pc_transfer","non_truck_lt1","non_truck_1_2","biz_truck_lt2","biz_truck_2_9","biz_truck_9_10","biz_truck_10_plus","biz_truck_10_plus_trac","biz_truck_10_plus_dump","biz_truck_10_plus_special","biz_truck_other","motorcycle","biz_pc_taxi","biz_pc_ridehailing"],d={非营业客车新车:"non_pc_new",非营业客车旧车非过户:"non_pc_used",非营业客车旧车过户:"non_pc_transfer",非营业客车旧车过户车:"non_pc_transfer","1吨以下非营业货车":"non_truck_lt1","1–2吨非营业货车":"non_truck_1_2",非营业货车新车:"non_truck_1_2",非营业货车旧车:"non_truck_1_2","2吨以下营业货车":"biz_truck_lt2","2-9吨营业货车":"biz_truck_2_9","2–9吨营业货车":"biz_truck_2_9","9-10吨营业货车":"biz_truck_9_10","9–10吨营业货车":"biz_truck_9_10","10吨以上营业货车（普货）":"biz_truck_10_plus","10吨以上-普货":"biz_truck_10_plus","10吨以上普货":"biz_truck_10_plus","10吨以上营业货车（牵引）":"biz_truck_10_plus_trac","10吨以上-牵引":"biz_truck_10_plus_trac","10吨以上牵引":"biz_truck_10_plus_trac",自卸车:"biz_truck_10_plus_dump",自卸:"biz_truck_10_plus_dump",特种车:"biz_truck_10_plus_special",其他营业货车:"biz_truck_other",摩托车:"motorcycle",出租车:"biz_pc_taxi",网约车:"biz_pc_ridehailing",其他:"biz_truck_other"},g={non_pc_new:"非营业客车新车",non_pc_used:"非营业客车旧车非过户",non_pc_transfer:"非营业客车旧车过户",non_truck_lt1:"1吨以下非营业货车",non_truck_1_2:"1–2吨非营业货车",biz_truck_lt2:"2吨以下营业货车",biz_truck_2_9:"2–9吨营业货车",biz_truck_9_10:"9–10吨营业货车",biz_truck_10_plus:"10吨以上营业货车（普货）",biz_truck_10_plus_trac:"10吨以上营业货车（牵引）",biz_truck_10_plus_dump:"自卸车",biz_truck_10_plus_special:"特种车",biz_truck_other:"其他营业货车",motorcycle:"摩托车",biz_pc_taxi:"出租车",biz_pc_ridehailing:"网约车",OTHER:"其他"},p={non_pc_new:"非营客-新",non_pc_used:"非营客-旧",non_pc_transfer:"非营客-过户",non_truck_lt1:"非营货-<1t",non_truck_1_2:"非营货-1–2t",biz_truck_lt2:"营货-<2t",biz_truck_2_9:"营货-2–9t",biz_truck_9_10:"营货-9–10t",biz_truck_10_plus:"营货-≥10t普",biz_truck_10_plus_trac:"营货-≥10t牵",biz_truck_10_plus_dump:"营货-≥10t卸",biz_truck_10_plus_special:"营货-≥10t特",biz_truck_other:"营货-其他",motorcycle:"摩托",biz_pc_taxi:"营客-出租",biz_pc_ridehailing:"营客-网约",OTHER:"其他"};function f(e){let t=String(e||"").trim();return t&&(d[t]||d[t.replace(/\s+/g,"").replace(/车/g,"车")])||"OTHER"}function _(e){return p[e]||"其他"}function m(e){return g[e]||"其他"}},97830:function(e,t,r){r.d(t,{Vd:function(){return a}});function a(e){return e&&"string"==typeof e?e.replace(/[\u200B-\u200D\uFEFF]/g,"").replace(/\u3000/g," ").trim().replace(/\s+/g," "):""}},76066:function(e,t,r){r.d(t,{a:function(){return l}});var a=r(90616),n=r(32522),s=r(55556),o=r(21782);function l(){let e=(0,n.r)(e=>e.filters),t=(0,n.r)(e=>e.updateFilters),r=(0,n.r)(e=>e.resetFilters),l=(0,n.r)(e=>e.setViewMode),i=(0,n.r)(e=>e.setDataViewType),c=(0,n.r)(e=>e.getActiveFilterCount),u=(0,n.r)(e=>e.isFilterActive),d=(0,s.qr)(e=>e.updateFilters),g=(0,s.qr)(e=>e.resetFilters),p=(0,s.qr)(e=>e.setViewMode),f=(0,a.useCallback)(e=>{t(e),d(e)},[t,d]),_=(0,a.useCallback)(()=>{r(),g()},[r,g]),m=(0,a.useCallback)(e=>{l(e),p(e)},[l,p]),y=(0,a.useCallback)(e=>{i(e),d({dataViewType:e})},[i,d]),h=(0,a.useCallback)(e=>{f({years:e})},[f]),b=(0,a.useCallback)(e=>{f({weeks:e})},[f]),v=(0,a.useCallback)(e=>{f({singleModeWeek:e,weeks:null!==e?[e]:[]})},[f]),w=(0,a.useCallback)(e=>{f({organizations:e})},[f]),S=(0,a.useCallback)(e=>{f({businessTypes:e})},[f]),x=(0,a.useCallback)(t=>{if(m(t),"single"===t){var r;let t=null!==(r=e.singleModeWeek)&&void 0!==r?r:e.weeks&&e.weeks.length>0?e.weeks[e.weeks.length-1]:null;f({singleModeWeek:t,weeks:null!==t?[t]:[]})}else{let t=e.trendModeWeeks&&e.trendModeWeeks.length>0?[...e.trendModeWeeks]:e.weeks&&e.weeks.length>0?[...e.weeks]:[];f({trendModeWeeks:t,weeks:t})}},[e,m,f]);return{filters:e,updateFilters:f,resetFilters:_,setViewMode:m,switchViewMode:x,setDataViewType:y,setYears:h,setWeeks:b,setSingleModeWeek:v,setOrganizations:w,setBusinessTypes:S,activeFilterCount:c(),isFilterActive:u,viewMode:e.viewMode,dataViewType:e.dataViewType,currentWeek:e.singleModeWeek,selectedYear:e.years&&e.years.length>0?(0,o.FT)(e.years):new Date().getFullYear()}}},62658:function(e,t,r){r.d(t,{_V:function(){return l}});var a=r(90616),n=r(77911),s=r(32522),o=r(69690);function l(){let e=(0,n.a)(e=>e.rawData),t=(0,n.a)(e=>e.isLoading),r=(0,n.a)(e=>e.error),l=(0,s.r)(e=>e.filters),i=(0,a.useMemo)(()=>o.D.filter(e,l),[e,l]),c=(0,a.useMemo)(()=>o.D.getStatistics(i),[i]),u=(0,a.useMemo)(()=>o.D.getStatistics(e),[e]);return{rawData:e,filteredData:i,stats:c,rawStats:u,isLoading:t,error:r,hasData:e.length>0,filterPercentage:e.length>0?(i.length/e.length*100).toFixed(1):"0"}}},87123:function(e,t,r){r.d(t,{pm:function(){return g}});var a=r(90616);let n=0,s=new Map,o=e=>{if(s.has(e))return;let t=setTimeout(()=>{s.delete(e),u({type:"REMOVE_TOAST",toastId:e})},1e6);s.set(e,t)},l=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:r}=t;return r?o(r):e.toasts.forEach(e=>{o(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===r||void 0===r?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},i=[],c={toasts:[]};function u(e){c=l(c,e),i.forEach(e=>{e(c)})}function d(e){let{...t}=e,r=(n=(n+1)%Number.MAX_SAFE_INTEGER).toString(),a=()=>u({type:"DISMISS_TOAST",toastId:r});return u({type:"ADD_TOAST",toast:{...t,id:r,open:!0,onOpenChange:e=>{e||a()}}}),{id:r,dismiss:a,update:e=>u({type:"UPDATE_TOAST",toast:{...e,id:r}})}}function g(){let[e,t]=a.useState(c);return a.useEffect(()=>(i.push(t),()=>{let e=i.indexOf(t);e>-1&&i.splice(e,1)}),[e]),{...e,toast:d,dismiss:e=>u({type:"DISMISS_TOAST",toastId:e})}}},50269:function(e,t,r){r.d(t,{G1:function(){return f},Kw:function(){return g},P8:function(){return o},ZS:function(){return s},d:function(){return i},nH:function(){return u},nJ:function(){return c},sB:function(){return p},vR:function(){return l},yx:function(){return d}});let a={DATA:"insuralytics_data",STORAGE_INFO:"insuralytics_storage_info",UPLOAD_HISTORY:"insuralytics_upload_history"};function n(e){return new Promise(t=>{let r=new FileReader;r.onload=e=>{var r;let a=null===(r=e.target)||void 0===r?void 0:r.result,n=0;for(let e=0;e<a.length;e++)n=(n<<5)-n+a.charCodeAt(e),n&=n;t(Math.abs(n).toString(36))},r.readAsText(e)})}async function s(e){try{let t=function(e){let t=JSON.stringify(e.map(e=>({week:e.week_number,year:e.policy_start_year,organization:e.third_level_organization,premium:e.signed_premium_yuan,policy_count:e.policy_count}))),r=0;for(let e=0;e<t.length;e++)r=(r<<5)-r+t.charCodeAt(e),r&=r;return Math.abs(r).toString(36)}(e),r={lastUpdated:new Date().toISOString(),totalRecords:e.length,dataHash:t,uploadHistory:i()};localStorage.setItem(a.DATA,JSON.stringify(e)),localStorage.setItem(a.STORAGE_INFO,JSON.stringify(r)),console.log("[Data Persistence] 数据已保存到本地存储，共 ".concat(e.length," 条记录"))}catch(e){throw console.error("[Data Persistence] 保存数据失败:",e),Error("保存数据到本地存储失败")}}function o(){try{let e=localStorage.getItem(a.DATA);if(!e)return null;let t=JSON.parse(e);return console.log("[Data Persistence] 从本地存储加载数据，共 ".concat(t.length," 条记录")),t}catch(e){return console.error("[Data Persistence] 加载数据失败:",e),null}}function l(){try{localStorage.removeItem(a.DATA),localStorage.removeItem(a.STORAGE_INFO),localStorage.removeItem(a.UPLOAD_HISTORY),console.log("[Data Persistence] 已清除所有存储的数据")}catch(e){throw console.error("[Data Persistence] 清除数据失败:",e),Error("清除存储数据失败")}}function i(){try{let e=localStorage.getItem(a.UPLOAD_HISTORY);if(!e)return[];return JSON.parse(e)}catch(e){return console.error("[Data Persistence] 获取上传历史失败:",e),[]}}async function c(e,t){try{let r=i(),s=await Promise.all(t.map(async(t,r)=>{var a,s,o;let l=e.results[r],i=await n(t);return{name:t.name,size:t.size,hash:i,recordCount:(null==l?void 0:null===(a=l.result)||void 0===a?void 0:a.stats.totalRows)||0,validRecords:(null==l?void 0:null===(s=l.result)||void 0===s?void 0:s.stats.validRows)||0,invalidRecords:(null==l?void 0:null===(o=l.result)||void 0===o?void 0:o.stats.invalidRows)||0}})),o={id:"upload_".concat(Date.now(),"_").concat(Math.random().toString(36).slice(2,8)),timestamp:new Date().toISOString(),files:s,totalRecords:e.totalRecords,validRecords:e.validRecords,invalidRecords:e.invalidRecords,status:0===e.failureCount?"success":e.successCount>0?"partial":"failed"};r.unshift(o),r.length>50&&r.splice(50),localStorage.setItem(a.UPLOAD_HISTORY,JSON.stringify(r)),console.log("[Data Persistence] 已添加上传历史记录: ".concat(o.id))}catch(e){console.error("[Data Persistence] 添加上传历史失败:",e)}}async function u(e){try{let t=await n(e);for(let r of i()){let a=r.files.find(r=>r.hash===t&&r.name===e.name);if(a)return{exists:!0,uploadRecord:r,fileInfo:a}}return{exists:!1}}catch(e){return console.error("[Data Persistence] 检查文件是否存在失败:",e),{exists:!1}}}function d(){let e=function(){try{let e=localStorage.getItem(a.STORAGE_INFO);if(!e)return null;return JSON.parse(e)}catch(e){return console.error("[Data Persistence] 获取存储信息失败:",e),null}}(),t=i();return{hasData:null!==e&&e.totalRecords>0,totalRecords:(null==e?void 0:e.totalRecords)||0,lastUpdated:(null==e?void 0:e.lastUpdated)||null,uploadCount:t.length}}function g(e){let t=new Map;return e.forEach(e=>{let r="".concat(e.policy_start_year,"-").concat(e.week_number);t.has(r)||t.set(r,{weekNumber:e.week_number,year:e.policy_start_year,recordCount:0,isConflict:!1,source:"new"});let a=t.get(r);a.recordCount++}),Array.from(t.values()).sort((e,t)=>e.year!==t.year?e.year-t.year:e.weekNumber-t.weekNumber)}function p(e,t){let r=function(e){let t=new Set;return e.forEach(e=>{let r="".concat(e.policy_start_year,"-").concat(e.week_number);t.add(r)}),t}(t),a=[],n=[];return e.forEach(e=>{let t="".concat(e.year,"-").concat(e.weekNumber);r.has(t)?n.push({...e,isConflict:!0,source:"existing"}):a.push({...e,isConflict:!1,source:"new"})}),{newWeeks:a,conflictWeeks:n}}function f(e,t){let r=new Set;return t.forEach(e=>{let t="".concat(e.year,"-").concat(e.weekNumber);r.add(t)}),e.filter(e=>{let t="".concat(e.policy_start_year,"-").concat(e.week_number);return r.has(t)})}},26992:function(e,t,r){r.d(t,{cn:function(){return s}});var a=r(53413),n=r(83877);function s(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,n.m6)((0,a.W)(t))}},21782:function(e,t,r){function a(e){if(0===e.length)return-1/0;let t=e[0];for(let r=1;r<e.length;r++)e[r]>t&&(t=e[r]);return t}function n(e){if(0===e.length)return{min:1/0,max:-1/0};let t=e[0],r=e[0];for(let a=1;a<e.length;a++){let n=e[a];n<t&&(t=n),n>r&&(r=n)}return{min:t,max:r}}r.d(t,{FT:function(){return a},ku:function(){return n}})},48134:function(e,t,r){function a(e,t){let r=new Date(Date.UTC(e,0,1)).getUTCDay(),a=new Date(Date.UTC(e,0,1+(6===r?0:(6-r+7)%7))),n=new Date(a);return n.setUTCDate(a.getUTCDate()+(t-1)*7),n}function n(e){let t=new Date(Date.UTC(e.getUTCFullYear(),0,1));return Math.ceil((e.getTime()-t.getTime())/864e5)}function s(e,t){return n(a(e,t))/365}r.d(t,{$:function(){return s},bQ:function(){return o},iR:function(){return n},ke:function(){return a}});let o=50},69690:function(e,t,r){r.d(t,{D:function(){return o}});var a=r(60373),n=r(97830),s=(r(45293),r(4121));s.env.NEXT_PUBLIC_SUPABASE_URL,s.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;class o{static async fetchAllData(){return console.log("[DataService] 当前使用本地数据模式，不从数据库获取数据"),[]}static filter(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],s=new Set(r);return e.filter(e=>{if(!s.has("years")&&t.years&&t.years.length>0&&!t.years.includes(e.policy_start_year)||!s.has("weeks")&&t.weeks&&t.weeks.length>0&&!t.weeks.includes(e.week_number)||!s.has("organizations")&&t.organizations&&t.organizations.length>0&&!t.organizations.includes((0,n.Vd)(e.third_level_organization))||!s.has("insuranceTypes")&&t.insuranceTypes&&t.insuranceTypes.length>0&&!t.insuranceTypes.includes(e.insurance_type))return!1;if(!s.has("businessTypes")&&t.businessTypes&&t.businessTypes.length>0){let r=(0,a.gX)(e.business_type_category);if(!t.businessTypes.includes(r))return!1}return(!!s.has("coverageTypes")||!t.coverageTypes||!(t.coverageTypes.length>0)||!!t.coverageTypes.includes(e.coverage_type))&&(!!s.has("customerCategories")||!t.customerCategories||!(t.customerCategories.length>0)||!!t.customerCategories.includes((0,n.Vd)(e.customer_category_3)))&&(!!s.has("vehicleGrades")||!t.vehicleGrades||!(t.vehicleGrades.length>0)||!e.vehicle_insurance_grade||!!t.vehicleGrades.includes(e.vehicle_insurance_grade))&&(!!s.has("terminalSources")||!t.terminalSources||!(t.terminalSources.length>0)||!!t.terminalSources.includes((0,n.Vd)(e.terminal_source)))&&(!!s.has("isNewEnergy")||null===t.isNewEnergy||void 0===t.isNewEnergy||e.is_new_energy_vehicle===t.isNewEnergy)&&(!!s.has("renewalStatuses")||!t.renewalStatuses||!(t.renewalStatuses.length>0)||!!t.renewalStatuses.includes(e.renewal_status))})}static getByWeek(e,t,r){let a={...this.getDefaultFilters(),...r,weeks:[t]};return this.filter(e,a)}static getByWeekRange(e,t,r){let[a,n]=t,s=Array.from({length:n-a+1},(e,t)=>a+t),o={...this.getDefaultFilters(),...r,weeks:s};return this.filter(e,o)}static deduplicate(e){let t=new Set,r=[];for(let a of e){let e="".concat(a.snapshot_date,"_").concat(a.week_number,"_").concat(a.policy_start_year,"_").concat(a.third_level_organization,"_").concat(a.customer_category_3,"_").concat(a.insurance_type,"_").concat(a.business_type_category);t.has(e)||(t.add(e),r.push(a))}return r}static merge(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];let a=t.flat();return this.deduplicate(a)}static groupBy(e,t){let r=new Map;for(let a of e){let e=a[t],n=r.get(e)||[];n.push(a),r.set(e,n)}return r}static getStatistics(e){if(0===e.length)return{totalRecords:0,totalPremium:0,totalPolicyCount:0,uniqueWeeks:[],uniqueOrganizations:[],dateRange:null};let t=e.reduce((e,t)=>e+t.signed_premium_yuan,0),r=e.reduce((e,t)=>e+t.policy_count,0),a=Array.from(new Set(e.map(e=>e.week_number))).sort((e,t)=>e-t),s=Array.from(new Set(e.map(e=>(0,n.Vd)(e.third_level_organization)))).sort(),o=e.map(e=>e.snapshot_date).sort(),l={min:o[0],max:o[o.length-1]};return{totalRecords:e.length,totalPremium:t,totalPolicyCount:r,uniqueWeeks:a,uniqueOrganizations:s,dateRange:l}}static normalize(e){return e.map(e=>({...e,customer_category_3:(0,n.Vd)(e.customer_category_3),business_type_category:(0,n.Vd)(e.business_type_category),third_level_organization:(0,n.Vd)(e.third_level_organization),terminal_source:(0,n.Vd)(e.terminal_source)}))}static getAvailableOptions(e,t,r){let a={...t};delete a[r];let s=this.filter(e,a,[r]),o=new Set;switch(r){case"years":return s.forEach(e=>o.add(e.policy_start_year)),Array.from(o).sort((e,t)=>t-e);case"weeks":return s.forEach(e=>o.add(e.week_number)),Array.from(o).sort((e,t)=>t-e);case"organizations":return s.forEach(e=>o.add((0,n.Vd)(e.third_level_organization))),Array.from(o).sort();case"businessTypes":return s.forEach(e=>o.add((0,n.Vd)(e.business_type_category))),Array.from(o).sort();case"customerCategories":return s.forEach(e=>o.add((0,n.Vd)(e.customer_category_3))),Array.from(o).sort();default:return[]}}static getDefaultFilters(){return{viewMode:"single",dataViewType:"current",years:[],weeks:[],singleModeWeek:null,trendModeWeeks:[],organizations:[],insuranceTypes:[],businessTypes:[],coverageTypes:[],customerCategories:[],vehicleGrades:[],terminalSources:[],isNewEnergy:null,renewalStatuses:[]}}}},77911:function(e,t,r){r.d(t,{a:function(){return d}});var a=r(8798),n=r(5379),s=r(69690);class o extends Error{constructor(e,t,r){super(e),this.code=t,this.originalError=r,this.name="PersistenceError"}}class l{getFullKey(e){return"".concat(this.prefix,"_").concat(e)}async save(e,t){let r=this.getFullKey(e);try{let a=JSON.stringify(t);localStorage.setItem(r,a),console.log("[LocalStorage] 已保存数据: ".concat(e," (").concat(this.formatSize(a.length),")"))}catch(t){if(t instanceof Error){if("QuotaExceededError"===t.name)throw new o("存储空间不足，无法保存数据: ".concat(e),"QUOTA_EXCEEDED",t);if(t.message.includes("circular")||t.message.includes("serialize"))throw new o("数据序列化失败: ".concat(e),"SERIALIZATION_ERROR",t)}throw new o("保存数据失败: ".concat(e),"UNKNOWN",t instanceof Error?t:void 0)}}async load(e){let t=this.getFullKey(e);try{let r=localStorage.getItem(t);if(null===r)return null;let a=JSON.parse(r);return console.log("[LocalStorage] 已加载数据: ".concat(e)),a}catch(t){return console.error("[LocalStorage] 加载数据失败: ".concat(e),t),null}}async remove(e){let t=this.getFullKey(e);localStorage.removeItem(t),console.log("[LocalStorage] 已删除数据: ".concat(e))}async clear(){let e=[];for(let t=0;t<localStorage.length;t++){let r=localStorage.key(t);r&&r.startsWith("".concat(this.prefix,"_"))&&e.push(r)}e.forEach(e=>localStorage.removeItem(e)),console.log("[LocalStorage] 已清空所有数据 (共 ".concat(e.length," 项)"))}async has(e){let t=this.getFullKey(e);return null!==localStorage.getItem(t)}async getStats(){let e,t=0,r=0;for(let e=0;e<localStorage.length;e++){let a=localStorage.key(e);if(a&&a.startsWith("".concat(this.prefix,"_"))){r++;let e=localStorage.getItem(a);e&&(t+=(a.length+e.length)*2)}}try{let t="".concat(this.prefix,"_test_capacity"),r="x".repeat(1048576);localStorage.setItem(t,r),localStorage.removeItem(t),e=1048576}catch(t){e=0}return{totalKeys:r,totalSize:t,availableSpace:e}}formatSize(e){return e<1024?"".concat(e," B"):e<1048576?"".concat((e/1024).toFixed(2)," KB"):"".concat((e/1048576).toFixed(2)," MB")}constructor(e="insuralytics"){this.prefix=e}}let i={RAW_DATA:"raw_data",STORAGE_INFO:"storage_info",UPLOAD_HISTORY:"upload_history",PREMIUM_TARGETS:"premium_targets",FILTER_STATE:"filter_state"};class c{async saveRawData(e){try{let t=this.calculateDataHash(e),r={lastUpdated:new Date().toISOString(),totalRecords:e.length,dataHash:t,version:this.version};await this.adapter.save(i.RAW_DATA,e),await this.adapter.save(i.STORAGE_INFO,r),console.log("[PersistenceService] 数据已保存，共 ".concat(e.length," 条记录"))}catch(e){throw console.error("[PersistenceService] 保存数据失败:",e),e}}async loadRawData(){try{let e=await this.adapter.load(i.RAW_DATA);return e&&console.log("[PersistenceService] 加载数据成功，共 ".concat(e.length," 条记录")),e}catch(e){return console.error("[PersistenceService] 加载数据失败:",e),null}}async getStorageInfo(){return await this.adapter.load(i.STORAGE_INFO)}async addUploadHistory(e,t){try{let r=await this.getUploadHistory(),a=await Promise.all(t.map(async(t,r)=>{var a,n,s;let o=e.results[r],l=await this.calculateFileHash(t);return{name:t.name,size:t.size,hash:l,recordCount:(null==o?void 0:null===(a=o.result)||void 0===a?void 0:a.stats.totalRows)||0,validRecords:(null==o?void 0:null===(n=o.result)||void 0===n?void 0:n.stats.validRows)||0,invalidRecords:(null==o?void 0:null===(s=o.result)||void 0===s?void 0:s.stats.invalidRows)||0}})),n={id:"upload_".concat(Date.now(),"_").concat(Math.random().toString(36).slice(2,8)),timestamp:new Date().toISOString(),files:a,totalRecords:e.totalRecords,validRecords:e.validRecords,invalidRecords:e.invalidRecords,status:0===e.failureCount?"success":e.successCount>0?"partial":"failed"};r.unshift(n),r.length>50&&r.splice(50),await this.adapter.save(i.UPLOAD_HISTORY,r),console.log("[PersistenceService] 已添加上传历史记录: ".concat(n.id))}catch(e){console.error("[PersistenceService] 添加上传历史失败:",e)}}async getUploadHistory(){return await this.adapter.load(i.UPLOAD_HISTORY)||[]}async checkFileExists(e){try{let t=await this.calculateFileHash(e);for(let r of(await this.getUploadHistory())){let a=r.files.find(r=>r.hash===t&&r.name===e.name);if(a)return{exists:!0,uploadRecord:r,fileInfo:a}}return{exists:!1}}catch(e){return console.error("[PersistenceService] 检查文件是否存在失败:",e),{exists:!1}}}async savePremiumTargets(e){await this.adapter.save(i.PREMIUM_TARGETS,e)}async loadPremiumTargets(){return await this.adapter.load(i.PREMIUM_TARGETS)}async saveFilterState(e){await this.adapter.save(i.FILTER_STATE,e)}async loadFilterState(){return await this.adapter.load(i.FILTER_STATE)}async clearAll(){await this.adapter.clear(),console.log("[PersistenceService] 已清空所有存储数据")}async getStats(){let e=await this.adapter.getStats(),t=await this.getStorageInfo();return{...e,hasData:null!==t&&t.totalRecords>0,totalRecords:(null==t?void 0:t.totalRecords)||0,lastUpdated:(null==t?void 0:t.lastUpdated)||null,uploadCount:(await this.getUploadHistory()).length}}calculateDataHash(e){let t=JSON.stringify(e.map(e=>({week:e.week_number,year:e.policy_start_year,organization:e.third_level_organization,premium:e.signed_premium_yuan,policy_count:e.policy_count}))),r=0;for(let e=0;e<t.length;e++)r=(r<<5)-r+t.charCodeAt(e),r&=r;return Math.abs(r).toString(36)}calculateFileHash(e){return new Promise(t=>{let r=new FileReader;r.onload=e=>{var r;let a=null===(r=e.target)||void 0===r?void 0:r.result,n=0;for(let e=0;e<a.length;e++)n=(n<<5)-n+a.charCodeAt(e),n&=n;t(Math.abs(n).toString(36))},r.readAsText(e)})}constructor(e){this.version="1.0.0",this.adapter=e||new l("insuralytics")}}let u=new c,d=(0,a.U)()((0,n.mW)((e,t)=>({rawData:[],isLoading:!1,error:null,uploadProgress:0,setData:async function(r){let a=!(arguments.length>1)||void 0===arguments[1]||arguments[1];try{let n=s.D.normalize(r);e({rawData:n,error:null},!1,"setData"),a&&await t().saveToStorage(),console.log("[DataStore] 数据已设置，共 ".concat(n.length," 条记录"))}catch(r){let t=r instanceof Error?r:Error("设置数据失败");throw e({error:t},!1,"setData:error"),t}},appendData:async function(r){let a=!(arguments.length>1)||void 0===arguments[1]||arguments[1];try{let n=t().rawData,o=s.D.normalize(r),l=s.D.merge(n,o);e({rawData:l,error:null},!1,"appendData"),a&&await t().saveToStorage(),console.log("[DataStore] 数据已追加，原有 ".concat(n.length," 条，新增 ").concat(o.length," 条，去重后共 ").concat(l.length," 条"))}catch(r){let t=r instanceof Error?r:Error("追加数据失败");throw e({error:t},!1,"appendData:error"),t}},clearData:async function(){let t=!(arguments.length>0)||void 0===arguments[0]||arguments[0];e({rawData:[],error:null},!1,"clearData"),t&&await u.clearAll(),console.log("[DataStore] 数据已清空")},loadFromStorage:async()=>{try{e({isLoading:!0},!1,"loadFromStorage:start");let r=await u.loadRawData();r&&r.length>0?(await t().setData(r,!1),console.log("[DataStore] 从本地存储加载数据成功")):console.log("[DataStore] 本地存储中没有数据")}catch(t){e({error:t instanceof Error?t:Error("从本地存储加载数据失败")},!1,"loadFromStorage:error"),console.error("[DataStore] 加载数据失败:",t)}finally{e({isLoading:!1},!1,"loadFromStorage:end")}},saveToStorage:async()=>{try{let{rawData:e}=t();await u.saveRawData(e),console.log("[DataStore] 数据已保存到本地存储")}catch(e){throw console.error("[DataStore] 保存数据到本地存储失败:",e),e}},setLoading:t=>{e({isLoading:t},!1,"setLoading")},setError:t=>{e({error:t,isLoading:!1},!1,"setError")},setUploadProgress:t=>{e({uploadProgress:t},!1,"setUploadProgress")},getStats:()=>{let{rawData:e}=t();return s.D.getStatistics(e)},hasData:()=>t().rawData.length>0}),{name:"data-store"}))},32522:function(e,t,r){r.d(t,{r:function(){return l}});var a=r(8798),n=r(5379),s=r(97830);let o={viewMode:"single",dataViewType:"current",years:[],weeks:[],singleModeWeek:null,trendModeWeeks:[],organizations:[],insuranceTypes:[],businessTypes:[],coverageTypes:[],customerCategories:[],vehicleGrades:[],terminalSources:[],isNewEnergy:null,renewalStatuses:[]},l=(0,a.U)()((0,n.mW)((0,n.tJ)((e,t)=>({filters:o,updateFilters:t=>{e(e=>{var r,a,n,o,l,i,c,u;return{filters:{...e.filters,...t,organizations:(null!==(r=t.organizations)&&void 0!==r?r:e.filters.organizations).map(s.Vd),insuranceTypes:(null!==(a=t.insuranceTypes)&&void 0!==a?a:e.filters.insuranceTypes).map(s.Vd),businessTypes:null!==(n=t.businessTypes)&&void 0!==n?n:e.filters.businessTypes,coverageTypes:(null!==(o=t.coverageTypes)&&void 0!==o?o:e.filters.coverageTypes).map(s.Vd),customerCategories:(null!==(l=t.customerCategories)&&void 0!==l?l:e.filters.customerCategories).map(s.Vd),vehicleGrades:(null!==(i=t.vehicleGrades)&&void 0!==i?i:e.filters.vehicleGrades).map(s.Vd),renewalStatuses:(null!==(c=t.renewalStatuses)&&void 0!==c?c:e.filters.renewalStatuses).map(s.Vd),terminalSources:(null!==(u=t.terminalSources)&&void 0!==u?u:e.filters.terminalSources).map(s.Vd)}}},!1,"updateFilters")},resetFilters:()=>{e({filters:o},!1,"resetFilters")},setViewMode:t=>{e(e=>({filters:{...e.filters,viewMode:t}}),!1,"setViewMode")},setDataViewType:t=>{e(e=>({filters:{...e.filters,dataViewType:t}}),!1,"setDataViewType")},getActiveFilterCount:()=>{let{filters:e}=t(),r=0;return e.years&&e.years.length>0&&r++,e.weeks&&e.weeks.length>0&&r++,e.organizations&&e.organizations.length>0&&r++,e.insuranceTypes&&e.insuranceTypes.length>0&&r++,e.businessTypes&&e.businessTypes.length>0&&r++,e.coverageTypes&&e.coverageTypes.length>0&&r++,e.customerCategories&&e.customerCategories.length>0&&r++,e.vehicleGrades&&e.vehicleGrades.length>0&&r++,e.terminalSources&&e.terminalSources.length>0&&r++,null!==e.isNewEnergy&&r++,e.renewalStatuses&&e.renewalStatuses.length>0&&r++,r},isFilterActive:e=>{let{filters:r}=t(),a=r[e];return Array.isArray(a)?a.length>0:"isNewEnergy"===e&&null!==a}}),{name:"filter-store",partialize:e=>({filters:e.filters})}),{name:"filter-store"}))},55556:function(e,t,r){r.d(t,{lz:function(){return x},qr:function(){return w},pu:function(){return S}});var a,n,s=r(8798),o=r(90616),l=r(5379);(a=n||(n={})).HEADQUARTERS="本部",a.DAZHOU="达州",a.DEYANG="德阳",a.GAOXIN="高新",a.LESHAN="乐山",a.LUZHOU="泸州",a.QINGYANG="青羊",a.TIANFU="天府",a.WUHOU="武侯",a.XINDU="新都",a.YIBIN="宜宾",a.ZIYANG="资阳",a.ZIGONG="自贡";let i=["businessType","thirdLevelOrganization","customerCategory","insuranceType"];var c=r(97830),u=r(60373),d=r(50269),g=r(77911);let p="insurDashPremiumTargets";function f(){return i.reduce((e,t)=>(e[t]={entries:{},updatedAt:null,versions:[]},e),{})}let _={year:new Date().getFullYear(),overall:0,byBusinessType:{},dimensions:f(),updatedAt:null};function m(e){let t=Number(e);return!Number.isFinite(t)||t<0?0:Math.round(t)}function y(e){if(!e||"object"!=typeof e)return{};let t={};return Object.entries(e).forEach(e=>{let[r,a]=e,n=(0,c.Vd)(r);n&&(t[n]=m(a))}),t}function h(e){return Array.isArray(e)?e.map(e=>{if(!e)return null;let t=e.id||"ver-".concat(Date.now(),"-").concat(Math.random().toString(36).slice(2,8));return{id:t,label:e.label||t,createdAt:e.createdAt||new Date().toISOString(),overall:m(e.overall),entries:y(e.entries),...void 0!==e.note&&{note:e.note}}}).filter(e=>null!==e).sort((e,t)=>new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime()):[]}function b(){try{let e=window.localStorage.getItem(p);if(!e)return _;let t=JSON.parse(e);return function(e){var t;if(!e)return{..._,year:new Date().getFullYear()};let r=e.year||new Date().getFullYear(),a=m(e.overall),n=null!==(t=e.updatedAt)&&void 0!==t?t:null,s=f(),o=y(e.byBusinessType);return i.forEach(t=>{var r,a,l;let i=null===(r=e.dimensions)||void 0===r?void 0:r[t],c="businessType"===t&&Object.keys(o).length>0?o:y(null==i?void 0:i.entries);s[t]={entries:c,updatedAt:null!==(l=null==i?void 0:i.updatedAt)&&void 0!==l?l:"businessType"===t?n:null!==(a=null==i?void 0:i.updatedAt)&&void 0!==a?a:null,versions:h(null==i?void 0:i.versions)}}),{year:r,overall:a,byBusinessType:s.businessType.entries,dimensions:s,updatedAt:n}}(t)}catch(e){return console.warn("[useAppStore] 读取保费目标数据失败，已回退默认值",e),_}}let v={viewMode:"single",dataViewType:"current",years:[],weeks:[],singleModeWeek:null,trendModeWeeks:[],organizations:[],insuranceTypes:[],businessTypes:[],coverageTypes:[],customerCategories:[],vehicleGrades:[],terminalSources:[],isNewEnergy:null,renewalStatuses:[]},w=(0,s.U)()((0,l.mW)(e=>({rawData:[],isLoading:!1,error:null,uploadProgress:0,filters:v,computedKPIs:new Map,viewMode:"single",expandedPanels:new Set,selectedOrganizations:[],premiumTargets:b(),setRawData:t=>e(e=>{let r=t.map(e=>({...e,customer_category_3:(0,c.Vd)(e.customer_category_3),business_type_category:(0,c.Vd)(e.business_type_category),third_level_organization:(0,c.Vd)(e.third_level_organization),terminal_source:(0,c.Vd)(e.terminal_source)}));g.a.getState().setData(r,!1).catch(e=>{console.error("[AppStore] 同步数据到 DataStore 失败:",e)});let a=Array.from(new Set(r.map(e=>e.week_number))).sort((e,t)=>t-e),n=a.length>0?a[0]:null;return console.log("[AppStore] 数据已加载，可用周次: [".concat(a.join(", "),"]，自动选中最新周次: ").concat(n)),{rawData:r,error:null,filters:{...e.filters,singleModeWeek:n,weeks:n?[n]:[]}}},!1,"setRawData"),appendRawData:t=>e(e=>{let r=t.map(e=>({...e,customer_category_3:(0,c.Vd)(e.customer_category_3),business_type_category:(0,c.Vd)(e.business_type_category),third_level_organization:(0,c.Vd)(e.third_level_organization),terminal_source:(0,c.Vd)(e.terminal_source)})),a=new Set(e.rawData.map(e=>"".concat(e.snapshot_date,"_").concat(e.week_number,"_").concat(e.policy_start_year,"_").concat(e.third_level_organization,"_").concat(e.customer_category_3,"_").concat(e.insurance_type,"_").concat(e.business_type_category))),n=r.filter(e=>!a.has("".concat(e.snapshot_date,"_").concat(e.week_number,"_").concat(e.policy_start_year,"_").concat(e.third_level_organization,"_").concat(e.customer_category_3,"_").concat(e.insurance_type,"_").concat(e.business_type_category)));console.log("[AppendData] 原有数据: ".concat(e.rawData.length," 条, 新数据: ").concat(t.length," 条, 去重后: ").concat(n.length," 条"));let s=[...e.rawData,...n];g.a.getState().appendData(n,!1).catch(e=>{console.error("[AppStore] 同步追加数据到 DataStore 失败:",e)});let o=Array.from(new Set(s.map(e=>e.week_number))).sort((e,t)=>t-e),l=o.length>0?o[0]:null,i=Array.from(new Set(e.rawData.map(e=>e.week_number))),u=o.length>i.length;return u&&console.log("[AppendData] 检测到新周次，可用周次: [".concat(o.join(", "),"]，自动选中最新周次: ").concat(l)),{rawData:s,error:null,filters:u?{...e.filters,singleModeWeek:l,weeks:l?[l]:[]}:e.filters}},!1,"appendRawData"),clearData:()=>{g.a.getState().clearData(),e({rawData:[],computedKPIs:new Map,error:null},!1,"clearData")},setLoading:t=>e({isLoading:t},!1,"setLoading"),setError:t=>e({error:t,isLoading:!1},!1,"setError"),setUploadProgress:t=>e({uploadProgress:t},!1,"setUploadProgress"),updateFilters:t=>e(e=>{var r,a,n,s,o,l,i,u;return{filters:{...e.filters,...t,organizations:(null!==(r=t.organizations)&&void 0!==r?r:e.filters.organizations).map(c.Vd),insuranceTypes:(null!==(a=t.insuranceTypes)&&void 0!==a?a:e.filters.insuranceTypes).map(c.Vd),businessTypes:(null!==(n=t.businessTypes)&&void 0!==n?n:e.filters.businessTypes).map(c.Vd),coverageTypes:(null!==(s=t.coverageTypes)&&void 0!==s?s:e.filters.coverageTypes).map(c.Vd),customerCategories:(null!==(o=t.customerCategories)&&void 0!==o?o:e.filters.customerCategories).map(c.Vd),vehicleGrades:(null!==(l=t.vehicleGrades)&&void 0!==l?l:e.filters.vehicleGrades).map(c.Vd),renewalStatuses:(null!==(i=t.renewalStatuses)&&void 0!==i?i:e.filters.renewalStatuses).map(c.Vd),terminalSources:(null!==(u=t.terminalSources)&&void 0!==u?u:e.filters.terminalSources).map(c.Vd)},computedKPIs:new Map}},!1,"updateFilters"),resetFilters:()=>e({filters:v,computedKPIs:new Map},!1,"resetFilters"),setViewMode:t=>e(e=>({viewMode:t,filters:(()=>{let r=e.filters;if("single"===t){var a;let e=null!==(a=r.singleModeWeek)&&void 0!==a?a:r.weeks.length>0?r.weeks[r.weeks.length-1]:null;return{...r,viewMode:t,singleModeWeek:e,weeks:null!=e?[e]:[]}}let n=r.trendModeWeeks.length>0?[...r.trendModeWeeks]:[...r.weeks];return{...r,viewMode:t,trendModeWeeks:n,weeks:n}})()}),!1,"setViewMode"),setPremiumTargets:t=>e(()=>{var e;let r=null!==(e=t.updatedAt)&&void 0!==e?e:new Date().toISOString(),a=t.year||new Date().getFullYear(),n=m(t.overall),s=f();i.forEach(e=>{var a,n,o;let l=null===(a=t.dimensions)||void 0===a?void 0:a[e],i="businessType"===e?t.byBusinessType:void 0,c=y(null!==(n=null==l?void 0:l.entries)&&void 0!==n?n:i),u=(null==l?void 0:l.entries)!==void 0||"businessType"===e&&Object.keys(c).length>0;s[e]={entries:c,updatedAt:null!==(o=null==l?void 0:l.updatedAt)&&void 0!==o?o:u?r:null,versions:h(null==l?void 0:l.versions)}});let o={year:a,overall:n,byBusinessType:s.businessType.entries,dimensions:s,updatedAt:r};return window.localStorage.setItem(p,JSON.stringify(o)),{premiumTargets:o}},!1,"setPremiumTargets"),loadPremiumTargets:()=>e(()=>({premiumTargets:b()}),!1,"loadPremiumTargets"),setKPICache:(t,r)=>e(e=>{let a=new Map(e.computedKPIs);return a.set(t,r),{computedKPIs:a}},!1,"setKPICache"),clearKPICache:()=>e({computedKPIs:new Map},!1,"clearKPICache"),getKPICache:e=>w.getState().computedKPIs.get(e),togglePanel:t=>e(e=>{let r=new Set(e.expandedPanels);return r.has(t)?r.delete(t):r.add(t),{expandedPanels:r}},!1,"togglePanel"),setSelectedOrganizations:t=>e({selectedOrganizations:t},!1,"setSelectedOrganizations"),saveDataToPersistentStorage:async()=>{let e=w.getState();await (0,d.ZS)(e.rawData)},loadDataFromPersistentStorage:()=>{let t=(0,d.P8)();t&&e({rawData:t.map(e=>({...e,customer_category_3:(0,c.Vd)(e.customer_category_3),business_type_category:(0,c.Vd)(e.business_type_category),third_level_organization:(0,c.Vd)(e.third_level_organization),terminal_source:(0,c.Vd)(e.terminal_source)})),error:null},!1,"loadDataFromPersistentStorage")},clearPersistentData:()=>{(0,d.vR)(),e({rawData:[],computedKPIs:new Map,error:null},!1,"clearPersistentData")},getStorageStats:()=>(0,d.yx)(),checkFileForDuplicates:async e=>await (0,d.nH)(e),addToUploadHistory:async(e,t)=>{await (0,d.nJ)(e,t)},getUploadHistoryRecords:()=>(0,d.d)()}),{name:"insurance-analytics-store"})),S=()=>{let e=w(e=>e.rawData),t=w(e=>e.filters.years),r=w(e=>e.filters.weeks),a=w(e=>e.filters.organizations),n=w(e=>e.filters.insuranceTypes),s=w(e=>e.filters.businessTypes),l=w(e=>e.filters.coverageTypes),i=w(e=>e.filters.customerCategories),d=w(e=>e.filters.vehicleGrades),g=w(e=>e.filters.terminalSources),p=w(e=>e.filters.isNewEnergy),f=w(e=>e.filters.renewalStatuses);return(0,o.useMemo)(()=>e.filter(e=>{let o={years:t,weeks:r,organizations:a,insuranceTypes:n,businessTypes:s,coverageTypes:l,customerCategories:i,vehicleGrades:d,terminalSources:g,isNewEnergy:p,renewalStatuses:f};if(o.years.length>0&&!o.years.includes(e.policy_start_year)||o.weeks.length>0&&!o.weeks.includes(e.week_number)||o.organizations.length>0&&!o.organizations.includes((0,c.Vd)(e.third_level_organization))||o.insuranceTypes.length>0&&!o.insuranceTypes.includes(e.insurance_type))return!1;if(o.businessTypes.length>0){let t=(0,u.gX)(e.business_type_category);if(!o.businessTypes.includes(t))return!1}return(!(o.coverageTypes.length>0)||!!o.coverageTypes.includes(e.coverage_type))&&(!(o.customerCategories.length>0)||!!o.customerCategories.includes((0,c.Vd)(e.customer_category_3)))&&(!(o.vehicleGrades.length>0)||!e.vehicle_insurance_grade||!!o.vehicleGrades.includes(e.vehicle_insurance_grade))&&(!(o.terminalSources.length>0)||!!o.terminalSources.includes((0,c.Vd)(e.terminal_source)))&&(null===o.isNewEnergy||e.is_new_energy_vehicle===o.isNewEnergy)&&(!(o.renewalStatuses.length>0)||!!o.renewalStatuses.includes(e.renewal_status))}),[e,t,r,a,n,s,l,i,d,g,p,f])};function x(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=new Set(r);return e.filter(e=>{if(!a.has("years")&&t.years.length>0&&!t.years.includes(e.policy_start_year)||!a.has("weeks")&&t.weeks.length>0&&!t.weeks.includes(e.week_number)||!a.has("organizations")&&t.organizations.length>0&&!t.organizations.includes((0,c.Vd)(e.third_level_organization))||!a.has("insuranceTypes")&&t.insuranceTypes.length>0&&!t.insuranceTypes.includes(e.insurance_type))return!1;if(!a.has("businessTypes")&&t.businessTypes.length>0){let r=(0,u.gX)(e.business_type_category);if(!t.businessTypes.includes(r))return!1}return!!((a.has("coverageTypes")||!(t.coverageTypes.length>0)||t.coverageTypes.includes(e.coverage_type))&&(a.has("customerCategories")||!(t.customerCategories.length>0)||t.customerCategories.includes((0,c.Vd)(e.customer_category_3)))&&(a.has("vehicleGrades")||!(t.vehicleGrades.length>0)||!e.vehicle_insurance_grade||t.vehicleGrades.includes(e.vehicle_insurance_grade))&&(a.has("terminalSources")||!(t.terminalSources.length>0)||t.terminalSources.includes((0,c.Vd)(e.terminal_source)))&&(a.has("isNewEnergy")||null===t.isNewEnergy||e.is_new_energy_vehicle===t.isNewEnergy)&&(a.has("renewalStatuses")||!(t.renewalStatuses.length>0)||t.renewalStatuses.includes(e.renewal_status)))})}},45860:function(e,t,r){function a(e){return null==e||isNaN(e)?{text:"text-slate-600",bg:"bg-slate-50",progress:"bg-slate-400",border:"border-slate-300",level:"medium",label:"无数据"}:e>=110?{text:"text-green-700",bg:"bg-green-50",progress:"bg-green-600",border:"border-green-300",level:"excellent",label:"卓越"}:e>=100?{text:"text-green-600",bg:"bg-green-50",progress:"bg-green-500",border:"border-green-200",level:"good",label:"健康"}:e>=90?{text:"text-yellow-600",bg:"bg-yellow-50",progress:"bg-yellow-500",border:"border-yellow-200",level:"warning",label:"预警"}:e>=80?{text:"text-orange-600",bg:"bg-orange-50",progress:"bg-orange-500",border:"border-orange-200",level:"warning",label:"危险"}:{text:"text-red-600",bg:"bg-red-50",progress:"bg-red-500",border:"border-red-200",level:"danger",label:"高危"}}function n(e){return null==e||isNaN(e)?{text:"text-slate-600",bg:"bg-slate-50",progress:"bg-slate-400",border:"border-slate-300",level:"medium",label:"无数据"}:e<50?{text:"text-green-700",bg:"bg-green-50",progress:"bg-green-600",border:"border-green-300",level:"excellent",label:"优秀"}:e<60?{text:"text-green-600",bg:"bg-green-50",progress:"bg-green-500",border:"border-green-200",level:"good",label:"良好"}:e<70?{text:"text-blue-600",bg:"bg-blue-50",progress:"bg-blue-500",border:"border-blue-200",level:"medium",label:"中等"}:e<80?{text:"text-yellow-600",bg:"bg-yellow-50",progress:"bg-yellow-500",border:"border-yellow-200",level:"warning",label:"预警"}:{text:"text-red-600",bg:"bg-red-50",progress:"bg-red-500",border:"border-red-200",level:"danger",label:"高危"}}function s(e){return null==e||isNaN(e)?{text:"text-slate-600",bg:"bg-slate-50",progress:"bg-slate-400",border:"border-slate-300",level:"medium",label:"无数据"}:e>12?{text:"text-green-700",bg:"bg-green-50",progress:"bg-green-600",border:"border-green-300",level:"excellent",label:"优秀"}:e>=8?{text:"text-green-600",bg:"bg-green-50",progress:"bg-green-500",border:"border-green-200",level:"good",label:"良好"}:e>=6?{text:"text-blue-600",bg:"bg-blue-50",progress:"bg-blue-500",border:"border-blue-200",level:"medium",label:"中等"}:e>=4?{text:"text-yellow-600",bg:"bg-yellow-50",progress:"bg-yellow-500",border:"border-yellow-200",level:"warning",label:"一般"}:e>=0?{text:"text-orange-600",bg:"bg-orange-50",progress:"bg-orange-500",border:"border-orange-200",level:"warning",label:"较差"}:{text:"text-red-600",bg:"bg-red-50",progress:"bg-red-500",border:"border-red-200",level:"danger",label:"严重"}}function o(e){return null==e||isNaN(e)?"#cbd5e1":e>12?"#2E7D32":e>=8?"#4CAF50":e>=6?"#1976D2":e>=4?"#FBC02D":e>=0?"#F57C00":"#D32F2F"}function l(e){return null==e||isNaN(e)?{text:"text-slate-600",bg:"bg-slate-50",progress:"bg-slate-400",border:"border-slate-300",level:"medium",label:"无数据"}:e<65?{text:"text-green-700",bg:"bg-green-50",progress:"bg-green-600",border:"border-green-300",level:"excellent",label:"优秀"}:e<75?{text:"text-green-600",bg:"bg-green-50",progress:"bg-green-500",border:"border-green-200",level:"good",label:"良好"}:e<85?{text:"text-blue-600",bg:"bg-blue-50",progress:"bg-blue-500",border:"border-blue-200",level:"medium",label:"中等"}:e<95?{text:"text-yellow-600",bg:"bg-yellow-50",progress:"bg-yellow-500",border:"border-yellow-200",level:"warning",label:"预警"}:{text:"text-red-600",bg:"bg-red-50",progress:"bg-red-500",border:"border-red-200",level:"danger",label:"高危"}}r.d(t,{Mc:function(){return n},RP:function(){return l},aV:function(){return s},qB:function(){return a},qj:function(){return o}})},11864:function(e,t,r){function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return null==e||isNaN(e)?"-":e.toLocaleString("zh-CN",{minimumFractionDigits:t,maximumFractionDigits:t})}function n(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return null==e||isNaN(e)?"-":"".concat(e.toFixed(t),"%")}function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return null==e||isNaN(e)?"-":"".concat(a(e,t)," 万元")}function o(e){return null==e||isNaN(e)?"text-slate-500":e>12?"text-green-700":e>=8?"text-green-600":e>=4?"text-yellow-600":e>=0?"text-orange-600":"text-red-600"}r.d(t,{T3:function(){return n},XH:function(){return o},uf:function(){return a},xG:function(){return s}})}}]);