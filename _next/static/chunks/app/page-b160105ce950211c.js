(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{28363:function(e,t,s){Promise.resolve().then(s.bind(s,32693))},32693:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return l4}});var l=s(36059),a=s(90616),r=s(60790),n=(s(64492),s(52837)),i=s(58220),o=s(11789),c=s(33239),d=s(62026),u=s(42002),m=s(20736),x=s(88041),h=s(27078);let g={maxFileSize:209715200,allowedExtensions:[".csv"],maxFiles:10,validateFileName:!1},p=(e,t)=>{console.log("[".concat(e.toUpperCase(),"] ").concat(t))};var b=s(75819),f=s(26992);let v=a.forwardRef((e,t)=>{let{className:s,value:a,indicatorClassName:r,...n}=e;return(0,l.jsx)(b.fC,{ref:t,className:(0,f.cn)("relative h-2 w-full overflow-hidden rounded-full bg-primary/20",s),...n,children:(0,l.jsx)(b.z$,{className:(0,f.cn)("h-full w-full flex-1 bg-primary transition-all",r),style:{transform:"translateX(-".concat(100-(a||0),"%)")}})})});v.displayName=b.fC.displayName;var y=s(87123),j=s(21782),N=s(82423),w=s(72110),_=s(1812),k=s(49979),C=s(14432),S=s(33955),M=s(98920),P=s(65577),D=s(83766),R=s(86350);function z(e){let{totalRecords:t,validRecords:s,invalidRecords:r,errorStats:n,fileName:i}=e,c=(0,a.useMemo)(()=>{let e=t>0?s/t*100:0,l=t>0?n.severityStats.error/t*100:0,a=Object.keys(n.fieldErrors).length,r=a>0?Math.max(0,100-5*a):100,i=Object.entries(n.errorTypes).filter(e=>{let[t]=e;return t.includes("格式")||t.includes("枚举")||t.includes("范围")}).reduce((e,t)=>{let[,s]=t;return e+s},0),o=t>0?Math.max(0,100-i/t*100):100,c=e=>e>=95?"excellent":e>=85?"good":e>=70?"warning":"poor";return[{name:"数据完整性",value:e,percentage:e,status:c(e),description:"有效记录占总记录的比例"},{name:"数据准确性",value:100-l,percentage:100-l,status:c(100-l),description:"无严重错误记录的比例"},{name:"字段完整性",value:r,percentage:r,status:c(r),description:"字段数据的完整程度"},{name:"数据一致性",value:o,percentage:o,status:c(o),description:"数据格式和规范的一致性"}]},[t,s,n]),d=(0,a.useMemo)(()=>Math.round(c.reduce((e,t)=>e+t.value,0)/c.length),[c]),u=d>=95?{grade:"A+",color:"text-green-600",bg:"bg-green-50"}:d>=90?{grade:"A",color:"text-green-600",bg:"bg-green-50"}:d>=85?{grade:"B+",color:"text-blue-600",bg:"bg-blue-50"}:d>=80?{grade:"B",color:"text-blue-600",bg:"bg-blue-50"}:d>=70?{grade:"C",color:"text-orange-600",bg:"bg-orange-50"}:{grade:"D",color:"text-red-600",bg:"bg-red-50"};return(0,l.jsxs)("div",{className:"bg-white rounded-2xl border border-slate-200 overflow-hidden",children:[(0,l.jsx)("div",{className:"p-6 border-b border-slate-200",children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsx)(o.Z,{className:"w-6 h-6 text-blue-600"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-slate-800",children:"数据质量报告"}),i&&(0,l.jsx)("p",{className:"text-sm text-slate-600",children:i})]})]}),(0,l.jsxs)("button",{onClick:()=>{let e=new Blob([[["数据质量报告"],["文件名",i||"未知"],["生成时间",new Date().toLocaleString("zh-CN")],[""],["总体评分","".concat(d,"分 (").concat(u.grade,")")],[""],["基础统计"],["总记录数",t],["有效记录数",s],["无效记录数",r],["错误总数",n.totalErrors],[""],["质量指标"],...c.map(e=>[e.name,"".concat(e.value.toFixed(1),"%"),e.description]),[""],["错误分布"],["严重错误",n.severityStats.error],["警告",n.severityStats.warning],["提示",n.severityStats.info],[""],["错误类型统计"],...Object.entries(n.errorTypes).map(e=>{let[t,s]=e;return[t,s]}),[""],["字段错误统计"],...Object.entries(n.fieldErrors).map(e=>{let[t,s]=e;return[t,s]})].map(e=>e.map(e=>'"'.concat(String(e).replace(/"/g,'""'),'"')).join(",")).join("\n")],{type:"text/csv;charset=utf-8;"}),l=document.createElement("a");l.href=URL.createObjectURL(e),l.download="数据质量报告_".concat(i||"未知文件","_").concat(new Date().toISOString().split("T")[0],".csv"),l.click()},className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors",children:[(0,l.jsx)(k.Z,{className:"w-4 h-4"}),"导出报告"]})]})}),(0,l.jsxs)("div",{className:"p-6 space-y-6",children:[(0,l.jsx)("div",{className:(0,f.cn)("p-6 rounded-xl border-2",u.bg,"text-green-600"===u.color?"border-green-200":"text-blue-600"===u.color?"border-blue-200":"text-orange-600"===u.color?"border-orange-200":"border-red-200"),children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h4",{className:"text-lg font-semibold text-slate-800 mb-1",children:"总体质量评分"}),(0,l.jsx)("p",{className:"text-sm text-slate-600",children:"基于完整性、准确性、一致性等维度综合评估"})]}),(0,l.jsxs)("div",{className:"text-right",children:[(0,l.jsx)("div",{className:(0,f.cn)("text-4xl font-bold",u.color),children:d}),(0,l.jsx)("div",{className:(0,f.cn)("text-lg font-semibold",u.color),children:u.grade})]})]})}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h4",{className:"text-lg font-semibold text-slate-800 mb-4",children:"质量指标详情"}),(0,l.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:c.map((e,t)=>(0,l.jsxs)("div",{className:"p-4 bg-slate-50 rounded-lg",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,l.jsx)("span",{className:"font-medium text-slate-800",children:e.name}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:["excellent"===e.status&&(0,l.jsx)(P.Z,{className:"w-4 h-4 text-green-500"}),"good"===e.status&&(0,l.jsx)(D.Z,{className:"w-4 h-4 text-blue-500"}),"warning"===e.status&&(0,l.jsx)(m.Z,{className:"w-4 h-4 text-orange-500"}),"poor"===e.status&&(0,l.jsx)(w.Z,{className:"w-4 h-4 text-red-500"}),(0,l.jsxs)("span",{className:(0,f.cn)("font-semibold","excellent"===e.status?"text-green-600":"good"===e.status?"text-blue-600":"warning"===e.status?"text-orange-600":"text-red-600"),children:[e.value.toFixed(1),"%"]})]})]}),(0,l.jsx)("div",{className:"w-full bg-slate-200 rounded-full h-2 mb-2",children:(0,l.jsx)("div",{className:(0,f.cn)("h-2 rounded-full transition-all duration-300","excellent"===e.status?"bg-green-500":"good"===e.status?"bg-blue-500":"warning"===e.status?"bg-orange-500":"bg-red-500"),style:{width:"".concat(e.percentage,"%")}})}),(0,l.jsx)("p",{className:"text-xs text-slate-600",children:e.description})]},t))})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h4",{className:"text-lg font-semibold text-slate-800 mb-4",children:"数据统计概览"}),(0,l.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,l.jsxs)("div",{className:"p-4 bg-blue-50 rounded-lg",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,l.jsx)(N.Z,{className:"w-4 h-4 text-blue-600"}),(0,l.jsx)("span",{className:"text-sm font-medium text-blue-800",children:"总记录数"})]}),(0,l.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:t.toLocaleString()})]}),(0,l.jsxs)("div",{className:"p-4 bg-green-50 rounded-lg",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,l.jsx)(P.Z,{className:"w-4 h-4 text-green-600"}),(0,l.jsx)("span",{className:"text-sm font-medium text-green-800",children:"有效记录"})]}),(0,l.jsx)("div",{className:"text-2xl font-bold text-green-600",children:s.toLocaleString()})]}),(0,l.jsxs)("div",{className:"p-4 bg-red-50 rounded-lg",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,l.jsx)(w.Z,{className:"w-4 h-4 text-red-600"}),(0,l.jsx)("span",{className:"text-sm font-medium text-red-800",children:"无效记录"})]}),(0,l.jsx)("div",{className:"text-2xl font-bold text-red-600",children:r.toLocaleString()})]}),(0,l.jsxs)("div",{className:"p-4 bg-orange-50 rounded-lg",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,l.jsx)(m.Z,{className:"w-4 h-4 text-orange-600"}),(0,l.jsx)("span",{className:"text-sm font-medium text-orange-800",children:"错误总数"})]}),(0,l.jsx)("div",{className:"text-2xl font-bold text-orange-600",children:n.totalErrors.toLocaleString()})]})]})]}),d<90&&(0,l.jsx)("div",{className:"p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:(0,l.jsxs)("div",{className:"flex items-start gap-3",children:[(0,l.jsx)(R.Z,{className:"w-5 h-5 text-yellow-600 mt-0.5"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h5",{className:"font-medium text-yellow-800 mb-2",children:"数据质量改进建议"}),(0,l.jsxs)("ul",{className:"text-sm text-yellow-700 space-y-1",children:[c.filter(e=>"warning"===e.status||"poor"===e.status).map((e,t)=>(0,l.jsxs)("li",{children:["• 关注 ",e.name,"：当前 ",e.value.toFixed(1),"%，建议提升至 90% 以上"]},t)),n.severityStats.error>0&&(0,l.jsxs)("li",{children:["• 优先处理 ",n.severityStats.error," 个严重错误"]}),Object.keys(n.fieldErrors).length>5&&(0,l.jsx)("li",{children:"• 检查数据源质量，减少字段错误数量"})]})]})]})})]})]})}var T=s(17103),W=s(32760),E=s(9824),F=s(59666),L=s(48930);function A(e){let{errorStats:t,totalRecords:s}=e,r=(0,a.useMemo)(()=>{let e=[];Object.entries(t.errorTypes).forEach(t=>{let[l,a]=t,r=a/s*100;"必填字段缺失"===l&&a>0&&e.push({id:"missing-required-fields",title:"修复必填字段缺失问题",description:"发现 ".concat(a," 个必填字段缺失错误，占总记录的 ").concat(r.toFixed(1),"%"),priority:"high",category:"data_source",impact:"提升数据完整性，确保关键信息不丢失",steps:["检查数据源系统，确保必填字段在导出时包含数据","设置数据验证规则，在源头防止空值产生","对于历史数据，可以设置合理的默认值或标记为待补充","建立数据质量监控，及时发现缺失字段问题"],examples:["保单号不能为空 → 检查保单生成流程","投保人姓名缺失 → 完善客户信息录入"]}),"格式错误"===l&&a>0&&e.push({id:"format-errors",title:"统一数据格式规范",description:"发现 ".concat(a," 个格式错误，占总记录的 ").concat(r.toFixed(1),"%"),priority:"high",category:"format",impact:"提高数据一致性，减少处理错误",steps:["制定统一的数据格式标准文档","在数据录入界面添加格式验证","使用数据清洗工具批量修正格式问题","培训数据录入人员，确保格式规范"],examples:["日期格式：统一使用 YYYY-MM-DD","电话号码：统一使用 11 位手机号格式","金额格式：统一保留两位小数"]}),"数值类型错误"===l&&a>0&&e.push({id:"numeric-type-errors",title:"修正数值类型问题",description:"发现 ".concat(a," 个数值类型错误，占总记录的 ").concat(r.toFixed(1),"%"),priority:"medium",category:"validation",impact:"确保数值计算准确性",steps:["检查数据源中的数值字段定义","清理非数值字符（如货币符号、千分位符号）","设置数值范围验证规则","对异常数值进行人工审核"],examples:["保费金额包含货币符号 → 移除 \xa5 符号","年龄字段包含文字 → 提取纯数字"]}),"枚举值错误"===l&&a>0&&e.push({id:"enum-value-errors",title:"规范枚举值选项",description:"发现 ".concat(a," 个枚举值错误，占总记录的 ").concat(r.toFixed(1),"%"),priority:"medium",category:"validation",impact:"确保分类统计准确性",steps:["建立标准的枚举值字典","在录入界面使用下拉选择而非手工输入","建立枚举值映射表，处理历史数据","定期审查和更新枚举值列表"],examples:['性别字段：统一使用"男"、"女"',"车辆类型：建立标准分类体系"]}),"日期时间错误"===l&&a>0&&e.push({id:"datetime-errors",title:"标准化日期时间格式",description:"发现 ".concat(a," 个日期时间错误，占总记录的 ").concat(r.toFixed(1),"%"),priority:"medium",category:"format",impact:"确保时间序列分析准确性",steps:["统一日期时间格式标准","验证日期的合理性（如生效日期不能早于投保日期）","处理时区问题，确保时间一致性","建立日期范围验证规则"],examples:["统一使用 ISO 8601 格式：2024-01-15","验证保单生效日期的合理性"]})});let l=Object.keys(t.fieldErrors).length;return l>5&&e.push({id:"multiple-field-errors",title:"优化数据源质量",description:"".concat(l," 个字段存在错误，建议从源头改善数据质量"),priority:"high",category:"data_source",impact:"全面提升数据质量，减少后续处理成本",steps:["分析数据源系统的数据质量问题","建立数据质量评估体系","在数据产生环节增加验证规则","定期进行数据质量审计"],relatedFields:Object.keys(t.fieldErrors).slice(0,5)}),t.severityStats.error>.1*s&&e.push({id:"high-error-rate",title:"紧急处理严重错误",description:"严重错误率过高（".concat((t.severityStats.error/s*100).toFixed(1),"%），需要立即处理"),priority:"high",category:"process",impact:"避免错误数据影响业务决策",steps:["暂停使用有严重错误的数据","建立错误数据隔离机制","优先修复影响业务的关键错误","建立数据质量监控告警"]}),e.length>0&&e.push({id:"general-improvements",title:"建立数据质量管理体系",description:"从流程和制度层面提升数据质量",priority:"low",category:"process",impact:"长期保障数据质量稳定性",steps:["制定数据质量标准和规范","建立数据质量监控仪表板","定期进行数据质量培训","建立数据质量问题反馈机制","设立数据质量责任人制度"]}),e.sort((e,t)=>{let s={high:3,medium:2,low:1};return s[t.priority]-s[e.priority]})},[t,s]),n=e=>{let t=["# ".concat(e.title),"","**描述：** ".concat(e.description),"**影响：** ".concat(e.impact),"","**修复步骤：**",...e.steps.map((e,t)=>"".concat(t+1,". ").concat(e)),"",...e.examples?["**示例：**",...e.examples.map(e=>"- ".concat(e)),""]:[],...e.relatedFields?["**相关字段：**",e.relatedFields.join(", "),""]:[]].join("\n");navigator.clipboard.writeText(t)},i=e=>{switch(e){case"high":return"text-red-600 bg-red-50 border-red-200";case"medium":return"text-orange-600 bg-orange-50 border-orange-200";case"low":return"text-blue-600 bg-blue-50 border-blue-200"}},o=e=>{switch(e){case"data_source":return(0,l.jsx)(D.Z,{className:"w-4 h-4"});case"format":return(0,l.jsx)(T.Z,{className:"w-4 h-4"});case"validation":return(0,l.jsx)(P.Z,{className:"w-4 h-4"});case"process":return(0,l.jsx)(R.Z,{className:"w-4 h-4"})}};return 0===r.length?(0,l.jsx)("div",{className:"bg-green-50 border border-green-200 rounded-2xl p-6",children:(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsx)(P.Z,{className:"w-6 h-6 text-green-600"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-green-800",children:"数据质量良好"}),(0,l.jsx)("p",{className:"text-green-700",children:"当前数据质量较高，无需特殊修复措施。建议继续保持现有的数据管理流程。"})]})]})}):(0,l.jsxs)("div",{className:"bg-white rounded-2xl border border-slate-200 overflow-hidden",children:[(0,l.jsx)("div",{className:"p-6 border-b border-slate-200",children:(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsx)(W.Z,{className:"w-6 h-6 text-yellow-600"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-slate-800",children:"数据修复建议"}),(0,l.jsx)("p",{className:"text-sm text-slate-600",children:"基于错误分析生成的具体修复指导"})]})]})}),(0,l.jsxs)("div",{className:"p-6 space-y-6",children:[r.map(e=>(0,l.jsxs)("div",{className:"border border-slate-200 rounded-lg overflow-hidden",children:[(0,l.jsx)("div",{className:"p-4 bg-slate-50",children:(0,l.jsxs)("div",{className:"flex items-start justify-between",children:[(0,l.jsxs)("div",{className:"flex items-start gap-3",children:[(0,l.jsx)("div",{className:"flex-shrink-0 mt-1",children:o(e.category)}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,l.jsx)("h4",{className:"font-semibold text-slate-800",children:e.title}),(0,l.jsx)("span",{className:(0,f.cn)("px-2 py-0.5 text-xs font-medium rounded border",i(e.priority)),children:"high"===e.priority?"高优先级":"medium"===e.priority?"中优先级":"低优先级"})]}),(0,l.jsx)("p",{className:"text-sm text-slate-600 mb-2",children:e.description}),(0,l.jsxs)("div",{className:"flex items-center gap-2 text-xs text-slate-500",children:[(0,l.jsx)(E.Z,{className:"w-3 h-3"}),(0,l.jsx)("span",{children:e.impact})]})]})]}),(0,l.jsxs)("button",{onClick:()=>n(e),className:"flex items-center gap-1 px-2 py-1 text-xs bg-white hover:bg-slate-100 border border-slate-300 rounded transition-colors",title:"复制建议内容",children:[(0,l.jsx)(F.Z,{className:"w-3 h-3"}),"复制"]})]})}),(0,l.jsxs)("div",{className:"p-4",children:[(0,l.jsx)("h5",{className:"font-medium text-slate-800 mb-3",children:"修复步骤"}),(0,l.jsx)("ol",{className:"space-y-2",children:e.steps.map((e,t)=>(0,l.jsxs)("li",{className:"flex items-start gap-3",children:[(0,l.jsx)("span",{className:"flex-shrink-0 w-5 h-5 bg-blue-100 text-blue-600 text-xs font-medium rounded-full flex items-center justify-center mt-0.5",children:t+1}),(0,l.jsx)("span",{className:"text-sm text-slate-700",children:e})]},t))}),e.examples&&(0,l.jsxs)("div",{className:"mt-4",children:[(0,l.jsx)("h6",{className:"font-medium text-slate-800 mb-2",children:"示例"}),(0,l.jsx)("div",{className:"space-y-1",children:e.examples.map((e,t)=>(0,l.jsx)("div",{className:"text-sm text-slate-600 bg-slate-50 p-2 rounded",children:e},t))})]}),e.relatedFields&&(0,l.jsxs)("div",{className:"mt-4",children:[(0,l.jsx)("h6",{className:"font-medium text-slate-800 mb-2",children:"相关字段"}),(0,l.jsx)("div",{className:"flex flex-wrap gap-1",children:e.relatedFields.map((e,t)=>(0,l.jsx)("span",{className:"px-2 py-1 text-xs bg-blue-100 text-blue-700 rounded",children:e},t))})]})]})]},e.id)),(0,l.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:(0,l.jsxs)("div",{className:"flex items-start gap-3",children:[(0,l.jsx)(L.Z,{className:"w-5 h-5 text-blue-600 mt-0.5"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h5",{className:"font-medium text-blue-800 mb-2",children:"相关资源"}),(0,l.jsxs)("ul",{className:"text-sm text-blue-700 space-y-1",children:[(0,l.jsx)("li",{children:"• 数据质量管理最佳实践指南"}),(0,l.jsx)("li",{children:"• 保险行业数据标准规范"}),(0,l.jsx)("li",{children:"• 数据清洗工具使用手册"}),(0,l.jsx)("li",{children:"• 数据验证规则配置说明"})]})]})]})})]})]})}function Z(e){var t;let{batchResult:s,onReset:r}=e,[n,i]=(0,a.useState)(new Set),[o,c]=(0,a.useState)(""),[d,u]=(0,a.useState)("all"),[x,h]=(0,a.useState)("all"),g=e=>{let t=new Set(n);t.has(e)?t.delete(e):t.add(e),i(t)},p=(0,a.useMemo)(()=>{let e=[];return s.results.forEach(t=>{var s;(null===(s=t.result)||void 0===s?void 0:s.errors)&&t.result.errors.forEach(s=>{let l;let a=s.message.match(/^([^:：]+)[：:]/);a&&(l=a[1].trim()),e.push({row:s.row,field:l,message:s.message,severity:s.severity,fileName:t.file.name})}),!t.success&&t.error&&e.push({row:1,field:void 0,message:t.error,severity:"error",fileName:t.file.name})}),e},[s]),b=(0,a.useMemo)(()=>{let e={},t={},s={error:0,warning:0,info:0};return p.forEach(l=>{l.field&&(e[l.field]=(e[l.field]||0)+1);let a="其他错误",r=l.message.toLowerCase();if(r.includes("required")||r.includes("必填")||r.includes("不能为空"))a="必填字段缺失";else if(r.includes("invalid")||r.includes("格式")||r.includes("无效"))a="格式错误";else if(r.includes("number")||r.includes("数字")||r.includes("数值"))a="数值类型错误";else if(r.includes("date")||r.includes("时间")||r.includes("日期"))a="日期时间错误";else if(r.includes("enum")||r.includes("枚举")||r.includes("选项"))a="枚举值错误";else if(r.includes("length")||r.includes("长度")||r.includes("范围"))a="长度范围错误";else if(r.includes("duplicate")||r.includes("重复"))a="重复数据";else{let e=l.message.indexOf(":");e>0&&e<30&&(a=l.message.substring(0,e).trim())}t[a]=(t[a]||0)+1,s[l.severity]++}),{totalErrors:p.length,fieldErrors:e,errorTypes:t,severityStats:s}},[p]),v=(0,a.useMemo)(()=>p.filter(e=>!!(!o||e.message.toLowerCase().includes(o.toLowerCase())||e.fileName.toLowerCase().includes(o.toLowerCase())||e.field&&e.field.toLowerCase().includes(o.toLowerCase()))&&("all"===d||e.severity===d)&&("all"===x||e.field===x)),[p,o,d,x]),y=0===s.failureCount&&0===b.severityStats.error;return(0,l.jsxs)("div",{className:"w-full max-w-6xl mx-auto space-y-6",children:[(0,l.jsxs)("div",{className:(0,f.cn)("p-6 rounded-2xl border-2",y?"bg-green-50/80 border-green-200":"bg-orange-50/80 border-orange-200"),children:[(0,l.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-xl font-semibold text-slate-800 mb-2",children:y?"数据导入成功":"数据导入完成（存在问题）"}),(0,l.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-slate-600",children:"总文件数："}),(0,l.jsx)("span",{className:"font-medium",children:s.totalFiles})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-slate-600",children:"成功文件："}),(0,l.jsx)("span",{className:"font-medium text-green-600",children:s.successCount})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-slate-600",children:"有效记录："}),(0,l.jsx)("span",{className:"font-medium text-blue-600",children:s.validRecords})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-slate-600",children:"问题记录："}),(0,l.jsx)("span",{className:"font-medium text-orange-600",children:s.invalidRecords})]})]})]}),(0,l.jsx)("button",{onClick:r,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors",children:"继续导入"})]}),b.totalErrors>0&&(0,l.jsxs)("div",{className:"mt-4 p-4 bg-white/60 rounded-lg",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,l.jsx)(N.Z,{className:"w-5 h-5 text-slate-600"}),(0,l.jsx)("h4",{className:"font-medium text-slate-800",children:"问题统计"})]}),(0,l.jsxs)("div",{className:"grid grid-cols-3 gap-4 text-sm mb-4",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(w.Z,{className:"w-4 h-4 text-red-500"}),(0,l.jsxs)("span",{children:["错误: ",b.severityStats.error]})]}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(m.Z,{className:"w-4 h-4 text-orange-500"}),(0,l.jsxs)("span",{children:["警告: ",b.severityStats.warning]})]}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(_.Z,{className:"w-4 h-4 text-blue-500"}),(0,l.jsxs)("span",{children:["提示: ",b.severityStats.info]})]})]}),(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsx)("h5",{className:"text-sm font-medium text-slate-700 mb-2",children:"错误类型分布"}),(0,l.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2 text-xs",children:Object.entries(b.errorTypes).sort((e,t)=>{let[,s]=e,[,l]=t;return l-s}).slice(0,6).map(e=>{let[t,s]=e;return(0,l.jsxs)("div",{className:"flex justify-between items-center bg-white/80 px-2 py-1 rounded",children:[(0,l.jsx)("span",{className:"text-slate-600 truncate",children:t}),(0,l.jsx)("span",{className:"font-medium text-slate-800 ml-1",children:s})]},t)})})]}),Object.keys(b.fieldErrors).length>0&&(0,l.jsxs)("div",{children:[(0,l.jsx)("h5",{className:"text-sm font-medium text-slate-700 mb-2",children:"问题字段分布"}),(0,l.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 text-xs",children:Object.entries(b.fieldErrors).sort((e,t)=>{let[,s]=e,[,l]=t;return l-s}).slice(0,8).map(e=>{let[t,s]=e;return(0,l.jsxs)("div",{className:"flex justify-between items-center bg-white/80 px-2 py-1 rounded",children:[(0,l.jsx)("span",{className:"text-slate-600 truncate",children:t}),(0,l.jsx)("span",{className:"font-medium text-slate-800 ml-1",children:s})]},t)})})]})]})]}),b.totalErrors>0&&(0,l.jsxs)("div",{className:"bg-white rounded-2xl border border-slate-200 overflow-hidden",children:[(0,l.jsxs)("div",{className:"p-6 border-b border-slate-200",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,l.jsx)("h4",{className:"text-lg font-semibold text-slate-800",children:"问题详情分析"}),(0,l.jsxs)("button",{onClick:()=>{let e=new Blob([["文件名,行号,字段,错误信息,严重程度",...v.map(e=>[e.fileName,e.row,e.field||"",'"'.concat(e.message.replace(/"/g,'""'),'"'),e.severity].join(","))].join("\n")],{type:"text/csv;charset=utf-8;"}),t=document.createElement("a");t.href=URL.createObjectURL(e),t.download="数据验证错误报告_".concat(new Date().toISOString().split("T")[0],".csv"),t.click()},className:"flex items-center gap-2 px-3 py-2 text-sm bg-slate-100 hover:bg-slate-200 rounded-lg transition-colors",children:[(0,l.jsx)(k.Z,{className:"w-4 h-4"}),"导出报告"]})]}),(0,l.jsxs)("div",{className:"flex flex-wrap gap-4 mb-4",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(C.Z,{className:"w-4 h-4 text-slate-500"}),(0,l.jsx)("input",{type:"text",placeholder:"搜索错误信息...",value:o,onChange:e=>c(e.target.value),className:"px-3 py-1 border border-slate-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,l.jsxs)("select",{value:d,onChange:e=>u(e.target.value),className:"px-3 py-1 border border-slate-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,l.jsx)("option",{value:"all",children:"所有级别"}),(0,l.jsx)("option",{value:"error",children:"错误"}),(0,l.jsx)("option",{value:"warning",children:"警告"}),(0,l.jsx)("option",{value:"info",children:"提示"})]}),(0,l.jsxs)("select",{value:x,onChange:e=>h(e.target.value),className:"px-3 py-1 border border-slate-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,l.jsx)("option",{value:"all",children:"所有字段"}),Object.keys(b.fieldErrors).sort().map(e=>(0,l.jsxs)("option",{value:e,children:[e," (",b.fieldErrors[e],")"]},e))]})]}),(0,l.jsxs)("div",{className:"text-sm text-slate-600",children:["显示 ",v.length," / ",b.totalErrors," 个问题"]})]}),(0,l.jsx)("div",{className:"max-h-96 overflow-y-auto",children:v.map((e,t)=>(0,l.jsxs)("div",{className:(0,f.cn)("flex items-start gap-3 p-4 border-b border-slate-100 hover:bg-slate-50","error"===e.severity&&"border-l-4 border-l-red-500","warning"===e.severity&&"border-l-4 border-l-orange-500","info"===e.severity&&"border-l-4 border-l-blue-500"),children:[(0,l.jsxs)("div",{className:"flex-shrink-0 mt-0.5",children:["error"===e.severity&&(0,l.jsx)(w.Z,{className:"w-4 h-4 text-red-500"}),"warning"===e.severity&&(0,l.jsx)(m.Z,{className:"w-4 h-4 text-orange-500"}),"info"===e.severity&&(0,l.jsx)(_.Z,{className:"w-4 h-4 text-blue-500"})]}),(0,l.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,l.jsx)("span",{className:"text-sm font-medium text-slate-800",children:e.fileName}),(0,l.jsxs)("span",{className:"text-xs text-slate-500",children:["第 ",e.row," 行"]}),e.field&&(0,l.jsx)("span",{className:"text-xs bg-slate-100 text-slate-600 px-2 py-0.5 rounded",children:e.field})]}),(0,l.jsx)("p",{className:"text-sm text-slate-600",children:e.message})]})]},t))})]}),s.totalRecords>0&&(0,l.jsx)(z,{totalRecords:s.totalRecords,validRecords:s.validRecords,invalidRecords:s.invalidRecords,errorStats:b,fileName:null===(t=s.results[0])||void 0===t?void 0:t.file.name}),b.totalErrors>0&&(0,l.jsx)(A,{errorStats:b,totalRecords:s.totalRecords}),(0,l.jsxs)("div",{className:"bg-white rounded-2xl border border-slate-200 overflow-hidden",children:[(0,l.jsx)("div",{className:"p-6 border-b border-slate-200",children:(0,l.jsx)("h4",{className:"text-lg font-semibold text-slate-800",children:"文件处理详情"})}),(0,l.jsx)("div",{className:"divide-y divide-slate-100",children:s.results.map((e,t)=>(0,l.jsxs)("div",{className:"p-4",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>g(t),children:[(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[n.has(t)?(0,l.jsx)(S.Z,{className:"w-4 h-4 text-slate-500"}):(0,l.jsx)(M.Z,{className:"w-4 h-4 text-slate-500"}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[e.success?(0,l.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full"}):(0,l.jsx)("div",{className:"w-2 h-2 bg-red-500 rounded-full"}),(0,l.jsx)("span",{className:"font-medium text-slate-800",children:e.file.name})]})]}),(0,l.jsxs)("div",{className:"flex items-center gap-4 text-sm text-slate-600",children:[e.success&&e.result&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("span",{children:[e.result.successRecords," 条有效"]}),(0,l.jsxs)("span",{children:[e.result.failedRecords," 条无效"]})]}),(0,l.jsxs)("span",{children:[Math.round(e.file.size/1024)," KB"]})]})]}),n.has(t)&&(0,l.jsx)("div",{className:"mt-4 ml-7 space-y-3",children:e.success&&e.result?(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 text-sm",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-slate-600",children:"总记录数："}),(0,l.jsx)("span",{className:"font-medium",children:e.result.processedRecords})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-slate-600",children:"有效记录："}),(0,l.jsx)("span",{className:"font-medium text-green-600",children:e.result.successRecords})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-slate-600",children:"无效记录："}),(0,l.jsx)("span",{className:"font-medium text-red-600",children:e.result.failedRecords})]})]}),e.result.errors&&e.result.errors.length>0&&(0,l.jsxs)("div",{className:"mt-3",children:[(0,l.jsxs)("h5",{className:"text-sm font-medium text-slate-800 mb-2",children:["错误详情 (",e.result.errors.length," 个)"]}),(0,l.jsxs)("div",{className:"space-y-1 max-h-32 overflow-y-auto",children:[e.result.errors.slice(0,10).map((e,t)=>(0,l.jsxs)("div",{className:"text-xs text-slate-600 bg-slate-50 p-2 rounded",children:["第 ",e.row," 行",e.field&&" (".concat(e.field,")"),":"," ",e.message]},t)),e.result.errors.length>10&&(0,l.jsxs)("div",{className:"text-xs text-slate-500 italic",children:["还有 ",e.result.errors.length-10," ","个错误..."]})]})]})]}):(0,l.jsxs)("div",{className:"text-sm text-red-600 bg-red-50 p-3 rounded",children:[(0,l.jsx)("strong",{children:"处理失败："}),e.error]})})]},t))})]})]})}let Y=e=>{if(0===e)return"0 B";let t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["B","KB","MB","GB"][t]},O=e=>e<1e3?"".concat(Math.round(e),"ms"):e<6e4?"".concat((e/1e3).toFixed(1),"s"):"".concat(Math.floor(e/6e4),"m ").concat(Math.floor(e%6e4/1e3),"s");function q(){let[e,t]=(0,a.useState)(!1),[s,n]=(0,a.useState)(!1),[b,N]=(0,a.useState)([]),[w,_]=(0,a.useState)(!1),{progress:k,batchResult:C,uploadFiles:S,validateFile:M,reset:P,setValidationOptions:D,isUploading:R}=function(){let[e,t]=(0,a.useState)("idle"),[s,l]=(0,a.useState)(null),[r,n]=(0,a.useState)(null),[i,o]=(0,a.useState)(g),{setRawData:c,setError:d,setLoading:u}=(0,h.qr)(),m=(0,a.useCallback)(e=>{var t;if(e.size>i.maxFileSize)return"文件大小超过限制 (".concat(Math.round(i.maxFileSize/1024/1024),"MB)");let s="."+(null===(t=e.name.split(".").pop())||void 0===t?void 0:t.toLowerCase());if(!i.allowedExtensions.includes(s))return"不支持的文件类型，仅支持: ".concat(i.allowedExtensions.join(", "));if(i.validateFileName){let t=e.name.replace(/\.[^/.]+$/,"");if(!/^[\u4e00-\u9fa5a-zA-Z0-9_-]+$/.test(t))return"文件名包含非法字符，仅支持中文、英文、数字、下划线和连字符"}return null},[i]),b=(0,a.useCallback)(async function(e){var s,a;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,i=Date.now(),o=null!==(s=null==n?void 0:n.currentFile)&&void 0!==s?s:1,c=null!==(a=null==n?void 0:n.totalFiles)&&void 0!==a?a:1;try{t("uploading"),u(!0);let s=m(e);if(s)return t("error"),d(Error(s)),p("error",s),{file:e,success:!1,error:s,uploadTime:Date.now()-i};let a=new x.r,n=await a.execute(e,r,e=>{let s={currentFile:o,totalFiles:c,fileName:e.currentItem||"",fileProgress:e.percentage,overallProgress:Math.round(((o-1)*100+e.percentage)/c),currentPhase:e.phase,estimatedTimeRemaining:e.estimatedTimeRemaining,processedRows:e.processedRows,totalRows:e.totalRows};switch(l(s),e.phase){case"parsing":t("parsing");break;case"validating":t("validating");break;case"storing":t("uploading")}});return n.success?(t("success"),p("success","成功上传 ".concat(n.successRecords," 条记录")),n.warnings.length>0&&n.warnings.forEach(e=>{p("warning",e)})):(t("error"),d(Error(n.errors.map(e=>e.message).join("; "))),p("error","上传失败，请检查文件格式")),{file:e,success:n.success,result:n,uploadTime:Date.now()-i}}catch(l){let s=l instanceof Error?l.message:String(l);return t("error"),d(Error(s)),p("error","上传过程中发生错误: ".concat(s)),{file:e,success:!1,error:s,uploadTime:Date.now()-i}}finally{u(!1),l(null)}},[m,d,u]),f=(0,a.useCallback)(async function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=Date.now(),r=[],o=0,c=0,m=0,x=0,h=0,g=0;try{var f;if(t("uploading"),u(!0),e.length>i.maxFiles){let s="文件数量超过限制，最多允许 ".concat(i.maxFiles," 个文件");return t("error"),d(Error(s)),p("error",s),{totalFiles:e.length,successCount:0,failureCount:e.length,results:[],totalTime:0,totalRecords:0,validRecords:0,invalidRecords:0}}let v=Math.max(1,Math.min(3,null!==(f=s.concurrency)&&void 0!==f?f:2)),y=e.map((e,t)=>({file:e,index:t})),j=async()=>{var t,a,n,i,d,u;let p=y.shift();if(!p)return;let{file:f,index:v}=p;l({currentFile:v+1,totalFiles:e.length,fileName:f.name,fileProgress:0,overallProgress:Math.round(g/e.length*100),currentPhase:"parsing",processedRows:0});let N=await b(f,s,{currentFile:v+1,totalFiles:e.length});r[v]=N,N.success?(o++,m+=(null===(i=N.result)||void 0===i?void 0:i.processedRecords)||0,x+=(null===(d=N.result)||void 0===d?void 0:d.successRecords)||0,h+=(null===(u=N.result)||void 0===u?void 0:u.failedRecords)||0):c++,g++,l({currentFile:v+1,totalFiles:e.length,fileName:f.name,fileProgress:100,overallProgress:Math.round(g/e.length*100),currentPhase:"completed",processedRows:(null===(t=N.result)||void 0===t?void 0:t.processedRecords)||0,totalRows:null===(a=N.result)||void 0===a?void 0:a.processedRecords,errorCount:null===(n=N.result)||void 0===n?void 0:n.failedRecords}),await j()},N=Array.from({length:Math.min(v,e.length)},()=>j());await Promise.all(N);let w={totalFiles:e.length,successCount:o,failureCount:c,results:r,totalTime:Date.now()-a,totalRecords:m,validRecords:x,invalidRecords:h};return n(w),t("success"),0===c?p("success","所有文件上传成功，共处理 ".concat(x," 条记录")):p("warning","上传完成：".concat(o," 个文件成功，").concat(c," 个文件失败，共处理 ").concat(x," 条有效记录")),w}catch(l){let s=l instanceof Error?l.message:String(l);return t("error"),d(Error(s)),p("error","批量上传过程中发生错误: ".concat(s)),{totalFiles:e.length,successCount:o,failureCount:c,results:r,totalTime:Date.now()-a,totalRecords:m,validRecords:x,invalidRecords:h}}finally{u(!1),l(null)}},[i.maxFiles,b,d,u]),v=(0,a.useCallback)(()=>{t("idle"),l(null),n(null),d(null)},[d]),y=(0,a.useCallback)(()=>{d(null),"error"===e&&t("idle")},[e,d]);return{status:e,progress:s,batchResult:r,validationOptions:i,uploadFile:b,uploadFiles:f,validateFile:m,reset:v,clearError:y,setValidationOptions:o,isUploading:"uploading"===e||"parsing"===e||"validating"===e,hasError:"error"===e,hasSuccess:"success"===e,isIdle:"idle"===e}}(),{toast:z}=(0,y.pm)(),T=(0,h.qr)(e=>e.rawData),W=(0,h.qr)(e=>e.clearData),E=(0,h.qr)(e=>e.clearPersistentData);(0,h.qr)(e=>e.getStorageStats);let F=(0,a.useMemo)(()=>{if(0===T.length)return null;let e=Array.from(new Set(T.map(e=>e.week_number))).sort((e,t)=>e-t),t=Array.from(new Set(T.map(e=>e.policy_start_year))).sort((e,t)=>e-t),{min:s,max:l}=e.length>0?(0,j.ku)(e):{min:0,max:0};return{totalRecords:T.length,weeks:e,years:t,weekRange:e.length>0?"".concat(s,"-").concat(l,"周"):""}},[T]);a.useEffect(()=>{t(!0)},[]),a.useEffect(()=>{D({maxFiles:10,maxFileSize:209715200,allowedExtensions:[".csv",".duckdb",".db"],validateFileName:!1})},[D]);let L=(0,a.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),R||n(!0)},[R]),A=(0,a.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),n(!1)},[]),q=(0,a.useCallback)(async e=>{if(e.preventDefault(),e.stopPropagation(),n(!1),R)return;let t=Array.from(e.dataTransfer.files).filter(e=>{let t=e.name.toLowerCase();return t.endsWith(".csv")||t.endsWith(".duckdb")||t.endsWith(".db")});if(0===t.length){z({title:"文件格式错误",description:"请上传 CSV 或 DuckDB 格式的文件",variant:"destructive"});return}let s=t.map(M).filter(Boolean);if(s.length>0){z({title:"文件验证失败",description:s.join("\n"),variant:"destructive"});return}N(t)},[R,M,z]),I=(0,a.useCallback)(async e=>{let t=Array.from(e.target.files||[]);if(0===t.length)return;let s=t.map(M).filter(Boolean);if(s.length>0){z({title:"文件验证失败",description:s.join("\n"),variant:"destructive"});return}N(t),e.target.value=""},[M,z]),V=(0,a.useCallback)(async()=>{if(0!==b.length)try{let e=await S(b,{});0===e.failureCount?z({title:"上传成功",description:"成功上传 ".concat(e.successCount," 个文件，共 ").concat(e.validRecords," 条有效记录")}):e.successCount>0?z({title:"部分成功",description:"".concat(e.successCount,"/").concat(e.totalFiles," 个文件上传成功"),variant:"destructive"}):z({title:"上传失败",description:"所有文件上传失败，请检查文件格式",variant:"destructive"})}catch(e){z({title:"上传错误",description:e instanceof Error?e.message:"上传失败",variant:"destructive"})}},[b,S,z]),B=(0,a.useCallback)(()=>{N([]),P()},[P]),K=(0,a.useCallback)(e=>{R||N(t=>t.filter((t,s)=>s!==e))},[R]),G=(0,a.useCallback)(async()=>{try{W(),await E(),z({title:"数据已清除",description:"所有数据和上传历史已成功清除"}),_(!1)}catch(e){z({title:"清除失败",description:e instanceof Error?e.message:"清除数据失败",variant:"destructive"})}},[W,E,z]);return R&&k?(0,l.jsxs)("div",{className:"w-full max-w-2xl mx-auto p-8 bg-white/80 backdrop-blur-sm rounded-2xl border border-slate-200",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3 mb-6",children:[(0,l.jsx)("div",{className:"relative",children:(0,l.jsx)("div",{className:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center",children:(0,l.jsx)(i.Z,{className:"w-6 h-6 text-blue-600 animate-spin"})})}),(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-slate-800",children:"正在处理文件..."}),(0,l.jsxs)("p",{className:"text-sm text-slate-600",children:[k.fileName," (",k.currentFile,"/",k.totalFiles,")"]}),(0,l.jsx)("p",{className:"text-xs text-slate-500",children:{uploading:"准备上传",parsing:"解析文件",validating:"验证数据",transforming:"处理数据"}[k.currentPhase]})]})]}),(0,l.jsxs)("div",{className:"space-y-3",children:[(0,l.jsx)(v,{value:k.overallProgress,className:"h-3"}),(0,l.jsxs)("div",{className:"flex justify-between text-xs text-slate-500",children:[(0,l.jsxs)("span",{children:[Math.round(k.overallProgress),"%"]}),(0,l.jsx)("div",{className:"flex items-center gap-2",children:k.estimatedTimeRemaining&&(0,l.jsxs)("span",{children:["剩余 ",O(k.estimatedTimeRemaining)]})})]})]})]}):C?(0,l.jsx)(Z,{batchResult:C,onReset:B}):b.length>0&&!C?(0,l.jsx)("div",{className:"w-full max-w-2xl mx-auto space-y-6",children:(0,l.jsxs)("div",{className:"p-6 bg-white/80 backdrop-blur-sm rounded-2xl border border-slate-200",children:[(0,l.jsxs)("h3",{className:"text-lg font-semibold text-slate-800 mb-4",children:["已选择的文件 (",b.length,")"]}),(0,l.jsx)("div",{className:"space-y-3 max-h-60 overflow-y-auto",children:b.map((e,t)=>{var s;let a=null===(s=e.name.split(".").pop())||void 0===s?void 0:s.toLowerCase(),n="duckdb"===a||"db"===a;return(0,l.jsxs)("div",{className:"flex items-center gap-3 p-3 bg-slate-50 rounded-lg",children:[n?(0,l.jsx)(r.Z,{className:"h-5 w-5 text-blue-500"}):(0,l.jsx)(o.Z,{className:"h-5 w-5 text-slate-400"}),(0,l.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,l.jsxs)("div",{className:"font-medium truncate",children:[e.name,n&&(0,l.jsx)("span",{className:"ml-2 text-xs bg-blue-100 text-blue-700 px-2 py-0.5 rounded",children:"DuckDB"})]}),(0,l.jsx)("div",{className:"text-sm text-slate-500",children:Y(e.size)})]}),(0,l.jsx)("button",{onClick:()=>K(t),className:"p-1 hover:bg-slate-200 rounded transition-colors",disabled:R,children:(0,l.jsx)(c.Z,{className:"h-4 w-4 text-slate-400"})})]},t)})}),(0,l.jsxs)("div",{className:"flex gap-3 mt-6",children:[(0,l.jsxs)("button",{onClick:V,disabled:R,className:"flex-1 px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors disabled:opacity-50",children:[(0,l.jsx)(d.Z,{className:"w-5 h-5 mr-2 inline"}),"开始上传 (",b.length," 个文件)"]}),(0,l.jsx)("button",{onClick:B,disabled:R,className:"px-6 py-3 bg-slate-200 hover:bg-slate-300 text-slate-700 font-medium rounded-lg transition-colors disabled:opacity-50",children:"重新选择"})]})]})}):(0,l.jsxs)("div",{className:"space-y-4",children:[e&&F&&(0,l.jsx)("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsx)(r.Z,{className:"h-5 w-5 text-green-600"}),(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsxs)("p",{className:"text-sm font-medium text-green-900",children:["已加载数据：",F.totalRecords.toLocaleString()," ","条记录"]}),(0,l.jsxs)("p",{className:"text-xs text-green-700 mt-1",children:[F.years.join(", ")," 年 \xb7"," ",F.weekRange," \xb7",(0,l.jsx)("span",{className:"font-semibold ml-1",children:"可继续上传其他周的数据"})]})]}),(0,l.jsxs)("button",{onClick:()=>_(!0),className:"px-3 py-1.5 bg-red-100 hover:bg-red-200 text-red-700 text-sm font-medium rounded-md transition-colors flex items-center gap-1.5",children:[(0,l.jsx)(u.Z,{className:"h-4 w-4"}),"清除数据"]})]})}),(0,l.jsx)("div",{className:(0,f.cn)("relative rounded-2xl border-2 border-dashed p-16 transition-all duration-300",s?"border-blue-500 bg-blue-50/50 scale-[1.02]":"border-slate-300 bg-white/80 backdrop-blur-sm hover:border-blue-400 hover:bg-white/90"),onDragEnter:L,onDragOver:e=>e.preventDefault(),onDragLeave:A,onDrop:q,children:(0,l.jsxs)("div",{className:"flex flex-col items-center text-center",children:[(0,l.jsx)("div",{className:"mb-6",children:(0,l.jsx)("div",{className:(0,f.cn)("rounded-full p-6 transition-all duration-300",s?"bg-blue-100 scale-110":"bg-slate-100"),children:(0,l.jsx)(d.Z,{className:(0,f.cn)("w-16 h-16",s?"text-blue-600":"text-slate-400")})})}),(0,l.jsx)("h2",{className:"text-2xl font-semibold text-slate-800 mb-2",children:s?"松开以上传文件":"上传数据文件"}),(0,l.jsxs)("p",{className:"text-slate-600 mb-8 max-w-md",children:["拖拽文件到此处，或点击下方按钮选择文件",(0,l.jsx)("br",{}),(0,l.jsx)("span",{className:"text-sm text-slate-500",children:"支持 CSV 和 DuckDB 格式 | 支持批量上传"})]}),(0,l.jsxs)("label",{className:"cursor-pointer",children:[(0,l.jsx)("input",{type:"file",accept:".csv,.duckdb,.db",multiple:!0,className:"hidden",onChange:I,disabled:R}),(0,l.jsxs)("div",{className:"px-8 py-3 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors shadow-lg shadow-blue-500/30 flex items-center gap-2",children:[(0,l.jsx)(o.Z,{className:"w-5 h-5"}),"选择文件"]})]}),(0,l.jsx)("p",{className:"text-xs text-slate-500 mt-6",children:"最大文件大小：200MB | 支持多文件上传 | 支持 CSV 和 DuckDB 格式 | 支持百万行数据导入"})]})}),w&&(0,l.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,l.jsxs)("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4 shadow-xl",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,l.jsx)(m.Z,{className:"h-6 w-6 text-red-500"}),(0,l.jsx)("h3",{className:"text-lg font-semibold text-slate-900",children:"确认清除数据"})]}),(0,l.jsx)("p",{className:"text-slate-600 mb-6",children:"此操作将清除所有已上传的数据和历史记录，且无法恢复。确定要继续吗？"}),(0,l.jsxs)("div",{className:"flex gap-3 justify-end",children:[(0,l.jsx)("button",{onClick:()=>_(!1),className:"px-4 py-2 bg-slate-200 hover:bg-slate-300 text-slate-700 rounded-md transition-colors",children:"取消"}),(0,l.jsx)("button",{onClick:G,className:"px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-md transition-colors",children:"确认清除"})]})]})})]})}var I=s(11864),V=s(13256),B=s(50043),K=s(97944);function G(e){let{title:t,value:s,unit:a="",description:r,valueColor:n,bgColor:i,compareValue:o,compareUnit:c="%",formatter:d,large:u=!1,icon:m,onClick:x}=e,h=d?d(s):null==s||isNaN(s)?"-":s.toLocaleString("zh-CN",{minimumFractionDigits:0,maximumFractionDigits:2}),g=null!=o&&!isNaN(o),p=g&&o>0?"up":g&&o<0?"down":"flat",b=g?"".concat(o>0?"+":"").concat(o.toFixed(2)).concat(c):null;return(0,l.jsxs)("div",{className:(0,f.cn)("group relative overflow-hidden rounded-xl border border-slate-200 bg-white/80 backdrop-blur-sm transition-all duration-300","hover:border-blue-300 hover:bg-white/90 hover:shadow-lg hover:shadow-blue-100/50",x&&"cursor-pointer",u?"col-span-2":"col-span-1",i),onClick:x,children:[(0,l.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-blue-50/50 via-transparent to-purple-50/30 opacity-0 transition-opacity duration-300 group-hover:opacity-100"}),(0,l.jsxs)("div",{className:"relative p-6",children:[(0,l.jsxs)("div",{className:"mb-4 flex items-start justify-between",children:[(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsx)("h3",{className:"text-sm font-medium text-slate-600",children:t}),r&&(0,l.jsx)("p",{className:"mt-1 text-xs text-slate-500",children:r})]}),m&&(0,l.jsx)("div",{className:"ml-3 flex h-10 w-10 items-center justify-center rounded-lg bg-blue-50 text-blue-600 transition-colors group-hover:bg-blue-100",children:m})]}),(0,l.jsxs)("div",{className:"mb-2 flex items-baseline gap-2",children:[(0,l.jsx)("span",{className:(0,f.cn)("text-3xl font-bold tabular-nums",n||"text-slate-800"),children:h}),a&&(0,l.jsx)("span",{className:"text-base font-medium text-slate-500",children:a})]}),b&&(0,l.jsxs)("div",{className:"flex items-center gap-1.5",children:["up"===p&&(0,l.jsx)(V.Z,{className:"h-4 w-4 text-green-600"}),"down"===p&&(0,l.jsx)(B.Z,{className:"h-4 w-4 text-red-600"}),"flat"===p&&(0,l.jsx)(K.Z,{className:"h-4 w-4 text-slate-500"}),(0,l.jsx)("span",{className:(0,f.cn)("text-sm font-semibold","up"===p?"text-green-600":"down"===p?"text-red-600":"text-slate-500"),children:b}),(0,l.jsx)("span",{className:"text-xs text-slate-500",children:"vs 上期"})]})]}),n&&(0,l.jsx)("div",{className:(0,f.cn)("absolute bottom-0 left-0 right-0 h-1 transition-all duration-300",n.replace("text-","bg-"),"opacity-0 group-hover:opacity-100")})]})}function U(e){let{enableDrillDown:t=!0,kpiKey:s,onClick:a,calculateValue:r,...n}=e;return(0,l.jsx)("div",{className:"relative group",children:(0,l.jsx)("div",{className:"transition-all duration-200 rounded-xl",children:(0,l.jsx)(G,{...n,onClick:a})})})}var X=s(24106);let H={premium_written:!0,matured_premium:!0,policy_count:!0,avg_premium_per_policy:!0,premium_achievement_rate:!0,premium_time_progress_achievement_rate:!0,contribution_margin_rate:!0,contribution_margin_amount:!0,avg_contribution_per_policy:!0,loss_ratio:!1,incurred_loss:!1,reported_claim_payment:!1,claim_case_count:!1,avg_claim_per_case:!1,average_claim:!1,incurred_loss_rate:!1,expense_ratio:!1,variable_cost_ratio:!1,expense_amount:!1,avg_expense_per_policy:!1,maturity_rate:!0,new_energy_ratio:!0,commercial_autonomy_coefficient:!0};function J(e){let{kpiData:t,compareData:s,isLoading:a=!1}=e,r=[{key:"contribution_margin_ratio",title:"满期边际贡献率",unit:"",formatter:I.T3,getColor:e=>(0,I.XH)(e)},{key:"premium_time_progress_achievement_rate",title:"保费时间进度达成率",unit:"",formatter:I.T3,getColor:e=>null!==e&&e>=100?"text-green-600":null!==e&&e>=80?"text-blue-600":"text-orange-600"},{key:"loss_ratio",title:"满期赔付率",unit:"",formatter:I.T3,getColor:e=>null!==e&&e>70?"text-red-600":null!==e&&e>60?"text-orange-600":"text-green-600"},{key:"expense_ratio",title:"费用率",unit:"",formatter:I.T3,getColor:e=>null!==e&&e>25?"text-red-600":null!==e&&e>20?"text-orange-600":"text-green-600"}],n=[{key:"contribution_margin_amount",title:"满期边际贡献额",unit:"",formatter:e=>null==e||isNaN(e)?"-":(0,I.xG)(e),getColor:e=>null!==e&&e>=0?"text-green-600":"text-red-600"},{key:"signed_premium",title:"签单保费",unit:"",formatter:e=>null==e||isNaN(e)?"-":(0,I.xG)(e),getColor:()=>"text-slate-700"},{key:"reported_claim_payment",title:"已报告赔款",unit:"",formatter:e=>null==e||isNaN(e)?"-":(0,I.xG)(e),getColor:()=>"text-slate-700"},{key:"expense_amount",title:"费用额",unit:"",formatter:e=>null==e||isNaN(e)?"-":(0,I.xG)(e),getColor:()=>"text-slate-700"}],i=[{key:"variable_cost_ratio",title:"变动成本率",unit:"",formatter:I.T3,getColor:e=>null!==e&&e>90?"text-red-600":null!==e&&e>85?"text-orange-600":"text-green-600"},{key:"maturity_ratio",title:"满期率",unit:"",formatter:I.T3,getColor:e=>null!==e&&e>=80?"text-green-600":null!==e&&e>=60?"text-blue-600":"text-orange-600"},{key:"matured_claim_ratio",title:"满期出险率",unit:"",formatter:I.T3,getColor:e=>null!==e&&e>60?"text-red-600":null!==e&&e>50?"text-orange-600":"text-green-600"},{key:"policy_count",title:"保单件数",unit:"件",formatter:e=>null==e||isNaN(e)?"-":e.toLocaleString("zh-CN"),getColor:()=>"text-slate-700"}],o=e=>{let a=null==t?void 0:t[e.key],r=function(e,t,s){var l,a,r;let n=null!==(l=null==t?void 0:t[e])&&void 0!==l?l:null,i=null!==(a=null==s?void 0:s[e])&&void 0!==a?a:null;if(null===n||null===i)return{current:n,previous:i,absoluteChange:null,percentChange:null,isBetter:!1,isWorsened:!1,direction:"flat"};let o=n-i,c="flat";o>0?c="up":o<0&&(c="down");let d=null===(r=H[e])||void 0===r||r,u=!1;"up"===c&&d&&(u=!0),"down"!==c||d||(u=!0);let m=!1;return"up"!==c||d||(m=!0),"down"===c&&d&&(m=!0),{current:n,previous:i,absoluteChange:o,percentChange:0!==i?o/Math.abs(i)*100:null,isBetter:u,isWorsened:m,direction:c}}(e.key,t,s),n=["loss_ratio","expense_ratio","maturity_ratio","contribution_margin_ratio","variable_cost_ratio","matured_claim_ratio","premium_time_progress_achievement_rate","autonomy_coefficient"].includes(e.key),i=null,o="%";return null!==r.absoluteChange&&(n?(i=r.absoluteChange,o="pp"):(i=r.percentChange,o="%")),(0,l.jsx)(U,{title:e.title,value:a,compareValue:i,compareUnit:o,unit:e.unit,valueColor:e.getColor(a),formatter:e.formatter,kpiKey:e.key,enableDrillDown:!0,calculateValue:t=>{let s=t.map(e=>X.Rm.fromRawData(e));return(0,X.Qt)(s)[e.key]}},e.key)};return a?(0,l.jsx)("div",{className:"space-y-4",children:Array.from({length:4}).map((e,t)=>(0,l.jsx)("div",{className:"grid grid-cols-4 gap-4",children:Array.from({length:4}).map((e,t)=>(0,l.jsxs)("div",{className:"animate-pulse rounded-xl border border-slate-200 bg-white p-5",children:[(0,l.jsx)("div",{className:"mb-3 h-3 w-28 rounded bg-slate-200"}),(0,l.jsx)("div",{className:"mb-2 h-8 w-24 rounded bg-slate-200"}),(0,l.jsx)("div",{className:"h-4 w-20 rounded bg-slate-200"})]},t))},t))}):t?(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsx)("div",{className:"grid grid-cols-4 gap-4",children:r.map(e=>o(e))}),(0,l.jsx)("div",{className:"grid grid-cols-4 gap-4",children:n.map(e=>o(e))}),(0,l.jsx)("div",{className:"grid grid-cols-4 gap-4",children:i.map(e=>o(e))}),(0,l.jsx)("div",{className:"grid grid-cols-4 gap-4",children:[{key:"claim_case_count",title:"赔案件数",unit:"件",formatter:e=>null==e||isNaN(e)?"-":e.toLocaleString("zh-CN"),getColor:()=>"text-slate-700"},{key:"average_premium",title:"单均保费",unit:"元",formatter:e=>null==e||isNaN(e)?"-":Math.round(e).toLocaleString("zh-CN"),getColor:()=>"text-slate-700"},{key:"average_claim",title:"案均赔款",unit:"元",formatter:e=>null==e||isNaN(e)?"-":Math.round(e).toLocaleString("zh-CN"),getColor:()=>"text-slate-700"},{key:"average_expense",title:"单均费用",unit:"元",formatter:e=>null==e||isNaN(e)?"-":Math.round(e).toLocaleString("zh-CN"),getColor:()=>"text-slate-700"}].map(e=>o(e))})]}):(0,l.jsx)("div",{className:"flex min-h-[400px] items-center justify-center rounded-2xl border-2 border-dashed border-slate-300 bg-slate-50",children:(0,l.jsx)("div",{className:"text-center",children:(0,l.jsx)("p",{className:"text-sm text-slate-600",children:"暂无数据"})})})}var Q=s(95838);function $(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return null===e||Number.isNaN(e)?null:"".concat(e>=0?"+":"").concat(e.toFixed(t),"pp")}function ee(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return null===e||Number.isNaN(e)?null:"".concat(e>=0?"增加":"减少"," ").concat((0,I.uf)(Math.abs(e),t)," 万元")}function et(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,s=Array.from(new Set(e.filter(Boolean)));if(0===s.length)return"—";let l=s.slice(0,t),a=s.length>t?"等":"";return"".concat(l.join("、")).concat(a)}function es(e,t){if(null==e)return t;let s=String(e).trim();return s.length>0?s:t}function el(e){return e.reduce((e,t)=>(e.signedPremiumYuan+=t.signed_premium_yuan,e.maturedPremiumYuan+=t.matured_premium_yuan,e.claimPaymentYuan+=t.reported_claim_payment_yuan,e.claimCaseCount+=t.claim_case_count,e),{signedPremiumYuan:0,maturedPremiumYuan:0,claimPaymentYuan:0,claimCaseCount:0})}function ea(e){return e.maturedPremiumYuan<=0?null:e.claimPaymentYuan/e.maturedPremiumYuan*100}function er(e){let t=null,s=Number.NEGATIVE_INFINITY;return e.forEach((e,l)=>{e>s&&(s=e,t=l)}),t}var en=s(60373);function ei(e,t,s){return{...e,years:[t],weeks:[s],trendModeWeeks:s>0?[s]:[],singleModeWeek:s>0?s:null}}function eo(e,t,s){let l=new Map,a=(e,t)=>(l.has(e)||l.set(e,{label:t,currentMatured:0,currentClaim:0,previousMatured:0,previousClaim:0,coverageClaims:new Map,partnerClaims:new Map}),l.get(e)),r=t=>{if("business"===e){let e=es(t.business_type_category,"未标记业务"),s=(0,en.gX)(e);return{key:s,label:(0,en.gW)(s)}}let s=es(t.third_level_organization,"未标记机构");return{key:s,label:s}},n=t=>{if("business"===e)return es(t.third_level_organization,"未标记机构");let s=es(t.business_type_category,"未标记业务"),l=(0,en.gX)(s);return(0,en.gW)(l)};t.forEach(e=>{var t,s;let{key:l,label:i}=r(e),o=a(l,i);o.currentMatured+=e.matured_premium_yuan,o.currentClaim+=e.reported_claim_payment_yuan;let c=es(e.coverage_type,"未标记险别");o.coverageClaims.set(c,(null!==(t=o.coverageClaims.get(c))&&void 0!==t?t:0)+e.reported_claim_payment_yuan);let d=n(e);o.partnerClaims.set(d,(null!==(s=o.partnerClaims.get(d))&&void 0!==s?s:0)+e.reported_claim_payment_yuan)}),s.forEach(e=>{let{key:t,label:s}=r(e),l=a(t,s);l.previousMatured+=e.matured_premium_yuan,l.previousClaim+=e.reported_claim_payment_yuan});let i=[];l.forEach((e,t)=>{let s=e.currentMatured,l=e.currentClaim,a=e.previousMatured,r=e.previousClaim;if(s<=0&&l<=0&&a<=0&&r<=0)return;let n=null;s>0&&l>=0&&(n=l/s*100);let o=null;a>0&&r>=0&&(o=r/a*100);let c=null!==n&&null!==o?n-o:null,d=er(e.coverageClaims),u=er(e.partnerClaims);i.push({key:t,label:e.label,lossRatio:n,lossRatioChange:c,claimPaymentWan:l/1e4,claimPaymentChangeWan:l-r!=0?(l-r)/1e4:null,topCoverage:d,topPartner:u})});let o=e=>null==e?Number.NEGATIVE_INFINITY:e;return i.sort((e,t)=>{let s=o(t.lossRatioChange)-o(e.lossRatioChange);if(0!==s&&Number.isFinite(s))return s;let l=o(t.lossRatio)-o(e.lossRatio);return 0!==l&&Number.isFinite(l)?l:t.claimPaymentWan-e.claimPaymentWan}),i}let ec=e=>t=>{if(!Array.isArray(t)||0===t.length)return"";let s=e[t[0].dataIndex];if(!s)return"";let l=null!==s.lossRatio?s.lossRatio-70:null,a='<div style="min-width: 260px;">\n    <div style="font-weight: 600; margin-bottom: 8px; font-size: 13px;">'.concat(s.week,'</div>\n    <div style="margin-bottom: 4px;">\n      <span style="color: #64748b;">签单保费：</span>\n      <span style="font-weight: 600;">').concat((0,I.uf)(s.signedPremium,1),' 万元</span>\n    </div>\n    <div style="margin-bottom: 4px;">\n      <span style="color: #64748b;">赔付率（累计）：</span>\n      <span style="font-weight: 600; color: ').concat(s.isRisk?"#ef4444":"#334155",';">\n        ').concat(null!==s.lossRatio?(0,I.T3)(s.lossRatio,2):"—",'\n      </span>\n    </div>\n    <div style="margin-bottom: 8px; font-size: 10px; color: #94a3b8;">\n      \uD83D\uDCA1 赔付率 = 年初至今累计赔款 / 累计保费\n    </div>');return null!==l&&(a+='<div style="margin-bottom: 8px;">\n      <span style="color: #64748b;">与阈值差值：</span>\n      <span style="font-weight: 600; color: '.concat(l>=0?"#ef4444":"#10b981",';">\n      ').concat(l>=0?"+":"").concat(l.toFixed(1),"pp\n      </span>\n    </div>")),a+="</div>"},ed=(e,t,s,l,a,r)=>[{name:"签单保费",type:"line",yAxisIndex:0,data:t,smooth:!0,symbol:"circle",symbolSize:6,lineStyle:{color:"#3b82f6",width:3},itemStyle:{color:"#3b82f6"},areaStyle:{color:new Q.graphic.LinearGradient(0,0,0,1,[{offset:0,color:"rgba(59, 130, 246, 0.3)"},{offset:1,color:"rgba(59, 130, 246, 0.05)"}])},emphasis:{focus:"series"},sampling:"lttb"},{name:"赔付率",type:"scatter",yAxisIndex:1,data:s,symbolSize:8,itemStyle:{color:"#94a3b8"},emphasis:{scale:1.5}},{name:"赔付率（风险）",type:"scatter",yAxisIndex:1,data:l,symbolSize:12,itemStyle:{color:"#f97316",borderColor:"#fff",borderWidth:2,shadowBlur:6,shadowColor:"rgba(249, 115, 22, 0.5)"},emphasis:{scale:1.8,itemStyle:{shadowBlur:10}},zlevel:10},{name:"赔付率",type:"line",yAxisIndex:1,data:a,showSymbol:!1,lineStyle:{color:"#f97316",width:2,type:"solid"},emphasis:{focus:"series"},markArea:{silent:!0,itemStyle:{color:"rgba(254, 226, 226, 0.3)"},data:[[{yAxis:70},{yAxis:"max"}]]}},{name:"阈值线 70%",type:"line",yAxisIndex:1,data:Array(e.length).fill(70),lineStyle:{color:"#ef4444",width:2,type:"dashed"},symbol:"none",emphasis:{disabled:!0}},{name:"趋势线",type:"line",yAxisIndex:1,data:r,lineStyle:{color:"#8b5cf6",width:2,type:"dashed"},symbol:"none",emphasis:{disabled:!0}}],eu=e=>{let{displayData:t,trendLineData:s}=e,l=t.map((e,s)=>{let l=e.weekNumber%4==1||1===e.weekNumber,a=s===t.length-1;return l||a?"第".concat(e.weekNumber,"周"):""}),a=t.map(e=>e.signedPremium),r=t.map(e=>e.lossRatio),n=t.map((e,t)=>e.isRisk||null===e.lossRatio?null:[t,e.lossRatio]).filter(e=>null!==e),i=t.map((e,t)=>e.isRisk&&null!==e.lossRatio?[t,e.lossRatio]:null).filter(e=>null!==e);return{backgroundColor:"transparent",grid:{left:"3%",right:"4%",bottom:"15%",top:"15%",containLabel:!0},tooltip:{trigger:"axis",axisPointer:{type:"cross",crossStyle:{color:"#999"}},backgroundColor:"rgba(255, 255, 255, 0.98)",borderColor:"#e2e8f0",borderWidth:1,textStyle:{color:"#334155",fontSize:12},padding:12,formatter:ec(t)},legend:{data:["签单保费","赔付率","阈值线 70%","趋势线"],top:"2%",textStyle:{fontSize:12}},xAxis:[{type:"category",data:l,axisPointer:{type:"shadow"},axisLabel:{fontSize:11,rotate:45,color:"#64748b"},axisLine:{lineStyle:{color:"#cbd5e1"}}}],yAxis:[{type:"value",name:"签单保费（万元）",position:"left",nameTextStyle:{color:"#64748b",fontSize:12},axisLabel:{formatter:e=>(0,I.uf)(e,0),fontSize:11,color:"#64748b"},axisLine:{show:!0,lineStyle:{color:"#cbd5e1"}},splitLine:{lineStyle:{color:"#f1f5f9"}}},{type:"value",name:"赔付率（%）",position:"right",nameTextStyle:{color:"#64748b",fontSize:12},axisLabel:{formatter:e=>"".concat(e.toFixed(0),"%"),fontSize:11,color:"#64748b"},axisLine:{show:!0,lineStyle:{color:"#cbd5e1"}},splitLine:{show:!1},min:e=>10*Math.floor(e.min/10),max:e=>10*Math.ceil(e.max/10)}],dataZoom:[{type:"slider",show:!0,xAxisIndex:0,start:t.length>26?(t.length-26)/t.length*100:0,end:100,height:20,bottom:"5%",handleSize:"80%",textStyle:{fontSize:10}},{type:"inside",xAxisIndex:0,start:t.length>26?(t.length-26)/t.length*100:0,end:100}],series:ed(l,a,n,i,r,s)}},em=a.memo(function(e){let{displayData:t,trendLineData:s,onPointClick:r}=e,n=(0,a.useRef)(null),i=(0,a.useRef)(null);return(0,a.useEffect)(()=>{if(!n.current||0===t.length)return;i.current||(i.current=Q.init(n.current,void 0,{renderer:"canvas"}));let e=i.current,l=eu({displayData:t,trendLineData:s,onPointClick:r});e.setOption(l,!0),e.off("click"),e.on("click",e=>{if("series"===e.componentType&&"scatter"===e.seriesType){let s=t[e.dataIndex];s&&r(s)}});let a=new ResizeObserver(()=>{e.resize()});return n.current&&a.observe(n.current),()=>{a.disconnect()}},[t,s,r]),(0,a.useEffect)(()=>()=>{i.current&&(i.current.dispose(),i.current=null)},[]),(0,l.jsx)("div",{ref:n,className:"h-[400px] w-full",style:{minHeight:"400px"}})});var ex=s(74170);let eh=a.memo(function(e){let{narrative:t}=e;return t?(0,l.jsxs)("div",{className:"space-y-4 rounded-xl border border-indigo-100 bg-indigo-50/50 p-4 text-sm",children:[(0,l.jsxs)("h4",{className:"flex items-center gap-2 font-bold text-indigo-900",children:[(0,l.jsx)(ex.Z,{className:"h-4 w-4"}),"深度经营复盘"]}),(0,l.jsxs)("div",{className:"space-y-3 text-slate-700",children:[(0,l.jsxs)("div",{className:"rounded-lg bg-white p-3 shadow-sm",children:[(0,l.jsx)("div",{className:"mb-2 font-medium text-indigo-700",children:"\uD83D\uDCCC 核心结论"}),(0,l.jsx)("p",{className:"leading-relaxed",children:t.overview}),(0,l.jsx)("p",{className:"mt-2 leading-relaxed",children:t.lossTrend})]}),t.insight&&(0,l.jsxs)("div",{className:"rounded-lg bg-red-50 p-3 shadow-sm",children:[(0,l.jsxs)("div",{className:"mb-2 flex items-center gap-2 font-medium text-red-700",children:[(0,l.jsx)(m.Z,{className:"h-4 w-4"}),"风险归因"]}),(0,l.jsx)("p",{className:"leading-relaxed text-red-800",children:t.insight})]}),(0,l.jsxs)("div",{className:"grid gap-3 md:grid-cols-2",children:[(0,l.jsxs)("div",{className:"rounded-lg bg-white p-3 shadow-sm",children:[(0,l.jsx)("div",{className:"mb-2 font-medium text-slate-800",children:"\uD83C\uDFE2 机构维度异常"}),t.organizationLines.length>0?(0,l.jsx)("ul",{className:"list-disc space-y-1 pl-4 text-xs text-slate-600",children:t.organizationLines.map((e,t)=>(0,l.jsx)("li",{children:e},t))}):(0,l.jsx)("p",{className:"text-xs text-slate-400",children:"无明显异常"})]}),(0,l.jsxs)("div",{className:"rounded-lg bg-white p-3 shadow-sm",children:[(0,l.jsx)("div",{className:"mb-2 font-medium text-slate-800",children:"\uD83D\uDE99 业务维度异常"}),t.businessLines.length>0?(0,l.jsx)("ul",{className:"list-disc space-y-1 pl-4 text-xs text-slate-600",children:t.businessLines.map((e,t)=>(0,l.jsx)("li",{children:e},t))}):(0,l.jsx)("p",{className:"text-xs text-slate-400",children:"无明显异常"})]})]}),(0,l.jsxs)("div",{className:"rounded-lg border border-indigo-200 bg-white p-3 shadow-sm",children:[(0,l.jsx)("div",{className:"mb-2 font-medium text-indigo-700",children:"\uD83D\uDE80 行动建议"}),(0,l.jsx)("ul",{className:"list-decimal space-y-1 pl-4 text-xs text-slate-600",children:t.actionLines.map((e,t)=>(0,l.jsx)("li",{children:e},t))}),(0,l.jsx)("div",{className:"mt-3 border-t border-slate-100 pt-2 text-xs font-medium text-slate-500",children:t.followUp})]})]})]}):null});var eg=s(8798),ep=s(5379);let eb=(0,eg.U)()((0,ep.mW)((0,ep.tJ)((e,t)=>({steps:[],pendingSteps:null,addDrillDownStep:t=>{e(e=>{var s;let l=null!==(s=e.pendingSteps)&&void 0!==s?s:e.steps;if(l.some(e=>e.dimensionKey===t.dimensionKey)){let e=l.findIndex(e=>e.dimensionKey===t.dimensionKey);if(-1!==e)return{pendingSteps:[...l.slice(0,e),t]}}return{pendingSteps:[...l,t]}})},removeDrillDownStepsFrom:function(t){let s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e(e=>{if(s){var l;let s=null!==(l=e.pendingSteps)&&void 0!==l?l:e.steps;return 0===t?{pendingSteps:[]}:{pendingSteps:s.slice(0,t)}}{let s=e.steps,l=s.slice(0,t);return l.length===s.length?{}:{pendingSteps:l}}})},clearDrillDown:()=>{e({pendingSteps:[]})},applyDrillDown:()=>{e(e=>null===e.pendingSteps?{}:{steps:e.pendingSteps,pendingSteps:null})},cancelDrillDown:()=>{e({pendingSteps:null})},isDimensionUsed:e=>{var s;let l=t();return(null!==(s=l.pendingSteps)&&void 0!==s?s:l.steps).some(t=>t.dimensionKey===e)},resetAll:()=>{e({steps:[],pendingSteps:null})}}),{name:"drill-down-storage"})));function ef(e){let{rawData:t,initialData:s,filters:l,drillDownSteps:a}=e;return(s||t).filter(e=>{if(!s){if(l.years.length>0&&!l.years.includes(e.policy_start_year)||"single"===l.viewMode&&null!==l.singleModeWeek&&e.week_number!==l.singleModeWeek||l.organizations.length>0&&!l.organizations.includes(e.third_level_organization)||l.insuranceTypes.length>0&&!l.insuranceTypes.includes(e.insurance_type))return!1;if(l.businessTypes.length>0){let t=(0,en.gX)(e.business_type_category);if(!l.businessTypes.includes(t))return!1}if(l.coverageTypes.length>0&&!l.coverageTypes.includes(e.coverage_type)||l.customerCategories.length>0&&!l.customerCategories.includes(e.customer_category_3)||l.vehicleGrades.length>0&&e.vehicle_insurance_grade&&!l.vehicleGrades.includes(e.vehicle_insurance_grade)||l.terminalSources.length>0&&!l.terminalSources.includes(e.terminal_source)||null!==l.isNewEnergy&&e.is_new_energy_vehicle!==l.isNewEnergy||l.renewalStatuses.length>0&&!l.renewalStatuses.includes(e.renewal_status))return!1}for(let t of a)if(function(e,t){switch(t){case"third_level_organization":return e.third_level_organization;case"business_type_category":return e.business_type_category;case"coverage_type":return e.coverage_type;case"terminal_source":return e.terminal_source;case"is_new_energy_vehicle":return e.is_new_energy_vehicle;case"renewal_status":return e.renewal_status;case"is_transferred_vehicle":return e.is_transferred_vehicle;case"insurance_type":return e.insurance_type;case"week_number":return String(e.week_number);default:return""}}(e,t.dimensionKey)!==t.value)return!1;return!0})}function ev(e,t){return e.filter(e=>{var s,l,a,r,n,i,o,c,d,u;if((null===(s=t.years)||void 0===s?void 0:s.length)&&!t.years.includes(e.policy_start_year)||(null===(l=t.weeks)||void 0===l?void 0:l.length)&&!t.weeks.includes(e.week_number)||(null===(a=t.organizations)||void 0===a?void 0:a.length)&&!t.organizations.includes(e.third_level_organization)||(null===(r=t.insuranceTypes)||void 0===r?void 0:r.length)&&!t.insuranceTypes.includes(e.insurance_type)||(null===(n=t.coverageTypes)||void 0===n?void 0:n.length)&&!t.coverageTypes.includes(e.coverage_type)||(null===(i=t.customerCategories)||void 0===i?void 0:i.length)&&!t.customerCategories.includes(e.customer_category_3))return!1;if(null===(o=t.businessTypes)||void 0===o?void 0:o.length){let s=(0,en.gX)(e.business_type_category);if(!t.businessTypes.includes(s))return!1}return(null===(c=t.renewalStatuses)||void 0===c||!c.length||!!t.renewalStatuses.includes(e.renewal_status))&&(null===t.isNewEnergy||void 0===t.isNewEnergy||t.isNewEnergy===e.is_new_energy_vehicle)&&(null===(d=t.vehicleGrades)||void 0===d||!d.length||!!e.vehicle_insurance_grade&&!!t.vehicleGrades.includes(e.vehicle_insurance_grade))&&(null===(u=t.terminalSources)||void 0===u||!u.length||!!t.terminalSources.includes(e.terminal_source))})}function ey(){let e=(0,h.qr)(e=>e.rawData),t=(0,h.qr)(e=>e.filters),s=eb(e=>e.steps);return(0,a.useMemo)(()=>{let l=ev(e,t);return s.length>0?ef({rawData:[],initialData:l,filters:t,drillDownSteps:s}):l},[e,t,s])}var ej=s(97830);let eN=e=>{let{displayData:t,rawRecords:s,filters:l,dataViewType:r,totalRiskWeeks:n}=e;return(0,a.useMemo)(()=>{var e;if(!t||0===t.length||!s||0===s.length)return null;let a=t[t.length-1];if(!a)return null;let i=function(e){var t,s,l,a,r,n,i,o,c;let d=[];return((null===(t=e.years)||void 0===t?void 0:t.length)&&d.push("年度=".concat(e.years.map(String).join("、"))),(null===(s=e.organizations)||void 0===s?void 0:s.length)&&d.push("机构=".concat(e.organizations.join("、"))),(null===(l=e.businessTypes)||void 0===l?void 0:l.length)&&d.push("业务类型=".concat(e.businessTypes.map(e=>(0,en.gW)(e)).join("、"))),(null===(a=e.coverageTypes)||void 0===a?void 0:a.length)&&d.push("险别=".concat(e.coverageTypes.join("、"))),(null===(r=e.insuranceTypes)||void 0===r?void 0:r.length)&&d.push("保险类别=".concat(e.insuranceTypes.join("、"))),(null===(n=e.customerCategories)||void 0===n?void 0:n.length)&&d.push("客户分类=".concat(e.customerCategories.join("、"))),(null===(i=e.vehicleGrades)||void 0===i?void 0:i.length)&&d.push("车险评级=".concat(e.vehicleGrades.join("、"))),(null===(o=e.renewalStatuses)||void 0===o?void 0:o.length)&&d.push("新续转=".concat(e.renewalStatuses.join("、"))),null!==e.isNewEnergy&&void 0!==e.isNewEnergy&&d.push("新能源=".concat(e.isNewEnergy?"是":"否")),(null===(c=e.terminalSources)||void 0===c?void 0:c.length)&&d.push("渠道=".concat(e.terminalSources.join("、"))),0===d.length)?"筛选条件：全部业务":"筛选条件：".concat(d.join(" | "))}(l),o="".concat(a.year,"年第").concat(a.weekNumber,"周"),c=a.signedPremium,d="".concat((0,I.uf)(c,0)," 万元"),u=t.length>1?t[t.length-2]:null,m=null!==u?c-u.signedPremium:null,x=null!==m?"，环比".concat(m>=0?"增加":"下降"," ").concat((0,I.uf)(Math.abs(m),0)," 万元"):"",h=t.slice(-Math.min(4,t.length)).map(e=>e.signedPremium),g=(h.length>0?Math.max(...h):c)-c,p=g>0?"，较近四周峰值累计回落 ".concat((0,I.uf)(g,0)," 万元"):"",b=0;for(let e=t.length-1;e>0;e-=1)if(t[e].signedPremium<t[e-1].signedPremium)b+=1;else break;let f=b>=2?"，已连续 ".concat(b," 周走低"):"",v=ev(s,ei(l,a.year,a.weekNumber)),y=null!==(e=null==u?void 0:u.weekNumber)&&void 0!==e?e:a.weekNumber-1,j=y&&y>=1?ev(s,ei(l,a.year,y)):[],N=el(v),w=el(j),_=ea(N),k=ea(w),C=eo("business",v,j),S=eo("organization",v,j),M=k;if(null===M){for(let e=t.length-2;e>=0;e-=1)if(null!==t[e].lossRatio){M=t[e].lossRatio;break}}let P=null!==_?_:a.lossRatio,D=null!==P&&null!==M?$(P-M,1):null,R=null!==P?(0,I.T3)(P,1):"—",z=0;for(let e=t.length-1;e>=0;e-=1)if(t[e].isRisk)z+=1;else break;let T=w.claimPaymentYuan>0||N.claimPaymentYuan>0?(N.claimPaymentYuan-w.claimPaymentYuan)/1e4:null,W="【经营概览】".concat(i,"；").concat(o," ").concat("increment"===r?"签单保费周增量":"年度累计签单保费"," ").concat(d).concat(x).concat(p).concat(f,"。"),E=z>0?"赔付率已连续 ".concat(z," 周触发预警"):n>0?"本期共出现 ".concat(n," 个预警周"):"赔付率保持在安全区间",F="赔付率保持在安全区间"===E?"【赔付趋势】".concat(E,"，最新值 ").concat(R).concat(D?"，环比".concat(D):"","。"):"【赔付趋势】".concat(E,"，最新值 ").concat(R).concat(D?"，环比".concat(D):"").concat(null!==T?"，赔款".concat(ee(T,1)):"","。"),L=C.slice(0,3).map(e=>{var t;let s=null!==e.lossRatio?(0,I.T3)(e.lossRatio,1):"—",l=e.lossRatioChange?$(e.lossRatioChange,1):null,a=null!==e.claimPaymentChangeWan?ee(e.claimPaymentChangeWan,1):"赔款 ".concat((0,I.uf)(e.claimPaymentWan,1)," 万元"),r=null!==(t=e.topCoverage)&&void 0!==t?t:"重点险别",n=e.topPartner&&"未标记机构"!==e.topPartner?"，重点机构 ".concat(e.topPartner):"";return"".concat(e.label,"：赔付率 ").concat(s).concat(l?"，环比".concat(l):"","，").concat(a,"，风险集中于 ").concat(r).concat(n)}),A=S.slice(0,3).map(e=>{var t;let s=null!==e.lossRatio?(0,I.T3)(e.lossRatio,1):"—",l=e.lossRatioChange?$(e.lossRatioChange,1):null,a=null!==e.claimPaymentChangeWan?ee(e.claimPaymentChangeWan,1):"赔款 ".concat((0,I.uf)(e.claimPaymentWan,1)," 万元"),r=null!==(t=e.topCoverage)&&void 0!==t?t:"重点险别",n=e.topPartner&&"未标记业务"!==e.topPartner?"，涉及业务 ".concat(e.topPartner):"";return"".concat(e.label,"：赔付率 ").concat(s).concat(l?"，环比".concat(l):"","，").concat(a,"，涉险险别 ").concat(r).concat(n)}),Z=et([...C.map(e=>{var t;return null!==(t=e.topCoverage)&&void 0!==t?t:""}).filter(Boolean),...S.map(e=>{var t;return null!==(t=e.topCoverage)&&void 0!==t?t:""}).filter(Boolean)]),Y=et(C.map(e=>e.label)),O=et(S.map(e=>e.label)),q=C.length>0||S.length>0,V=q?"【风险洞察】异常组合集中在 ".concat(Z,"，叠加 ").concat(Y," 等业务类型，并显著指向 ").concat(O," 等机构，需重点复核赔付控制。"):null,B=function(e,t,s,l,a,r){let n=[];if(r){var i,o,c,d,u,m;"—"!==a?n.push("渠道：聚焦 ".concat("—"===a?"重点机构":a," 等机构，核查代理与直销渠道质量并梳理承保准入。")):n.push("渠道：保持重点机构渠道巡查频次，确保异常及时上报。"),n.push("产品：针对 ".concat("—"===s?"重点险别":s," 与 ").concat("—"===l?"重点业务类型":l,"，复盘费率及赔付条款，评估是否需调整承保策略。"));let r=null!==(d=null===(i=e[0])||void 0===i?void 0:i.label)&&void 0!==d?d:"—"!==l?l.replace(/等$/,""):"重点业务",x=null!==(u=null===(o=e[0])||void 0===o?void 0:o.topCoverage)&&void 0!==u?u:"—"!==s?s.replace(/等$/,""):"重点险别",h=null!==(m=null===(c=t[0])||void 0===c?void 0:c.label)&&void 0!==m?m:"—"!==a?a.replace(/等$/,""):"重点机构";n.push("作业：构建“".concat(r,"—").concat(x,"—").concat(h,"”风险热力图，纳入周度经营例会跟踪。"))}else n.push("渠道：当前未发现异常波动，维持现有巡检节奏即可。"),n.push("流程：持续关注赔付率趋势，如触及阈值及时启动专项排查。");return n}(C,S,Z,Y,O,q),K="【后续跟踪】请于下周周例会上复盘整改进度，并持续关注第".concat(a.weekNumber+1,"周实时赔付表现。");return{overview:W,lossTrend:F,businessLines:L,organizationLines:A,insight:V,actionLines:B,followUp:"".concat(K)}},[r,t,l,s,n])},ew=()=>{let e=function(e){let t=ey(),s=(0,h.qr)(e=>e.filters),l=s.dataViewType,r=(0,h.qr)(e=>e.premiumTargets),n=(0,a.useMemo)(()=>{if(!r)return null;if(s.businessTypes.length>0){let e=s.businessTypes.reduce((e,t)=>{var s;let l=(0,en.qP)(t),a=(0,ej.Vd)(l);return e+(null!==(s=r.dimensions.businessType.entries[a])&&void 0!==s?s:0)},0);if(e>0)return e}if(s.organizations.length>0){let e=s.organizations.reduce((e,t)=>{var s;let l=(0,ej.Vd)(t);return e+(null!==(s=r.dimensions.thirdLevelOrganization.entries[l])&&void 0!==s?s:0)},0);if(e>0)return e}if(s.customerCategories.length>0){let e=s.customerCategories.reduce((e,t)=>{var s;let l=(0,ej.Vd)(t);return e+(null!==(s=r.dimensions.customerCategory.entries[l])&&void 0!==s?s:0)},0);if(e>0)return e}if(s.insuranceTypes.length>0){let e=s.insuranceTypes.reduce((e,t)=>{var s;let l=(0,ej.Vd)(t);return e+(null!==(s=r.dimensions.insuranceType.entries[l])&&void 0!==s?s:0)},0);if(e>0)return e}return r.overall>0?r.overall:null},[s,r]);return(0,a.useMemo)(()=>{if(0===t.length)return[];let e=function(e){let t=new Map;for(let s of e){let e="".concat(s.policy_start_year,"-").concat(String(s.week_number).padStart(3,"0"));t.has(e)||t.set(e,[]),t.get(e).push(s)}return t}(t),a=Array.from(e.keys()).sort((e,t)=>{let[s,l]=e.split("-").map(Number),[a,r]=t.split("-").map(Number);return s!==a?s-a:l-r}),r=[];return(a.forEach((t,s)=>{let i;let o=e.get(t),[c,d]=t.split("-");if("increment"===l&&s>0){let t=a[s-1],l=e.get(t),r=o.map(e=>X.Rm.fromRawData(e)),c=l.map(e=>X.Rm.fromRawData(e));i=(0,X.u_)(r,c,{annualTargetYuan:null!=n?n:void 0})}else{let e=o.map(e=>X.Rm.fromRawData(e));i=(0,X.Qt)(e,{annualTargetYuan:null!=n?n:void 0})}r.push({key:t,year:Number(c),week:Number(d),label:"".concat(c,"年第").concat(Number(d),"周"),signed_premium_10k:i.signed_premium,matured_premium_10k:i.matured_premium,loss_ratio:i.loss_ratio,contribution_margin_ratio:i.contribution_margin_ratio})}),r.sort((e,t)=>e.year!==t.year?t.year-e.year:e.week-t.week),s.years&&1===s.years.length)?r.filter(e=>e.year===s.years[0]):r},[t,s.years,l,n])}(),[t,s]=(0,a.useState)(null),l=(0,h.qr)(e=>e.filters.dataViewType),r=(0,h.qr)(e=>e.filters),n=(0,h.qr)(e=>e.rawData),i=eb(e=>e.addDrillDownStep),o=(0,a.useMemo)(()=>e&&0!==e.length?e.map(e=>({week:e.label,weekNumber:e.week,year:e.year,signedPremium:e.signed_premium_10k,lossRatio:e.loss_ratio,isRisk:null!==e.loss_ratio&&e.loss_ratio>=70})).sort((e,t)=>e.year!==t.year?e.year-t.year:e.weekNumber-t.weekNumber):[],[e]),c=(0,a.useMemo)(()=>"increment"===l&&o.length>1?o.slice(1):o,[o,l]),d=(0,a.useMemo)(()=>(function(e,t){if(0===e.length)return"";let s=e[e.length-1],l=s.signedPremium,a=0;for(let t=e.length-1;t>=0;t--)if(e[t].isRisk)a++;else break;let r=e.filter(e=>e.isRisk).length;if("increment"===t){var n;let t=e.length>1?e[e.length-2]:null,a=(0,I.uf)(l,0),r=null!=t?l-t.signedPremium:null,i=null!=r?"，较上周".concat(r>=0?"增加":"下降"," ").concat((0,I.uf)(Math.abs(r),0)," 万元"):"",o=Math.max(1,e.length-6),c=[];for(let t=o;t<e.length;t++){let s=e[t-1],l=e[t];l.signedPremium<s.signedPremium&&c.push({week:l.weekNumber,diff:l.signedPremium-s.signedPremium})}let d=c.length>0?"保费周增量在".concat(c.slice(-2).map(e=>"第".concat(e.week,"周较前一周下降 ").concat((0,I.uf)(Math.abs(e.diff),0)," 万元")).join("、"),"，需尽快排查渠道与获客效率"):"保费周增量总体保持平稳",u=e.filter(e=>e.isRisk).map(e=>e.weekNumber),m=u.length>0?"赔付率预警集中在 ".concat(0===(n=u.slice(-4)).length?"":n.map(e=>"第".concat(e,"周")).join("、"),"，赔付压力明显上行"):"赔付率暂未触发预警",x=e.slice(-Math.min(5,e.length)),h=x.length>=2?x[x.length-1].signedPremium-x[0].signedPremium:0,g=0;for(let t=e.length-1;t>0;t--)if(e[t].signedPremium<e[t-1].signedPremium)g+=1;else break;let p="趋势暂未出现明显恶化";if(h<0){let e=g>=2?"已连续 ".concat(g," 周回落"):"近几周动能转弱";p="趋势正在恶化，".concat(e,"，累计回落 ").concat((0,I.uf)(Math.abs(h),0)," 万元")}let b="截至".concat(s.year,"年第").concat(s.weekNumber,"周，本周签单保费周增量 ").concat(a," 万元").concat(i,"。");return(b+="".concat(d,"。")+"".concat(m,"。")+"".concat(p,"。")).trim()}let i="截至".concat(s.year,"年第").concat(s.weekNumber,"周，");return i+="年度累计签单保费 ".concat((0,I.uf)(l,0)," 万元"),a>0?i+="，连续 ".concat(a," 周处于预警区"):r>0?i+="，".concat(r," 周处于预警区"):i+="，经营状况良好",i})(c,l),[c,l]),u=(0,a.useMemo)(()=>{if(0===c.length)return{totalRiskWeeks:0,avgLossRatio:0,maxLossRatio:0};let e=c.map(e=>e.lossRatio).filter(e=>null!==e);return{totalRiskWeeks:c.filter(e=>e.isRisk).length,avgLossRatio:e.length>0?e.reduce((e,t)=>e+t,0)/e.length:0,maxLossRatio:e.length>0?Math.max(...e):0}},[c]),m=eN({displayData:c,rawRecords:n,filters:r,dataViewType:l,totalRiskWeeks:u.totalRiskWeeks}),x=(0,a.useMemo)(()=>(function(e){let t=e.map(e=>e.lossRatio).filter(e=>null!==e);if(t.length<2)return[];let s=t.length,l=t.reduce((e,t,s)=>e+s,0),a=t.reduce((e,t)=>e+t,0),r=(s*t.reduce((e,t,s)=>e+t*s,0)-l*a)/(s*t.reduce((e,t,s)=>e+s*s,0)-l*l),n=(a-r*l)/s;return e.map((e,t)=>r*t+n)})(c),[c]);return{trendData:e,chartData:o,displayData:c,operationalSummary:d,stats:u,filters:r,dataViewType:l,selectedPoint:t,setSelectedPoint:s,addDrillDownStep:i,rawRecords:n,analysisNarrative:m,trendLineData:x,handlePointClick:e=>{console.log("\uD83D\uDD0D 下钻分析：",e),s(e),i({dimensionKey:"week_number",dimensionLabel:"周次",value:String(e.weekNumber),displayLabel:"".concat(e.year,"年第").concat(e.weekNumber,"周")})}}},e_=a.memo(function(){let{displayData:e,operationalSummary:t,stats:s,analysisNarrative:a,trendLineData:r,handlePointClick:n}=ew();return e&&0!==e.length?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"rounded-2xl border border-slate-100 bg-white/60 p-6 shadow-lg backdrop-blur",children:[(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsxs)("h3",{className:"text-xl font-bold text-slate-900",children:["\uD83D\uDCC8 趋势洞察：",s.totalRiskWeeks>0?"赔付率连续".concat(s.totalRiskWeeks,"周预警，经营风险上升"):"经营态势平稳，保费增长".concat(e.length>1?e[e.length-1].signedPremium>e[e.length-2].signedPremium?"向好":"承压":"稳定")]}),e.length>0&&(0,l.jsxs)("span",{className:"text-sm text-slate-500",children:[e[e.length-1].year,"年第",e[e.length-1].weekNumber,"周"]})]}),(0,l.jsxs)("div",{className:"flex items-center gap-4 text-sm",children:[(0,l.jsxs)("div",{className:"flex items-center gap-1.5 rounded-full bg-blue-50 px-3 py-1 text-blue-700",children:[(0,l.jsx)("span",{className:"h-2 w-2 rounded-full bg-blue-500"}),"累计保费趋势"]}),(0,l.jsxs)("div",{className:"flex items-center gap-1.5 rounded-full bg-orange-50 px-3 py-1 text-orange-700",children:[(0,l.jsx)("span",{className:"h-2 w-2 rounded-full bg-orange-500"}),"赔付率风险点"]})]})]}),(0,l.jsx)("p",{className:"mt-1 text-sm text-slate-500",children:t})]}),(0,l.jsx)(em,{displayData:e,trendLineData:r,onPointClick:n})]}),(0,l.jsx)(eh,{narrative:a})]}):(0,l.jsx)("div",{className:"rounded-2xl border border-slate-200 bg-white/60 p-6 backdrop-blur",children:(0,l.jsx)("div",{className:"text-center text-slate-500",children:"暂无周度趋势数据"})})});var ek=s(42751),eC=s(27710);function eS(){let e=ey();return(0,a.useMemo)(()=>{if(!e||0===e.length)return[];let t=new Map;e.forEach(e=>{let s=e.business_type_category;t.has(s)||t.set(s,[]),t.get(s).push(e)});let s=Array.from(t.entries()).map(e=>{let[t,s]=e;return{businessType:t,kpi:(0,X.Qt)(s.map(e=>X.Rm.fromRawData(e))),recordCount:s.length,rank:0}});return s.sort((e,t)=>(t.kpi.contribution_margin_ratio||0)-(e.kpi.contribution_margin_ratio||0)),s.forEach((e,t)=>{e.rank=t+1}),s},[e])}function eM(){let e=ey();return(0,a.useMemo)(()=>{if(!e||0===e.length)return[];let t=new Map;e.forEach(e=>{let s=e.third_level_organization;t.has(s)||t.set(s,[]),t.get(s).push(e)});let s=Array.from(t.entries()).map(e=>{let[t,s]=e;return{organization:t,kpi:(0,X.Qt)(s.map(e=>X.Rm.fromRawData(e))),recordCount:s.length,rank:0}});return s.sort((e,t)=>(t.kpi.contribution_margin_ratio||0)-(e.kpi.contribution_margin_ratio||0)),s.forEach((e,t)=>{e.rank=t+1}),s},[e])}let eP=["#3b82f6","#ef4444","#10b981","#f59e0b","#8b5cf6","#ec4899"];function eD(){let e=eM(),t=(0,a.useRef)(null),s=(0,a.useRef)(null),r=e.slice(0,50).map(e=>({name:e.organization,满期保费:e.kpi.matured_premium,签单保费:e.kpi.signed_premium,边际贡献率:e.kpi.contribution_margin_ratio||0})).sort((e,t)=>e.边际贡献率-t.边际贡献率).slice(0,10);return((0,a.useEffect)(()=>{if(!t.current||0===r.length||0===e.length)return;s.current||(s.current=Q.init(t.current,void 0,{renderer:"canvas"}));let l=s.current,a=r.map(e=>e.name),n=r.map(e=>e.满期保费),i=r.map(e=>e.边际贡献率);l.setOption({backgroundColor:"transparent",grid:{left:"5%",right:"10%",top:"12%",bottom:"15%",containLabel:!0},tooltip:{trigger:"axis",axisPointer:{type:"shadow"},backgroundColor:"rgba(255, 255, 255, 0.98)",borderColor:"#e2e8f0",borderWidth:1,textStyle:{color:"#334155",fontSize:12,fontWeight:"bold"},padding:12},legend:{data:["满期保费(万元)","边际贡献率(%)"],top:"2%",textStyle:{fontSize:12,fontWeight:"bold"}},xAxis:{type:"category",data:a,axisLabel:{fontSize:11,color:"#64748b",fontWeight:"bold",rotate:0,interval:0,hideOverlap:!0},axisLine:{lineStyle:{color:"#cbd5e1"}}},yAxis:[{type:"value",name:"满期保费(万元)",position:"left",nameTextStyle:{color:"#64748b",fontSize:12,fontWeight:"bold"},axisLabel:{fontSize:11,color:"#64748b",fontWeight:"bold"},axisLine:{lineStyle:{color:"#cbd5e1"}},splitLine:{show:!1}},{type:"value",name:"边际贡献率(%)",position:"right",nameTextStyle:{color:"#64748b",fontSize:12,fontWeight:"bold"},axisLabel:{fontSize:11,color:"#64748b",fontWeight:"bold"},axisLine:{lineStyle:{color:"#cbd5e1"}},splitLine:{show:!1}}],series:[{name:"满期保费(万元)",type:"bar",yAxisIndex:0,data:n,label:{show:!0,position:"top",fontWeight:"bold",formatter:e=>(0,I.uf)(e.value,0)},itemStyle:{color:"#3b82f6"},emphasis:{itemStyle:{shadowBlur:10,shadowColor:"rgba(0, 0, 0, 0.3)"}}},{name:"边际贡献率(%)",type:"bar",yAxisIndex:1,data:i,label:{show:!0,position:"top",fontWeight:"bold",formatter:e=>"".concat(e.value.toFixed(1),"%")},itemStyle:{color:"#10b981"},emphasis:{itemStyle:{shadowBlur:10,shadowColor:"rgba(0, 0, 0, 0.3)"}},markLine:{symbol:"none",lineStyle:{type:"dashed",color:"#10b981",width:2},label:{show:!0,position:"end",fontSize:11,fontWeight:"bold",color:"#10b981",formatter:"目标 15%"},data:[{yAxis:15}]}}]},!0);let o=new ResizeObserver(()=>{l.resize()});return t.current&&o.observe(t.current),()=>{o.disconnect()}},[r]),(0,a.useEffect)(()=>()=>{s.current&&(s.current.dispose(),s.current=null)},[]),0===e.length)?null:(0,l.jsxs)("div",{className:"rounded-2xl border border-white/50 bg-white/40 p-6 shadow-lg backdrop-blur-xl",children:[(0,l.jsxs)("div",{className:"mb-4 flex items-center justify-between",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(ek.Z,{className:"h-5 w-5 text-blue-600"}),(0,l.jsx)("h3",{className:"text-lg font-semibold text-slate-800",children:"机构对比分析"})]}),(0,l.jsxs)("p",{className:"text-xs text-slate-500",children:["Top ",r.length," 机构"]})]}),(0,l.jsx)("div",{className:"mb-6 overflow-x-auto",children:(0,l.jsxs)("table",{className:"w-full text-sm",children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{className:"border-b border-slate-200 bg-slate-50",children:[(0,l.jsx)("th",{className:"p-2 text-left font-medium text-slate-700",children:"排名"}),(0,l.jsx)("th",{className:"p-2 text-left font-medium text-slate-700",children:"机构"}),(0,l.jsx)("th",{className:"p-2 text-right font-medium text-slate-700",children:"满期保费(万元)"}),(0,l.jsx)("th",{className:"p-2 text-right font-medium text-slate-700",children:"边际贡献率"}),(0,l.jsx)("th",{className:"p-2 text-right font-medium text-slate-700",children:"赔付率"}),(0,l.jsx)("th",{className:"p-2 text-right font-medium text-slate-700",children:"保单数"})]})}),(0,l.jsx)("tbody",{children:e.slice(0,10).map((e,t)=>(0,l.jsxs)("tr",{className:"border-b border-slate-100 hover:bg-blue-50/50 transition-colors",children:[(0,l.jsx)("td",{className:"p-2 font-semibold text-slate-600",children:t+1}),(0,l.jsx)("td",{className:"p-2 font-medium text-slate-800",children:e.organization}),(0,l.jsx)("td",{className:"p-2 text-right tabular-nums",children:(0,I.xG)(e.kpi.matured_premium)}),(0,l.jsx)("td",{className:"p-2 text-right font-semibold tabular-nums ".concat((e.kpi.contribution_margin_ratio||0)>15?"text-green-600":(e.kpi.contribution_margin_ratio||0)>10?"text-blue-600":"text-orange-600"),children:(0,I.T3)(e.kpi.contribution_margin_ratio)}),(0,l.jsx)("td",{className:"p-2 text-right tabular-nums",children:(0,I.T3)(e.kpi.loss_ratio)}),(0,l.jsx)("td",{className:"p-2 text-right tabular-nums",children:(0,I.uf)(e.kpi.policy_count)})]},e.organization))})]})}),(0,l.jsx)("div",{ref:t,className:"h-80"})]})}function eR(){let e=function(){let e=ey();return(0,a.useMemo)(()=>{if(!e||0===e.length)return[];let t=new Map;e.forEach(e=>{let s=e.insurance_type;t.has(s)||t.set(s,{signedPremium:0,maturedPremium:0,policyCount:0});let l=t.get(s);l.signedPremium+=e.signed_premium_yuan,l.maturedPremium+=e.matured_premium_yuan,l.policyCount+=e.policy_count});let s=Array.from(t.values()).reduce((e,t)=>e+t.signedPremium,0),l=Array.from(t.entries()).map(e=>{let[t,l]=e;return{insuranceType:t,signedPremium:Math.round(l.signedPremium/1e4),maturedPremium:Math.round(l.maturedPremium/1e4),policyCount:l.policyCount,percentage:s>0?l.signedPremium/s*100:0,avgPremiumPerPolicy:l.policyCount>0?Math.round(l.signedPremium/l.policyCount):0}});return l.sort((e,t)=>t.signedPremium-e.signedPremium),l},[e])}(),t=(0,a.useRef)(null),s=(0,a.useRef)(null),r=e.map(e=>({name:e.insuranceType,value:e.signedPremium,percentage:e.percentage})).sort((e,t)=>e.percentage-t.percentage);return((0,a.useEffect)(()=>{if(!t.current||0===r.length||0===e.length)return;s.current||(s.current=Q.init(t.current,void 0,{renderer:"canvas"}));let l=s.current,a=r.map((e,t)=>({name:e.name,value:e.value,itemStyle:{color:eP[t%eP.length]}}));l.setOption({backgroundColor:"transparent",tooltip:{trigger:"item",backgroundColor:"rgba(255, 255, 255, 0.98)",borderColor:"#e2e8f0",borderWidth:1,textStyle:{color:"#334155",fontSize:12,fontWeight:"bold"},padding:12,formatter:e=>'<div style="min-width: 180px;">\n            <div style="font-weight: 600; margin-bottom: 4px;">'.concat(e.name,'</div>\n            <div>\n              <span style="color: #64748b;">签单保费：</span>\n              <span style="font-weight: 600;">').concat((0,I.xG)(e.value),'</span>\n            </div>\n            <div>\n              <span style="color: #64748b;">占比：</span>\n              <span style="font-weight: 600; color: #3b82f6;">').concat(e.percent.toFixed(1),"%</span>\n            </div>\n          </div>")},series:[{name:"险种结构",type:"pie",radius:"70%",center:["50%","50%"],data:a,label:{show:!0,formatter:"{b}\n{d}%",fontSize:11,color:"#334155",fontWeight:"bold"},emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.3)"}}}]},!0);let n=new ResizeObserver(()=>{l.resize()});return t.current&&n.observe(t.current),()=>{n.disconnect()}},[r]),(0,a.useEffect)(()=>()=>{s.current&&(s.current.dispose(),s.current=null)},[]),0===e.length)?null:(0,l.jsxs)("div",{className:"rounded-2xl border border-white/50 bg-white/40 p-6 shadow-lg backdrop-blur-xl",children:[(0,l.jsx)("div",{className:"mb-4 flex items-center justify-between",children:(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(eC.Z,{className:"h-5 w-5 text-purple-600"}),(0,l.jsx)("h3",{className:"text-lg font-semibold text-slate-800",children:"险种结构分析"})]})}),(0,l.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,l.jsx)("div",{ref:t,className:"h-64"}),(0,l.jsx)("div",{className:"space-y-3",children:e.map((e,t)=>(0,l.jsxs)("div",{className:"rounded-lg border border-slate-200 bg-white p-3",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("div",{className:"h-3 w-3 rounded",style:{backgroundColor:eP[t%eP.length]}}),(0,l.jsx)("span",{className:"font-medium text-slate-800",children:e.insuranceType})]}),(0,l.jsxs)("span",{className:"text-sm font-semibold text-blue-600",children:[e.percentage.toFixed(1),"%"]})]}),(0,l.jsxs)("div",{className:"grid grid-cols-3 gap-2 text-xs",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-slate-500",children:"签单保费"}),(0,l.jsx)("div",{className:"font-semibold text-slate-700",children:(0,I.xG)(e.signedPremium)})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-slate-500",children:"保单数"}),(0,l.jsx)("div",{className:"font-semibold text-slate-700",children:(0,I.uf)(e.policyCount)})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-slate-500",children:"件均保费"}),(0,l.jsxs)("div",{className:"font-semibold text-slate-700",children:[(0,I.uf)(e.avgPremiumPerPolicy),"元"]})]})]})]},e.insuranceType))})]})]})}function ez(){return(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsx)(eD,{}),(0,l.jsx)(eR,{})]})}var eT=s(77587);let eW=["#1F77B4","#FF7F0E","#2CA02C","#D62728","#9467BD","#8C564B","#E377C2"],eE=["天府","高新","新都","青羊","宜宾","武侯","泸州","德阳","乐山","资阳","自贡","达州"],eF=[{id:"chengdu",label:"成都",icon:"\uD83D\uDCCD",description:"成都地区机构",organizations:["天府","高新","新都","青羊"]},{id:"yidi",label:"异地",icon:"\uD83C\uDF0F",description:"成都以外机构",organizations:["宜宾","武侯","泸州","德阳","乐山","资阳","自贡","达州"]}];function eL(e){return eW[e%eW.length]}function eA(e){let{selectedOrganizations:t,onChange:s,quickFilters:r,className:n}=e,[i,o]=(0,a.useState)(""),d=(0,a.useMemo)(()=>i?eE.filter(e=>e.toLowerCase().includes(i.toLowerCase())):eE,[i]),u=t.length<7,m=e=>{s(Array.from(e.organizations).slice(0,7))},x=e=>{t.includes(e)?s(t.filter(t=>t!==e)):u&&s([...t,e])},h=()=>{s([])},g=e=>{s(t.filter(t=>t!==e))};return(0,l.jsxs)("div",{className:(0,f.cn)("rounded-xl border border-slate-200 bg-white p-6",n),children:[(0,l.jsxs)("div",{className:"mb-6",children:[(0,l.jsx)("div",{className:"mb-3 flex items-center gap-2",children:(0,l.jsx)("span",{className:"text-sm font-semibold text-slate-700",children:"\uD83C\uDFAF 快捷筛选"})}),(0,l.jsx)("div",{className:"flex flex-wrap gap-2",children:r.map(e=>(0,l.jsxs)("button",{onClick:()=>m(e),className:"inline-flex items-center gap-1.5 rounded-lg border border-slate-300 bg-white px-3 py-1.5 text-sm font-medium text-slate-700 transition-all hover:border-blue-400 hover:bg-blue-50 hover:text-blue-700",title:e.description,children:[(0,l.jsx)("span",{children:e.icon}),(0,l.jsx)("span",{children:e.label}),(0,l.jsxs)("span",{className:"text-xs text-slate-500",children:["(",e.organizations.length,")"]})]},e.id))})]}),(0,l.jsxs)("div",{className:"mb-6",children:[(0,l.jsx)("div",{className:"mb-3 flex items-center gap-2",children:(0,l.jsx)("span",{className:"text-sm font-semibold text-slate-700",children:"⚙️ 自定义选择"})}),(0,l.jsxs)("div",{className:"relative mb-3",children:[(0,l.jsx)(C.Z,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-slate-400"}),(0,l.jsx)("input",{type:"text",placeholder:"搜索机构名称...",value:i,onChange:e=>o(e.target.value),className:"w-full rounded-lg border border-slate-300 py-2 pl-10 pr-4 text-sm focus:border-blue-400 focus:outline-none focus:ring-2 focus:ring-blue-200"})]}),(0,l.jsx)("div",{className:"mb-3 flex flex-wrap gap-2",children:d.map(e=>{let s=t.includes(e),a=!s&&!u;return(0,l.jsxs)("button",{onClick:()=>x(e),disabled:a,className:(0,f.cn)("rounded-lg border px-3 py-1.5 text-sm font-medium transition-all",s?"border-blue-500 bg-blue-50 text-blue-700":a?"cursor-not-allowed border-slate-200 bg-slate-50 text-slate-400":"border-slate-300 bg-white text-slate-700 hover:border-slate-400 hover:bg-slate-50"),title:a?"最多选择 ".concat(7," 个机构"):s?"点击取消选择":"点击选择",children:[(0,l.jsx)("span",{className:"mr-1.5",children:s?"☑":"☐"}),e]},e)})}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)("button",{onClick:()=>{s(Array.from(eE).slice(0,7))},className:"rounded-lg border border-slate-300 bg-white px-3 py-1.5 text-xs font-medium text-slate-700 transition-all hover:bg-slate-50",children:"全选"}),(0,l.jsx)("button",{onClick:h,className:"rounded-lg border border-slate-300 bg-white px-3 py-1.5 text-xs font-medium text-slate-700 transition-all hover:bg-slate-50",children:"清空"})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"mb-3 flex items-center justify-between",children:[(0,l.jsxs)("span",{className:"text-sm font-semibold text-slate-700",children:["已选择: ",t.length,"/",7]}),t.length>0&&(0,l.jsx)("button",{onClick:h,className:"text-xs text-blue-600 hover:text-blue-700 hover:underline",children:"清空全部"})]}),t.length>0?(0,l.jsx)("div",{className:"flex flex-wrap gap-2",children:t.map((e,t)=>{let s=eL(t);return(0,l.jsxs)("div",{className:"inline-flex items-center gap-2 rounded-lg border px-3 py-1.5",style:{borderColor:s},children:[(0,l.jsx)("div",{className:"h-3 w-8 rounded",style:{backgroundColor:s}}),(0,l.jsx)("span",{className:"text-sm font-medium text-slate-800",children:e}),(0,l.jsx)("button",{onClick:()=>g(e),className:"ml-1 text-slate-500 hover:text-slate-700",title:"移除",children:(0,l.jsx)(c.Z,{className:"h-3.5 w-3.5"})})]},e)})}):(0,l.jsx)("div",{className:"rounded-lg border border-dashed border-slate-300 bg-slate-50 p-4 text-center",children:(0,l.jsx)("p",{className:"text-sm text-slate-500",children:"请选择要对比的机构"})}),!u&&(0,l.jsxs)("div",{className:"mt-3 rounded-lg bg-orange-50 p-2 text-xs text-orange-700",children:["⚠️ 已达到最大选择数量（",7,"个机构）"]})]})]})}function eZ(e){let t=(0,h.qr)(e=>e.rawData),s=(0,h.qr)(e=>e.filters),l=(0,h.qr)(e=>e.premiumTargets);return(0,a.useMemo)(()=>{let a=new Map,r=s.years.length>0?(0,j.FT)(s.years):new Date().getFullYear(),n="single"===s.viewMode?s.singleModeWeek:null;return e.forEach(e=>{let i=t.filter(t=>{if(t.third_level_organization!==e||s.years.length>0&&!s.years.includes(t.policy_start_year)||"single"===s.viewMode&&null!==s.singleModeWeek&&t.week_number!==s.singleModeWeek||s.insuranceTypes.length>0&&!s.insuranceTypes.includes(t.insurance_type))return!1;if(s.businessTypes.length>0){let e=(0,en.gX)(t.business_type_category);if(!s.businessTypes.includes(e))return!1}return(!(s.coverageTypes.length>0)||!!s.coverageTypes.includes(t.coverage_type))&&(!(s.customerCategories.length>0)||!!s.customerCategories.includes(t.customer_category_3))&&(!(s.vehicleGrades.length>0)||!t.vehicle_insurance_grade||!!s.vehicleGrades.includes(t.vehicle_insurance_grade))&&(!(s.terminalSources.length>0)||!!s.terminalSources.includes(t.terminal_source))&&(null===s.isNewEnergy||t.is_new_energy_vehicle===s.isNewEnergy)&&(!(s.renewalStatuses.length>0)||!!s.renewalStatuses.includes(t.renewal_status))});if(0===i.length){a.set(e,null);return}let o=null==l?void 0:l.dimensions.thirdLevelOrganization.entries[e],c=i.map(e=>X.Rm.fromRawData(e)),d=(0,X.Qt)(c,{annualTargetYuan:null!=o?o:void 0,mode:"current",currentWeekNumber:null!=n?n:void 0,year:r});a.set(e,d)}),a},[t,e,s.years,s.viewMode,s.singleModeWeek,s.insuranceTypes,s.businessTypes,s.coverageTypes,s.customerCategories,s.vehicleGrades,s.terminalSources,s.isNewEnergy,s.renewalStatuses,l])}let eY={high:5e7,medium:2e7},eO={high:.7,low:.5};function eq(e){let{className:t}=e,[s,r]=(0,a.useState)(["天府","高新","宜宾"]),[n,i]=(0,a.useState)(null),o=(0,a.useRef)(null),c=(0,a.useRef)(null),d=eZ(Array.from(eE)),u=eZ(s),m=(0,a.useMemo)(()=>[...eF,...function(e){let t=[],s=[],l=[],a=[],r=[],n=[];return e.forEach((e,t)=>{if(!e)return;let i=e.signed_premium||0;i>eY.high?s.push(t):i>eY.medium?l.push(t):a.push(t);let o=e.loss_ratio;null!=o&&(o>eO.high?r.push(t):o<eO.low&&n.push(t))}),s.length>0&&t.push({id:"high_premium",label:"高保费",icon:"\uD83D\uDCB0",description:"保费 > 5000万 (".concat(s.length,"个机构)"),organizations:s}),l.length>0&&t.push({id:"medium_premium",label:"中保费",icon:"\uD83D\uDCB5",description:"2000万 < 保费 ≤ 5000万 (".concat(l.length,"个机构)"),organizations:l}),a.length>0&&t.push({id:"low_premium",label:"低保费",icon:"\uD83D\uDCB4",description:"保费 ≤ 2000万 (".concat(a.length,"个机构)"),organizations:a}),r.length>0&&t.push({id:"high_loss_ratio",label:"高赔付",icon:"⚠️",description:"赔付率 > 70% (".concat(r.length,"个机构)"),organizations:r}),n.length>0&&t.push({id:"low_loss_ratio",label:"低赔付",icon:"✅",description:"赔付率 < 50% (".concat(n.length,"个机构)"),organizations:n}),t}(d)],[d]),x=(0,a.useMemo)(()=>X.tv.map(e=>{let t={dimension:e.shortLabel,fullLabel:e.label,dimensionKey:e.key,unit:e.unit,description:e.description,rawValues:{},levels:{},colors:{}};return s.forEach(s=>{var l,a,r,n;let i=u.get(s),o=(i?(0,X.lE)(i):new Map).get(e.key);t[s]=null!==(l=null==o?void 0:o.score)&&void 0!==l?l:0,t.rawValues[s]=null!==(a=null==o?void 0:o.rawValue)&&void 0!==a?a:0,t.levels[s]=null!==(r=null==o?void 0:o.label)&&void 0!==r?r:"-",t.colors[s]=null!==(n=null==o?void 0:o.color)&&void 0!==n?n:"#94a3b8"}),t}),[s,u]),h=(0,a.useMemo)(()=>{let e={};return s.forEach(t=>{let s=x.map(e=>e[t]).filter(e=>e>0);s.length>0?e[t]=Math.round(s.reduce((e,t)=>e+t,0)/s.length):e[t]=0}),e},[s,x]),g=e=>e>=95?{label:"卓越",color:"#2E7D32"}:e>=86?{label:"良好",color:"#4CAF50"}:e>=70?{label:"中等",color:"#1976D2"}:e>=20?{label:"预警",color:"#F57C00"}:{label:"高危",color:"#D32F2F"},p=e=>{let t="",l=-1,a=x.find(t=>t.dimensionKey===e);return a?(s.forEach(e=>{let s=a[e];s>l&&(l=s,t=e)}),t||"-"):"-"};return((0,a.useEffect)(()=>{if(!o.current||!x||0===x.length||0===s.length)return;c.current||(c.current=Q.init(o.current,void 0,{renderer:"canvas"}));let e=c.current,t=x.map(e=>({name:e.dimension,max:100})),l=s.map((e,t)=>{let s=x.map(t=>t[e]),l=eL(t);return{name:e,value:s,itemStyle:{color:l},lineStyle:{color:l,width:2.5},areaStyle:{color:l,opacity:.08}}});e.setOption({backgroundColor:"transparent",tooltip:{trigger:"item",backgroundColor:"rgba(255, 255, 255, 0.98)",borderColor:"#e2e8f0",borderWidth:1,textStyle:{color:"#334155",fontSize:12},padding:12,formatter:e=>{let t=e.seriesIndex,l=e.dataIndex,a=s[t],r=x[l];if(!r)return"";let n=r[a],i=r.rawValues[a],o=r.levels[a],c=r.colors[a],d=p(r.dimensionKey),u='<div style="min-width: 200px;">\n            <div style="font-weight: 600; margin-bottom: 8px; font-size: 13px;">'.concat(r.fullLabel,'</div>\n            <div style="margin-bottom: 6px;">\n              <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">\n                <div style="width: 12px; height: 12px; border-radius: 50%; background: ').concat(eL(t),';"></div>\n                <span style="font-weight: 500; color: #475569;">').concat(a,'</span>\n              </div>\n              <div style="margin-left: 20px;">\n                <span style="color: #64748b;">评分：</span>\n                <span style="font-weight: 600; color: #1e293b;">').concat((0,I.uf)(n,1),"</span>\n              </div>");return void 0!==i&&(u+='<div style="margin-left: 20px;">\n              <span style="color: #64748b;">原始值：</span>\n              <span style="color: #64748b;">'.concat((0,I.T3)(i,1),"</span>\n            </div>")),u+='<div style="margin-left: 20px;">\n            <span style="color: #64748b;">等级：</span>\n            <span style="font-weight: 600; color: '.concat(c,';">').concat(o,'</span>\n          </div>\n        </div>\n        <div style="margin-top: 8px; padding-top: 8px; border-top: 1px solid #e2e8f0;">\n          <span style="font-size: 11px; color: #64748b;">最优: ').concat(d," \uD83C\uDFC6</span>\n        </div>\n      </div>")}},legend:{data:s,bottom:"5%",textStyle:{fontSize:13,fontWeight:500},itemWidth:20,itemHeight:8},radar:{indicator:t,center:["50%","52%"],radius:"60%",splitNumber:5,shape:"polygon",axisName:{color:"#475569",fontSize:13,fontWeight:600},axisLine:{lineStyle:{color:"#cbd5e1"}},splitLine:{lineStyle:{color:"#cbd5e1",width:1}},splitArea:{show:!0,areaStyle:{color:["rgba(255, 255, 255, 0.05)","rgba(148, 163, 184, 0.05)"]}}},series:[{type:"radar",data:l,symbol:"circle",symbolSize:5,emphasis:{lineStyle:{width:3},itemStyle:{borderWidth:2,borderColor:"#fff"}}}]},!0);let a=new ResizeObserver(()=>{e.resize()});return o.current&&a.observe(o.current),()=>{a.disconnect()}},[x,s]),(0,a.useEffect)(()=>()=>{c.current&&(c.current.dispose(),c.current=null)},[]),0===s.length)?(0,l.jsxs)("div",{className:(0,f.cn)("space-y-6",t),children:[(0,l.jsx)(eA,{selectedOrganizations:s,onChange:r,quickFilters:m}),(0,l.jsx)("div",{className:"rounded-2xl border border-slate-200 bg-white/60 p-8 text-center backdrop-blur-sm",children:(0,l.jsx)("p",{className:"text-sm text-slate-500",children:"请选择要对比的机构"})})]}):(0,l.jsxs)("div",{className:(0,f.cn)("space-y-6",t),children:[(0,l.jsx)(eA,{selectedOrganizations:s,onChange:r,quickFilters:m}),(0,l.jsxs)("div",{className:"rounded-2xl border border-white/50 bg-white/40 shadow-lg backdrop-blur-xl",children:[(0,l.jsx)("div",{className:"border-b border-slate-200/50 p-6",children:(0,l.jsxs)("div",{className:"flex items-start justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-slate-800",children:"多维健康度雷达图 - 机构对比"}),(0,l.jsxs)("p",{className:"mt-1 text-xs text-slate-500",children:["综合对比",s.length,"个机构在5个核心维度的业务健康状况"]})]}),(0,l.jsxs)("div",{className:"rounded-lg border border-slate-200 bg-white p-3",children:[(0,l.jsx)("p",{className:"mb-2 text-xs font-medium text-slate-600",children:"综合排名"}),Object.entries(h).sort((e,t)=>{let[,s]=e,[,l]=t;return l-s}).slice(0,3).map((e,t)=>{let[a,r]=e,n=g(r),i=eL(s.indexOf(a));return(0,l.jsxs)("div",{className:"mb-1.5 flex items-center gap-2 last:mb-0",children:[(0,l.jsx)("span",{className:"text-sm",children:["\uD83E\uDD47","\uD83E\uDD48","\uD83E\uDD49"][t]}),(0,l.jsx)("div",{className:"h-2 w-2 rounded-full",style:{backgroundColor:i}}),(0,l.jsx)("span",{className:"text-xs font-medium text-slate-700",children:a}),(0,l.jsx)("span",{className:"ml-auto text-sm font-bold",style:{color:n.color},children:r})]},a)})]})]})}),(0,l.jsx)("div",{className:"p-6",children:(0,l.jsx)("div",{ref:o,className:"h-96 w-full"})}),(0,l.jsx)("div",{className:"border-t border-slate-200/50 bg-slate-50/50 px-6 py-3",children:(0,l.jsx)("p",{className:"text-xs text-slate-500",children:"\uD83D\uDCA1 提示：评分基于业务规则自动计算，范围为 0-100 分。卓越（95-100）、良好（86-94）、中等（70-85）、预警（20-69）、高危（0-19）"})})]})]})}let eI={primary:["#3b82f6","#f97316","#10b981","#8b5cf6","#ef4444","#06b6d4","#f59e0b","#ec4899"],threshold:{standard:"#ef4444",target:"#10b981",average:"#9ca3af"},neutral:{50:"#f8fafc",100:"#f1f5f9",200:"#e2e8f0",300:"#cbd5e1",400:"#94a3b8",500:"#64748b",600:"#475569",700:"#334155",800:"#1e293b",900:"#0f172a"}};eI.threshold.standard,eI.threshold.target;let eV={title:{fontSize:16,fontWeight:600,color:eI.neutral[800]},subtitle:{fontSize:12,fontWeight:400,color:eI.neutral[500]},axis:{fontSize:11,color:eI.neutral[600]},label:{fontSize:12,fontWeight:500,color:eI.neutral[700]},legend:{fontSize:12,fontWeight:400,color:eI.neutral[700]},tooltip:{fontSize:12,color:eI.neutral[700]}},eB={default:{left:"3%",right:"4%",bottom:"15%",top:"15%",containLabel:!0},compact:{left:"2%",right:"2%",bottom:"10%",top:"10%",containLabel:!0},vertical:{left:"10%",right:"5%",bottom:"5%",top:"5%",containLabel:!0}},eK={trigger:"axis",backgroundColor:"rgba(255, 255, 255, 0.98)",borderColor:eI.neutral[200],borderWidth:1,textStyle:{color:eI.neutral[700],fontSize:12},padding:12,extraCssText:"box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);"},eG={top:"2%",textStyle:{fontSize:eV.legend.fontSize,color:eV.legend.color},itemWidth:14,itemHeight:14,itemGap:16},eU={xAxis:{axisLine:{lineStyle:{color:eI.neutral[300]}},axisLabel:{fontSize:eV.axis.fontSize,color:eV.axis.color,fontWeight:"bold",rotate:0,hideOverlap:!0},splitLine:{show:!1}},yAxis:{axisLine:{show:!0,lineStyle:{color:eI.neutral[300]}},axisLabel:{fontSize:eV.axis.fontSize,color:eV.axis.color,fontWeight:"bold",hideOverlap:!0},splitLine:{show:!1},nameTextStyle:{color:eV.axis.color,fontSize:12,fontWeight:"bold"}}};eI.neutral[300],eI.primary[0],eI.neutral[300];let eX=a.memo(function(e){let{option:t,className:s,style:r,height:n=400,width:i="100%",loading:o=!1,loadingText:c="加载中...",onClick:d,onDblClick:u,onMouseOver:m,onMouseOut:x,onChartReady:h,autoResize:g=!0,renderer:p="canvas",mergeTheme:b=!0,chartRef:v,emptyText:y="暂无数据",isEmpty:j=!1}=e,N=(0,a.useRef)(null),w=(0,a.useRef)(null),[_,k]=(0,a.useState)(!1),C=v||w,S=(0,a.useMemo)(()=>b?{backgroundColor:"transparent",color:[...eI.primary],textStyle:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif'},animation:!0,animationDuration:750,animationEasing:"cubicOut",...t}:t,[t,b]);(0,a.useEffect)(()=>{if(!N.current)return;let e=Q.init(N.current,void 0,{renderer:p,useDirtyRect:!0});return C.current=e,k(!0),h&&h(e),()=>{e.dispose(),C.current=null,k(!1)}},[p]),(0,a.useEffect)(()=>{C.current&&_&&C.current.setOption(S,{notMerge:!1,lazyUpdate:!1,silent:!1})},[S,_,C]),(0,a.useEffect)(()=>{C.current&&_&&(o?C.current.showLoading("default",{text:c,color:"#3b82f6",textColor:"#64748b",maskColor:"rgba(255, 255, 255, 0.8)",zlevel:0}):C.current.hideLoading())},[o,c,_,C]),(0,a.useEffect)(()=>{if(!C.current||!_)return;let e=C.current;if(d){let t=t=>d(t,e);return e.on("click",t),()=>{e.off("click",t)}}},[d,_,C]),(0,a.useEffect)(()=>{if(!C.current||!_)return;let e=C.current;if(u){let t=t=>u(t,e);return e.on("dblclick",t),()=>{e.off("dblclick",t)}}},[u,_,C]),(0,a.useEffect)(()=>{if(!C.current||!_)return;let e=C.current;if(m){let t=t=>m(t,e);return e.on("mouseover",t),()=>{e.off("mouseover",t)}}},[m,_,C]),(0,a.useEffect)(()=>{if(!C.current||!_)return;let e=C.current;if(x){let t=t=>x(t,e);return e.on("mouseout",t),()=>{e.off("mouseout",t)}}},[x,_,C]),(0,a.useEffect)(()=>{if(!C.current||!g||!N.current)return;let e=C.current,t=new ResizeObserver(()=>{e.resize()});return t.observe(N.current),()=>{t.disconnect()}},[g,_,C]);let M={width:"number"==typeof i?"".concat(i,"px"):i,height:"number"==typeof n?"".concat(n,"px"):n,...r};return j?(0,l.jsx)("div",{className:(0,f.cn)("flex items-center justify-center rounded-lg border border-slate-200 bg-slate-50",s),style:M,children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("div",{className:"mb-2 text-4xl text-slate-300",children:"\uD83D\uDCCA"}),(0,l.jsx)("p",{className:"text-sm text-slate-500",children:y})]})}):(0,l.jsx)("div",{ref:N,className:(0,f.cn)("echarts-container",s),style:M})});eX.displayName="BaseEChart";var eH=s(45860);let eJ={excellent:{level:"excellent",label:"卓越",color:"#059669",bgColor:"#ecfdf5",priority:5},outstanding:{level:"outstanding",label:"优秀",color:"#0284c7",bgColor:"#f0f9ff",priority:4},healthy:{level:"healthy",label:"健康",color:"#10b981",bgColor:"#d1fae5",priority:3},warning:{level:"warning",label:"预警",color:"#f59e0b",bgColor:"#fef3c7",priority:2},danger:{level:"danger",label:"危险",color:"#ef4444",bgColor:"#fee2e2",priority:1}},eQ=[{metricKey:"time_progress_ratio",metricName:"时间进度达成率",unit:"%",isHigherBetter:!0,ranges:[{max:60,level:"danger"},{min:60,max:80,level:"warning"},{min:80,max:95,level:"healthy"},{min:95,max:105,level:"outstanding"},{min:105,level:"excellent"}]},{metricKey:"variable_cost_ratio",metricName:"变动成本率",unit:"%",isHigherBetter:!1,ranges:[{min:92,level:"danger"},{min:85,max:92,level:"warning"},{min:75,max:85,level:"healthy"},{min:65,max:75,level:"outstanding"},{max:65,level:"excellent"}]},{metricKey:"loss_ratio",metricName:"满期赔付率",unit:"%",isHigherBetter:!1,ranges:[{min:80,level:"danger"},{min:70,max:80,level:"warning"},{min:60,max:70,level:"healthy"},{min:50,max:60,level:"outstanding"},{max:50,level:"excellent"}]},{metricKey:"expense_ratio",metricName:"费用率",unit:"%",isHigherBetter:!1,ranges:[{min:30,level:"danger"},{min:25,max:30,level:"warning"},{min:20,max:25,level:"healthy"},{min:15,max:20,level:"outstanding"},{max:15,level:"excellent"}]},{metricKey:"contribution_margin_ratio",metricName:"边际贡献率",unit:"%",isHigherBetter:!0,ranges:[{max:10,level:"danger"},{min:10,max:20,level:"warning"},{min:20,max:30,level:"healthy"},{min:30,max:40,level:"outstanding"},{min:40,level:"excellent"}]},{metricKey:"combined_ratio",metricName:"综合成本率",unit:"%",isHigherBetter:!1,ranges:[{min:105,level:"danger"},{min:100,max:105,level:"warning"},{min:95,max:100,level:"healthy"},{min:90,max:95,level:"outstanding"},{max:90,level:"excellent"}]},{metricKey:"matured_claim_ratio",metricName:"满期出险率",unit:"%",isHigherBetter:!1,ranges:[{min:12,level:"danger"},{min:11.5,max:12,level:"warning"},{min:11,max:11.5,level:"healthy"},{min:10.5,max:11,level:"outstanding"},{max:10.5,level:"excellent"}]},{metricKey:"average_claim",metricName:"案均赔款",unit:"元",isHigherBetter:!1,ranges:[{min:5400,level:"danger"},{min:5200,max:5400,level:"warning"},{min:5e3,max:5200,level:"healthy"},{min:4800,max:5e3,level:"outstanding"},{max:4800,level:"excellent"}]},{metricKey:"average_expense",metricName:"单均费用",unit:"元",isHigherBetter:!1,ranges:[{min:700,level:"danger"},{min:500,max:700,level:"warning"},{min:300,max:500,level:"healthy"},{min:150,max:300,level:"outstanding"},{max:150,level:"excellent"}]},{metricKey:"expense_amount",metricName:"费用金额",unit:"万元",isHigherBetter:!1,ranges:[{min:1e4,level:"danger"},{min:5e3,max:1e4,level:"warning"},{min:2e3,max:5e3,level:"healthy"},{min:500,max:2e3,level:"outstanding"},{max:500,level:"excellent"}]}];function e$(e){return eQ.find(t=>t.metricKey===e)||null}function e0(e,t){if(null==e)return"warning";let s=e$(t);if(!s)return"healthy";for(let t of s.ranges){let s=!1;if(void 0!==t.min&&void 0!==t.max?s=e>=t.min&&e<=t.max:void 0!==t.min?s=e>=t.min:void 0!==t.max&&(s=e<=t.max),s)return t.level}return"healthy"}function e1(e,t){return eJ[e0(e,t)].color}function e2(e,t,s){let l=e$(s);return l?[...e].sort((e,s)=>{var a,r;let n=null!==(a=t(e))&&void 0!==a?a:0,i=null!==(r=t(s))&&void 0!==r?r:0;return l.isHigherBetter?i-n:n-i}):e}function e5(e){let{title:t,chartId:s,metrics:r,defaultMetric:n,aggregateFunction:i,defaultTopN:o=12}=e,c=ey(),[d,u]=(0,a.useState)("business_type"),[m,x]=(0,a.useState)(n),[h,g]=(0,a.useState)(o),p=r.find(e=>e.value===m);if(!p)throw Error("未找到指标配置: ".concat(m));let b=p.config,f=(0,a.useMemo)(()=>{if(!c||0===c.length)return[];let e=i(c,d);return e.sort((e,t)=>{var s;let l=e[b.sortKey],a=t[b.sortKey],r=e$(b.dataKey);return null!==(s=null==r?void 0:r.isHigherBetter)&&void 0!==s&&s?l-a:a-l}),e.slice(0,Math.max(1,Math.min(50,h)))},[c,d,h,i,b.sortKey,b.dataKey]),v=(0,a.useMemo)(()=>{if(!f||0===f.length)return null;let e=f.map(e=>e.label),t=f.map(e=>e[b.dataKey]),s=f.map(e=>(0,eH.qj)(e.contribution_margin_ratio)),l=e$(b.dataKey),a=null==l?void 0:l.ranges.find(e=>"warning"===e.level),r=(null==a?void 0:a.min)!==void 0?a.min:(null==a?void 0:a.max)!==void 0?a.max:void 0;return{backgroundColor:"transparent",grid:{left:"15%",right:"5%",top:"8%",bottom:"8%",containLabel:!0},tooltip:{trigger:"axis",axisPointer:{type:"shadow"},backgroundColor:"rgba(255, 255, 255, 0.98)",borderColor:"#e2e8f0",borderWidth:1,textStyle:{color:"#334155",fontSize:12,fontWeight:"bold"},padding:12,formatter:e=>{if(!Array.isArray(e)||0===e.length)return"";let t=e[0],s=f[t.dataIndex];if(!s)return"";let l=null!==s.contribution_margin_ratio?"".concat((100*s.contribution_margin_ratio).toFixed(1),"%"):"—";return'<div style="min-width: 200px;">\n            <div style="font-weight: 600; margin-bottom: 6px; font-size: 13px;">'.concat(t.name,'</div>\n            <div style="margin-bottom: 4px;">\n              <span style="color: #64748b;">').concat(b.name,'：</span>\n              <span style="font-weight: 600;">').concat(b.formatter(t.value),'</span>\n            </div>\n            <div>\n              <span style="color: #64748b;">边际贡献率：</span>\n              <span style="font-weight: 600; color: #3b82f6;">').concat(l,"</span>\n            </div>\n          </div>")}},xAxis:{type:"value",axisLabel:{formatter:e=>b.formatter(e),fontSize:11,color:"#64748b",fontWeight:"bold"},axisLine:{lineStyle:{color:"#cbd5e1"}},splitLine:{show:!1}},yAxis:{type:"category",data:e,axisLabel:{fontSize:12,color:"#334155",fontWeight:"bold",width:110,overflow:"truncate",ellipsis:"..."},axisLine:{lineStyle:{color:"#cbd5e1"}}},series:[{name:b.name,type:"bar",data:t,label:{show:!0,position:"right",fontWeight:"bold",color:"#334155",formatter:e=>b.formatter(e.value)},itemStyle:{borderRadius:[0,4,4,0],color:e=>s[e.dataIndex]||"#94a3b8"},emphasis:{itemStyle:{shadowBlur:10,shadowColor:"rgba(0, 0, 0, 0.3)"}},barMaxWidth:30,markLine:void 0!==r?{symbol:"none",lineStyle:{type:"dashed",color:"#ef4444",width:2},label:{show:!0,position:"end",fontSize:11,fontWeight:"bold",color:"#ef4444",formatter:"预警线"},data:[{xAxis:r}]}:void 0}]}},[f,b,b.dataKey]);return f&&0!==f.length?(0,l.jsxs)("div",{id:s,className:"rounded-2xl border border-white/50 bg-white/40 p-6 shadow-lg backdrop-blur-xl",children:[(0,l.jsxs)("div",{className:"mb-4 flex flex-col gap-3",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-slate-800",children:t}),(0,l.jsxs)("p",{className:"text-xs text-slate-500",children:[b.name,"（",b.unit,"） Top 排序"]})]}),(0,l.jsxs)("div",{className:"flex items-center gap-2 text-xs",children:[(0,l.jsx)("label",{className:"text-slate-600",children:"Top"}),(0,l.jsx)("input",{type:"number",min:1,max:50,value:h,onChange:e=>g(Number(e.target.value)||1),className:"w-16 border border-slate-300 rounded px-2 py-1"})]})]}),(0,l.jsxs)("div",{className:"flex items-center gap-4",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2 text-xs",children:[(0,l.jsx)("label",{className:"text-slate-600 font-medium",children:"Y轴维度"}),(0,l.jsxs)("select",{className:"border border-slate-300 rounded px-3 py-1 bg-white",value:d,onChange:e=>u(e.target.value),children:[(0,l.jsx)("option",{value:"business_type",children:"业务类型"}),(0,l.jsx)("option",{value:"organization",children:"三级机构"}),(0,l.jsx)("option",{value:"coverage_type",children:"险别组合"})]})]}),(0,l.jsxs)("div",{className:"flex items-center gap-2 text-xs",children:[(0,l.jsx)("label",{className:"text-slate-600 font-medium",children:"X轴指标"}),(0,l.jsx)("select",{className:"border border-slate-300 rounded px-3 py-1 bg-white",value:m,onChange:e=>x(e.target.value),children:r.map(e=>(0,l.jsx)("option",{value:e.value,children:e.label},e.value))})]})]})]}),v&&(0,l.jsx)(eX,{option:v,height:320})]}):null}function e4(e,t){switch(t){case"business_type":return(0,en.gX)(e.business_type_category||"");case"organization":return e.third_level_organization||"未知";case"coverage_type":return e.coverage_type||"未知"}}function e3(e,t){return"business_type"===t?(0,en.gW)(e):e}function e6(e,t){let s=new Map;for(let l of e){let e=e4(l,t);s.has(e)||s.set(e,{signed:0,matured:0,count:0,contribution:0});let a=s.get(e);a.signed+=l.signed_premium_yuan,a.matured+=l.matured_premium_yuan,a.count+=l.policy_count,a.contribution+=l.marginal_contribution_amount_yuan}return Array.from(s.entries()).map(e=>{let[s,l]=e;return{key:s,label:e3(s,t),signed_premium_10k:l.signed/1e4,matured_premium_10k:l.matured/1e4,policy_count:l.count,avg_premium:l.count>0?l.signed/l.count:0,maturity_ratio:l.signed>0?l.matured/l.signed*100:0,contribution_margin_ratio:l.matured>0?l.contribution/l.matured*100:null}})}let e8=[{value:"signed_premium",label:"签单保费",config:{dataKey:"signed_premium_10k",name:"签单保费",unit:"万元",formatter:e=>(0,I.uf)(e,2),sortKey:"signed_premium_10k"}},{value:"matured_premium",label:"满期保费",config:{dataKey:"matured_premium_10k",name:"满期保费",unit:"万元",formatter:e=>(0,I.uf)(e,2),sortKey:"matured_premium_10k"}},{value:"avg_premium",label:"单均保费",config:{dataKey:"avg_premium",name:"单均保费",unit:"元",formatter:e=>(0,I.uf)(e,0),sortKey:"avg_premium"}},{value:"policy_count",label:"保单件数",config:{dataKey:"policy_count",name:"保单件数",unit:"件",formatter:e=>(0,I.uf)(e,0),sortKey:"policy_count"}},{value:"maturity_ratio",label:"满期率",config:{dataKey:"maturity_ratio",name:"满期率",unit:"%",formatter:e=>(0,I.uf)(e,2)+"%",sortKey:"maturity_ratio"}}],e7=a.memo(function(){return(0,l.jsx)(e5,{title:"保费分析条形图",chartId:"premium-analysis-chart",metrics:e8,defaultMetric:"matured_premium",aggregateFunction:e6,defaultTopN:12})});function e9(e,t){let s=new Map;for(let l of e){let e=e4(l,t);s.has(e)||s.set(e,{reportedClaim:0,claimCount:0,maturedPremium:0,policyCount:0,contribution:0});let a=s.get(e);a.reportedClaim+=l.reported_claim_payment_yuan,a.claimCount+=l.claim_case_count,a.maturedPremium+=l.matured_premium_yuan,a.policyCount+=l.policy_count,a.contribution+=l.marginal_contribution_amount_yuan}return Array.from(s.entries()).map(e=>{let[s,l]=e;return{key:s,label:e3(s,t),reported_claim_10k:l.reportedClaim/1e4,claim_count:l.claimCount,avg_claim:l.claimCount>0?l.reportedClaim/l.claimCount:0,matured_claim_ratio:l.policyCount>0?l.claimCount/l.policyCount*100:0,loss_ratio:l.maturedPremium>0?l.reportedClaim/l.maturedPremium*100:0,contribution_margin_ratio:l.maturedPremium>0?l.contribution/l.maturedPremium*100:null}})}let te=[{value:"reported_claim",label:"已报告赔款",config:{dataKey:"reported_claim_10k",name:"已报告赔款",unit:"万元",formatter:e=>(0,I.uf)(e,2),sortKey:"reported_claim_10k"}},{value:"claim_count",label:"赔案件数",config:{dataKey:"claim_count",name:"赔案件数",unit:"件",formatter:e=>(0,I.uf)(e,0),sortKey:"claim_count"}},{value:"avg_claim",label:"案均赔款",config:{dataKey:"avg_claim",name:"案均赔款",unit:"元",formatter:e=>(0,I.uf)(e,0),sortKey:"avg_claim"}},{value:"matured_claim_ratio",label:"满期出险率",config:{dataKey:"matured_claim_ratio",name:"满期出险率",unit:"%",formatter:e=>(0,I.uf)(e,2)+"%",sortKey:"matured_claim_ratio"}},{value:"loss_ratio",label:"满期赔付率",config:{dataKey:"loss_ratio",name:"满期赔付率",unit:"%",formatter:e=>(0,I.uf)(e,2)+"%",sortKey:"loss_ratio"}}],tt=a.memo(function(){return(0,l.jsx)(e5,{title:"赔付分析条形图",chartId:"claim-analysis-chart",metrics:te,defaultMetric:"reported_claim",aggregateFunction:e9,defaultTopN:12})});function ts(e,t){let s=new Map;for(let l of e){let e=t(l);s.has(e)||s.set(e,{signed:0,matured:0,count:0});let a=s.get(e);a.signed+=l.signed_premium_yuan,a.matured+=l.matured_premium_yuan,a.count+=l.policy_count}return s}function tl(e,t){let s=new Map;return e.forEach((e,l)=>{let a=t.get(l)||{signed:0,matured:0,count:0};s.set(l,{signed:e.signed-a.signed,matured:e.matured-a.matured,count:e.count-a.count})}),s}function ta(){let e=(0,h.qr)(e=>e.rawData),t=(0,h.qr)(e=>e.filters);return(0,a.useMemo)(()=>{let s="single"===t.viewMode?t.singleModeWeek:null;if(!s)return[];let l=s-1;return e.filter(e=>{if(e.week_number!==l||t.years.length>0&&!t.years.includes(e.policy_start_year)||t.organizations.length>0&&!t.organizations.includes(e.third_level_organization)||t.insuranceTypes.length>0&&!t.insuranceTypes.includes(e.insurance_type))return!1;if(t.businessTypes.length>0){let s=(0,en.gX)(e.business_type_category);if(!t.businessTypes.includes(s))return!1}return(!(t.coverageTypes.length>0)||!!t.coverageTypes.includes(e.coverage_type))&&(!(t.customerCategories.length>0)||!!t.customerCategories.includes(e.customer_category_3))&&(!(t.vehicleGrades.length>0)||!e.vehicle_insurance_grade||!!t.vehicleGrades.includes(e.vehicle_insurance_grade))&&(!(t.terminalSources.length>0)||!!t.terminalSources.includes(e.terminal_source))&&(null===t.isNewEnergy||e.is_new_energy_vehicle===t.isNewEnergy)&&(!(t.renewalStatuses.length>0)||!!t.renewalStatuses.includes(e.renewal_status))})},[e,t])}let tr=["#1d4ed8","#0ea5e9","#22c55e","#ef4444","#f59e0b","#8b5cf6","#14b8a6","#ec4899","#94a3b8","#eab308","#10b981"],tn=a.memo(function(){let[e,t]=(0,a.useState)("customer"),s=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t=ey(),s=ta(),l=(0,h.qr)(e=>e.filters).dataViewType;return(0,a.useMemo)(()=>{if(0===t.length)return[];let a=ts(t,e=>e.customer_category_3||"未知"),r=a;"increment"===l&&s.length>0&&(r=tl(a,ts(s,e=>e.customer_category_3||"未知")));let n=Array.from(r.entries()).map(e=>{let[t,s]=e;return{key:t,label:t,value:s.matured/1e4}});return n.sort((e,t)=>t.value-e.value),n.length>e&&(n=[...n.slice(0,e-1),{key:"其他",label:"其他",value:n.slice(e-1).reduce((e,t)=>e+t.value,0)}]),n},[t,s,l,e])}(),r=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t=ey(),s=ta(),l=(0,h.qr)(e=>e.filters).dataViewType;return(0,a.useMemo)(()=>{if(0===t.length)return[];let a=ts(t,e=>e.terminal_source||"未知"),r=a;"increment"===l&&s.length>0&&(r=tl(a,ts(s,e=>e.terminal_source||"未知")));let n=Array.from(r.entries()).map(e=>{let[t,s]=e;return{key:t,label:t,value:s.matured/1e4}});return n.sort((e,t)=>t.value-e.value),n.length>e&&(n=[...n.slice(0,e-1),{key:"其他",label:"其他",value:n.slice(e-1).reduce((e,t)=>e+t.value,0)}]),n},[t,s,l,e])}(),n="customer"===e?s:r,i=(0,a.useMemo)(()=>{if(!n||0===n.length)return null;let e=n.reduce((e,t)=>e+t.value,0);return{backgroundColor:"transparent",color:tr,tooltip:{trigger:"item",backgroundColor:"rgba(255, 255, 255, 0.98)",borderColor:"#e2e8f0",borderWidth:1,textStyle:{color:"#334155",fontSize:12,fontWeight:"bold"},padding:12,formatter:e=>{let t=e.percent.toFixed(1);return'<div style="min-width: 160px;">\n            <div style="font-weight: 600; margin-bottom: 4px;">'.concat(e.name,'</div>\n            <div style="margin-bottom: 2px;">\n              <span style="color: #64748b;">保费：</span>\n              <span style="font-weight: 600;">').concat((0,I.uf)(e.value,2),' 万</span>\n            </div>\n            <div>\n              <span style="color: #64748b;">占比：</span>\n              <span style="font-weight: 600; color: #3b82f6;">').concat(t,"%</span>\n            </div>\n          </div>")}},legend:{orient:"vertical",right:"5%",top:"center",textStyle:{fontSize:12,fontWeight:"bold"},formatter:t=>{let s=n.find(e=>e.label===t);if(!s)return t;let l=(s.value/e*100).toFixed(1);return"".concat(t,"  ").concat(l,"%")}},series:[{name:"满期保费",type:"pie",radius:["40%","70%"],center:["40%","50%"],avoidLabelOverlap:!0,itemStyle:{borderRadius:8,borderColor:"#fff",borderWidth:2},label:{show:!0,formatter:"{b}\n{d}%",fontSize:11,color:"#334155",fontWeight:"bold"},emphasis:{label:{show:!0,fontSize:14,fontWeight:"bold"},itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.3)"}},data:[...n].sort((e,t)=>e.value-t.value).map(e=>({name:e.label,value:e.value}))}]}},[n]);if(!n||0===n.length)return null;let o=n.reduce((e,t)=>e+t.value,0);return(0,l.jsxs)("div",{className:"rounded-2xl border border-white/50 bg-white/40 p-6 shadow-lg backdrop-blur-xl",children:[(0,l.jsxs)("div",{className:"mb-4 flex items-center justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-slate-800",children:"占比分析"}),(0,l.jsx)("p",{className:"text-xs text-slate-500",children:"满期保费（万元）占比"})]}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)("button",{className:"px-2 py-1 text-xs rounded border ".concat("customer"===e?"bg-blue-600 text-white border-blue-600":"border-slate-300 text-slate-700"),onClick:()=>t("customer"),children:"客户"}),(0,l.jsx)("button",{className:"px-2 py-1 text-xs rounded border ".concat("channel"===e?"bg-blue-600 text-white border-blue-600":"border-slate-300 text-slate-700"),onClick:()=>t("channel"),children:"渠道"})]})]}),i&&(0,l.jsx)(eX,{option:i,height:320}),(0,l.jsxs)("div",{className:"mt-3 text-right text-xs text-slate-600",children:["总计：",(0,I.uf)(o,2)," 万"]})]})});var ti=s(75113),to=s(42030),tc=s(63075),td=s(75635),tu=s(76910);let tm=tc.fC;tc.ZA;let tx=tc.B4,th=a.forwardRef((e,t)=>{let{className:s,children:a,...r}=e;return(0,l.jsxs)(tc.xz,{ref:t,className:(0,f.cn)("flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",s),...r,children:[a,(0,l.jsx)(tc.JO,{asChild:!0,children:(0,l.jsx)(S.Z,{className:"h-4 w-4 opacity-50"})})]})});th.displayName=tc.xz.displayName;let tg=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,l.jsx)(tc.u_,{ref:t,className:(0,f.cn)("flex cursor-default items-center justify-center py-1",s),...a,children:(0,l.jsx)(td.Z,{className:"h-4 w-4"})})});tg.displayName=tc.u_.displayName;let tp=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,l.jsx)(tc.$G,{ref:t,className:(0,f.cn)("flex cursor-default items-center justify-center py-1",s),...a,children:(0,l.jsx)(S.Z,{className:"h-4 w-4"})})});tp.displayName=tc.$G.displayName;let tb=a.forwardRef((e,t)=>{let{className:s,children:a,position:r="popper",...n}=e;return(0,l.jsx)(tc.h_,{children:(0,l.jsxs)(tc.VY,{ref:t,className:(0,f.cn)("relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]","popper"===r&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:r,...n,children:[(0,l.jsx)(tg,{}),(0,l.jsx)(tc.l_,{className:(0,f.cn)("p-1","popper"===r&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:a}),(0,l.jsx)(tp,{})]})})});tb.displayName=tc.VY.displayName,a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,l.jsx)(tc.__,{ref:t,className:(0,f.cn)("px-2 py-1.5 text-sm font-semibold",s),...a})}).displayName=tc.__.displayName;let tf=a.forwardRef((e,t)=>{let{className:s,children:a,...r}=e;return(0,l.jsxs)(tc.ck,{ref:t,className:(0,f.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...r,children:[(0,l.jsx)("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,l.jsx)(tc.wU,{children:(0,l.jsx)(tu.Z,{className:"h-4 w-4"})})}),(0,l.jsx)(tc.eT,{children:a})]})});function tv(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return null==e||isNaN(e)?"-":e.toLocaleString("zh-CN",{minimumFractionDigits:t,maximumFractionDigits:t})}function ty(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return null==e||isNaN(e)?"-":"".concat(e.toFixed(t),"%")}function tj(e){return{type:"value",...eU.yAxis,...e}}function tN(e){let{name:t,data:s,color:l,yAxisIndex:a=0,smooth:r=!0,showSymbol:n=!0,areaStyle:i=!1,lineWidth:o=3,symbolSize:c=6}=e,d={name:t,type:"line",data:s,yAxisIndex:a,smooth:r,symbol:n?"circle":"none",symbolSize:c,lineStyle:{width:o},emphasis:{focus:"series"}};return l&&(d.lineStyle.color=l,d.itemStyle={color:l}),i&&(d.areaStyle={opacity:.3}),d}tf.displayName=tc.ck.displayName,a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,l.jsx)(tc.Z0,{ref:t,className:(0,f.cn)("-mx-1 my-1 h-px bg-muted",s),...a})}).displayName=tc.Z0.displayName;let tw={variableCostRatio:{label:"变动成本率",color:"#f97316",isInverse:!0,thresholds:{warning:85,danger:90}},contributionMarginRatio:{label:"边际贡献率",color:"#10b981",isInverse:!1,thresholds:{warning:10,danger:5}},lossRatio:{label:"满期赔付率",color:"#ef4444",isInverse:!0,thresholds:{warning:60,danger:70}},expenseRatio:{label:"费用率",color:"#8b5cf6",isInverse:!0,thresholds:{warning:20,danger:25}}};function t_(){let[e,t]=(0,a.useState)("variableCostRatio"),s=ey(),r=(0,a.useMemo)(()=>{let t=new Map;s.forEach(e=>{let s=e.business_type_category,l=t.get(s)||{signedPremium:0,maturedPremium:0,reportedClaimPayment:0,expenseAmount:0,policyCount:0};l.signedPremium+=e.signed_premium_yuan/1e4,l.maturedPremium+=e.matured_premium_yuan/1e4,l.reportedClaimPayment+=e.reported_claim_payment_yuan/1e4,l.expenseAmount+=e.expense_amount_yuan/1e4,l.policyCount+=e.policy_count,t.set(s,l)});let l=Array.from(t.values()).reduce((e,t)=>e+t.signedPremium,0),a=[];en.p7.forEach(s=>{let r=t.get(s)||{signedPremium:0,maturedPremium:0,reportedClaimPayment:0,expenseAmount:0,policyCount:0},n=r.signedPremium,i=r.maturedPremium,o=null;switch(e){case"variableCostRatio":o=(i>0?r.reportedClaimPayment/i*100:0)+(n>0?r.expenseAmount/n*100:0);break;case"contributionMarginRatio":o=100-((i>0?r.reportedClaimPayment/i*100:0)+(n>0?r.expenseAmount/n*100:0));break;case"lossRatio":o=i>0?r.reportedClaimPayment/i*100:0;break;case"expenseRatio":o=n>0?r.expenseAmount/n*100:0}a.push({businessType:s,signedPremium:n,premiumRatio:l>0?n/l*100:0,metricValue:o})});let r=tw[e];return a.sort((e,t)=>{var s,l;let a=null!==(s=e.metricValue)&&void 0!==s?s:0,n=null!==(l=t.metricValue)&&void 0!==l?l:0;return r.isInverse?n-a:a-n}),a},[s,e]),n=(0,a.useMemo)(()=>{var t,s,l;let a=tw[e],n=r.map(e=>(0,en.SO)(e.businessType)),i=r.map(e=>e.signedPremium),o=r.map(e=>e.premiumRatio),c=r.map(e=>e.metricValue);return{grid:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";return eB[e]}("default"),tooltip:(t={trigger:"axis",axisPointer:{type:"cross",crossStyle:{color:eI.neutral[400]}},formatter:e=>{if(!Array.isArray(e)||0===e.length)return"";let t=r[e[0].dataIndex];return t?['<div style="font-weight: 600; margin-bottom: 4px;">'.concat((0,en.SO)(t.businessType),"</div>"),'<div style="display: flex; align-items: center; gap: 8px;">','  <span style="display: inline-block; width: 10px; height: 10px; background: '.concat(eI.primary[0],'; border-radius: 2px;"></span>'),"  <span>签单保费: ".concat(tv(t.signedPremium,0)," 万元</span>"),"</div>",'<div style="display: flex; align-items: center; gap: 8px;">','  <span style="display: inline-block; width: 10px; height: 10px; background: '.concat(eI.neutral[500],'; border-radius: 50%;"></span>'),"  <span>保费占比: ".concat(ty(t.premiumRatio,2),"</span>"),"</div>",'<div style="display: flex; align-items: center; gap: 8px;">','  <span style="display: inline-block; width: 10px; height: 10px; background: '.concat(a.color,'; border-radius: 50%;"></span>'),"  <span>".concat(a.label,": ").concat(null!==t.metricValue?ty(t.metricValue,2):"-","</span>"),"</div>"].join(""):""}},{...eK,...t}),legend:(s={data:["签单保费","保费占比",a.label]},{...eG,...s}),xAxis:(l={data:n,axisLabel:{interval:0,rotate:0,fontSize:11,fontWeight:"bold",hideOverlap:!0}},{type:"category",...eU.xAxis,...l}),yAxis:[tj({name:"签单保费 (万元)",position:"left",axisLabel:{formatter:e=>tv(e,0),fontWeight:"bold"}}),tj({name:"比率 (%)",position:"right",axisLabel:{formatter:e=>"".concat(e,"%"),fontWeight:"bold"},splitLine:{show:!1}})],series:[function(e){let{name:t,data:s,color:l,yAxisIndex:a=0,barWidth:r,barGap:n,stack:i}=e,o={name:t,type:"bar",data:s,yAxisIndex:a,emphasis:{focus:"series"}};return l&&(o.itemStyle={color:l}),void 0!==r&&(o.barWidth=r),void 0!==n&&(o.barGap=n),i&&(o.stack=i),o}({name:"签单保费",data:i,color:eI.primary[0],yAxisIndex:0,barWidth:"40%",label:{show:!0,position:"top",fontWeight:"bold",formatter:e=>tv(e.value,0)}}),tN({name:"保费占比",data:o,color:eI.neutral[500],yAxisIndex:1,smooth:!0,showSymbol:!0,lineWidth:2,symbolSize:6,label:{show:!0,position:"top",fontWeight:"bold",formatter:e=>"".concat(e.value.toFixed(1),"%")}}),tN({name:a.label,data:c,color:a.color,yAxisIndex:1,smooth:!0,showSymbol:!0,lineWidth:3,symbolSize:7,label:{show:!0,position:"top",fontWeight:"bold",formatter:e=>"".concat(e.value.toFixed(1),"%")}})]}},[r,e]);return(0,l.jsxs)(to.Zb,{children:[(0,l.jsx)(to.Ol,{children:(0,l.jsxs)("div",{className:"flex items-start justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)(to.ll,{className:"text-lg",children:"业务类型经营分析"}),(0,l.jsx)(to.SZ,{children:"规模与效率双维度分析,柱状图展示保费规模,折线展示占比与经营指标"})]}),(0,l.jsxs)(tm,{value:e,onValueChange:e=>t(e),children:[(0,l.jsx)(th,{className:"w-48",children:(0,l.jsx)(tx,{placeholder:"选择指标"})}),(0,l.jsx)(tb,{children:Object.entries(tw).map(e=>{let[t,s]=e;return(0,l.jsx)(tf,{value:t,children:s.label},t)})})]})]})}),(0,l.jsx)(to.aY,{children:r.length>0?(0,l.jsx)(ti.Z,{option:n,style:{height:"500px"},opts:{renderer:"canvas"}}):(0,l.jsx)("div",{className:"flex h-[400px] items-center justify-center rounded-lg border border-dashed border-slate-300 bg-slate-50",children:(0,l.jsx)("p",{className:"text-sm text-slate-500",children:"当前筛选条件下暂无数据"})})})]})}var tk=s(69754);let tC=(0,tk.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function tS(e){let{className:t,variant:s,...a}=e;return(0,l.jsx)("div",{className:(0,f.cn)(tC({variant:s}),t),...a})}var tM=s(94258),tP=s(7010),tD=s(89367),tR=s(39721);function tz(){let e=ey(),t=(0,a.useMemo)(()=>(function(e){let t=[],s=new Map;return e.forEach(e=>{let t=e.business_type_category,l=e.week_number;s.has(t)||s.set(t,{totalPremium:0,maturedPremium:0,reportedClaim:0,expense:0,policyCount:0,weeklyData:new Map});let a=s.get(t);a.totalPremium+=e.signed_premium_yuan/1e4,a.maturedPremium+=e.matured_premium_yuan/1e4,a.reportedClaim+=e.reported_claim_payment_yuan/1e4,a.expense+=e.expense_amount_yuan/1e4,a.policyCount+=e.policy_count,a.weeklyData.has(l)||a.weeklyData.set(l,{premium:0,maturedPremium:0,claim:0,expense:0});let r=a.weeklyData.get(l);r.premium+=e.signed_premium_yuan/1e4,r.maturedPremium+=e.matured_premium_yuan/1e4,r.claim+=e.reported_claim_payment_yuan/1e4,r.expense+=e.expense_amount_yuan/1e4}),en.p7.forEach(e=>{let l=s.get(e);if(!l||0===l.totalPremium)return;let a=l.maturedPremium>0?l.reportedClaim/l.maturedPremium*100:0,r=l.expense/l.totalPremium*100,n=a+r;if(n>90){let s=Array.from(l.weeklyData.keys()).sort((e,t)=>e-t),i=s.map(e=>{let t=l.weeklyData.get(e);return(t.maturedPremium>0?t.claim/t.maturedPremium*100:0)+(t.premium>0?t.expense/t.premium*100:0)});t.push({id:"risk-".concat(e),type:"risk",severity:n>95?"high":"medium",title:"".concat((0,en.SO)(e),"业务成本率过高"),description:"该业务变动成本率达到".concat(ty(n,1),"，其中赔付率").concat(ty(a,1),"，费用率").concat(ty(r,1),"。建议立即审查承保质量和费用控制策略。"),businessType:e,metrics:[{name:"变动成本率",value:n},{name:"赔付率",value:a},{name:"费用率",value:r}],trendData:{weeks:s,values:i}})}}),en.p7.forEach(e=>{let l=s.get(e);if(!l||0===l.totalPremium)return;let a=100-(l.maturedPremium>0?l.reportedClaim/l.maturedPremium*100:0)-l.expense/l.totalPremium*100;a>20&&l.totalPremium>50&&t.push({id:"opportunity-".concat(e),type:"opportunity",severity:"low",title:"".concat((0,en.SO)(e),"业务表现优秀"),description:"该业务边际贡献率达到".concat(ty(a,1),"，累计保费").concat(tv(l.totalPremium,0),"万元，贡献利润约").concat(tv(l.totalPremium*a/100,0),"万元。可作为标杆进行复制推广。"),businessType:e,metrics:[{name:"边际贡献率",value:a},{name:"签单保费",value:l.totalPremium},{name:"贡献利润",value:l.totalPremium*a/100}]})}),en.p7.forEach(e=>{let l=s.get(e);if(!l||l.weeklyData.size<2)return;let a=Array.from(l.weeklyData.keys()).sort((e,t)=>e-t),r=a[a.length-1],n=a[a.length-2],i=l.weeklyData.get(r),o=l.weeklyData.get(n),c=i.premium>0?(i.claim+i.expense)/i.premium*100:0,d=c-(o.premium>0?(o.claim+o.expense)/o.premium*100:0);d>5&&i.premium>10&&t.push({id:"trend-".concat(e),type:"trend",severity:d>10?"high":"medium",title:"".concat((0,en.SO)(e),"业务成本率环比上升"),description:"第".concat(r,"周成本率为").concat(ty(c,1),"，较第").concat(n,"周上升").concat(ty(d,1),"。需要关注该业务的成本变化趋势。"),businessType:e,metrics:[{name:"当前成本率",value:c},{name:"环比变化",value:d,change:d}]})}),t.sort((e,t)=>{let s={high:3,medium:2,low:1};return s[t.severity]-s[e.severity]})})(e),[e]),s=(0,a.useMemo)(()=>(function(e){let t=0,s=0,a=0,r=0;e.forEach(e=>{t+=e.signed_premium_yuan/1e4,s+=e.matured_premium_yuan/1e4,a+=e.reported_claim_payment_yuan/1e4,r+=e.expense_amount_yuan/1e4});let n=s>0?a/s*100:0,i=t>0?r/t*100:0,o=20*Math.random()-10,c=5*Math.random()-2.5,d=5*Math.random()-2.5;return[{label:"总保费",value:"".concat(tv(t,0),"万元"),change:o,changeLabel:"".concat(o>0?"+":"").concat(ty(o,1)),icon:(0,l.jsx)(N.Z,{className:"w-5 h-5 text-blue-600"})},{label:"边际贡献率",value:ty(100-n-i,1),change:c,changeLabel:"".concat(c>0?"+":"").concat(ty(c,1)),icon:(0,l.jsx)(D.Z,{className:"w-5 h-5 text-green-600"})},{label:"变动成本率",value:ty(n+i,1),change:d,changeLabel:"".concat(d>0?"+":"").concat(ty(d,1)),icon:(0,l.jsx)(B.Z,{className:"w-5 h-5 text-amber-600"})},{label:"风险业务数",value:"0个",change:0,changeLabel:"持平",icon:(0,l.jsx)(m.Z,{className:"w-5 h-5 text-red-600"})}]})(e),[e]);return(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsxs)(to.Zb,{children:[(0,l.jsxs)(to.Ol,{children:[(0,l.jsxs)(to.ll,{className:"text-lg flex items-center gap-2",children:[(0,l.jsx)(D.Z,{className:"w-5 h-5 text-blue-600"}),"核心发现"]}),(0,l.jsx)(to.SZ,{children:"基于当前数据自动识别的关键洞察和建议"})]}),(0,l.jsx)(to.aY,{className:"space-y-4",children:0===t.length?(0,l.jsx)("div",{className:"text-center py-8 text-slate-500",children:"当前数据未发现显著异常或机会"}):t.slice(0,3).map((e,t)=>(0,l.jsx)("div",{className:"rounded-lg border-l-4 p-4 ".concat("risk"===e.type?"border-l-red-500 bg-red-50":"opportunity"===e.type?"border-l-green-500 bg-green-50":"border-l-amber-500 bg-amber-50"),children:(0,l.jsxs)("div",{className:"flex items-start gap-3",children:[(0,l.jsxs)("div",{className:"flex-shrink-0 mt-1",children:["risk"===e.type&&(0,l.jsx)(m.Z,{className:"w-5 h-5 text-red-600"}),"opportunity"===e.type&&(0,l.jsx)(tP.Z,{className:"w-5 h-5 text-green-600"}),"trend"===e.type&&(0,l.jsx)(B.Z,{className:"w-5 h-5 text-amber-600"})]}),(0,l.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsxs)("span",{className:"font-semibold text-slate-900",children:[t+1,". ",e.title]}),(0,l.jsx)(tS,{variant:"high"===e.severity?"destructive":"secondary",className:"text-xs",children:"high"===e.severity?"高优先级":"medium"===e.severity?"中优先级":"低优先级"})]}),(0,l.jsx)("p",{className:"text-sm text-slate-700",children:e.description}),e.metrics&&e.metrics.length>0&&(0,l.jsx)("div",{className:"flex flex-wrap gap-3 mt-3",children:e.metrics.map(e=>(0,l.jsxs)("div",{className:"bg-white rounded-md px-3 py-2 border border-slate-200",children:[(0,l.jsx)("div",{className:"text-xs text-slate-600",children:e.name}),(0,l.jsxs)("div",{className:"font-semibold text-slate-900 flex items-center gap-1",children:[ty(e.value,1),void 0!==e.change&&(0,l.jsxs)("span",{className:"text-xs ".concat(e.change>0?"text-red-600":"text-green-600"),children:[e.change>0?"↑":"↓",Math.abs(e.change).toFixed(1),"%"]})]})]},e.name))}),e.trendData&&(0,l.jsxs)("div",{className:"mt-3",children:[(0,l.jsxs)("div",{className:"text-xs text-slate-600 mb-1",children:["趋势变化（最近",e.trendData.weeks.length,"周）"]}),(0,l.jsx)(ti.Z,{option:{grid:{left:40,right:10,top:10,bottom:25},xAxis:{type:"category",data:e.trendData.weeks.map(e=>"周".concat(e)),axisLabel:{fontSize:10}},yAxis:{type:"value",axisLabel:{formatter:e=>"".concat(e.toFixed(0),"%"),fontSize:10}},series:[{data:e.trendData.values,type:"line",smooth:!0,areaStyle:{color:"risk"===e.type?"rgba(239, 68, 68, 0.1)":"rgba(234, 179, 8, 0.1)"},lineStyle:{color:"risk"===e.type?"#ef4444":"#eab308",width:2},itemStyle:{color:"risk"===e.type?"#ef4444":"#eab308"}}],tooltip:{trigger:"axis",formatter:"{b}: {c}%"}},style:{height:"120px"},opts:{renderer:"canvas"}})]})]})]})},e.id))})]}),(0,l.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:s.map(e=>(0,l.jsx)(to.Zb,{children:(0,l.jsxs)(to.aY,{className:"pt-6",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,l.jsx)("span",{className:"text-sm text-slate-600",children:e.label}),e.icon]}),(0,l.jsx)("div",{className:"text-2xl font-bold text-slate-900 mb-1",children:e.value}),(0,l.jsxs)("div",{className:"flex items-center text-sm ".concat(e.change>0?"text-green-600":e.change<0?"text-red-600":"text-slate-500"),children:[e.change>0?(0,l.jsx)(tD.Z,{className:"w-4 h-4 mr-1"}):e.change<0?(0,l.jsx)(tR.Z,{className:"w-4 h-4 mr-1"}):(0,l.jsx)(K.Z,{className:"w-4 h-4 mr-1"}),(0,l.jsxs)("span",{children:[e.changeLabel," vs上期"]})]})]})},e.label))}),t.length>0&&(0,l.jsxs)(to.Zb,{children:[(0,l.jsxs)(to.Ol,{children:[(0,l.jsx)(to.ll,{className:"text-lg",children:"推荐行动"}),(0,l.jsx)(to.SZ,{children:"基于数据分析建议采取的具体措施"})]}),(0,l.jsx)(to.aY,{children:(0,l.jsx)("div",{className:"space-y-2",children:t.slice(0,3).map(e=>(0,l.jsx)(tM.bZ,{className:"border-slate-200",children:(0,l.jsxs)(tM.X,{className:"flex items-start gap-2",children:[(0,l.jsx)("input",{type:"checkbox",className:"mt-0.5 rounded border-slate-300"}),(0,l.jsxs)("span",{className:"text-sm text-slate-700",children:["risk"===e.type&&"召开".concat((0,en.SO)(e.businessType),"业务风险评审会，制定成本控制方案"),"opportunity"===e.type&&"研究".concat((0,en.SO)(e.businessType),"业务的成功因素，制定复制推广计划"),"trend"===e.type&&"评估".concat((0,en.SO)(e.businessType),"业务的承保政策和费率调整必要性")]})]})},e.id))})})]})]})}var tT=s(1207);let tW={variableCostRatio:{label:"变动成本率",isInverse:!0,thresholds:{excellent:75,good:80,warning:85,danger:90}},contributionMarginRatio:{label:"边际贡献率",isInverse:!1,thresholds:{excellent:20,good:15,warning:10,danger:5}},lossRatio:{label:"满期赔付率",isInverse:!0,thresholds:{excellent:50,good:60,warning:70,danger:80}},expenseRatio:{label:"费用率",isInverse:!0,thresholds:{excellent:15,good:20,warning:25,danger:30}}};function tE(){let[e,t]=(0,a.useState)("variableCostRatio"),s=ey(),{heatmapData:r,weekNumbers:n,anomalies:i}=(0,a.useMemo)(()=>{let t=tW[e],l=new Map;s.forEach(t=>{let s=(0,en.gX)(t.business_type_category),a=t.week_number;l.has(s)||l.set(s,new Map);let r=l.get(s),n=r.get(a)||{businessType:s,weekNumber:a,metricValue:null,signedPremiumYuan:0,policyCount:0,maturedPremiumYuan:0,reportedClaimPaymentYuan:0,expenseAmountYuan:0,marginalContributionAmountYuan:0};n.signedPremiumYuan+=t.signed_premium_yuan,n.policyCount+=t.policy_count,n.maturedPremiumYuan+=t.matured_premium_yuan,n.reportedClaimPaymentYuan+=t.reported_claim_payment_yuan,n.expenseAmountYuan+=t.expense_amount_yuan,n.marginalContributionAmountYuan+=t.marginal_contribution_amount_yuan;let i=null;switch(e){case"variableCostRatio":i=(0,tT.vF)(n.reportedClaimPaymentYuan,n.maturedPremiumYuan,n.expenseAmountYuan,n.signedPremiumYuan);break;case"contributionMarginRatio":i=(0,tT.oR)(n.marginalContributionAmountYuan,n.maturedPremiumYuan);break;case"lossRatio":i=(0,tT.nR)(n.reportedClaimPaymentYuan,n.maturedPremiumYuan);break;case"expenseRatio":i=(0,tT.bA)(n.expenseAmountYuan,n.signedPremiumYuan)}n.metricValue=i,r.set(a,n)});let a=new Set;l.forEach(e=>{e.forEach((e,t)=>a.add(t))});let r=Array.from(a).sort((e,t)=>e-t),n=[];en.AL.forEach((e,t)=>{let s=l.get(e);r.forEach((e,l)=>{var a;let r=null==s?void 0:s.get(e),i=null!==(a=null==r?void 0:r.metricValue)&&void 0!==a?a:-1;n.push([l,t,i])})});let i=[];return en.AL.forEach(e=>{let s=l.get(e);if(!s)return;let a=r.map(e=>{var t;return null===(t=s.get(e))||void 0===t?void 0:t.metricValue}),n=0;a.forEach((s,l)=>{if(null==s){n=0;return}(t.isInverse?s>=t.thresholds.danger:s<=t.thresholds.danger)?++n>=3&&i.push({type:"continuous_danger",businessType:e,description:"连续".concat(n,"周处于危险区域（周").concat(r[l-n+1],"-").concat(r[l],"）"),severity:"high"}):n=0});let o=0;a.forEach(s=>{if(null==s){o=0;return}(t.isInverse?s<=t.thresholds.excellent:s>=t.thresholds.excellent)?o++:(o>=4&&i.push({type:"excellent_streak",businessType:e,description:"连续".concat(o,"周保持优秀水平"),severity:"low"}),o=0)})}),{heatmapData:n,weekNumbers:r,anomalies:i}},[s,e]),o=(0,a.useMemo)(()=>{let t=tW[e],s={value:-1,label:"无数据",color:"#e2e8f0"},l=t.isInverse?[s,{lte:t.thresholds.excellent,label:"≤".concat(t.thresholds.excellent,"%"),color:"#22c55e"},{gt:t.thresholds.excellent,lte:t.thresholds.good,label:"".concat(t.thresholds.excellent,"-").concat(t.thresholds.good,"%"),color:"#84cc16"},{gt:t.thresholds.good,lte:t.thresholds.warning,label:"".concat(t.thresholds.good,"-").concat(t.thresholds.warning,"%"),color:"#eab308"},{gt:t.thresholds.warning,lte:t.thresholds.danger,label:"".concat(t.thresholds.warning,"-").concat(t.thresholds.danger,"%"),color:"#f97316"},{gt:t.thresholds.danger,label:">".concat(t.thresholds.danger,"%"),color:"#ef4444"}]:[s,{lte:t.thresholds.danger,label:"≤".concat(t.thresholds.danger,"%"),color:"#ef4444"},{gt:t.thresholds.danger,lte:t.thresholds.warning,label:"".concat(t.thresholds.danger,"-").concat(t.thresholds.warning,"%"),color:"#f97316"},{gt:t.thresholds.warning,lte:t.thresholds.good,label:"".concat(t.thresholds.warning,"-").concat(t.thresholds.good,"%"),color:"#eab308"},{gt:t.thresholds.good,lte:t.thresholds.excellent,label:"".concat(t.thresholds.good,"-").concat(t.thresholds.excellent,"%"),color:"#84cc16"},{gt:t.thresholds.excellent,label:">".concat(t.thresholds.excellent,"%"),color:"#22c55e"}];return{tooltip:{position:"top",textStyle:{fontSize:12,fontWeight:"bold"},formatter:e=>{let s=e.data[0],l=e.data[1],a=e.data[2];return -1===a?'<div style="padding: 8px;">\n              <div style="font-weight: 600;">暂无数据</div>\n              <div>第'.concat(n[s],"周 - ").concat((0,en.qP)(en.AL[l]),"</div>\n            </div>"):'<div style="padding: 8px;">\n            <div style="font-weight: 600; margin-bottom: 4px;">第'.concat(n[s],"周 - ").concat((0,en.qP)(en.AL[l]),"</div>\n            <div>").concat(t.label,": ").concat(ty(a,2),"</div>\n          </div>")}},grid:{left:120,right:80,top:40,bottom:40},xAxis:{type:"category",data:n.map(e=>"周".concat(e)),splitArea:{show:!1},axisLabel:{interval:0,rotate:0,fontSize:11,fontWeight:"bold",hideOverlap:!0}},yAxis:{type:"category",data:en.AL.map(e=>(0,en.gW)(e)),splitArea:{show:!1},axisLabel:{fontSize:11,fontWeight:"bold",hideOverlap:!0}},visualMap:{type:"piecewise",pieces:l,selectedMode:!1,orient:"vertical",right:10,top:"center",textStyle:{fontSize:11,fontWeight:"bold"}},series:[{name:t.label,type:"heatmap",data:r,label:{show:!0,fontSize:10,fontWeight:"bold",formatter:e=>-1===e.data[2]?"":"".concat(Number(e.data[2]).toFixed(0),"%")},emphasis:{itemStyle:{shadowBlur:10,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]}},[r,n,e]);return(0,l.jsxs)(to.Zb,{children:[(0,l.jsx)(to.Ol,{children:(0,l.jsxs)("div",{className:"flex items-start justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)(to.ll,{className:"text-lg",children:"业务类型健康度热力图"}),(0,l.jsx)(to.SZ,{children:"一屏展示所有业务类型在多周的健康度变化，颜色越深表示风险越高"})]}),(0,l.jsxs)(tm,{value:e,onValueChange:e=>t(e),children:[(0,l.jsx)(th,{className:"w-48",children:(0,l.jsx)(tx,{placeholder:"选择指标"})}),(0,l.jsx)(tb,{children:Object.entries(tW).map(e=>{let[t,s]=e;return(0,l.jsx)(tf,{value:t,children:s.label},t)})})]})]})}),(0,l.jsxs)(to.aY,{className:"space-y-6",children:[r.length>0?(0,l.jsx)(ti.Z,{option:o,style:{height:"600px"},opts:{renderer:"canvas"}}):(0,l.jsx)("div",{className:"flex h-[400px] items-center justify-center rounded-lg border border-dashed border-slate-300 bg-slate-50",children:(0,l.jsx)("p",{className:"text-sm text-slate-500",children:"当前筛选条件下暂无数据"})}),i.length>0&&(0,l.jsxs)("div",{className:"space-y-3",children:[(0,l.jsxs)("h4",{className:"text-sm font-semibold text-slate-800 flex items-center gap-2",children:[(0,l.jsx)(m.Z,{className:"w-4 h-4 text-amber-600"}),"异常模式识别"]}),(0,l.jsx)("div",{className:"grid grid-cols-1 gap-2",children:i.slice(0,5).map((e,t)=>(0,l.jsx)(tM.bZ,{className:"border-l-4 ".concat("high"===e.severity?"border-l-red-500 bg-red-50":"medium"===e.severity?"border-l-amber-500 bg-amber-50":"border-l-green-500 bg-green-50"),children:(0,l.jsxs)(tM.X,{className:"flex items-start gap-2 text-sm",children:["continuous_danger"===e.type&&(0,l.jsx)(B.Z,{className:"w-4 h-4 text-red-600 mt-0.5 flex-shrink-0"}),"excellent_streak"===e.type&&(0,l.jsx)(V.Z,{className:"w-4 h-4 text-green-600 mt-0.5 flex-shrink-0"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"font-medium",children:(0,en.gW)(e.businessType)}),"：",e.description]})]})},t))})]}),(0,l.jsxs)("div",{className:"rounded-lg border border-slate-200 p-4 bg-slate-50",children:[(0,l.jsx)("h4",{className:"text-sm font-semibold text-slate-800 mb-2",children:"使用说明"}),(0,l.jsxs)("ul",{className:"text-xs text-slate-600 space-y-1",children:[(0,l.jsx)("li",{children:"• 颜色越深（红色）表示该指标处于风险区域"}),(0,l.jsx)("li",{children:"• 颜色越浅（绿色）表示该指标表现优秀"}),(0,l.jsx)("li",{children:"• 悬停在格子上查看详细数值"}),(0,l.jsx)("li",{children:"• 横向观察可以看出某业务类型的时间趋势"}),(0,l.jsx)("li",{children:"• 纵向观察可以对比不同业务类型在同一周的表现"})]})]})]})]})}function tF(e){var t;let{className:s}=e,[r,n]=(0,a.useState)("insights"),i=[{value:"insights",label:"智能洞察",description:"自动识别关键问题和机会，提供决策建议"},{value:"heatmap",label:"健康度热力图",description:"全局展示业务类型在多周的健康度变化"},{value:"radar",label:"机构雷达图",description:"多机构健康度对比分析"},{value:"premium",label:"保费分析",description:"保费数据多维度分析"},{value:"claim",label:"赔付分析",description:"赔付数据多维度分析"},{value:"distribution",label:"占比分析",description:"客户与渠道占比分析"},{value:"businessType",label:"业务类型经营",description:"业务类型规模与效率双维度分析"}];return(0,l.jsxs)("div",{className:s,children:[(0,l.jsxs)(eT.mQ,{value:r,onValueChange:e=>n(e),className:"space-y-6",children:[(0,l.jsxs)("div",{className:"rounded-2xl border border-white/50 bg-white/40 p-4 shadow-lg backdrop-blur-xl",children:[(0,l.jsx)("div",{className:"flex items-start justify-between mb-4",children:(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-xl font-bold text-blue-600 text-left",children:"多维图表分析"}),(0,l.jsx)("p",{className:"text-sm text-slate-600 mt-1",children:null===(t=i.find(e=>e.value===r))||void 0===t?void 0:t.description})]})}),(0,l.jsx)(eT.dr,{className:"grid grid-cols-7 gap-2 bg-slate-100/50 p-1 rounded-lg text-xs",children:i.map(e=>(0,l.jsx)(eT.SP,{value:e.value,className:"data-[state=active]:bg-white data-[state=active]:shadow-sm",children:e.label},e.value))})]}),(0,l.jsxs)(eT.nU,{value:"insights",className:"mt-0",children:[(0,l.jsx)("div",{className:"mb-3",children:(0,l.jsx)("h4",{className:"text-lg font-bold text-blue-600 text-left",children:"智能洞察"})}),(0,l.jsx)(tz,{})]}),(0,l.jsxs)(eT.nU,{value:"heatmap",className:"mt-0",children:[(0,l.jsx)("div",{className:"mb-3",children:(0,l.jsx)("h4",{className:"text-lg font-bold text-blue-600 text-left",children:"健康度热力图"})}),(0,l.jsx)(tE,{})]}),(0,l.jsxs)(eT.nU,{value:"radar",className:"mt-0",children:[(0,l.jsx)("div",{className:"mb-3",children:(0,l.jsx)("h4",{className:"text-lg font-bold text-blue-600 text-left",children:"机构雷达图"})}),(0,l.jsx)(eq,{})]}),(0,l.jsxs)(eT.nU,{value:"premium",className:"mt-0",children:[(0,l.jsx)("div",{className:"mb-3",children:(0,l.jsx)("h4",{className:"text-lg font-bold text-blue-600 text-left",children:"保费分析"})}),(0,l.jsx)(e7,{})]}),(0,l.jsxs)(eT.nU,{value:"claim",className:"mt-0",children:[(0,l.jsx)("div",{className:"mb-3",children:(0,l.jsx)("h4",{className:"text-lg font-bold text-blue-600 text-left",children:"赔付分析"})}),(0,l.jsx)(tt,{})]}),(0,l.jsxs)(eT.nU,{value:"distribution",className:"mt-0",children:[(0,l.jsx)("div",{className:"mb-3",children:(0,l.jsx)("h4",{className:"text-lg font-bold text-blue-600 text-left",children:"占比分析"})}),(0,l.jsx)(tn,{})]}),(0,l.jsxs)(eT.nU,{value:"businessType",className:"mt-0",children:[(0,l.jsx)("div",{className:"mb-3",children:(0,l.jsx)("h4",{className:"text-lg font-bold text-blue-600 text-left",children:"业务类型经营"})}),(0,l.jsx)(t_,{})]})]}),(0,l.jsxs)("div",{className:"rounded-2xl border border-slate-200 p-4 bg-white/60 backdrop-blur-sm",children:[(0,l.jsx)("h4",{className:"text-sm font-semibold text-slate-800 mb-2",children:"图表使用说明"}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 text-xs text-slate-600",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"font-medium text-slate-700",children:"智能洞察："}),"自动分析数据，识别风险业务、标杆业务和趋势变化，提供决策建议"]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"font-medium text-slate-700",children:"健康度热力图："}),"一屏展示16个业务类型在多周的健康度，快速发现异常模式"]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"font-medium text-slate-700",children:"机构雷达图："}),"对比多个机构在承保、赔付、客户、渠道、综合5个维度的健康评分"]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"font-medium text-slate-700",children:"保费分析："}),"按业务类型、机构、险别等维度分析保费数据"]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"font-medium text-slate-700",children:"赔付分析："}),"按业务类型、机构、险别等维度分析赔付数据"]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"font-medium text-slate-700",children:"占比分析："}),"展示客户类型和渠道类型的满期保费占比"]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"font-medium text-slate-700",children:"业务类型经营："}),"双Y轴复合图展示业务类型的规模与效率，可切换多种经营指标"]})]})]})]})}let tL={个人客户:"#3b82f6",企业客户:"#10b981",政府机关:"#f59e0b",其他:"#6b7280"},tA={"非营客-新":"#3b82f6","非营客-旧":"#10b981","非营客-过户":"#f59e0b","非营货-<1t":"#8b5cf6","非营货-1–2t":"#6366f1","营货-<2t":"#ef4444","营货-2–9t":"#f97316","营货-9–10t":"#f59e0b","营货-≥10t普":"#22c55e","营货-≥10t牵":"#0ea5e9","营货-≥10t卸":"#14b8a6","营货-≥10t特":"#a855f7","营货-其他":"#6b7280",摩托:"#64748b","营客-出租":"#d946ef","营客-网约":"#ec4899",其他:"#6b7280"},tZ={"high-value":"\uD83D\uDC8E 高价值客户","high-risk":"⚠️ 高风险客户","low-value":"\uD83D\uDCC9 低价值客户",normal:"✓ 正常客户"};function tY(e){let{className:t}=e,s=ey(),[r,n]=(0,a.useState)("customer"),i=(0,a.useMemo)(()=>{if(0===s.length)return[];let e="customer"===r?"customer_category_3":"business_type_category",t=new Map;s.forEach(s=>{let l="customer"===r?s[e]||"其他":(0,en.gX)(s[e]||"");t.has(l)||t.set(l,[]),t.get(l).push(s)});let l=[];return t.forEach((e,t)=>{let s=e.reduce((e,t)=>e+t.signed_premium_yuan,0),a=e.reduce((e,t)=>e+t.matured_premium_yuan,0),n=e.reduce((e,t)=>e+t.reported_claim_payment_yuan,0),i=e.reduce((e,t)=>e+t.policy_count,0);if(0===i)return;let o=Math.round(s/i),c=a>0?n/a*100:0,d="customer"===r?tL:tA,u=d["customer"===r?t:(0,en.gW)(t)]||d["其他"],m="normal";o>3e3&&c<60?m="high-value":c>80?m="high-risk":o<2e3&&c>70&&(m="low-value"),l.push({name:"business"===r?(0,en.gW)(t):t,averagePremium:o,lossRatio:c,policyCount:i,color:u,segment:m})}),l},[s,r]),o=(0,a.useMemo)(()=>{if(0===i.length)return{avgPremium:0,avgLossRatio:0};let e=i.reduce((e,t)=>e+t.policyCount,0);return{avgPremium:Math.round(i.reduce((e,t)=>e+t.averagePremium*t.policyCount,0)/e),avgLossRatio:i.reduce((e,t)=>e+t.lossRatio*t.policyCount,0)/e}},[i]),c=(0,a.useMemo)(()=>0===i.length?null:{backgroundColor:"transparent",grid:{left:"10%",right:"10%",top:"10%",bottom:"15%",containLabel:!0},tooltip:{backgroundColor:"rgba(255, 255, 255, 0.98)",borderColor:"#e2e8f0",borderWidth:1,textStyle:{color:"#334155",fontSize:12,fontWeight:"bold"},padding:16,formatter:e=>{let t=e.data,s=tZ[t.segment];return'<div style="min-width: 220px;">\n            <div style="font-weight: 600; margin-bottom: 8px; font-size: 14px;">'.concat(t.name,'</div>\n            <div style="margin-bottom: 4px;">\n              <span style="color: #64748b;">单均保费：</span>\n              <span style="font-weight: 600;">').concat((0,I.uf)(t.value[0]),' 元</span>\n            </div>\n            <div style="margin-bottom: 4px;">\n              <span style="color: #64748b;">赔付率：</span>\n              <span style="font-weight: 600;">').concat((0,I.T3)(t.value[1]/100),'</span>\n            </div>\n            <div style="margin-bottom: 8px;">\n              <span style="color: #64748b;">保单件数：</span>\n              <span style="font-weight: 600;">').concat(t.policyCount.toLocaleString(),'</span>\n            </div>\n            <div style="padding-top: 8px; border-top: 1px solid #e5e7eb;">\n              <span style="color: #6b7280;">').concat(s,"</span>\n            </div>\n          </div>")}},xAxis:{type:"value",name:"单均保费（元）",nameLocation:"middle",nameGap:35,nameTextStyle:{fontSize:13,fontWeight:"bold",color:"#334155"},axisLabel:{formatter:e=>"".concat((e/1e3).toFixed(1),"k"),fontSize:11,color:"#64748b",fontWeight:"bold",hideOverlap:!0,rotate:0},axisLine:{lineStyle:{color:"#cbd5e1"}},splitLine:{show:!1}},yAxis:{type:"value",name:"赔付率（%）",nameLocation:"middle",nameGap:45,nameTextStyle:{fontSize:13,fontWeight:"bold",color:"#334155"},axisLabel:{formatter:e=>"".concat(e.toFixed(0),"%"),fontSize:11,color:"#64748b",fontWeight:"bold",hideOverlap:!0},axisLine:{lineStyle:{color:"#cbd5e1"}},splitLine:{show:!1}},series:[{name:"客户群",type:"scatter",data:i.map(e=>({value:[e.averagePremium,e.lossRatio,e.policyCount],name:e.name,itemStyle:{color:e.color},segment:e.segment,policyCount:e.policyCount})),label:{show:!0,position:"top",fontWeight:"bold",formatter:e=>"".concat(e.value[1].toFixed(0),"%")},symbolSize:e=>{let t=e[2],s=Math.min(...i.map(e=>e.policyCount)),l=Math.max(...i.map(e=>e.policyCount));return l===s?25:10+(t-s)/(l-s)*30},emphasis:{focus:"series",itemStyle:{shadowBlur:15,shadowColor:"rgba(0, 0, 0, 0.3)"}},markLine:{silent:!0,symbol:"none",lineStyle:{type:"dashed",color:"#9ca3af",width:1},label:{fontSize:11,color:"#6b7280",fontWeight:"bold"},data:[{xAxis:o.avgPremium,label:{formatter:"平均单均保费",position:"end"}},{yAxis:o.avgLossRatio,label:{formatter:"平均赔付率",position:"end"}}]}}]},[i,o]);return 0===i.length?(0,l.jsx)("div",{className:"bg-white rounded-lg border p-8 ".concat(t),children:(0,l.jsx)("div",{className:"text-center text-gray-500",children:"暂无数据，请先上传数据文件"})}):(0,l.jsxs)("div",{className:"bg-white rounded-lg border ".concat(t),children:[(0,l.jsx)("div",{className:"p-4 border-b",children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-lg font-semibold",children:"客户分群气泡图"}),(0,l.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"X轴：单均保费 | Y轴：赔付率 | 气泡大小：保单件数"})]}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)("button",{onClick:()=>n("customer"),className:"px-4 py-2 rounded-lg text-sm font-medium transition-colors ".concat("customer"===r?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:"按客户类型"}),(0,l.jsx)("button",{onClick:()=>n("business"),className:"px-4 py-2 rounded-lg text-sm font-medium transition-colors ".concat("business"===r?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:"按业务类型"})]})]})}),(0,l.jsxs)("div",{className:"p-4",children:[c&&(0,l.jsx)(eX,{option:c,height:500}),(0,l.jsxs)("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-3 gap-4",children:[i.filter(e=>"high-value"===e.segment).length>0&&(0,l.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[(0,l.jsx)("div",{className:"font-semibold text-green-900 mb-2",children:"\uD83D\uDC8E 高价值客户群"}),(0,l.jsx)("div",{className:"text-sm text-green-800",children:i.filter(e=>"high-value"===e.segment).map(e=>e.name).join("、")}),(0,l.jsx)("div",{className:"text-xs text-green-700 mt-2",children:"单均保费高且赔付率低，建议加大营销力度"})]}),i.filter(e=>"high-risk"===e.segment).length>0&&(0,l.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[(0,l.jsx)("div",{className:"font-semibold text-red-900 mb-2",children:"⚠️ 高风险客户群"}),(0,l.jsx)("div",{className:"text-sm text-red-800",children:i.filter(e=>"high-risk"===e.segment).map(e=>e.name).join("、")}),(0,l.jsx)("div",{className:"text-xs text-red-700 mt-2",children:"赔付率偏高，需加强风险管控和定价策略"})]}),i.filter(e=>"low-value"===e.segment).length>0&&(0,l.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[(0,l.jsx)("div",{className:"font-semibold text-yellow-900 mb-2",children:"\uD83D\uDCC9 低价值客户群"}),(0,l.jsx)("div",{className:"text-sm text-yellow-800",children:i.filter(e=>"low-value"===e.segment).map(e=>e.name).join("、")}),(0,l.jsx)("div",{className:"text-xs text-yellow-700 mt-2",children:"单均保费低且赔付率高，建议优化客户结构"})]})]})]})]})}function tO(e){let t=e0(e,"expense_ratio");return{color:e1(e,"expense_ratio"),level:t}}function tq(e){let{className:t}=e,s=ey(),r=(0,a.useMemo)(()=>{if(0===s.length)return[];let e=new Map;s.forEach(t=>{let s=t.third_level_organization;e.has(s)||e.set(s,[]),e.get(s).push(t)});let t=[];return e.forEach((e,s)=>{let l=e.reduce((e,t)=>e+t.expense_amount_yuan,0),a=e.reduce((e,t)=>e+t.signed_premium_yuan,0),r=e.reduce((e,t)=>e+t.policy_count,0);t.push({organization:s,expenseRatio:a>0?l/a*100:0,averageExpense:r>0?Math.round(l/r):0,expenseAmount:Math.round(l/1e4),totalPremium:Math.round(a/1e4)})}),t.sort((e,t)=>t.expenseRatio-e.expenseRatio)},[s]),n=(0,a.useMemo)(()=>{let e=[];return r.forEach(t=>{let s=tO(t.expenseRatio);e.push({organization:t.organization,metric:"费用率",value:t.expenseRatio,displayValue:(0,I.T3)(t.expenseRatio/100),color:s.color,level:s.level});let l=function(e){let t=e0(e,"average_expense");return{color:e1(e,"average_expense"),level:t}}(t.averageExpense);e.push({organization:t.organization,metric:"单均费用",value:t.averageExpense,displayValue:"".concat((0,I.uf)(t.averageExpense)," 元"),color:l.color,level:l.level});let a=r.reduce((e,t)=>Math.max(e,t.expenseAmount),0),n=tO(t.expenseAmount/a*30);e.push({organization:t.organization,metric:"费用金额",value:t.expenseAmount,displayValue:(0,I.xG)(t.expenseAmount),color:n.color,level:n.level})}),e},[r]),i=["费用率","单均费用","费用金额"],o=(e,t)=>n.find(s=>s.organization===e&&s.metric===t);return 0===s.length?(0,l.jsx)("div",{className:"bg-white rounded-lg border p-8 ".concat(t),children:(0,l.jsx)("div",{className:"text-center text-gray-500",children:"暂无数据，请先上传数据文件"})}):(0,l.jsxs)("div",{className:"bg-white rounded-lg border ".concat(t),children:[(0,l.jsxs)("div",{className:"p-4 border-b",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold",children:"费用结构热力图"}),(0,l.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"行：三级机构 | 列：费用指标 | 颜色：费用水平（绿色优秀，红色警告）"})]}),(0,l.jsx)("div",{className:"p-4 overflow-x-auto",children:(0,l.jsxs)("table",{className:"w-full border-collapse",children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{className:"border bg-gray-50 px-4 py-3 text-left font-semibold text-gray-700 sticky left-0 z-10",children:"机构"}),i.map(e=>(0,l.jsx)("th",{className:"border bg-gray-50 px-4 py-3 text-center font-semibold text-gray-700 min-w-[120px]",children:e},e))]})}),(0,l.jsx)("tbody",{children:r.map((e,t)=>(0,l.jsxs)("tr",{className:t%2==0?"bg-white":"bg-gray-50/50",children:[(0,l.jsx)("td",{className:"border px-4 py-3 font-medium text-gray-900 sticky left-0 z-10 bg-inherit",children:e.organization}),i.map(t=>{let s=o(e.organization,t);return s?(0,l.jsxs)("td",{className:"border px-4 py-3 text-center transition-all hover:scale-105 cursor-pointer",style:{backgroundColor:s.color+"20",borderLeftColor:s.color,borderLeftWidth:"4px"},title:"".concat(e.organization," - ").concat(t,": ").concat(s.displayValue),children:[(0,l.jsx)("div",{className:"font-semibold",style:{color:s.color},children:s.displayValue}),(0,l.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:["excellent"===s.level&&"✓ 卓越","outstanding"===s.level&&"★ 优秀","healthy"===s.level&&"○ 健康","warning"===s.level&&"△ 预警","danger"===s.level&&"✕ 危险"]})]},t):(0,l.jsx)("td",{className:"border"},t)})]},e.organization))})]})}),null]})}function tI(e){let{achievedProgress:t,timeProgress:s,progressColor:a,timeMarkerColor:r="bg-slate-700",height:n="h-4",showLabels:i=!0,className:o}=e,c=t>=s;return(0,l.jsxs)("div",{className:(0,f.cn)("w-full",o),children:[(0,l.jsxs)("div",{className:(0,f.cn)("relative w-full rounded-full bg-slate-100",n),children:[(0,l.jsx)("div",{className:(0,f.cn)("absolute left-0 top-0 h-full rounded-full transition-all duration-500 ease-out",a),style:{width:"".concat(Math.min(Math.max(t,0),100),"%")}}),(0,l.jsx)("div",{className:(0,f.cn)("absolute top-0 h-full w-1 transition-all duration-500 ease-out",r),style:{left:"".concat(Math.min(Math.max(s,0),100),"%")},children:(0,l.jsx)("div",{className:(0,f.cn)("absolute -top-1.5 left-1/2 h-0 w-0 -translate-x-1/2","border-l-[4px] border-r-[4px] border-t-[6px]","border-l-transparent border-r-transparent",r.replace("bg-","border-t-"))})})]}),i&&(0,l.jsxs)("div",{className:"mt-2 flex items-center justify-between text-xs text-slate-600",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("div",{className:(0,f.cn)("h-3 w-3 rounded",a)}),(0,l.jsxs)("span",{children:["已达成: ",t.toFixed(1),"%"]})]}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("div",{className:(0,f.cn)("h-3 w-1",r)}),(0,l.jsxs)("span",{children:["时间进度: ",s.toFixed(1),"%"]})]}),(0,l.jsxs)("div",{className:(0,f.cn)("text-xs font-medium",c?"text-green-600":"text-orange-600"),children:[c?"超前":"落后"," ",Math.abs(t-s).toFixed(1),"%"]})]})]})}var tV=s(94564),tB=s(13850);function tK(e){var t;if(!e.weeks||0===e.weeks.length)return null;let s=Array.from(new Set(e.weeks)).map(e=>e-1).filter(e=>e>=1);if(0===s.length)return null;let l=(null===(t=e.trendModeWeeks)||void 0===t?void 0:t.length)?e.trendModeWeeks.map(e=>e-1).filter(e=>e>=1):e.trendModeWeeks;return{...e,weeks:s,singleModeWeek:e.singleModeWeek&&e.singleModeWeek>1?e.singleModeWeek-1:e.singleModeWeek,trendModeWeeks:l}}function tG(e,t){let s=new Map;e.forEach(e=>{var l;let{key:a,label:r}=function(e,t){switch(t){case"is_new_energy_vehicle":return e.is_new_energy_vehicle?{key:"new_energy",label:"新能源车"}:{key:"traditional",label:"燃油车"};case"is_transferred_vehicle":return e.is_transferred_vehicle?{key:"transferred",label:"过户车"}:{key:"non_transferred",label:"非过户车"};default:{let s=e[t];if(null==s||"string"==typeof s&&""===s.trim())return{key:"__EMPTY__:".concat(t),label:"未标记"};let l=(0,ej.Vd)(String(s));if("business_type_category"===t){let e=(0,en.gX)(l);return{key:e,label:(0,en.gW)(e)}}return{key:l,label:l}}}}(e,t);s.has(a)||s.set(a,{label:r,signedPremiumYuan:0,premiumPlanYuan:0,policyCount:0,estimatedPolicyTarget:0});let n=s.get(a);if(n.label=r,n.signedPremiumYuan+=e.signed_premium_yuan,n.premiumPlanYuan+=null!==(l=e.premium_plan_yuan)&&void 0!==l?l:0,n.policyCount+=e.policy_count,e.premium_plan_yuan&&e.policy_count>0&&e.signed_premium_yuan>0){let t=e.signed_premium_yuan/e.policy_count;t>0&&(n.estimatedPolicyTarget+=e.premium_plan_yuan/t)}});let l=[];return s.forEach((e,t)=>{let s=e.policyCount>0?e.signedPremiumYuan/e.policyCount:null,a=e.estimatedPolicyTarget>0?e.estimatedPolicyTarget:null;l.push({key:t,label:e.label,signedPremiumYuan:e.signedPremiumYuan,premiumPlanYuan:e.premiumPlanYuan,policyCount:e.policyCount,policyTarget:a,averagePremium:s})}),l.sort((e,t)=>t.signedPremiumYuan-e.signedPremiumYuan),l}function tU(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12,s=ey(),l=(0,h.qr)(e=>e.rawData),r=(0,h.qr)(e=>e.filters),n=(0,a.useMemo)(()=>tK(r),[r]),i=(0,a.useMemo)(()=>n?ev(l,n):[],[n,l]),o=(0,a.useMemo)(()=>tG(s,e).slice(0,t),[s,e,t]),c=(0,a.useMemo)(()=>tG(i,e),[i,e]);return{items:o,previousMap:(0,a.useMemo)(()=>{let e=new Map;return c.forEach(t=>{e.set(t.key,t)}),e},[c])}}function tX(e,t){let s=new Map;e.forEach(e=>{let{key:l,label:a}=function(e,t){switch(t){case"is_new_energy_vehicle":return e.is_new_energy_vehicle?{key:"new_energy",label:"新能源车"}:{key:"traditional",label:"燃油车"};case"is_transferred_vehicle":return e.is_transferred_vehicle?{key:"transferred",label:"过户车"}:{key:"non_transferred",label:"非过户车"};default:{let s=e[t];if(null==s||"string"==typeof s&&""===s.trim())return{key:"__EMPTY__:".concat(t),label:"未标记"};let l=(0,ej.Vd)(String(s));if("business_type_category"===t){let e=(0,en.gX)(l);return{key:e,label:(0,en.gW)(e)}}return{key:l,label:l}}}}(e,t);s.has(l)||s.set(l,{label:a,maturedPremiumYuan:0,reportedClaimPaymentYuan:0,claimCaseCount:0,signedPremiumYuan:0});let r=s.get(l);r.label=a,r.maturedPremiumYuan+=e.matured_premium_yuan,r.reportedClaimPaymentYuan+=e.reported_claim_payment_yuan,r.claimCaseCount+=e.claim_case_count,r.signedPremiumYuan+=e.signed_premium_yuan});let l=new Map;return s.forEach((e,t)=>{let s=(0,tT.nR)(e.reportedClaimPaymentYuan,e.maturedPremiumYuan),a=e.reportedClaimPaymentYuan/1e4,r=e.claimCaseCount,n=(0,tT.Oc)(e.reportedClaimPaymentYuan,e.claimCaseCount);l.set(t,{label:e.label,lossRatio:s,reportedClaimPayment:a,claimCaseCount:r,averageClaim:n,maturedPremiumYuan:e.maturedPremiumYuan,signedPremiumYuan:e.signedPremiumYuan})}),l}function tH(e){let t=ey(),s=(0,h.qr)(e=>e.rawData),l=(0,h.qr)(e=>e.filters),r=(0,a.useMemo)(()=>tK(l),[l]),n=(0,a.useMemo)(()=>r?ev(s,r):[],[r,s]),i=(0,a.useMemo)(()=>tX(t,e),[t,e]),o=(0,a.useMemo)(()=>tX(n,e),[n,e]);return(0,a.useMemo)(()=>(function(e,t){let s=[];return e.forEach((e,l)=>{var a;s.push({key:l,label:e.label,current:e,previous:null!==(a=t.get(l))&&void 0!==a?a:null})}),s.sort((e,t)=>t.current.signedPremiumYuan-e.current.signedPremiumYuan)})(i,o),[i,o])}let tJ=[{value:"customer_category_3",label:"客户类别"},{value:"business_type_category",label:"业务类型"},{value:"third_level_organization",label:"三级机构"},{value:"insurance_type",label:"险种类型"},{value:"is_new_energy_vehicle",label:"能源类型"},{value:"is_transferred_vehicle",label:"过户车状态"},{value:"renewal_status",label:"新续转状态"}],tQ=[{value:"customer_category_3",label:"客户类别"},{value:"business_type_category",label:"业务类型"},{value:"third_level_organization",label:"三级机构"},{value:"insurance_type",label:"险种类型"},{value:"is_new_energy_vehicle",label:"能源类型"},{value:"is_transferred_vehicle",label:"过户车状态"},{value:"renewal_status",label:"新转续状态"}];function t$(e){let{title:t,description:s,children:a}=e;return(0,l.jsxs)("section",{className:"space-y-3",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-base font-semibold text-slate-800",children:t}),(0,l.jsx)("p",{className:"text-xs text-slate-500",children:s})]}),a]})}function t0(e,t,s){if(null===e||null===t)return{current:e,previous:t,absoluteChange:null,percentChange:null,isBetter:!1,isWorsened:!1,direction:"flat"};let l=e-t,a="flat";l>0?a="up":l<0&&(a="down");let r=!1;"up"===a&&s&&(r=!0),"down"!==a||s||(r=!0);let n=!1;return"up"!==a||s||(n=!0),"down"===a&&s&&(n=!0),{current:e,previous:t,absoluteChange:l,percentChange:0!==t?l/Math.abs(t)*100:null,direction:a,isBetter:r,isWorsened:n}}function t1(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return null===e||Number.isNaN(e)?"-":"".concat(e>0?"+":e<0?"-":"").concat((0,I.uf)(Math.abs(e),t))}function t2(e){let{item:t,timeProgress:s,compact:a=!1}=e,r=t.premiumPlanYuan>0?t.signedPremiumYuan/t.premiumPlanYuan*100:null,n=null!==r&&s>0?r/s*100:null,i=(0,eH.qB)(n),o=t.signedPremiumYuan/1e4,c=t.premiumPlanYuan>0?t.premiumPlanYuan/1e4:null;return(0,l.jsxs)("div",{className:(0,f.cn)("rounded-xl border border-slate-200 bg-white shadow-sm",a?"p-3":"p-4"),children:[(0,l.jsxs)("div",{className:"mb-2 flex items-start justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-xs text-slate-500",children:t.label}),(0,l.jsx)("p",{className:(0,f.cn)(a?"text-xl":"text-2xl","font-bold",i.text),children:null!==n?"".concat(n.toFixed(1),"%"):"-"})]}),(0,l.jsx)("span",{className:(0,f.cn)("rounded px-1.5 py-0.5 text-xs font-medium",i.bg,i.text),children:i.label})]}),(0,l.jsx)(tI,{achievedProgress:null!=r?r:0,timeProgress:s,progressColor:i.progress,showLabels:!1,height:a?"h-2":"h-2.5"}),(0,l.jsx)("div",{className:"mt-2 text-xs text-slate-500",children:null!==c?"".concat((0,I.uf)(o,1)," / ").concat((0,I.uf)(c,1)," 万"):"".concat((0,I.uf)(o,1)," 万")})]})}function t5(e){let{item:t,timeProgress:s,compact:a=!1}=e,r=null!==t.policyTarget?t.policyTarget:null,n=r&&r>0?t.policyCount/r*100:null,i=null!==n&&s>0?n/s*100:null,o=(0,eH.qB)(i);return(0,l.jsxs)("div",{className:(0,f.cn)("rounded-xl border border-slate-200 bg-white shadow-sm",a?"p-3":"p-4"),children:[(0,l.jsxs)("div",{className:"mb-2 flex items-start justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-xs text-slate-500",children:t.label}),(0,l.jsx)("p",{className:(0,f.cn)(a?"text-xl":"text-2xl","font-bold",o.text),children:null!==i?"".concat(i.toFixed(1),"%"):"-"})]}),(0,l.jsx)("span",{className:(0,f.cn)("rounded px-1.5 py-0.5 text-xs font-medium",o.bg,o.text),children:o.label})]}),(0,l.jsx)(tI,{achievedProgress:null!=n?n:0,timeProgress:s,progressColor:o.progress,showLabels:!1,height:a?"h-2":"h-2.5"}),(0,l.jsx)("div",{className:"mt-2 text-xs text-slate-500",children:null!==r?"".concat((0,I.uf)(t.policyCount,0)," / ").concat((0,I.uf)(r,1)," 件"):"".concat((0,I.uf)(t.policyCount,0)," 件 \xb7 缺少目标")})]})}function t4(e){var t;let{item:s,previous:a,compact:r=!1}=e,n=s.averagePremium,i=null!==(t=null==a?void 0:a.averagePremium)&&void 0!==t?t:null,o=null!==n&&null!==i?n-i:null,c=null!==o&&null!==i&&0!==i?o/Math.abs(i)*100:null,d=null===o?"flat":o>0?"up":o<0?"down":"flat";return(0,l.jsxs)("div",{className:(0,f.cn)("rounded-xl border border-slate-200 bg-white shadow-sm",r?"p-3":"p-4"),children:[(0,l.jsx)("p",{className:"text-xs text-slate-500",children:s.label}),(0,l.jsx)("p",{className:(0,f.cn)(r?"text-xl":"text-2xl","font-bold text-slate-800"),children:null!==n?"".concat((0,I.uf)(n,0)," 元"):"-"}),null!==o?(0,l.jsxs)("div",{className:(0,f.cn)("mt-1 flex items-center gap-1 text-sm font-medium","up"===d?"text-emerald-600":"down"===d?"text-rose-500":"text-slate-500"),children:["up"===d&&(0,l.jsx)(tV.Z,{className:"h-4 w-4"}),"down"===d&&(0,l.jsx)(tB.Z,{className:"h-4 w-4"}),(0,l.jsx)("span",{children:"".concat(o>0?"+":"").concat((0,I.uf)(Math.round(o),0))}),null!==c&&(0,l.jsxs)("span",{className:"text-xs",children:["(","".concat(c>0?"+":"").concat(c.toFixed(1),"%"),")"]})]}):(0,l.jsx)("div",{className:"mt-1 text-xs text-slate-400",children:"缺少上期对比"}),(0,l.jsxs)("div",{className:"mt-2 text-xs text-slate-500",children:["上期：",null!==i?"".concat((0,I.uf)(i,0)," 元"):"—"]})]})}function t3(e){var t,s,a,r,n;let{item:i,compact:o=!1}=e,c=i.current.lossRatio,d=(0,eH.Mc)(c),u=t0(c,null!==(n=null===(t=i.previous)||void 0===t?void 0:t.lossRatio)&&void 0!==n?n:null,!1);return(0,l.jsxs)("div",{className:(0,f.cn)("relative rounded-xl border border-slate-200 bg-white shadow-sm",o?"p-3":"p-4"),children:[u.isWorsened&&(0,l.jsx)("div",{className:"absolute right-3 top-3 text-rose-500",children:(0,l.jsx)(B.Z,{className:o?"h-4 w-4":"h-5 w-5"})}),(0,l.jsxs)("div",{className:"flex items-start justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-xs text-slate-500",children:i.label}),(0,l.jsx)("p",{className:(0,f.cn)(o?"text-xl":"text-2xl","font-bold",d.text),children:null!==c?(0,I.T3)(c,1):"-"})]}),(0,l.jsx)("span",{className:(0,f.cn)("rounded px-1.5 py-0.5 text-xs font-medium",d.bg,d.text),children:d.label})]}),(0,l.jsx)(v,{value:null===c||Number.isNaN(c)?0:Math.min(Math.max(c,0),120),className:(0,f.cn)("mt-3 h-2",o?"mt-2":"mt-3"),indicatorClassName:d.progress}),(0,l.jsxs)("div",{className:"mt-2 text-xs text-slate-500",children:["上期：",(null===(s=i.previous)||void 0===s?void 0:s.lossRatio)!==null&&(null===(a=i.previous)||void 0===a?void 0:a.lossRatio)!==void 0?(0,I.T3)(null===(r=i.previous)||void 0===r?void 0:r.lossRatio,1):"—"]})]})}function t6(e){var t,s;let{item:a,metric:r,unit:n,decimals:i=1,compact:o=!1}=e,c=a.current[r],d=null!==(s=null===(t=a.previous)||void 0===t?void 0:t[r])&&void 0!==s?s:null,u=t0(c,d,!1),m=null===u.absoluteChange?"text-slate-500":u.isBetter?"text-green-600":u.isWorsened?"text-red-600":"text-slate-600",x="up"===u.direction?(0,l.jsx)(tV.Z,{className:o?"h-3 w-3":"h-4 w-4"}):"down"===u.direction?(0,l.jsx)(tB.Z,{className:o?"h-3 w-3":"h-4 w-4"}):null;return(0,l.jsxs)("div",{className:(0,f.cn)("rounded-xl border border-slate-200 bg-white shadow-sm",o?"p-3":"p-4"),children:[(0,l.jsx)("p",{className:"text-xs text-slate-500",children:a.label}),(0,l.jsx)("p",{className:(0,f.cn)(o?"text-xl":"text-2xl","font-bold text-slate-800"),children:null!=c?"".concat((0,I.uf)(c,i)).concat(n):"-"}),null!==u.absoluteChange?(0,l.jsxs)("div",{className:(0,f.cn)("mt-1 flex items-center gap-1 text-sm font-medium",m),children:[x,(0,l.jsxs)("span",{children:[t1(u.absoluteChange,i),n]}),null!==u.percentChange&&(0,l.jsxs)("span",{className:"text-xs",children:["(",t1(u.percentChange,1),"%)"]})]}):(0,l.jsx)("div",{className:"mt-1 text-xs text-slate-400",children:"缺少上期对比"}),(0,l.jsxs)("div",{className:"mt-2 text-xs text-slate-500",children:["上期：",null!=d?"".concat((0,I.uf)(d,i)).concat(n):"—"]})]})}function t8(e){let{label:t,ratio:s,previous:a,colorFn:r,isHigherBetter:n,compact:i=!1}=e,o=r(s),c=null!==s&&null!=a,d=c?s-a:null,u=null!==s?Math.min(Math.max(s,0),120):0;return(0,l.jsxs)("div",{className:(0,f.cn)("relative rounded-xl border border-slate-200 bg-white shadow-sm",i?"p-3":"p-4"),children:[!!c&&(n?d<0:d>0)&&(0,l.jsx)("div",{className:"absolute right-3 top-3 text-rose-500",children:(0,l.jsx)(B.Z,{className:i?"h-4 w-4":"h-5 w-5"})}),(0,l.jsx)("p",{className:"text-xs text-slate-500 mb-1",children:t}),(0,l.jsx)("p",{className:(0,f.cn)(i?"text-xl":"text-2xl","font-bold",o.text),children:null!==s?(0,I.T3)(s,1):"-"}),(0,l.jsx)(v,{value:u,className:(0,f.cn)("mt-3",i?"h-2":"h-2.5"),indicatorClassName:o.progress})]})}function t7(e){let{label:t,value:s,previous:a,unit:r,decimals:n=0,compact:i=!1}=e,o=null!==s&&null!=a,c=o?s-a:null,d=o&&0!==a?c/Math.abs(a)*100:null,u=null===c?"flat":c>0?"up":c<0?"down":"flat",m="up"===u?(0,l.jsx)(tV.Z,{className:i?"h-3 w-3":"h-4 w-4"}):"down"===u?(0,l.jsx)(tB.Z,{className:i?"h-3 w-3":"h-4 w-4"}):null;return(0,l.jsxs)("div",{className:(0,f.cn)("rounded-xl border border-slate-200 bg-white shadow-sm",i?"p-3":"p-4"),children:[(0,l.jsx)("p",{className:"text-xs text-slate-500 mb-1",children:t}),(0,l.jsx)("p",{className:(0,f.cn)(i?"text-xl":"text-2xl","font-bold text-slate-800"),children:null!==s?"".concat((0,I.uf)(s,n)).concat(r):"-"}),o&&null!==c?(0,l.jsxs)("div",{className:(0,f.cn)("mt-1 flex items-center gap-1 text-sm font-medium","up"===u?"text-emerald-600":"down"===u?"text-rose-500":"text-slate-500"),children:[m,(0,l.jsx)("span",{children:t1(c,n)}),null!==d&&(0,l.jsxs)("span",{className:"text-xs",children:["(",t1(d,1),"%)"]})]}):(0,l.jsx)("div",{className:"mt-1 text-xs text-slate-400",children:"-"}),(0,l.jsxs)("div",{className:"mt-2 text-xs text-slate-500",children:["上期：",null!=a?"".concat((0,I.uf)(a,n)).concat(r):"—"]})]})}function t9(e){let{timeProgress:t,compact:s=!1}=e,[r,n]=(0,a.useState)("customer_category_3"),{items:i,previousMap:o}=tU(r),c=s?"grid-cols-2 md:grid-cols-3":"sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",d=i.length>0;return(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsxs)("div",{className:(0,f.cn)("flex flex-col gap-3",s?"sm:flex-row sm:items-center sm:justify-between":"md:flex-row md:items-center md:justify-between"),children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h2",{className:"text-base font-semibold text-slate-800",children:"分析维度"}),(0,l.jsx)("p",{className:"text-xs text-slate-500",children:"单选一个维度，联动观察保费进度、件数进度与单均保费"})]}),(0,l.jsxs)(tm,{value:r,onValueChange:e=>n(e),children:[(0,l.jsx)(th,{className:(0,f.cn)("w-full",s?"sm:w-48":"sm:w-60"),children:(0,l.jsx)(tx,{placeholder:"选择分析维度"})}),(0,l.jsx)(tb,{children:tJ.map(e=>(0,l.jsx)(tf,{value:e.value,children:e.label},e.value))})]})]}),d?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(t$,{title:"保费进度分析",description:"衡量各类业务保费收入与时间进度的快慢",children:(0,l.jsx)("div",{className:(0,f.cn)("grid gap-3",c),children:i.map(e=>(0,l.jsx)(t2,{item:e,timeProgress:t,compact:s},"premium-".concat(e.key)))})}),(0,l.jsx)(t$,{title:"保单件数进度分析",description:"对比件数增长速度与时间推移的差距",children:(0,l.jsx)("div",{className:(0,f.cn)("grid gap-3",c),children:i.map(e=>(0,l.jsx)(t5,{item:e,timeProgress:t,compact:s},"policy-".concat(e.key)))})}),(0,l.jsx)(t$,{title:"单均保费分析",description:"查看平均保费水平及相对上期的变化幅度",children:(0,l.jsx)("div",{className:(0,f.cn)("grid gap-3",c),children:i.map(e=>(0,l.jsx)(t4,{item:e,previous:o.get(e.key),compact:s},"avg-".concat(e.key)))})})]}):(0,l.jsx)("div",{className:"rounded-xl border border-dashed border-slate-300 bg-slate-50 p-6 text-center text-sm text-slate-500",children:"当前筛选下暂无可用数据，请调整筛选条件后重试"})]})}function se(e){let{compact:t=!1}=e,[s,r]=(0,a.useState)("customer_category_3"),n=tH(s),i=n.length>0,o=t?"grid-cols-2 md:grid-cols-3":"sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",c=[...n].sort((e,t)=>{var s,l;let a=null!==(s=e.current.lossRatio)&&void 0!==s?s:-1/0;return(null!==(l=t.current.lossRatio)&&void 0!==l?l:-1/0)-a}).slice(0,12),d=(e,t)=>{var s,l;let a=e.current[t],r=null!==(l=null===(s=e.previous)||void 0===s?void 0:s[t])&&void 0!==l?l:null;return null==a||null==r?-1/0:Math.abs(a-r)},u=[...n].sort((e,t)=>d(t,"reportedClaimPayment")-d(e,"reportedClaimPayment")).slice(0,12),m=[...n].sort((e,t)=>d(t,"claimCaseCount")-d(e,"claimCaseCount")).slice(0,12),x=[...n].sort((e,t)=>d(t,"averageClaim")-d(e,"averageClaim")).slice(0,12);return(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsxs)("div",{className:(0,f.cn)("flex flex-col gap-3",t?"sm:flex-row sm:items-center sm:justify-between":"md:flex-row md:items-center md:justify-between"),children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h2",{className:"text-base font-semibold text-slate-800",children:"分析维度"}),(0,l.jsx)("p",{className:"text-xs text-slate-500",children:"从结果指标到驱动因，逐层定位赔付风险的根源"})]}),(0,l.jsxs)(tm,{value:s,onValueChange:e=>r(e),children:[(0,l.jsx)(th,{className:(0,f.cn)("w-full",t?"sm:w-48":"sm:w-60"),children:(0,l.jsx)(tx,{placeholder:"选择分析维度"})}),(0,l.jsx)(tb,{children:tQ.map(e=>(0,l.jsx)(tf,{value:e.value,children:e.label},e.value))})]})]}),i?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(t$,{title:"满期赔付率概览",description:"按业务板块呈现赔付风险等级，并高亮环比恶化的业务",children:(0,l.jsx)("div",{className:(0,f.cn)("grid gap-3",o),children:c.map(e=>(0,l.jsx)(t3,{item:e,compact:t},"loss-ratio-".concat(e.key)))})}),(0,l.jsx)(t$,{title:"已报告赔款分析",description:"识别赔款额增长最快的业务线，以判断赔付额上升的主因",children:(0,l.jsx)("div",{className:(0,f.cn)("grid gap-3",o),children:u.map(e=>(0,l.jsx)(t6,{item:e,metric:"reportedClaimPayment",unit:" 万元",decimals:2,compact:t},"reported-".concat(e.key)))})}),(0,l.jsx)(t$,{title:"赔案件数分析",description:"衡量出险频率的变化，判断风险是否因为事故更频繁",children:(0,l.jsx)("div",{className:(0,f.cn)("grid gap-3",o),children:m.map(e=>(0,l.jsx)(t6,{item:e,metric:"claimCaseCount",unit:" 件",decimals:0,compact:t},"claim-count-".concat(e.key)))})}),(0,l.jsx)(t$,{title:"案均赔款分析",description:"观察单次赔款的严重度变化，识别赔付额被拉高的根因",children:(0,l.jsx)("div",{className:(0,f.cn)("grid gap-3",o),children:x.map(e=>(0,l.jsx)(t6,{item:e,metric:"averageClaim",unit:" 元",decimals:0,compact:t},"avg-claim-".concat(e.key)))})})]}):(0,l.jsx)("div",{className:"rounded-xl border border-dashed border-slate-300 bg-slate-50 p-6 text-center text-sm text-slate-500",children:"当前筛选下暂无可用数据，请调整筛选条件后重试"})]})}function st(e){let{compact:t=!1}=e,s=function(){var e;let t=ey(),s=function(){let e=(0,h.qr)(e=>e.rawData),t=(0,h.qr)(e=>e.filters);return(0,a.useMemo)(()=>{let s="single"===t.viewMode?t.singleModeWeek:null;if(!s)return[];let l=s-1;return e.filter(e=>{if(e.week_number!==l||t.years.length>0&&!t.years.includes(e.policy_start_year)||t.organizations.length>0&&!t.organizations.includes(e.third_level_organization)||t.insuranceTypes.length>0&&!t.insuranceTypes.includes(e.insurance_type))return!1;if(t.businessTypes.length>0){let s=(0,en.gX)(e.business_type_category);if(!t.businessTypes.includes(s))return!1}return(!(t.coverageTypes.length>0)||!!t.coverageTypes.includes(e.coverage_type))&&(!(t.customerCategories.length>0)||!!t.customerCategories.includes(e.customer_category_3))&&(!(t.vehicleGrades.length>0)||!e.vehicle_insurance_grade||!!t.vehicleGrades.includes(e.vehicle_insurance_grade))&&(!(t.terminalSources.length>0)||!!t.terminalSources.includes(e.terminal_source))&&(null===t.isNewEnergy||e.is_new_energy_vehicle===t.isNewEnergy)&&(!(t.renewalStatuses.length>0)||!!t.renewalStatuses.includes(e.renewal_status))})},[e,t])}(),l=(0,h.qr)(e=>e.filters),r=l.dataViewType,n=(0,h.qr)(e=>e.premiumTargets),i="single"===l.viewMode?l.singleModeWeek:null,o=l.years.length>0?Math.max(...l.years):new Date().getFullYear(),c=null!==(e=null==n?void 0:n.overall)&&void 0!==e?e:null;return(0,a.useMemo)(()=>{if(0===t.length)return[];let e=new Map;t.forEach(t=>{let s=(0,en.gX)(t.business_type_category||"");e.has(s)||e.set(s,[]),e.get(s).push(t)});let l=new Map;"increment"===r&&s.length>0&&s.forEach(e=>{let t=(0,en.gX)(e.business_type_category||"");l.has(t)||l.set(t,[]),l.get(t).push(e)});let a=[];return e.forEach((e,t)=>{let s;let n=l.get(t)||[];if("increment"===r&&n.length>0){let t=e.map(e=>X.Rm.fromRawData(e)),l=n.map(e=>X.Rm.fromRawData(e));s=(0,X.u_)(t,l,{mode:"increment",currentWeekNumber:null!=i?i:void 0,annualTargetYuan:null!=c?c:void 0,year:o})}else{let t=e.map(e=>X.Rm.fromRawData(e));s=(0,X.Qt)(t,{mode:"current",currentWeekNumber:null!=i?i:void 0,annualTargetYuan:null!=c?c:void 0,year:o})}let d=null;if(n.length>0){let e=n.map(e=>X.Rm.fromRawData(e));d=(0,X.Qt)(e)}a.push({key:t,label:(0,en.gW)(t),contributionMarginRatio:s.contribution_margin_ratio,variableCostRatio:s.variable_cost_ratio,contributionMarginAmount:s.contribution_margin_amount,averageContribution:s.average_contribution,previous:d?{contributionMarginRatio:d.contribution_margin_ratio,variableCostRatio:d.variable_cost_ratio,contributionMarginAmount:d.contribution_margin_amount,averageContribution:d.average_contribution}:void 0})}),a.sort((e,t)=>{var s,l;let a=null!==(s=e.contributionMarginRatio)&&void 0!==s?s:-1/0;return(null!==(l=t.contributionMarginRatio)&&void 0!==l?l:-1/0)-a}),a.slice(0,16)},[t,s,r,i,o,c])}(),r=s.length>0,n=t?"grid-cols-2 md:grid-cols-3":"sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",i=[...s].sort((e,t)=>{var s,l;return(null!==(s=e.variableCostRatio)&&void 0!==s?s:1/0)-(null!==(l=t.variableCostRatio)&&void 0!==l?l:1/0)}),o=[...s].sort((e,t)=>{let s=e.previous?Math.abs(e.contributionMarginAmount-e.previous.contributionMarginAmount):-1/0;return(t.previous?Math.abs(t.contributionMarginAmount-t.previous.contributionMarginAmount):-1/0)-s}).slice(0,16),c=[...s].sort((e,t)=>{var s,l,a,r,n,i;let o=null!==(a=e.averageContribution)&&void 0!==a?a:0,c=null!==(r=t.averageContribution)&&void 0!==r?r:0,d=null!==(n=null===(s=e.previous)||void 0===s?void 0:s.averageContribution)&&void 0!==n?n:0;return Math.abs(c-(null!==(i=null===(l=t.previous)||void 0===l?void 0:l.averageContribution)&&void 0!==i?i:0))-Math.abs(o-d)}).slice(0,16);return(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h2",{className:"text-base font-semibold text-slate-800",children:"边贡分析"}),(0,l.jsx)("p",{className:"text-xs text-slate-500",children:"从利润率到利润额，再到单位利润质量的完整盈利能力诊断"})]}),r?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(t$,{title:"满期边贡率",description:"业务盈利能力的最终体现，越高越好",children:(0,l.jsx)("div",{className:(0,f.cn)("grid gap-3",n),children:s.map(e=>{var s;return(0,l.jsx)(t8,{label:e.label,ratio:e.contributionMarginRatio,previous:null===(s=e.previous)||void 0===s?void 0:s.contributionMarginRatio,colorFn:eH.aV,isHigherBetter:!0,compact:t},"margin-ratio-".concat(e.key))})})}),(0,l.jsx)(t$,{title:"变动成本率",description:"业务的直接成本，越低越好",children:(0,l.jsx)("div",{className:(0,f.cn)("grid gap-3",n),children:i.map(e=>{var s;return(0,l.jsx)(t8,{label:e.label,ratio:e.variableCostRatio,previous:null===(s=e.previous)||void 0===s?void 0:s.variableCostRatio,colorFn:eH.RP,isHigherBetter:!1,compact:t},"cost-ratio-".concat(e.key))})})}),(0,l.jsx)(t$,{title:"满期边贡额",description:"对比各业务线满期边贡额的环比变化",children:(0,l.jsx)("div",{className:(0,f.cn)("grid gap-3",n),children:o.map(e=>{var s;return(0,l.jsx)(t7,{label:e.label,value:e.contributionMarginAmount,previous:null===(s=e.previous)||void 0===s?void 0:s.contributionMarginAmount,unit:" 万元",decimals:2,compact:t},"margin-amount-".concat(e.key))})})}),(0,l.jsx)(t$,{title:"单均边贡额",description:"对比各业务线单均边贡额的环比变化",children:(0,l.jsx)("div",{className:(0,f.cn)("grid gap-3",n),children:c.map(e=>{var s;return(0,l.jsx)(t7,{label:e.label,value:e.averageContribution,previous:null===(s=e.previous)||void 0===s?void 0:s.averageContribution,unit:" 元",decimals:0,compact:t},"avg-contribution-".concat(e.key))})})})]}):(0,l.jsx)("div",{className:"rounded-xl border border-dashed border-slate-300 bg-slate-50 p-6 text-center text-sm text-slate-500",children:"当前筛选下暂无可用数据，请调整筛选条件后重试"})]})}function ss(e){return(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h2",{className:"text-base font-semibold text-slate-800",children:"业务类型经营趋势"}),(0,l.jsx)("p",{className:"text-xs text-slate-500",children:"横向对比各业务类型的规模、占比与经营指标,识别增长机会与风险点"})]}),(0,l.jsx)(t_,{})]})}function sl(e){let{currentKpis:t,compareKpis:s,timeProgress:a,annualPremiumTarget:r,compact:n=!1,className:i}=e;return(0,l.jsx)("div",{className:(0,f.cn)("w-full",i),children:(0,l.jsxs)(eT.mQ,{defaultValue:"premium",className:"w-full",children:[(0,l.jsxs)(eT.dr,{className:(0,f.cn)("grid w-full","grid-cols-3"),children:[(0,l.jsx)(eT.SP,{value:"premium",children:"保费分析"}),(0,l.jsx)(eT.SP,{value:"loss",children:"赔付分析"}),(0,l.jsx)(eT.SP,{value:"trend",children:"趋势分析"})]}),(0,l.jsx)(eT.nU,{value:"premium",className:"mt-4",children:(0,l.jsx)(t9,{currentKpis:t,compareKpis:s,timeProgress:a,annualPremiumTarget:r,compact:n})}),(0,l.jsx)(eT.nU,{value:"loss",className:"mt-4",children:(0,l.jsx)(se,{currentKpis:t,compareKpis:s,timeProgress:a,compact:n})}),(0,l.jsx)(eT.nU,{value:"trend",className:"mt-4",children:(0,l.jsx)(ss,{currentKpis:t,compareKpis:s,timeProgress:a,compact:n})}),(0,l.jsx)(eT.nU,{value:"contribution",className:"mt-4",children:(0,l.jsx)(st,{currentKpis:t,compareKpis:s,timeProgress:a,compact:n})})]})})}let sa=(e,t)=>e.length===t.length&&e.every((e,s)=>e===t[s]);function sr(){let e=(0,h.qr)(e=>e.filters),t=(0,h.qr)(e=>e.updateFilters),s=(0,h.qr)(e=>e.rawData),l=(0,a.useCallback)(()=>{if(!s||0===s.length)return;let l=Array.from(new Set(s.map(e=>e.policy_start_year))).sort(),a=new Date().getFullYear(),r=l.includes(a)?a:l[l.length-1],n=s.filter(e=>e.policy_start_year===r).map(e=>e.week_number).reduce((e,t)=>Math.max(e,t),0),i=n>0?n:null,o=n>0?Array.from({length:4},(e,t)=>n-t).filter(e=>e>0).sort((e,t)=>e-t):[],c="single"===e.viewMode?null!=i?[i]:[]:o,d={};0===e.years.length&&(d.years=[r]),null==e.singleModeWeek&&null!=i&&(d.singleModeWeek=i),0===e.trendModeWeeks.length&&o.length>0&&(d.trendModeWeeks=o),0===e.weeks.length&&(d.weeks=c),Object.keys(d).length>0&&t(d)},[s,e.viewMode,e.years.length,e.weeks.length,e.singleModeWeek,e.trendModeWeeks.length,t]),r=(0,a.useCallback)(()=>{if(s&&0!==s.length){if("single"===e.viewMode){let l=e.singleModeWeek;if(null==l){let t=e.weeks;if(t.length>0)l=t.reduce((e,t)=>Math.max(e,t),0);else if(e.trendModeWeeks.length>0)l=e.trendModeWeeks[e.trendModeWeeks.length-1];else{let t=s.filter(t=>!(e.years.length>0)||e.years.includes(t.policy_start_year)).map(e=>e.week_number);t.length>0&&(l=t.reduce((e,t)=>Math.max(e,t),0))}}let a={};e.singleModeWeek!==l&&(a.singleModeWeek=null!=l?l:null);let r=null!=l&&l>0?[l]:[];sa(e.weeks,r)||(a.weeks=r),Object.keys(a).length>0&&t(a)}else if("trend"===e.viewMode){let l=new Set;s.forEach(t=>{(0===e.years.length||e.years.includes(t.policy_start_year))&&l.add(t.week_number)});let a=Array.from(l).sort((e,t)=>e-t);if(0===a.length)return;let r=e.trendModeWeeks.filter(e=>a.includes(e)).sort((e,t)=>e-t);0===r.length&&(r=[...a]);let n={};sa(e.trendModeWeeks,r)||(n.trendModeWeeks=[...r]),sa(e.weeks,r)||(n.weeks=[...r]),Object.keys(n).length>0&&t(n)}}},[s,e.viewMode,e.years,e.weeks,e.singleModeWeek,e.trendModeWeeks,t]),n=(0,a.useCallback)(()=>{if(!s||0===s.length||0===e.years.length)return;let l=new Set;s.forEach(t=>{e.years.includes(t.policy_start_year)&&l.add(t.week_number)});let a=Array.from(l).sort((e,t)=>e-t),r=a.length>0?a[a.length-1]:null,n=null!=e.singleModeWeek&&a.includes(e.singleModeWeek)?e.singleModeWeek:r,i=e.trendModeWeeks.filter(e=>a.includes(e));0===i.length&&a.length>0&&(i=a.slice(-12));let o="single"===e.viewMode?null!=n?[n]:[]:i,c={};e.singleModeWeek!==n&&(c.singleModeWeek=null!=n?n:null),sa(e.trendModeWeeks,i)||(c.trendModeWeeks=i),sa(e.weeks,o)||(c.weeks=o),Object.keys(c).length>0&&t(c)},[s,e.years,e.viewMode,e.singleModeWeek,e.trendModeWeeks,e.weeks,t]),i=(0,a.useCallback)(()=>{"increment"===e.dataViewType&&e.weeks.length<2&&console.log("提示：周增量分析建议选择多个周期以获得更好的分析效果")},[e.dataViewType,e.weeks.length]),o=(0,a.useCallback)(()=>{if(!s||0===s.length||0===e.organizations.length)return;let l=s.filter(t=>e.organizations.includes(t.third_level_organization));if(0===l.length)return;let a=e=>new Set(l.map(e).filter(Boolean)),r=a(e=>e.business_type_category),n=a(e=>e.insurance_type),i=a(e=>e.coverage_type),o=a(e=>e.customer_category_3),c=a(e=>e.terminal_source),d=new Set(l.map(e=>e.is_new_energy_vehicle)),u=(e,t)=>{let s=e.filter(e=>t.has(e));return s.length>0?s:Array.from(t).sort((e,t)=>e.localeCompare(t,"zh-CN"))},m={},x=u(e.businessTypes,r);sa(e.businessTypes,x)||(m.businessTypes=x);let h=u(e.insuranceTypes,n);sa(e.insuranceTypes,h)||(m.insuranceTypes=h);let g=u(e.coverageTypes,i);sa(e.coverageTypes,g)||(m.coverageTypes=g);let p=u(e.customerCategories,o);sa(e.customerCategories,p)||(m.customerCategories=p);let b=u(e.terminalSources,c);sa(e.terminalSources,b)||(m.terminalSources=b),null==e.isNewEnergy||d.has(e.isNewEnergy)||(m.isNewEnergy=null),Object.keys(m).length>0&&t(m)},[s,e.organizations,e.businessTypes,e.insuranceTypes,e.coverageTypes,e.customerCategories,e.terminalSources,e.isNewEnergy,t]);return(0,a.useEffect)(()=>{l()},[l]),(0,a.useEffect)(()=>{r()},[r]),(0,a.useEffect)(()=>{n()},[n]),(0,a.useEffect)(()=>{i()},[i]),(0,a.useEffect)(()=>{o()},[o]),null}var sn=s(32522);function si(){let{filters:e,updateFilters:t}=(0,h.qr)(),{setDataViewType:s}=(0,sn.r)();e.dataViewType;let a=e=>{t({dataViewType:e}),s(e),console.log("[DataViewSelector] 切换数据视图类型: ".concat(e))};return(0,l.jsxs)("div",{className:"flex items-center bg-slate-100 rounded-lg p-1 shadow-sm border border-slate-200 transition-all duration-200",children:[(0,l.jsx)("button",{onClick:()=>a("current"),className:(0,f.cn)("px-3 py-1.5 text-sm font-medium rounded-md transition-all duration-200","current"===e.dataViewType?"bg-white text-blue-700 shadow-sm border border-blue-200":"text-slate-600 hover:text-slate-800 hover:bg-slate-50"),children:"年累计"}),(0,l.jsx)("button",{onClick:()=>a("increment"),className:(0,f.cn)("px-3 py-1.5 text-sm font-medium rounded-md transition-all duration-200","increment"===e.dataViewType?"bg-white text-blue-700 shadow-sm border border-blue-200":"text-slate-600 hover:text-slate-800 hover:bg-slate-50"),children:"周增量"})]})}var so=s(48753),sc=s(79250),sd=s(46053),su=s(76066);function sm(e){let{mode:t}=e,[s,r]=(0,a.useState)(!1),n=(0,a.useRef)(null),{filters:i,updateFilters:o,switchViewMode:d}=(0,su.a)(),u=(0,h.qr)(e=>e.rawData),m="flexible"===t,x=!m||"single"===i.viewMode,g=x?null!=i.singleModeWeek?[i.singleModeWeek]:[]:i.trendModeWeeks;(0,a.useEffect)(()=>{m||"single"===i.viewMode||d("single")},[m,i.viewMode,d]);let p=(0,h.lz)(u,i,["years"]),b=(0,h.lz)(u,i,["weeks"]),v=Array.from(new Set(p.map(e=>e.policy_start_year))).sort((e,t)=>t-e),y=Array.from(new Set(b.map(e=>e.week_number))).sort((e,t)=>e-t);(0,a.useEffect)(()=>{function e(e){n.current&&!n.current.contains(e.target)&&r(!1)}if(s)return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[s]);let j=e=>{o({years:i.years.includes(e)?i.years.filter(t=>t!==e):[...i.years,e]})},N=e=>{if(x){let t=i.singleModeWeek===e?null:e;o({singleModeWeek:t,weeks:null!=t?[t]:[]});return}let t=i.trendModeWeeks.includes(e)?i.trendModeWeeks.filter(t=>t!==e):[...i.trendModeWeeks,e].sort((e,t)=>e-t);o({trendModeWeeks:t,weeks:t})},w=i.years.length>0||g.length>0,_=v.length>3,k=m&&!x&&y.length>3;return(0,l.jsxs)("div",{className:"relative",ref:n,children:[(0,l.jsxs)("button",{onClick:()=>r(!s),className:(0,f.cn)("inline-flex items-center gap-2 px-3 py-1.5 rounded-md text-sm font-medium transition-all border",w?"bg-blue-50 border-blue-200 text-blue-700 hover:bg-blue-100":"bg-white border-slate-200 text-slate-600 hover:border-slate-300 hover:bg-slate-50"),children:[(0,l.jsx)(so.Z,{className:"w-4 h-4"}),(0,l.jsx)("span",{className:"whitespace-nowrap",children:(()=>{if(!w)return"时间";let e=[];return i.years.length>0&&(1===i.years.length?e.push("".concat(i.years[0],"年")):e.push("".concat(i.years.length,"个年度"))),g.length>0&&(1===g.length?e.push("W".concat(g[0])):e.push("".concat(g.length,"周"))),e.join(" \xb7 ")})()}),w&&(0,l.jsx)("div",{className:"flex items-center gap-1",children:(0,l.jsx)("span",{className:"text-xs bg-blue-200 text-blue-800 px-1.5 py-0.5 rounded-full",children:(i.years.length||0)+(g.length||0)})})]}),s&&(0,l.jsxs)("div",{className:"absolute top-full left-0 mt-2 w-80 bg-white rounded-lg shadow-lg border border-slate-200 z-50",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between p-3 border-b border-slate-200",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(so.Z,{className:"w-4 h-4 text-slate-600"}),(0,l.jsx)("h3",{className:"font-medium text-slate-900",children:"时间筛选"})]}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[w&&(0,l.jsx)("button",{onClick:()=>{o({years:[],weeks:[],singleModeWeek:null,trendModeWeeks:[]})},className:"text-xs text-blue-600 hover:text-blue-700 px-2 py-1 hover:bg-blue-50 rounded transition-colors",children:"清空"}),(0,l.jsx)("button",{onClick:()=>r(!1),className:"text-slate-400 hover:text-slate-600 p-1 hover:bg-slate-100 rounded transition-colors",children:(0,l.jsx)(c.Z,{className:"w-4 h-4"})})]})]}),(0,l.jsxs)("div",{className:"p-3 space-y-4 max-h-96 overflow-y-auto",children:[m&&(0,l.jsxs)("div",{className:"flex items-center justify-between p-2 bg-slate-50 rounded-md",children:[(0,l.jsx)("span",{className:"text-xs font-medium text-slate-700",children:"周序号选择模式"}),(0,l.jsx)("button",{onClick:()=>{"flexible"===t&&d("single"===i.viewMode?"trend":"single")},className:"flex items-center gap-2 text-xs text-blue-600 hover:text-blue-700 transition-colors",children:x?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(sc.Z,{className:"w-4 h-4"}),(0,l.jsx)("span",{children:"单选模式"})]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(sd.Z,{className:"w-4 h-4"}),(0,l.jsx)("span",{children:"多选模式"})]})})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"text-xs text-slate-600 mb-2 block",children:"保单年度"}),_&&(0,l.jsxs)("div",{className:"mb-2 flex flex-wrap gap-2",children:[(0,l.jsx)("button",{onClick:()=>{0!==v.length&&o({years:[...v]})},className:"text-xs text-blue-600 hover:text-blue-700 px-2 py-1 hover:bg-blue-50 rounded transition-colors",children:"全选"}),(0,l.jsx)("button",{onClick:()=>{0!==v.length&&o({years:v.filter(e=>!i.years.includes(e))})},className:"text-xs text-blue-600 hover:text-blue-700 px-2 py-1 hover:bg-blue-50 rounded transition-colors",children:"反选"}),(0,l.jsx)("button",{onClick:()=>{0!==i.years.length&&o({years:[]})},className:"text-xs text-blue-600 hover:text-blue-700 px-2 py-1 hover:bg-blue-50 rounded transition-colors",children:"清空"})]}),(0,l.jsx)("div",{className:"flex flex-wrap gap-2",children:v.map(e=>(0,l.jsxs)("button",{onClick:()=>j(e),className:(0,f.cn)("px-3 py-1.5 text-sm rounded-md border transition-colors",i.years.includes(e)?"bg-blue-50 border-blue-200 text-blue-700":"bg-white border-slate-200 text-slate-600 hover:border-slate-300"),children:[e,"年"]},e))})]}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("label",{className:"text-xs text-slate-600 mb-2 block",children:["周序号"," ",(0,l.jsxs)("span",{className:"text-slate-400",children:["(",y.length,"周可选)"]}),m&&!x&&(0,l.jsx)("span",{className:"ml-2 text-xs bg-blue-100 text-blue-700 px-2 py-0.5 rounded-full",children:"多选模式"})]}),k&&(0,l.jsxs)("div",{className:"mb-2 flex flex-wrap gap-2",children:[(0,l.jsx)("button",{onClick:()=>{0!==y.length&&(x||o({trendModeWeeks:[...y],weeks:[...y]}))},className:"text-xs text-blue-600 hover:text-blue-700 px-2 py-1 hover:bg-blue-50 rounded transition-colors",children:"全选"}),(0,l.jsx)("button",{onClick:()=>{if(0===y.length||x)return;let e=y.filter(e=>!i.trendModeWeeks.includes(e));o({trendModeWeeks:e,weeks:e})},className:"text-xs text-blue-600 hover:text-blue-700 px-2 py-1 hover:bg-blue-50 rounded transition-colors",children:"反选"}),(0,l.jsx)("button",{onClick:()=>{0!==g.length&&(x?o({singleModeWeek:null,weeks:[]}):o({trendModeWeeks:[],weeks:[]}))},className:"text-xs text-blue-600 hover:text-blue-700 px-2 py-1 hover:bg-blue-50 rounded transition-colors",children:"清空"})]}),(0,l.jsx)("div",{className:"grid grid-cols-7 gap-1.5",children:y.map(e=>(0,l.jsx)("button",{onClick:()=>N(e),className:(0,f.cn)("px-2 py-1.5 text-xs rounded border transition-colors",g.includes(e)?"bg-blue-50 border-blue-200 text-blue-700 font-medium":"bg-white border-slate-200 text-slate-600 hover:border-slate-300"),children:"W".concat(e)},e))}),x&&(0,l.jsx)("p",{className:"text-xs text-slate-500 mt-2",children:"单选模式：点击周序号进行选择，再次点击取消选择"})]})]}),(0,l.jsx)("div",{className:"p-3 border-t border-slate-200 bg-slate-50 text-xs text-slate-600",children:w?(0,l.jsxs)("span",{children:["已选择"," ",i.years.length>0&&(0,l.jsxs)("span",{className:"font-medium text-slate-700",children:[i.years.length,"个年度"]}),i.years.length>0&&g.length>0&&(0,l.jsx)("span",{children:" 和 "}),g.length>0&&(0,l.jsxs)("span",{className:"font-medium text-slate-700",children:[g.length,"周",!x&&g.length>1&&" (多选)"]})]}):(0,l.jsx)("span",{children:"未选择任何时间条件"})})]})]})}function sx(){let[e,t]=(0,a.useState)(!1),[s,r]=(0,a.useState)(""),n=(0,a.useRef)(null),i=(0,h.qr)(e=>e.filters),o=(0,h.qr)(e=>e.updateFilters),d=(0,h.qr)(e=>e.rawData),u=Array.from(new Set((0,h.lz)(d,i,["organizations"]).map(e=>(0,ej.Vd)(e.third_level_organization)))).filter(e=>e).sort(),m=s?u.filter(e=>e.toLowerCase().includes(s.toLowerCase())):u;(0,a.useEffect)(()=>{function s(e){n.current&&!n.current.contains(e.target)&&t(!1)}if(e)return document.addEventListener("mousedown",s),()=>{document.removeEventListener("mousedown",s)}},[e]);let x=e=>{let t=(0,ej.Vd)(e);o({organizations:i.organizations.includes(t)?i.organizations.filter(e=>e!==t):[...i.organizations,t]})},g=()=>{o({organizations:[]}),r("")},p=u.length>3,b=i.organizations.length>0;return(0,l.jsxs)("div",{ref:n,className:"relative",children:[(0,l.jsxs)("button",{onClick:()=>t(!e),className:(0,f.cn)("flex items-center gap-1.5 sm:gap-2 px-3 sm:px-4 py-2 text-xs sm:text-sm font-medium rounded-lg transition-all duration-200","border border-slate-300 bg-slate-50 text-slate-600 hover:bg-slate-100 hover:border-slate-400","focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1","shadow-sm hover:shadow-md",e&&"bg-slate-100 border-slate-400",i.organizations.length>0&&"border-blue-300 bg-blue-50 text-blue-700"),children:[(0,l.jsx)(ek.Z,{className:"h-3 w-3 sm:h-4 sm:w-4 flex-shrink-0"}),(0,l.jsx)("span",{className:"truncate max-w-[80px] sm:max-w-none",children:i.organizations.length>0?"已选 ".concat(i.organizations.length," 个"):"选择机构"}),i.organizations.length>0&&(0,l.jsx)("div",{className:"w-1.5 h-1.5 sm:w-2 sm:h-2 bg-blue-500 rounded-full flex-shrink-0"}),i.organizations.length>0&&(0,l.jsx)("div",{className:"flex items-center gap-1 ml-1",children:(0,l.jsx)("div",{className:"h-1 w-1 rounded-full bg-blue-500"})})]}),e&&(0,l.jsxs)("div",{className:"absolute top-full left-0 mt-2 w-80 bg-white rounded-lg shadow-lg border border-slate-200 z-50",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between p-3 border-b border-slate-200",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(ek.Z,{className:"w-4 h-4 text-slate-600"}),(0,l.jsx)("h3",{className:"font-medium text-slate-900",children:"三级机构筛选"})]}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[b&&(0,l.jsx)("button",{onClick:g,className:"text-xs text-blue-600 hover:text-blue-700 px-2 py-1 hover:bg-blue-50 rounded transition-colors",children:"清空"}),(0,l.jsx)("button",{onClick:()=>t(!1),className:"text-slate-400 hover:text-slate-600 p-1 hover:bg-slate-100 rounded transition-colors",children:(0,l.jsx)(c.Z,{className:"w-4 h-4"})})]})]}),(0,l.jsx)("div",{className:"p-3 border-b border-slate-200",children:(0,l.jsx)("input",{type:"text",placeholder:"搜索机构名称...",value:s,onChange:e=>r(e.target.value),className:"w-full px-3 py-2 text-sm border border-slate-200 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})}),(0,l.jsxs)("div",{className:"p-3 border-b border-slate-200 flex items-center justify-between",children:[(0,l.jsxs)("span",{className:"text-xs text-slate-600",children:[u.length," 个机构可选"]}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("button",{onClick:()=>{o({organizations:[...u]})},className:"text-xs text-blue-600 hover:text-blue-700 px-2 py-1 hover:bg-blue-50 rounded transition-colors",children:"全选"}),p&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("button",{onClick:()=>{0!==u.length&&o({organizations:u.filter(e=>!i.organizations.includes(e))})},className:"text-xs text-blue-600 hover:text-blue-700 px-2 py-1 hover:bg-blue-50 rounded transition-colors",children:"反选"}),(0,l.jsx)("button",{onClick:g,className:"text-xs text-blue-600 hover:text-blue-700 px-2 py-1 hover:bg-blue-50 rounded transition-colors",children:"清空"})]})]})]}),(0,l.jsx)("div",{className:"p-3 space-y-1 max-h-80 overflow-y-auto",children:m.length>0?m.map(e=>(0,l.jsxs)("button",{onClick:()=>x(e),className:(0,f.cn)("w-full flex items-center justify-between px-3 py-2 text-sm rounded-md border transition-colors",i.organizations.includes(e)?"bg-blue-50 border-blue-200 text-blue-700":"bg-white border-slate-200 text-slate-600 hover:border-slate-300"),children:[(0,l.jsx)("span",{children:e}),i.organizations.includes(e)&&(0,l.jsx)("svg",{className:"w-4 h-4 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})]},e)):(0,l.jsx)("div",{className:"text-center py-8 text-slate-500 text-sm",children:s?"未找到匹配的机构":"暂无可选机构"})}),(0,l.jsx)("div",{className:"p-3 border-t border-slate-200 bg-slate-50 text-xs text-slate-600",children:b?(0,l.jsxs)("span",{children:["已选择"," ",(0,l.jsx)("span",{className:"font-medium text-slate-700",children:i.organizations.length})," ","个机构"]}):(0,l.jsx)("span",{children:"未选择任何机构"})})]})]})}var sh=s(43242),sg=s(48134),sp=s(79471);function sb(e){let t=e.getFullYear(),s=e.getMonth()+1,l=e.getDate();return"".concat(t,"年").concat(s,"月").concat(l,"日")}function sf(e){var t,s;let{className:r,compact:n=!1}=e,i=(0,h.qr)(e=>e.rawData),o=(0,h.qr)(e=>e.filters.viewMode),c=(0,h.qr)(e=>e.filters.singleModeWeek),d=(0,h.qr)(e=>e.filters.years),u=(0,a.useMemo)(()=>{let e;let t={viewMode:o,singleModeWeek:c,years:d};if(0===i.length){let e=new Date,t=(0,sg.iR)(e);return{year:e.getFullYear(),weekNumber:Math.ceil(t/7),daysPassed:t,daysRemaining:365-t,progressPercent:t/365*100,startDate:new Date(e.getFullYear(),0,1),endDate:e,totalDays:365}}let s=null;if("single"===t.viewMode&&t.singleModeWeek&&(s=t.singleModeWeek),!s){let e=i.map(e=>e.week_number);s=e.length>0?(0,j.FT)(e):1}if(t.years.length>0)e=Math.max(...t.years);else{let t=i.map(e=>e.policy_start_year);e=t.length>0?(0,j.FT)(t):new Date().getFullYear()}let l=new Date(e,0,1),a=(0,sg.ke)(e,s),r=Math.floor((a.getTime()-l.getTime())/864e5)+1,n=31===new Date(e,11,31).getDate()&&e%4==0&&(e%100!=0||e%400==0)?366:365;return{year:e,weekNumber:s,daysPassed:r,daysRemaining:n-r,progressPercent:r/n*100,startDate:l,endDate:a,totalDays:n}},[i,o,c,d]),m=(t=u.progressPercent)<50?"bg-blue-500":t<=90?"bg-orange-500":"bg-red-500",x=(s=u.progressPercent)<50?"bg-blue-100":s<=90?"bg-orange-100":"bg-red-100";return n?(0,l.jsxs)("div",{className:(0,f.cn)("flex items-center gap-2 bg-slate-50 rounded-lg px-3 py-1.5 border border-slate-200",r),children:[(0,l.jsxs)("span",{className:"text-xs text-slate-600 whitespace-nowrap",children:["已过"," ",(0,l.jsx)("span",{className:"font-medium text-slate-700",children:u.daysPassed})," ","天 / 剩余"," ",(0,l.jsx)("span",{className:"font-medium text-slate-700",children:u.daysRemaining})," ","天",(0,l.jsxs)("span",{className:"ml-1 text-slate-500",children:["(",u.progressPercent.toFixed(1),"%)"]})]}),(0,l.jsx)("div",{className:"relative w-16 flex-shrink-0",children:(0,l.jsx)("div",{className:(0,f.cn)("h-1 rounded-full transition-all duration-200",x),children:(0,l.jsx)("div",{className:(0,f.cn)("h-full rounded-full transition-all duration-200",m),style:{width:"".concat(Math.min(u.progressPercent,100),"%")}})})})]}):(0,l.jsxs)("div",{className:(0,f.cn)("space-y-3",r),children:[(0,l.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center gap-3 sm:gap-4 text-sm",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2 text-slate-700",children:[(0,l.jsx)(so.Z,{className:"h-4 w-4 text-blue-600 flex-shrink-0"}),(0,l.jsxs)("span",{className:"font-medium",children:[u.year,"年第",u.weekNumber,"周"]})]}),(0,l.jsx)("div",{className:"hidden sm:block text-slate-400",children:"|"}),(0,l.jsxs)("div",{className:"flex items-center gap-2 text-slate-600",children:[(0,l.jsx)(sh.Z,{className:"h-4 w-4 text-slate-500 flex-shrink-0"}),(0,l.jsxs)("span",{className:"text-xs sm:text-sm",children:["已过"," ",(0,l.jsx)("span",{className:"font-medium text-slate-700",children:u.daysPassed})," ","天 / 剩余"," ",(0,l.jsx)("span",{className:"font-medium text-slate-700",children:u.daysRemaining})," ","天",(0,l.jsxs)("span",{className:"ml-1 text-slate-500",children:["(",u.progressPercent.toFixed(1),"%)"]})]})]}),(0,l.jsxs)(sp.u,{children:[(0,l.jsx)(sp.aJ,{asChild:!0,children:(0,l.jsx)(_.Z,{className:"h-4 w-4 text-slate-400 hover:text-slate-600 cursor-help transition-colors duration-200 flex-shrink-0"})}),(0,l.jsx)(sp._v,{side:"bottom",className:"max-w-xs",children:(0,l.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("strong",{children:"周期起始日期："}),sb(u.startDate)]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("strong",{children:"周期结束日期："}),sb(u.endDate)]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("strong",{children:"总天数："}),u.totalDays," 天"]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("strong",{children:"已过天数："}),u.daysPassed," 天"]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("strong",{children:"剩余天数："}),u.daysRemaining," 天"]})]})})]})]}),(0,l.jsx)("div",{className:"relative",children:(0,l.jsx)("div",{className:(0,f.cn)("h-1 sm:h-1 rounded-full transition-all duration-200",x),children:(0,l.jsx)("div",{className:(0,f.cn)("h-full rounded-full transition-all duration-200",m),style:{width:"".concat(Math.min(u.progressPercent,100),"%")}})})})]})}var sv=s(12643),sy=s(66066),sj=s(61511),sN=s(18661);function sw(e){let{title:t,children:s,onReset:a}=e;return(0,l.jsxs)("div",{className:"space-y-3",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between border-b border-slate-200 pb-2.5",children:[(0,l.jsx)("h3",{className:"text-sm font-bold text-slate-800",children:t}),a&&(0,l.jsxs)(sy.z,{variant:"ghost",size:"sm",onClick:a,className:"h-7 gap-1 rounded-lg px-2.5 text-xs font-medium text-slate-600 hover:bg-red-50 hover:text-red-600",children:[(0,l.jsx)(c.Z,{className:"h-3.5 w-3.5"}),"清除"]})]}),s]})}var s_=s(20753),sk=s(37145);let sC=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,l.jsx)(sk.mY,{ref:t,className:(0,f.cn)("flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",s),...a})});sC.displayName=sk.mY.displayName;let sS=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,l.jsxs)("div",{className:"flex items-center border-b px-3","cmdk-input-wrapper":"",children:[(0,l.jsx)(C.Z,{className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),(0,l.jsx)(sk.mY.Input,{ref:t,className:(0,f.cn)("flex h-10 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",s),...a})]})});sS.displayName=sk.mY.Input.displayName;let sM=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,l.jsx)(sk.mY.List,{ref:t,className:(0,f.cn)("max-h-[300px] overflow-y-auto overflow-x-hidden",s),...a})});sM.displayName=sk.mY.List.displayName;let sP=a.forwardRef((e,t)=>(0,l.jsx)(sk.mY.Empty,{ref:t,className:"py-6 text-center text-sm",...e}));sP.displayName=sk.mY.Empty.displayName;let sD=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,l.jsx)(sk.mY.Group,{ref:t,className:(0,f.cn)("overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",s),...a})});sD.displayName=sk.mY.Group.displayName,a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,l.jsx)(sk.mY.Separator,{ref:t,className:(0,f.cn)("-mx-1 h-px bg-border",s),...a})}).displayName=sk.mY.Separator.displayName;let sR=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,l.jsx)(sk.mY.Item,{ref:t,className:(0,f.cn)("relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected=true]:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",s),...a})});sR.displayName=sk.mY.Item.displayName;var sz=s(57040);function sT(e){let{options:t,selectedValues:s,onChange:r,placeholder:n="选择选项",searchPlaceholder:i="搜索...",emptyText:o="未找到选项",id:c}=e,[d,u]=(0,a.useState)(!1),m=(0,a.useId)(),x=c||m,h=t.map(e=>e.value),g=h.length>0&&s.length===h.length,p=t.length>3,b=t.length>=2&&t.length<=3,v=e=>{r(s.includes(e)?s.filter(t=>t!==e):[...s,e])},y=0===s.length?n:g?"全部":"已选 ".concat(s.length," 项");return b?(0,l.jsx)("div",{className:(0,f.cn)("grid gap-2",2===t.length?"grid-cols-2":"grid-cols-3"),children:t.map(e=>{let t=s.includes(e.value);return(0,l.jsx)("button",{onClick:()=>v(e.value),className:(0,f.cn)("px-3 py-2.5 text-sm font-medium rounded-xl transition-all duration-200","border-2 active:scale-95 whitespace-normal text-center",t?"bg-blue-500 border-blue-500 text-white shadow-lg shadow-blue-200":"bg-white border-slate-200 text-slate-700 hover:border-slate-300 active:bg-slate-50"),children:e.label},e.value)})}):(0,l.jsxs)(sz.J2,{open:d,onOpenChange:u,children:[(0,l.jsx)(sz.xo,{asChild:!0,children:(0,l.jsxs)(sy.z,{variant:"outline",role:"combobox","aria-expanded":d,className:(0,f.cn)("w-full justify-between h-11 rounded-xl border-2 font-medium transition-all",s.length>0?"border-blue-500 text-blue-600 bg-blue-50 hover:bg-blue-100":"border-slate-200 text-slate-700 hover:border-slate-300"),children:[(0,l.jsx)("span",{className:(0,f.cn)("truncate",s.length>0&&"text-blue-600 font-semibold"),children:y}),(0,l.jsx)(s_.Z,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),(0,l.jsx)(sz.yk,{className:"w-full p-0 rounded-2xl shadow-xl border-2",align:"start",children:(0,l.jsxs)(sC,{className:"rounded-2xl",children:[(0,l.jsx)(sS,{id:"".concat(x,"-search"),name:"".concat(x,"-search"),placeholder:i,className:"h-12 text-base"}),p&&(0,l.jsx)("div",{className:"border-b border-slate-100 bg-slate-50/50 px-3 py-2.5",children:(0,l.jsxs)("div",{className:"flex gap-2 overflow-x-auto scrollbar-thin scrollbar-thumb-slate-300 scrollbar-track-transparent pb-1",children:[(0,l.jsx)("button",{onClick:()=>{0!==h.length&&r(h)},className:(0,f.cn)("flex-shrink-0 px-4 py-2 text-sm font-medium rounded-lg transition-all","border-2 active:scale-95",g?"bg-blue-500 border-blue-500 text-white shadow-md":"bg-white border-slate-200 text-slate-700 hover:border-blue-300 hover:text-blue-600"),children:"全选"}),(0,l.jsx)("button",{onClick:()=>{0!==h.length&&r(h.filter(e=>!s.includes(e)))},className:"flex-shrink-0 px-4 py-2 text-sm font-medium rounded-lg transition-all bg-white border-2 border-slate-200 text-slate-700 hover:border-blue-300 hover:text-blue-600 active:scale-95",children:"反选"}),(0,l.jsx)("button",{onClick:()=>{0!==s.length&&r([])},disabled:0===s.length,className:(0,f.cn)("flex-shrink-0 px-4 py-2 text-sm font-medium rounded-lg transition-all border-2 active:scale-95",s.length>0?"bg-white border-slate-200 text-slate-700 hover:border-red-300 hover:text-red-600":"bg-slate-50 border-slate-100 text-slate-400 cursor-not-allowed"),children:"清空"})]})}),(0,l.jsxs)(sM,{children:[(0,l.jsx)(sP,{className:"py-6 text-center text-sm text-slate-500",children:o}),(0,l.jsx)(sD,{className:"p-2",children:t.map(e=>{let t=s.includes(e.value);return(0,l.jsxs)(sR,{onSelect:()=>v(e.value),className:(0,f.cn)("cursor-pointer rounded-lg px-3 py-2.5 mb-1 transition-all",t?"bg-blue-50 text-blue-700 font-semibold":"text-slate-700 hover:bg-slate-50"),children:[(0,l.jsx)("div",{className:(0,f.cn)("mr-3 flex h-5 w-5 items-center justify-center rounded-md border-2 transition-all flex-shrink-0",t?"bg-blue-500 border-blue-500":"border-slate-300"),children:t&&(0,l.jsx)(tu.Z,{className:"h-3.5 w-3.5 text-white"})}),(0,l.jsx)("span",{className:(0,f.cn)("break-words",t&&"text-blue-700"),children:e.label})]},e.value)})})]})]})})]})}function sW(){let e=(0,h.qr)(e=>e.filters),t=(0,h.qr)(e=>e.updateFilters),s=(0,h.qr)(e=>e.rawData),a=new Set((0,h.lz)(s,e,["insuranceTypes"]).map(e=>String(e.insurance_type)).filter(e=>!!e)),r=en.Xs.filter(e=>a.has(e)).sort((e,t)=>e.localeCompare(t,"zh-CN")).map(e=>({label:e,value:e})),n=new Set((0,h.lz)(s,e,["businessTypes"]).map(e=>(0,en.gX)(e.business_type_category))),i=en.AL.filter(e=>n.has(e)).map(e=>({label:(0,en.gW)(e),value:e})),o=new Set((0,h.lz)(s,e,["coverageTypes"]).map(e=>String(e.coverage_type)).filter(e=>!!e)),c=en.rG.filter(e=>o.has(e)).sort((e,t)=>e.localeCompare(t,"zh-CN")).map(e=>({label:e,value:e})),d=e.insuranceTypes.length>0||e.businessTypes.length>0||e.coverageTypes.length>0;return(0,l.jsx)("div",{className:"rounded-2xl border-2 border-slate-200 bg-white p-5",children:(0,l.jsx)(sw,{title:"产品维度",onReset:d?()=>{t({insuranceTypes:[],businessTypes:[],coverageTypes:[]})}:void 0,children:(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"mb-2 block text-sm font-medium text-slate-700",children:"保险类型"}),(0,l.jsx)(sT,{id:"product-filter-insurance-type",options:r,selectedValues:e.insuranceTypes,onChange:e=>{t({insuranceTypes:e})},placeholder:"选择险种",searchPlaceholder:"搜索险种...",emptyText:"未找到险种"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"mb-2 block text-sm font-medium text-slate-700",children:"业务类型"}),(0,l.jsx)(sT,{id:"product-filter-business-type",options:i,selectedValues:e.businessTypes,onChange:e=>{t({businessTypes:e})},placeholder:"选择业务类型",searchPlaceholder:"搜索业务类型...",emptyText:"未找到业务类型"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"mb-2 block text-sm font-medium text-slate-700",children:"险别组合"}),(0,l.jsx)(sT,{id:"product-filter-coverage-type",options:c,selectedValues:e.coverageTypes,onChange:e=>{t({coverageTypes:e})},placeholder:"选择险别组合",searchPlaceholder:"搜索险别组合...",emptyText:"未找到险别组合"})]})]})})})}function sE(){let e=(0,h.qr)(e=>e.filters),t=(0,h.qr)(e=>e.updateFilters),s=(0,h.qr)(e=>e.rawData),a=new Set((0,h.lz)(s,e,["customerCategories"]).map(e=>(0,ej.Vd)(e.customer_category_3)).filter(e=>!!e)),r=en.iZ.filter(e=>a.has(e)).sort((e,t)=>e.localeCompare(t,"zh-CN")).map(e=>({label:e,value:e})),n=(0,h.lz)(s,e,["vehicleGrades"]).map(e=>e.vehicle_insurance_grade).filter(e=>null!=e&&"X"!==e&&""!==e.trim()).reduce((e,t)=>(e.includes(t)||e.push(t),e),[]).sort().map(e=>({label:e,value:e})),i=(0,h.lz)(s,e,["renewalStatuses"]),o=(()=>{let e=new Set(i.map(e=>String(e.renewal_status)).filter(e=>!!e));return en.rj.filter(t=>e.has(t)).sort((e,t)=>e.localeCompare(t,"zh-CN")).map(e=>({label:e,value:e}))})(),c=e.customerCategories.length>0||e.vehicleGrades.length>0||e.renewalStatuses.length>0;return(0,l.jsx)("div",{className:"rounded-2xl border-2 border-slate-200 bg-white p-5",children:(0,l.jsx)(sw,{title:"客户维度",onReset:c?()=>{t({customerCategories:[],vehicleGrades:[],renewalStatuses:[]})}:void 0,children:(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"mb-2 block text-sm font-medium text-slate-700",children:"客户分类"}),(0,l.jsx)(sT,{id:"customer-filter-category",options:r,selectedValues:e.customerCategories,onChange:e=>{t({customerCategories:e})},placeholder:"选择客户分类",searchPlaceholder:"搜索客户分类...",emptyText:"未找到客户分类"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"mb-2 block text-sm font-medium text-slate-700",children:"车险评级"}),(0,l.jsx)(sT,{id:"customer-filter-vehicle-grade",options:n,selectedValues:e.vehicleGrades,onChange:e=>{t({vehicleGrades:e})},placeholder:"选择车险评级",searchPlaceholder:"搜索车险评级...",emptyText:"未找到车险评级"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"mb-2 block text-sm font-medium text-slate-700",children:"新续转状态"}),(0,l.jsx)(sT,{id:"customer-filter-renewal-status",options:o,selectedValues:e.renewalStatuses,onChange:e=>{t({renewalStatuses:e})},placeholder:"选择新续转状态",searchPlaceholder:"搜索状态...",emptyText:"未找到状态"})]})]})})})}function sF(){let e=(0,h.qr)(e=>e.filters),t=(0,h.qr)(e=>e.updateFilters),s=(0,h.qr)(e=>e.rawData),a=new Set((0,h.lz)(s,e,["terminalSources"]).map(e=>(0,ej.Vd)(e.terminal_source)).filter(e=>!!e)),r=en.Dm.filter(e=>a.has(e)).sort((e,t)=>e.localeCompare(t,"zh-CN")).map(e=>({label:e,value:e})),n=e=>{t({isNewEnergy:e})},i=e.terminalSources.length>0||null!==e.isNewEnergy;return(0,l.jsx)("div",{className:"rounded-2xl border-2 border-slate-200 bg-white p-5",children:(0,l.jsx)(sw,{title:"渠道维度",onReset:i?()=>{t({terminalSources:[],isNewEnergy:null})}:void 0,children:(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"mb-2 block text-sm font-medium text-slate-700",children:"终端来源"}),(0,l.jsx)(sT,{id:"channel-filter-terminal-source",options:r,selectedValues:e.terminalSources,onChange:e=>{t({terminalSources:e})},placeholder:"选择终端来源",searchPlaceholder:"搜索终端来源...",emptyText:"未找到终端来源"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"mb-2 block text-sm font-medium text-slate-700",children:"新能源车状态"}),(0,l.jsxs)("div",{className:"grid grid-cols-3 gap-2",children:[(0,l.jsx)("button",{onClick:()=>n(null),className:(0,f.cn)("px-3 py-2.5 text-sm font-medium rounded-xl transition-all duration-200","border-2 active:scale-95 whitespace-normal text-center",null===e.isNewEnergy?"bg-blue-500 border-blue-500 text-white shadow-lg shadow-blue-200":"bg-white border-slate-200 text-slate-700 hover:border-slate-300 active:bg-slate-50"),children:"全部"}),(0,l.jsx)("button",{onClick:()=>n(!0),className:(0,f.cn)("px-3 py-2.5 text-sm font-medium rounded-xl transition-all duration-200","border-2 active:scale-95 whitespace-normal text-center",!0===e.isNewEnergy?"bg-blue-500 border-blue-500 text-white shadow-lg shadow-blue-200":"bg-white border-slate-200 text-slate-700 hover:border-slate-300 active:bg-slate-50"),children:"新能源车"}),(0,l.jsx)("button",{onClick:()=>n(!1),className:(0,f.cn)("px-3 py-2.5 text-sm font-medium rounded-xl transition-all duration-200","border-2 active:scale-95 whitespace-normal text-center",!1===e.isNewEnergy?"bg-blue-500 border-blue-500 text-white shadow-lg shadow-blue-200":"bg-white border-slate-200 text-slate-700 hover:border-slate-300 active:bg-slate-50"),children:"非新能源车"})]})]})]})})})}var sL=s(37027),sA=s(46186),sZ=s(86304);let sY="insurance-analytics-filter-presets";function sO(){let e=(0,h.qr)(e=>e.filters),t=(0,h.qr)(e=>e.updateFilters),{presets:s,createPreset:r,deletePreset:n,applyPreset:i,getMostUsedPresets:o,getRecentPresets:c,exportPresets:d}=function(){let[e,t]=(0,a.useState)([]),[s,l]=(0,a.useState)(!0);(0,a.useEffect)(()=>{try{let e=localStorage.getItem(sY);if(e){let s=JSON.parse(e);t(s)}}catch(e){console.error("加载筛选预设失败:",e)}finally{l(!1)}},[]);let r=(0,a.useCallback)(e=>{try{localStorage.setItem(sY,JSON.stringify(e))}catch(e){console.error("保存筛选预设失败:",e)}},[]),n=(0,a.useCallback)((s,l,a)=>{let n={id:"preset_".concat(Date.now(),"_").concat(Math.random().toString(36).slice(2,9)),name:s,description:a,filters:{...l},createdAt:new Date().toISOString(),useCount:0},i=[...e,n];return t(i),r(i),n},[e,r]),i=(0,a.useCallback)((s,l)=>{let a=e.map(e=>e.id===s?{...e,...l}:e);t(a),r(a)},[e,r]),o=(0,a.useCallback)(s=>{let l=e.filter(e=>e.id!==s);t(l),r(l)},[e,r]),c=(0,a.useCallback)(s=>{let l=e.find(e=>e.id===s);if(!l)return null;let a=e.map(e=>e.id===s?{...e,lastUsedAt:new Date().toISOString(),useCount:e.useCount+1}:e);return t(a),r(a),l.filters},[e,r]),d=(0,a.useCallback)(t=>e.find(e=>e.id===t),[e]),u=(0,a.useCallback)(function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;return[...e].sort((e,t)=>t.useCount-e.useCount).slice(0,t)},[e]),m=(0,a.useCallback)(function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;return[...e].filter(e=>e.lastUsedAt).sort((e,t)=>new Date(t.lastUsedAt).getTime()-new Date(e.lastUsedAt).getTime()).slice(0,t)},[e]),x=(0,a.useCallback)(()=>{t([]),r([])},[r]),h=(0,a.useCallback)(()=>{let t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),s=URL.createObjectURL(t),l=document.createElement("a");l.href=s,l.download="filter-presets-".concat(new Date().toISOString().split("T")[0],".json"),l.click(),URL.revokeObjectURL(s)},[e]),g=(0,a.useCallback)(function(s){let l=!(arguments.length>1)||void 0===arguments[1]||arguments[1],a=l?[...e,...s]:s;t(a),r(a)},[e,r]);return{presets:e,isLoading:s,createPreset:n,updatePreset:i,deletePreset:o,applyPreset:c,getPreset:d,getMostUsedPresets:u,getRecentPresets:m,clearAllPresets:x,exportPresets:h,importPresets:g}}(),[m,x]=(0,a.useState)(!1),[g,p]=(0,a.useState)(!1),[b,v]=(0,a.useState)(""),[y,j]=(0,a.useState)(""),[N,w]=(0,a.useState)("all"),_=e=>{let s=i(e.id);s&&(t(s),x(!1))},C=(e,t)=>{t.stopPropagation(),confirm("确定要删除这个筛选预设吗？")&&n(e)},S=(()=>{switch(N){case"frequent":return o();case"recent":return c();default:return s}})(),M=e.years.length>0||e.weeks.length>0||e.organizations.length>0||e.insuranceTypes.length>0||e.businessTypes.length>0||e.coverageTypes.length>0||e.customerCategories.length>0||e.vehicleGrades.length>0||e.terminalSources.length>0||e.renewalStatuses.length>0||null!==e.isNewEnergy;return(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsxs)(sj.Vq,{open:g,onOpenChange:p,children:[(0,l.jsx)(sj.hg,{asChild:!0,children:(0,l.jsxs)("button",{className:(0,f.cn)("inline-flex items-center gap-2 rounded-lg border px-3 py-2 text-sm font-medium transition-all",M?"border-blue-200 bg-blue-50 text-blue-700 hover:bg-blue-100":"border-slate-200 bg-white text-slate-400 cursor-not-allowed"),disabled:!M,title:M?"保存当前筛选条件":"当前没有筛选条件",children:[(0,l.jsx)(sL.Z,{className:"h-4 w-4"}),"保存筛选"]})}),(0,l.jsxs)(sj.cZ,{children:[(0,l.jsxs)(sj.fK,{children:[(0,l.jsx)(sj.$N,{children:"保存筛选预设"}),(0,l.jsx)(sj.Be,{children:"为当前筛选条件创建一个预设，方便下次快速使用"})]}),(0,l.jsxs)("div",{className:"space-y-4 py-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("label",{className:"mb-2 block text-sm font-medium text-slate-700",children:["预设名称 ",(0,l.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,l.jsx)("input",{type:"text",value:b,onChange:e=>v(e.target.value),placeholder:"例如：2024年高新区商业险",className:"w-full rounded-lg border border-slate-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-100",maxLength:50})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"mb-2 block text-sm font-medium text-slate-700",children:"描述（可选）"}),(0,l.jsx)("textarea",{value:y,onChange:e=>j(e.target.value),placeholder:"简要描述这个筛选条件的用途...",className:"w-full rounded-lg border border-slate-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-100",rows:3,maxLength:200})]}),(0,l.jsxs)("div",{className:"rounded-lg border border-slate-200 bg-slate-50 p-3",children:[(0,l.jsx)("p",{className:"mb-2 text-xs font-semibold text-slate-700",children:"当前筛选条件："}),(0,l.jsxs)("div",{className:"space-y-1 text-xs text-slate-600",children:[e.years.length>0&&(0,l.jsxs)("div",{children:["• 年度: ",e.years.join(", ")]}),e.weeks.length>0&&(0,l.jsxs)("div",{children:["• 周次: ",e.weeks.join(", ")]}),e.organizations.length>0&&(0,l.jsxs)("div",{children:["• 机构: ",e.organizations.join(", ")]}),e.insuranceTypes.length>0&&(0,l.jsxs)("div",{children:["• 险种: ",e.insuranceTypes.join(", ")]})]})]})]}),(0,l.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,l.jsx)("button",{onClick:()=>p(!1),className:"rounded-lg border border-slate-200 px-4 py-2 text-sm font-medium text-slate-700 hover:bg-slate-50",children:"取消"}),(0,l.jsx)("button",{onClick:()=>{b.trim()&&(r(b.trim(),e,y.trim()||void 0),v(""),j(""),p(!1))},className:"rounded-lg bg-blue-600 px-4 py-2 text-sm font-medium text-white hover:bg-blue-700",children:"保存预设"})]})]})]}),(0,l.jsxs)(sj.Vq,{open:m,onOpenChange:x,children:[(0,l.jsx)(sj.hg,{asChild:!0,children:(0,l.jsxs)("button",{className:(0,f.cn)("inline-flex items-center gap-2 rounded-lg border px-3 py-2 text-sm font-medium transition-all",s.length>0?"border-slate-200 bg-white text-slate-700 hover:bg-slate-50":"border-slate-200 bg-white text-slate-400 cursor-not-allowed"),disabled:0===s.length,title:s.length>0?"加载已保存的筛选预设":"暂无保存的预设",children:[(0,l.jsx)(sA.Z,{className:"h-4 w-4"}),"加载预设",s.length>0&&(0,l.jsx)("span",{className:"ml-1 rounded-full bg-blue-100 px-2 py-0.5 text-xs font-semibold text-blue-700",children:s.length})]})}),(0,l.jsxs)(sj.cZ,{className:"max-w-2xl",children:[(0,l.jsxs)(sj.fK,{children:[(0,l.jsx)(sj.$N,{children:"筛选预设管理"}),(0,l.jsx)(sj.Be,{children:"选择一个预设快速应用筛选条件，或管理已保存的预设"})]}),(0,l.jsxs)("div",{className:"flex gap-1 border-b border-slate-200",children:[(0,l.jsxs)("button",{onClick:()=>w("all"),className:(0,f.cn)("px-4 py-2 text-sm font-medium transition-colors","all"===N?"border-b-2 border-blue-600 text-blue-600":"text-slate-600 hover:text-slate-900"),children:["全部 (",s.length,")"]}),(0,l.jsxs)("button",{onClick:()=>w("frequent"),className:(0,f.cn)("inline-flex items-center gap-1 px-4 py-2 text-sm font-medium transition-colors","frequent"===N?"border-b-2 border-blue-600 text-blue-600":"text-slate-600 hover:text-slate-900"),children:[(0,l.jsx)(sZ.Z,{className:"h-4 w-4"}),"常用"]}),(0,l.jsxs)("button",{onClick:()=>w("recent"),className:(0,f.cn)("inline-flex items-center gap-1 px-4 py-2 text-sm font-medium transition-colors","recent"===N?"border-b-2 border-blue-600 text-blue-600":"text-slate-600 hover:text-slate-900"),children:[(0,l.jsx)(sh.Z,{className:"h-4 w-4"}),"最近"]})]}),(0,l.jsx)("div",{className:"max-h-[400px] space-y-2 overflow-y-auto py-4",children:0===S.length?(0,l.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[(0,l.jsx)(sA.Z,{className:"mb-3 h-12 w-12 text-slate-300"}),(0,l.jsx)("p",{className:"text-sm font-medium text-slate-600",children:"all"===N?"暂无保存的筛选预设":"frequent"===N?"暂无常用预设":"暂无最近使用的预设"}),(0,l.jsx)("p",{className:"mt-1 text-xs text-slate-500",children:"点击“保存筛选”按钮创建第一个预设"})]}):S.map(e=>(0,l.jsx)("div",{onClick:()=>_(e),className:"group relative flex cursor-pointer items-start gap-3 rounded-lg border border-slate-200 bg-white p-3 transition-all hover:border-blue-300 hover:bg-blue-50",children:(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("h4",{className:"font-medium text-slate-800",children:e.name}),(0,l.jsx)("button",{onClick:t=>C(e.id,t),className:"opacity-0 transition-opacity group-hover:opacity-100",title:"删除预设",children:(0,l.jsx)(u.Z,{className:"h-4 w-4 text-red-500 hover:text-red-700"})})]}),e.description&&(0,l.jsx)("p",{className:"mt-1 text-xs text-slate-600",children:e.description}),(0,l.jsxs)("div",{className:"mt-2 flex items-center gap-3 text-xs text-slate-500",children:[e.useCount>0&&(0,l.jsxs)("span",{className:"flex items-center gap-1",children:[(0,l.jsx)(sZ.Z,{className:"h-3 w-3"}),"使用",e.useCount,"次"]}),e.lastUsedAt&&(0,l.jsxs)("span",{className:"flex items-center gap-1",children:[(0,l.jsx)(sh.Z,{className:"h-3 w-3"}),new Date(e.lastUsedAt).toLocaleDateString()]})]})]})},e.id))}),s.length>0&&(0,l.jsxs)("div",{className:"flex justify-between border-t border-slate-200 pt-4",children:[(0,l.jsxs)("button",{onClick:d,className:"inline-flex items-center gap-2 text-sm text-slate-600 hover:text-slate-900",children:[(0,l.jsx)(k.Z,{className:"h-4 w-4"}),"导出预设"]}),(0,l.jsx)("button",{onClick:()=>x(!1),className:"rounded-lg border border-slate-200 px-4 py-2 text-sm font-medium text-slate-700 hover:bg-slate-50",children:"关闭"})]})]})]})]})}var sq=s(68464);function sI(){let e=(0,h.qr)(e=>e.filters),t=(0,h.qr)(e=>e.rawData),s=ey(),[r,n]=(0,a.useState)({type:"info",message:"",show:!1});return((0,a.useEffect)(()=>{if(!t||0===t.length){n({type:"info",message:"",show:!1});return}let l=t.length,a=s.length,r=a/l,i={type:"info",message:"",show:!1};if(0===a?i={type:"warning",message:"当前筛选条件未找到匹配数据，请尝试调整筛选条件",show:!0}:r<.01?i={type:"warning",message:"筛选结果仅占总数据的 ".concat((100*r).toFixed(1),"%，数据样本较小，分析结果可能不够全面"),show:!0}:r>.9&&(i={type:"tip",message:"当前筛选条件较宽泛，可以尝试添加更多筛选条件以获得更精准的分析",show:!0}),"trend"===e.viewMode&&e.weeks.length<2&&(i={type:"tip",message:"趋势分析模式建议选择多个周期，以便观察数据变化趋势",show:!0}),"increment"===e.dataViewType&&e.weeks.length<2&&(i={type:"warning",message:"周增量分析需要选择至少2个周期才能计算增量变化",show:!0}),e.years.length>1){let t=e.years.reduce((e,t)=>Math.max(e,t),-1/0)-e.years.reduce((e,t)=>Math.min(e,t),1/0);t>2&&(i={type:"tip",message:"当前选择了跨度 ".concat(t+1," 年的数据，建议关注年度间的业务变化趋势"),show:!0})}if(!1===i.show&&a>0&&(i={type:"success",message:"已筛选出 ".concat(a.toLocaleString()," 条数据记录，占总数据的 ").concat((100*r).toFixed(1),"%"),show:!0}),n(i),"success"===i.type||"tip"===i.type){let e=setTimeout(()=>{n(e=>({...e,show:!1}))},5e3);return()=>clearTimeout(e)}},[t,s,e]),r.show)?(0,l.jsxs)(tM.bZ,{className:"mb-4 ".concat((()=>{switch(r.type){case"warning":return"border-amber-200 bg-amber-50 text-amber-800";case"success":return"border-green-200 bg-green-50 text-green-800";case"tip":return"border-blue-200 bg-blue-50 text-blue-800";default:return"border-slate-200 bg-slate-50 text-slate-800"}})()),children:[(()=>{switch(r.type){case"warning":return(0,l.jsx)(sq.Z,{className:"w-4 h-4"});case"success":return(0,l.jsx)(P.Z,{className:"w-4 h-4"});case"tip":return(0,l.jsx)(W.Z,{className:"w-4 h-4"});default:return(0,l.jsx)(_.Z,{className:"w-4 h-4"})}})(),(0,l.jsx)(tM.X,{className:"ml-2",children:r.message})]}):null}function sV(){let e=(0,h.qr)(e=>e.filters),t=(0,h.qr)(e=>e.rawData),s=ey();if(!t||0===t.length)return null;let a=t.length,r=s.length,n=(r/a*100).toFixed(1),i=[e.years.length>0?"年份":null,e.weeks.length>0?"周期":null,e.organizations.length>0?"组织":null,e.insuranceTypes.length>0?"险种":null,e.businessTypes.length>0?"业务类型":null,e.coverageTypes.length>0?"保障类型":null,e.customerCategories.length>0?"客户类别":null,e.vehicleGrades.length>0?"车辆等级":null,e.terminalSources.length>0?"终端来源":null,null!==e.isNewEnergy?"新能源":null,e.renewalStatuses.length>0?"续保状态":null].filter(Boolean);return(0,l.jsxs)("div",{className:"flex items-center gap-4 text-sm text-slate-600 mb-4",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("span",{className:"font-medium",children:"筛选结果:"}),(0,l.jsx)("span",{className:"text-blue-600 font-semibold",children:r.toLocaleString()}),(0,l.jsx)("span",{children:"条记录"}),(0,l.jsxs)("span",{className:"text-slate-400",children:["(",n,"%)"]})]}),i.length>0&&(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("span",{children:"活跃筛选器:"}),(0,l.jsx)("span",{className:"text-green-600 font-medium",children:i.length}),(0,l.jsxs)("span",{className:"text-slate-400",children:["(",i.join(", "),")"]})]})]})}function sB(){let e=(0,sn.r)(e=>e.filters),t=(0,sn.r)(e=>e.resetFilters),s=(0,h.qr)(e=>e.resetFilters),a=e.insuranceTypes.length>0||e.businessTypes.length>0||e.coverageTypes.length>0||e.customerCategories.length>0||e.vehicleGrades.length>0||e.renewalStatuses.length>0||e.terminalSources.length>0||null!==e.isNewEnergy;return(0,l.jsxs)("div",{className:"rounded-3xl border-2 border-slate-200 bg-white p-8 shadow-xl",children:[(0,l.jsx)(sI,{}),(0,l.jsx)(sV,{}),(0,l.jsxs)("div",{className:"mb-8 flex items-center justify-between border-b-2 border-slate-100 pb-6",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsx)("div",{className:"rounded-xl bg-blue-50 p-2.5",children:(0,l.jsx)(sv.Z,{className:"h-6 w-6 text-blue-600"})}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h2",{className:"text-xl font-bold text-slate-800",children:"业务维度筛选"}),a&&(0,l.jsx)("p",{className:"text-sm text-slate-500 mt-0.5",children:"已应用筛选条件"})]})]}),a&&(0,l.jsxs)(sy.z,{variant:"outline",size:"lg",onClick:()=>{t(),s()},className:"gap-2 rounded-xl border-2 font-semibold",children:[(0,l.jsx)(sN.Z,{className:"h-4 w-4"})," 重置全部"]})]}),(0,l.jsx)("div",{className:"mb-6",children:(0,l.jsx)(sO,{})}),(0,l.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,l.jsx)(sW,{}),(0,l.jsx)(sE,{}),(0,l.jsx)(sF,{})]})]})}function sK(){let[e,t]=(0,a.useState)(!1);return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(sy.z,{variant:"outline",size:"sm",onClick:()=>t(!0),className:"gap-2 border-slate-300 hover:border-slate-400",children:[(0,l.jsx)(sv.Z,{className:"w-4 h-4"}),"更多筛选"]}),(0,l.jsx)(sj.Vq,{open:e,onOpenChange:t,children:(0,l.jsxs)(sj.cZ,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[(0,l.jsx)(sj.fK,{children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)(sj.$N,{className:"text-xl font-bold text-slate-800",children:"更多筛选"}),(0,l.jsx)(sj.Be,{className:"text-slate-600",children:"精细筛选业务数据，快速定位目标信息"})]}),(0,l.jsx)(sy.z,{variant:"ghost",size:"sm",onClick:()=>t(!1),className:"p-1 h-8 w-8",children:(0,l.jsx)(c.Z,{className:"w-4 h-4"})})]})}),(0,l.jsx)("div",{className:"mt-6",children:(0,l.jsx)(sB,{})})]})})]})}function sG(e){let{rawCount:t,activeTab:s}=e;return(0,l.jsx)("div",{className:"bg-white border-b border-slate-200",children:(0,l.jsx)("div",{className:"px-4 sm:px-6 py-3 sm:py-4",children:(0,l.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center gap-3",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3 flex-shrink-0",children:[(0,l.jsx)(sm,{mode:"cockpit"===s||"trend"===s||"multichart"===s?"flexible":"single-only"}),(0,l.jsx)(si,{})]}),(0,l.jsxs)("div",{className:"flex items-center gap-3 flex-wrap lg:flex-nowrap",children:[(0,l.jsx)(sx,{}),(0,l.jsx)(sf,{compact:!0}),(0,l.jsx)(sK,{})]})]})})})}var sU=s(83154);let sX=sU.zt,sH=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,l.jsx)(sU.l_,{ref:t,className:(0,f.cn)("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",s),...a})});sH.displayName=sU.l_.displayName;let sJ=(0,tk.j)("group pointer-events-auto relative flex w-full items-center justify-between space-x-2 overflow-hidden rounded-md border p-4 pr-6 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),sQ=a.forwardRef((e,t)=>{let{className:s,variant:a,...r}=e;return(0,l.jsx)(sU.fC,{ref:t,className:(0,f.cn)(sJ({variant:a}),s),...r})});sQ.displayName=sU.fC.displayName,a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,l.jsx)(sU.aU,{ref:t,className:(0,f.cn)("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium transition-colors hover:bg-secondary focus:outline-none focus:ring-1 focus:ring-ring disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",s),...a})}).displayName=sU.aU.displayName;let s$=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,l.jsx)(sU.x8,{ref:t,className:(0,f.cn)("absolute right-1 top-1 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-1 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",s),"toast-close":"",...a,children:(0,l.jsx)(c.Z,{className:"h-4 w-4"})})});s$.displayName=sU.x8.displayName;let s0=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,l.jsx)(sU.Dx,{ref:t,className:(0,f.cn)("text-sm font-semibold [&+div]:text-xs",s),...a})});s0.displayName=sU.Dx.displayName;let s1=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,l.jsx)(sU.dk,{ref:t,className:(0,f.cn)("text-sm opacity-90",s),...a})});function s2(){let{toasts:e}=(0,y.pm)();return(0,l.jsxs)(sX,{children:[e.map(function(e){let{id:t,title:s,description:a,action:r,...n}=e;return(0,l.jsxs)(sQ,{...n,children:[(0,l.jsxs)("div",{className:"grid gap-1",children:[s&&(0,l.jsx)(s0,{children:s}),a&&(0,l.jsx)(s1,{children:a})]}),r,(0,l.jsx)(s$,{})]},t)}),(0,l.jsx)(sH,{})]})}s1.displayName=sU.dk.displayName;var s5=s(62658),s4=s(77911),s3=s(69690);class s6{static calculate(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(0===e.length)return null;let s=e.map(e=>X.Rm.fromRawData(e));return(0,X.Qt)(s,{annualTargetYuan:t.annualTargetYuan,mode:t.mode||"current",currentWeekNumber:t.currentWeekNumber,year:t.year||new Date().getFullYear()})}static calculateIncrement(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(0===e.length)return null;let l=e.map(e=>X.Rm.fromRawData(e)),a=t.map(e=>X.Rm.fromRawData(e));return(0,X.u_)(l,a,{mode:"increment",annualTargetYuan:s.annualTargetYuan,currentWeekNumber:s.currentWeekNumber,year:s.year||new Date().getFullYear()})}static calculateTrend(e,t,s){let l=new Map;for(let a of s.weekRange){let s=s3.D.getByWeek(e,a,t);if(s.length>0){let e=this.calculate(s,{currentWeekNumber:a,year:t.years&&t.years.length>0?(0,j.FT)(t.years):new Date().getFullYear()});e&&l.set(a,e)}}return l}static calculateSmartComparison(e,t,s,l){let a=s3.D.getByWeek(e,t,s),r=t-1,n=s3.D.getByWeek(e,r,s);return{currentKpi:this.calculate(a,{annualTargetYuan:l,currentWeekNumber:t,mode:"increment"}),compareKpi:n.length>0?this.calculate(n,{annualTargetYuan:l,currentWeekNumber:r,mode:"increment"}):null,previousWeekNumber:n.length>0?r:null}}static calculateByDimension(e,t,s){let l=s3.D.filter(e,s),a=s3.D.groupBy(l,t),r=new Map;for(let[e,t]of a.entries()){let s=this.calculate(t);s&&r.set(e,s)}return r}static calculateBatch(e,t){return t.map(t=>{let s=s3.D.filter(e,t);return this.calculate(s)}).filter(e=>null!==e)}static calculateAchievementRate(e,t){return 0===t?0:e/t}static calculateTimeProgress(e,t){let s=t||e.getFullYear(),l=new Date(s,0,1),a=(new Date(s,11,31,23,59,59).getTime()-l.getTime())/864e5;return Math.min((e.getTime()-l.getTime())/864e5/a,1)}static calculateGrowthRate(e,t){var s;return{premiumGrowthRate:t.signed_premium>0?(e.signed_premium-t.signed_premium)/t.signed_premium:0,policyCountGrowthRate:t.policy_count>0?(e.policy_count-t.policy_count)/t.policy_count:0,averagePremiumGrowthRate:t.average_premium&&t.average_premium>0?((null!==(s=e.average_premium)&&void 0!==s?s:0)-t.average_premium)/t.average_premium:0}}}function s8(){let e=ey(),t=(0,h.qr)(e=>e.rawData),s=(0,h.qr)(e=>e.filters.businessTypes),l=(0,h.qr)(e=>e.filters.organizations),r=(0,h.qr)(e=>e.filters.customerCategories),n=(0,h.qr)(e=>e.filters.insuranceTypes),i=(0,h.qr)(e=>e.filters.years),o=(0,h.qr)(e=>e.filters.coverageTypes),c=(0,h.qr)(e=>e.filters.vehicleGrades),d=(0,h.qr)(e=>e.filters.terminalSources),u=(0,h.qr)(e=>e.filters.isNewEnergy),m=(0,h.qr)(e=>e.filters.renewalStatuses),x=(0,h.qr)(e=>e.filters.viewMode),g=(0,h.qr)(e=>e.filters.singleModeWeek),p=(0,h.qr)(e=>e.filters.dataViewType),b=(0,h.qr)(e=>e.premiumTargets),f=(0,a.useMemo)(()=>{if(!b)return null;if(s.length>0){let e=s.reduce((e,t)=>{var s;let l=(0,en.qP)(t),a=(0,ej.Vd)(l);return e+(null!==(s=b.dimensions.businessType.entries[a])&&void 0!==s?s:0)},0);if(e>0)return e}if(l.length>0){let e=l.reduce((e,t)=>{var s;let l=(0,ej.Vd)(t);return e+(null!==(s=b.dimensions.thirdLevelOrganization.entries[l])&&void 0!==s?s:0)},0);if(e>0)return e}if(r.length>0){let e=r.reduce((e,t)=>{var s;let l=(0,ej.Vd)(t);return e+(null!==(s=b.dimensions.customerCategory.entries[l])&&void 0!==s?s:0)},0);if(e>0)return e}if(n.length>0){let e=n.reduce((e,t)=>{var s;let l=(0,ej.Vd)(t);return e+(null!==(s=b.dimensions.insuranceType.entries[l])&&void 0!==s?s:0)},0);if(e>0)return e}return b.overall>0?b.overall:null},[s,l,r,n,b]);return(0,a.useMemo)(()=>{if(0===e.length)return null;let a={years:i,organizations:l,insuranceTypes:n,businessTypes:s,coverageTypes:o,customerCategories:r,vehicleGrades:c,terminalSources:d,isNewEnergy:u,renewalStatuses:m},h="single"===x?g:null,b=i.length>0?(0,j.FT)(i):new Date().getFullYear();if("current"===p){let t=e.map(e=>X.Rm.fromRawData(e));return(0,X.Qt)(t,{annualTargetYuan:null!=f?f:void 0,mode:"current",currentWeekNumber:null!=h?h:void 0,year:b})}if(!h){let t=e.map(e=>X.Rm.fromRawData(e));return(0,X.Qt)(t,{annualTargetYuan:null!=f?f:void 0,mode:"current",year:b})}let v=h-1,y=t.filter(e=>{if(a.years.length>0&&!a.years.includes(e.policy_start_year)||e.week_number!==v||a.organizations.length>0&&!a.organizations.includes(e.third_level_organization)||a.insuranceTypes.length>0&&!a.insuranceTypes.includes(e.insurance_type))return!1;if(a.businessTypes.length>0){let t=(0,en.gX)(e.business_type_category);if(!a.businessTypes.includes(t))return!1}return(!(a.coverageTypes.length>0)||!!a.coverageTypes.includes(e.coverage_type))&&(!(a.customerCategories.length>0)||!!a.customerCategories.includes(e.customer_category_3))&&(!(a.vehicleGrades.length>0)||!e.vehicle_insurance_grade||!!a.vehicleGrades.includes(e.vehicle_insurance_grade))&&(!(a.terminalSources.length>0)||!!a.terminalSources.includes(e.terminal_source))&&(null===a.isNewEnergy||e.is_new_energy_vehicle===a.isNewEnergy)&&(!(a.renewalStatuses.length>0)||!!a.renewalStatuses.includes(e.renewal_status))}),N=e.map(e=>X.Rm.fromRawData(e)),w=y.map(e=>X.Rm.fromRawData(e));return(0,X.u_)(N,w,{mode:"increment",annualTargetYuan:null!=f?f:void 0,currentWeekNumber:h,year:b})},[e,t,x,g,i,l,n,s,o,r,c,d,u,m,p,f])}let s7="insurance_analytics_",s9={RAW_DATA:"".concat(s7,"raw_data"),FILTERS:"".concat(s7,"filters"),LAST_UPLOAD_TIME:"".concat(s7,"last_upload_time")};function le(){try{let e="__storage_test__";return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(e){return!1}}function lt(e,t,s){if(!le())return{success:!1,error:"LocalStorage 不可用"};try{!function(){let e=Date.now(),t=[];for(let s=0;s<localStorage.length;s++){let l=localStorage.key(s);if(null==l?void 0:l.startsWith(s7))try{let s=localStorage.getItem(l);if(s){let a=JSON.parse(s);a.expiry&&e>a.timestamp+a.expiry&&t.push(l)}}catch(e){t.push(l)}}t.forEach(e=>localStorage.removeItem(e)),t.length>0&&console.log("[Storage] 清理了 ".concat(t.length," 个过期项"))}();let l={value:t,timestamp:Date.now(),expiry:s},a=JSON.stringify(l),r=2*a.length;if(function(){let e=0;for(let t=0;t<localStorage.length;t++){let s=localStorage.key(t);if(null==s?void 0:s.startsWith(s7)){let t=localStorage.getItem(s);e+=(s.length+((null==t?void 0:t.length)||0))*2}}return e}()+r>524288e3)return{success:!1,error:"存储空间不足,请清理部分数据"};return localStorage.setItem(e,a),{success:!0}}catch(e){if(e instanceof Error&&"QuotaExceededError"===e.name)return{success:!1,error:"存储配额已满"};return{success:!1,error:"存储失败"}}}function ls(e){if(!le())return null;try{let t=localStorage.getItem(e);if(!t)return null;let s=JSON.parse(t);if(s.expiry&&Date.now()>s.timestamp+s.expiry)return localStorage.removeItem(e),null;return s.value}catch(t){return console.error("[Storage] 读取失败:",e,t),null}}function ll(e){le()&&localStorage.removeItem(e)}let la="raw_data_store",lr="raw_data";function ln(){return!!window.indexedDB}function li(){return new Promise((e,t)=>{try{let s=indexedDB.open("insurance_analytics_db",1);s.onupgradeneeded=()=>{let e=s.result;e.objectStoreNames.contains(la)||e.createObjectStore(la)},s.onsuccess=()=>e(s.result),s.onerror=()=>t(s.error)}catch(e){t(e)}})}async function lo(e){if(!ln())return{success:!1,error:"IndexedDB 不可用"};try{let t=await li();return await new Promise((s,l)=>{let a=t.transaction(la,"readwrite").objectStore(la).put(e,lr);a.onsuccess=()=>s(),a.onerror=()=>l(a.error)}),t.close(),{success:!0}}catch(t){let e=t instanceof Error?t.message:"未知错误";return console.warn("[IndexedDB] 保存原始数据失败:",e),{success:!1,error:e}}}async function lc(){if(!ln())return null;try{let e=await li(),t=await new Promise((t,s)=>{let l=e.transaction(la,"readonly").objectStore(la).get(lr);l.onsuccess=()=>t(l.result||null),l.onerror=()=>s(l.error)});return e.close(),t}catch(e){return console.warn("[IndexedDB] 读取原始数据失败:",e instanceof Error?e.message:"未知错误"),null}}async function ld(){if(ln())try{let e=await li();await new Promise((t,s)=>{let l=e.transaction(la,"readwrite").objectStore(la).delete(lr);l.onsuccess=()=>t(),l.onerror=()=>s(l.error)}),e.close()}catch(e){console.warn("[IndexedDB] 清除原始数据失败:",e instanceof Error?e.message:"未知错误")}}function lu(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=(0,h.qr)(e=>e.rawData),s=(0,h.qr)(e=>e.filters),l=(0,h.qr)(e=>e.setRawData),r=(0,h.qr)(e=>e.updateFilters);(0,a.useEffect)(()=>{let t=!1;return async function(){if(h.qr.getState().rawData.length>0){console.log("[Persist] Store 已有数据，跳过恢复操作。");return}let s=ls(s9.RAW_DATA),a=ls(s9.FILTERS);if(s&&s.length>0)console.log("[Persist] 恢复了 ".concat(s.length," 条数据 (localStorage)")),l(s);else if(ln()){let e=await lc();!t&&e&&e.length>0&&(console.log("[Persist] 从 IndexedDB 恢复了 ".concat(e.length," 条数据")),l(e))}else e&&e.length>0&&(console.log("[Persist] 从服务器初始了 ".concat(e.length," 条数据")),l(e));a&&(console.log("[Persist] 恢复筛选条件"),r(a))}(),()=>{t=!0}},[e,l,r]),(0,a.useEffect)(()=>{if(t.length>0){if(ln()&&lo(t).then(e=>{e.success?console.log("[Persist] IndexedDB 已保存 ".concat(t.length," 条数据")):console.warn("[Persist] IndexedDB 保存失败: ".concat(e.error))}),t.length<=1e3){let e=lt(s9.RAW_DATA,t,6048e5);e.success?console.log("[Persist] localStorage 已保存 ".concat(t.length," 条数据")):console.warn("[Persist] localStorage 保存失败: ".concat(e.error))}else ll(s9.RAW_DATA),console.log("[Persist] 数据量 (".concat(t.length," 条) 超过 localStorage 限制，仅使用 IndexedDB 存储"))}else ll(s9.RAW_DATA),ld(),console.log("[Persist] 已清空缓存数据")},[t]);let n=(0,a.useRef)("");return(0,a.useEffect)(()=>{if(s){let e=JSON.stringify(s);e!==n.current&&(n.current=e,lt(s9.FILTERS,s,6048e5),console.log("[Persist] 已保存筛选条件"))}},[s]),{saveUploadTime:()=>{lt(s9.LAST_UPLOAD_TIME,Date.now())},clearPersistedData:()=>{ll(s9.RAW_DATA),ll(s9.FILTERS),ld(),console.log("[Persist] 已清除所有持久化数据")}}}var lm=s(28406);function lx(){var e,t,s,a;let r=s8();if(!r)return null;let n=null!==(e=r.premium_time_progress_achievement_rate)&&void 0!==e?e:null,i=null!==(t=r.variable_cost_ratio)&&void 0!==t?t:null,o=null!==(s=r.loss_ratio)&&void 0!==s?s:null,c=null!==(a=r.expense_ratio)&&void 0!==a?a:null;return(0,l.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[{title:"时间进度达成率",value:n,metricKey:"time_progress_ratio",unit:"%",formatter:e=>null===e?"—":"".concat(e.toFixed(1),"%")},{title:"变动成本率",value:i,metricKey:"variable_cost_ratio",unit:"%",formatter:e=>null===e?"—":"".concat(e.toFixed(1),"%")},{title:"满期赔付率",value:o,metricKey:"loss_ratio",unit:"%",formatter:e=>null===e?"—":"".concat(e.toFixed(1),"%")},{title:"费用率",value:c,metricKey:"expense_ratio",unit:"%",formatter:e=>null===e?"—":"".concat(e.toFixed(1),"%")}].map(e=>{let{title:t,value:s,metricKey:a,unit:r,formatter:n}=e,i=eJ[e0(s,a)];return(0,l.jsxs)("div",{className:"rounded-xl border p-4 bg-white/70 backdrop-blur-sm",style:{borderColor:i.bgColor},children:[(0,l.jsx)("div",{className:"text-xs font-medium text-slate-600",children:t}),(0,l.jsxs)("div",{className:"mt-2 flex items-end justify-between",children:[(0,l.jsx)("div",{className:"text-2xl font-bold",style:{color:i.color},children:n(s)}),(0,l.jsx)("span",{className:"text-xs px-2 py-0.5 rounded bg-slate-100 font-medium text-slate-700",children:i.label})]}),(0,l.jsxs)("div",{className:"mt-2 text-xs text-slate-500",children:["单位：",r]})]},t)})})}function lh(){let e=eM(),t=eS(),s=(0,a.useMemo)(()=>{let s=e.filter(e=>{let t=e0(e.kpi.premium_time_progress_achievement_rate,"time_progress_ratio");return"danger"===t||"warning"===t}).length;return{timeProgressLagging:s,highVariableCost:e.filter(e=>{var t;return(null!==(t=e.kpi.variable_cost_ratio)&&void 0!==t?t:0)>92}).length,highLossRatioOrgs:e.filter(e=>{var t;return(null!==(t=e.kpi.loss_ratio)&&void 0!==t?t:0)>70}).length,highLossRatioBusinessTypes:t.filter(e=>{var t;return(null!==(t=e.kpi.loss_ratio)&&void 0!==t?t:0)>70}).length}},[e,t]),r=[{title:"时间进度达成率落后机构数",value:s.timeProgressLagging,color:"text-amber-600",icon:"⏰"},{title:"变动成本率>92%机构数",value:s.highVariableCost,color:"text-orange-600",icon:"\uD83D\uDCCA"},{title:"满期赔付率>70%机构数",value:s.highLossRatioOrgs,color:"text-red-600",icon:"⚠️"},{title:"满期赔付率>70%业务类型数",value:s.highLossRatioBusinessTypes,color:"text-red-700",icon:"\uD83D\uDD34"}];return(0,l.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:r.map(e=>(0,l.jsxs)("div",{className:"rounded-xl border p-4 bg-white/70 backdrop-blur-sm",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,l.jsx)("span",{className:"text-lg",children:e.icon}),(0,l.jsx)("div",{className:"text-xs font-medium text-slate-600",children:e.title})]}),(0,l.jsx)("div",{className:"text-2xl font-bold ".concat(e.color),children:e.value})]},e.title))})}function lg(){let e=eM(),t=(0,a.useMemo)(()=>e2(e.filter(e=>{let t=e0(e.kpi.premium_time_progress_achievement_rate,"time_progress_ratio");return"danger"===t||"warning"===t}),e=>e.kpi.premium_time_progress_achievement_rate,"time_progress_ratio").map(e=>{var t;return{organization:e.organization,value:null!==(t=e.kpi.premium_time_progress_achievement_rate)&&void 0!==t?t:0,level:e0(e.kpi.premium_time_progress_achievement_rate,"time_progress_ratio")}}),[e]),s={title:{text:"时间进度达成率落后机构",left:"center",textStyle:{fontSize:14,fontWeight:"bold",color:"#334155"}},tooltip:{trigger:"axis",axisPointer:{type:"shadow"},formatter:e=>{let t=e[0];return"".concat(t.name,"<br/>达成率: ").concat(t.value.toFixed(1),"%")}},grid:{left:"15%",right:"5%",top:"15%",bottom:"10%"},xAxis:{type:"value",name:"达成率 (%)",axisLabel:{formatter:"{value}%"}},yAxis:{type:"category",data:t.map(e=>e.organization),axisLabel:{fontSize:11}},series:[{type:"bar",data:t.map(e=>({value:e.value,itemStyle:{color:"danger"===e.level?"#ef4444":"#f59e0b"}})),label:{show:!0,position:"right",formatter:"{c}%",fontSize:10}}]};return(0,l.jsxs)("div",{className:"rounded-xl border p-4 bg-white/70 backdrop-blur-sm",children:[(0,l.jsx)("h4",{className:"text-sm font-bold text-slate-700 mb-4",children:"经营观察：时间进度达成率"}),t.length>0?(0,l.jsx)(ti.Z,{option:s,style:{height:"400px"}}):(0,l.jsx)("div",{className:"text-center text-slate-500 py-8",children:"暂无落后机构数据"})]})}function lp(){let[e,t]=(0,a.useState)("organization"),s=eM(),r=eS(),n=(0,a.useMemo)(()=>e2(("organization"===e?s:r).filter(e=>{let t=e0(e.kpi.variable_cost_ratio,"variable_cost_ratio");return"danger"===t||"warning"===t}),e=>e.kpi.variable_cost_ratio,"variable_cost_ratio").map(t=>{var s;return{name:"organization"===e?t.organization:t.businessType,value:null!==(s=t.kpi.variable_cost_ratio)&&void 0!==s?s:0,level:e0(t.kpi.variable_cost_ratio,"variable_cost_ratio")}}),[e,s,r]),i=(0,a.useMemo)(()=>({danger:n.filter(e=>"danger"===e.level).length,warning:n.filter(e=>"warning"===e.level).length}),[n]),o={title:{text:"变动成本率风险分布（".concat("organization"===e?"机构":"业务类型","）"),left:"center",textStyle:{fontSize:14,fontWeight:"bold",color:"#334155"}},tooltip:{trigger:"axis",axisPointer:{type:"shadow"},formatter:e=>{let t=e[0],s="danger"===t.data.level?"危险":"预警";return"".concat(t.name,"<br/>成本率: ").concat(t.value.toFixed(1),"%<br/>状态: ").concat(s)}},grid:{left:"15%",right:"5%",top:"15%",bottom:"10%"},xAxis:{type:"value",name:"变动成本率 (%)",axisLabel:{formatter:"{value}%"}},yAxis:{type:"category",data:n.map(e=>e.name),axisLabel:{fontSize:11}},series:[{type:"bar",data:n.map(e=>({value:e.value,level:e.level,itemStyle:{color:"danger"===e.level?"#ef4444":"#f59e0b"}})),label:{show:!0,position:"right",formatter:"{c}%",fontSize:10}}]};return(0,l.jsxs)("div",{className:"rounded-xl border p-4 bg-white/70 backdrop-blur-sm",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,l.jsx)("h4",{className:"text-sm font-bold text-slate-700",children:"经营观察：变动成本率"}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)("button",{onClick:()=>t("organization"),className:"px-3 py-1 text-xs rounded transition-colors ".concat("organization"===e?"bg-blue-600 text-white":"bg-slate-200 text-slate-600 hover:bg-slate-300"),children:"机构维度"}),(0,l.jsx)("button",{onClick:()=>t("businessType"),className:"px-3 py-1 text-xs rounded transition-colors ".concat("businessType"===e?"bg-blue-600 text-white":"bg-slate-200 text-slate-600 hover:bg-slate-300"),children:"业务类型维度"})]})]}),(0,l.jsxs)("div",{className:"flex gap-4 mb-4 text-xs",children:[(0,l.jsxs)("div",{className:"flex items-center gap-1",children:[(0,l.jsx)("span",{className:"w-3 h-3 rounded bg-red-500"}),(0,l.jsxs)("span",{className:"text-slate-600",children:["危险状态: ",i.danger]})]}),(0,l.jsxs)("div",{className:"flex items-center gap-1",children:[(0,l.jsx)("span",{className:"w-3 h-3 rounded bg-orange-500"}),(0,l.jsxs)("span",{className:"text-slate-600",children:["预警状态: ",i.warning]})]})]}),n.length>0?(0,l.jsx)(ti.Z,{option:o,style:{height:"400px"}}):(0,l.jsxs)("div",{className:"text-center text-slate-500 py-8",children:["暂无风险","organization"===e?"机构":"业务类型","数据"]})]})}function lb(){return(0,l.jsxs)("div",{className:"rounded-xl border p-4 bg-white/70 backdrop-blur-sm",children:[(0,l.jsx)("h4",{className:"text-sm font-bold text-blue-600 mb-2 text-left",children:"业务健康度热力图"}),(0,l.jsx)(tE,{})]})}function lf(){return(0,l.jsxs)("div",{className:"rounded-xl border p-4 bg-white/70 backdrop-blur-sm",children:[(0,l.jsx)("h4",{className:"text-sm font-bold text-blue-600 mb-2 text-left",children:"多维健康度雷达"}),(0,l.jsx)(eq,{})]})}function lv(){return(0,l.jsxs)("div",{className:"rounded-xl border p-4 bg-white/70 backdrop-blur-sm",children:[(0,l.jsx)("h4",{className:"text-sm font-bold text-blue-600 mb-2 text-left",children:"动态条形图"}),(0,l.jsx)(e7,{})]})}function ly(){return(0,l.jsxs)("div",{className:"rounded-xl border p-4 bg-white/70 backdrop-blur-sm",children:[(0,l.jsx)("h4",{className:"text-sm font-bold text-blue-600 mb-2 text-left",children:"占比分析"}),(0,l.jsx)(tn,{})]})}function lj(){return(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsx)(lx,{}),(0,l.jsx)(lh,{}),(0,l.jsx)(lg,{}),(0,l.jsx)(lp,{}),(0,l.jsx)(lb,{}),(0,l.jsx)(lf,{}),(0,l.jsx)(lv,{}),(0,l.jsx)(ly,{})]})}var lN=s(41405),lw=s(13344);let l_=[{key:"2025-11-30",label:"2025年11月30日"},{key:"2025-12-31",label:"2025年12月31日"},{key:"2026-03-31",label:"2026年3月31日"},{key:"2026-06-30",label:"2026年6月30日"},{key:"2026-09-30",label:"2026年9月30日"},{key:"2026-12-31",label:"2026年12月31日"}];function lk(e){return new Date(e,0,1)}function lC(e,t){return Math.max(0,Math.floor((t.getTime()-e.getTime())/864e5)+1)}function lS(e){return Math.round(e/1e4*100)/100}function lM(){let e=ey(),t=(0,h.qr)(e=>e.filters),{items:s}=tU("business_type_category",20),r=tH("business_type_category"),[n,i]=(0,a.useState)(l_[0].key),[o,c]=(0,a.useState)({}),d=(0,a.useMemo)(()=>{if(t.years&&t.years.length>0)return t.years[0];let s=e[0];return s?s.policy_start_year:new Date().getFullYear()},[t.years,e]),u=function(e,t){let s=new Date(e,0,1+7*t-1);return lC(lk(e),s)}(d,(0,a.useMemo)(()=>t.singleModeWeek?t.singleModeWeek:t.trendModeWeeks&&t.trendModeWeeks.length>0?(0,j.FT)(t.trendModeWeeks):e.reduce((e,t)=>Math.max(e,t.week_number),1)||1,[t.singleModeWeek,t.trendModeWeeks,e])),m=function(e){let[t,s,l]=e.split("-").map(Number);return new Date(t,s-1,l)}(n),x=lC(lk(d),m),g=(0,a.useMemo)(()=>{let t=new Map;e.forEach(e=>{let s=e.business_type_category||"__EMPTY__";t.has(s)||t.set(s,[]),t.get(s).push(e)});let s=new Map;return t.forEach((e,t)=>{let l=e.map(e=>X.Rm.fromRawData(e));s.set(t,(0,X.Qt)(l))}),s},[e]),p=(0,a.useMemo)(()=>{let e=new Map;return r.forEach(t=>{e.set(t.key,{avgClaim:t.current.averageClaim,claimCases:t.current.claimCaseCount})}),new Map(s.map(t=>{var s,l,a,r;return[t.key,{label:t.label,signedPremiumYuan:t.signedPremiumYuan,premiumPlanYuan:t.premiumPlanYuan,policyCount:t.policyCount,averagePremium:t.averagePremium,avgClaim:null!==(a=null===(s=e.get(t.key))||void 0===s?void 0:s.avgClaim)&&void 0!==a?a:null,claimCases:null!==(r=null===(l=e.get(t.key))||void 0===l?void 0:l.claimCases)&&void 0!==r?r:0}]}))},[s,r]),b=(0,a.useMemo)(()=>s.map(e=>{var t,s,l,a,r,n,i,c;let d=e.key,m=p.get(d),h=o[d]||{},b=g.get(d),f=null!==(t=null==b?void 0:b.maturity_ratio)&&void 0!==t?t:null,v=null!==f&&u>0?f/u:null,y=null!==v?Math.min(100,Math.max(0,v*x)):f,j=m.signedPremiumYuan;"number"==typeof h.signedPremiumYuan?j=h.signedPremiumYuan:"number"==typeof h.premiumAchievementRate&&m.premiumPlanYuan>0?j=m.premiumPlanYuan*h.premiumAchievementRate/100:"number"==typeof h.averagePremium&&"number"==typeof h.policyCount&&(j=h.averagePremium*h.policyCount);let N=m.policyCount;"number"==typeof h.policyCount?N=Math.round(Math.max(0,h.policyCount)):"number"==typeof h.averagePremium&&(N=Math.round(j/Math.max(1,h.averagePremium)));let w=null!==(s=m.averagePremium)&&void 0!==s?s:m.policyCount>0?m.signedPremiumYuan/m.policyCount:null;"number"==typeof h.averagePremium?w=h.averagePremium:N>0&&(w=j/N);let _=null!==(l=null!=y?y:null==b?void 0:b.maturity_ratio)&&void 0!==l?l:null,k=null!==_?j*_/100:0,C=m.claimCases;"number"==typeof h.claimCaseCount?C=Math.round(Math.max(0,h.claimCaseCount)):"number"==typeof h.maturedFrequencyRate?C=Math.round(N*h.maturedFrequencyRate/100):N>0&&null!==_&&(null==b?void 0:b.matured_claim_ratio)!==null&&(C=Math.round(N*(null!==(a=null==b?void 0:b.matured_claim_ratio)&&void 0!==a?a:0)/100));let S=null!==(r=m.avgClaim)&&void 0!==r?r:null;"number"==typeof h.averageClaim&&(S=h.averageClaim);let M=0;"number"==typeof h.lossRatio&&null!==_?M=k*h.lossRatio/100:null!==S?M=C*S:(null!==(n=null==b?void 0:b.loss_ratio)&&void 0!==n?n:null)!==null&&(M=k*(null!==(i=null==b?void 0:b.loss_ratio)&&void 0!==i?i:0)/100);let P="number"==typeof h.expenseRatio?h.expenseRatio:null!==(c=null==b?void 0:b.expense_ratio)&&void 0!==c?c:null,D=null!==P?j*P/100:0,R=k-M-D,z=k>0?R/k*100:null,T=k>0?M/k*100:null,W=N>0&&null!==_?C/N*_:null,E=N>0?D/N:null,F=N>0?R/N:null;return{key:d,label:m.label,input:h,output:{signedPremiumWan:lS(j),maturedPremiumWan:lS(k),reportedClaimPaymentWan:lS(M),expenseAmountWan:lS(D),contributionMarginWan:lS(R),policyCount:N,claimCaseCount:C},rates:{maturityRatio:_,lossRatio:T,expenseRatio:P,contributionMarginRatio:z,maturedFrequencyRate:W},averages:{averagePremium:w,averageClaim:S,averageExpense:E,averageContribution:F}}}),[s,p,o,g,u,x]),f=(e,t,s)=>{let l=""===s?void 0:Number(s);c(s=>({...s,[e]:{...s[e],[t]:l}}))};return(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsx)(to.Zb,{className:"p-4",children:(0,l.jsxs)("div",{className:"flex flex-wrap items-center gap-3",children:[(0,l.jsx)("div",{className:"text-sm text-slate-700 font-medium",children:"目标时间点"}),(0,l.jsxs)(tm,{value:n,onValueChange:i,children:[(0,l.jsx)(th,{className:"w-[220px]",children:(0,l.jsx)(tx,{placeholder:"选择目标日期"})}),(0,l.jsx)(tb,{children:l_.map(e=>(0,l.jsx)(tf,{value:e.key,children:e.label},e.key))})]}),(0,l.jsx)("div",{className:"text-xs text-slate-500",children:"满期率预测：日均满期率 \xd7 年内已过天数（按所选年度）"})]})}),(0,l.jsx)("div",{className:"grid gap-4",children:b.map(e=>{var t,s,a,r,n,i,o,d,u;return(0,l.jsxs)(to.Zb,{className:"p-4",children:[(0,l.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,l.jsxs)("div",{className:"min-w-[180px]",children:[(0,l.jsx)("div",{className:"text-base font-semibold text-slate-800",children:e.label}),(0,l.jsx)("div",{className:"mt-1 text-xs text-slate-500",children:"业务类型"})]}),(0,l.jsxs)("div",{className:"flex-1 grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-xs text-slate-600 mb-1",children:"签单保费(元)"}),(0,l.jsx)(lw.I,{type:"number",value:null!==(t=e.input.signedPremiumYuan)&&void 0!==t?t:"",onChange:t=>f(e.key,"signedPremiumYuan",t.target.value)})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-xs text-slate-600 mb-1",children:"保费达成率(%)"}),(0,l.jsx)(lw.I,{type:"number",value:null!==(s=e.input.premiumAchievementRate)&&void 0!==s?s:"",onChange:t=>f(e.key,"premiumAchievementRate",t.target.value)})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-xs text-slate-600 mb-1",children:"单均保费(元)"}),(0,l.jsx)(lw.I,{type:"number",value:null!==(a=e.input.averagePremium)&&void 0!==a?a:"",onChange:t=>f(e.key,"averagePremium",t.target.value)})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-xs text-slate-600 mb-1",children:"保单件数(件)"}),(0,l.jsx)(lw.I,{type:"number",value:null!==(r=e.input.policyCount)&&void 0!==r?r:"",onChange:t=>f(e.key,"policyCount",t.target.value)})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-xs text-slate-600 mb-1",children:"赔案件数(件)"}),(0,l.jsx)(lw.I,{type:"number",value:null!==(n=e.input.claimCaseCount)&&void 0!==n?n:"",onChange:t=>f(e.key,"claimCaseCount",t.target.value)})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-xs text-slate-600 mb-1",children:"满期出险率(%)"}),(0,l.jsx)(lw.I,{type:"number",value:null!==(i=e.input.maturedFrequencyRate)&&void 0!==i?i:"",onChange:t=>f(e.key,"maturedFrequencyRate",t.target.value)})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-xs text-slate-600 mb-1",children:"案均赔款(元)"}),(0,l.jsx)(lw.I,{type:"number",value:null!==(o=e.input.averageClaim)&&void 0!==o?o:"",onChange:t=>f(e.key,"averageClaim",t.target.value)})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-xs text-slate-600 mb-1",children:"费用率(%)"}),(0,l.jsx)(lw.I,{type:"number",value:null!==(d=e.input.expenseRatio)&&void 0!==d?d:"",onChange:t=>f(e.key,"expenseRatio",t.target.value)})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-xs text-slate-600 mb-1",children:"满期赔付率(%)"}),(0,l.jsx)(lw.I,{type:"number",value:null!==(u=e.input.lossRatio)&&void 0!==u?u:"",onChange:t=>f(e.key,"lossRatio",t.target.value)})]})]})]}),(0,l.jsxs)("div",{className:"mt-4 grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3 text-sm",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-slate-500",children:"签单保费(万元)"}),(0,l.jsx)("div",{className:"font-semibold",children:e.output.signedPremiumWan.toLocaleString()})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-slate-500",children:"满期保费(万元)"}),(0,l.jsx)("div",{className:"font-semibold",children:e.output.maturedPremiumWan.toLocaleString()})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-slate-500",children:"已报告赔款(万元)"}),(0,l.jsx)("div",{className:"font-semibold",children:e.output.reportedClaimPaymentWan.toLocaleString()})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-slate-500",children:"费用金额(万元)"}),(0,l.jsx)("div",{className:"font-semibold",children:e.output.expenseAmountWan.toLocaleString()})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-slate-500",children:"满期边贡额(万元)"}),(0,l.jsx)("div",{className:"font-semibold",children:e.output.contributionMarginWan.toLocaleString()})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-slate-500",children:"保单/赔案件数"}),(0,l.jsxs)("div",{className:"font-semibold",children:[e.output.policyCount.toLocaleString()," /"," ",e.output.claimCaseCount.toLocaleString()]})]})]}),(0,l.jsxs)("div",{className:"mt-3 grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3 text-xs",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-slate-500",children:"满期率(%)"}),(0,l.jsx)("div",{className:"font-medium",children:e.rates.maturityRatio?e.rates.maturityRatio.toFixed(2):"—"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-slate-500",children:"满期赔付率(%)"}),(0,l.jsx)("div",{className:"font-medium",children:e.rates.lossRatio?e.rates.lossRatio.toFixed(2):"—"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-slate-500",children:"费用率(%)"}),(0,l.jsx)("div",{className:"font-medium",children:e.rates.expenseRatio?e.rates.expenseRatio.toFixed(2):"—"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-slate-500",children:"满期边贡率(%)"}),(0,l.jsx)("div",{className:"font-medium",children:e.rates.contributionMarginRatio?e.rates.contributionMarginRatio.toFixed(2):"—"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-slate-500",children:"满期出险率(%)"}),(0,l.jsx)("div",{className:"font-medium",children:e.rates.maturedFrequencyRate?e.rates.maturedFrequencyRate.toFixed(2):"—"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-slate-500",children:"件均/案均/单均费用/单均边贡(元)"}),(0,l.jsxs)("div",{className:"font-medium",children:[e.averages.averagePremium?Math.round(e.averages.averagePremium).toLocaleString():"—"," ","/",e.averages.averageClaim?Math.round(e.averages.averageClaim).toLocaleString():"—"," ","/",e.averages.averageExpense?Math.round(e.averages.averageExpense).toLocaleString():"—"," ","/",e.averages.averageContribution?Math.round(e.averages.averageContribution).toLocaleString():"—"]})]})]}),(0,l.jsx)("div",{className:"mt-4 flex justify-end",children:(0,l.jsx)(sy.z,{variant:"outline",size:"sm",onClick:()=>c(t=>({...t,[e.key]:{}})),children:"清空该行输入"})})]},e.key)})})]})}var lP=s(18805),lD=s(25246),lR=s(95138),lz=s.n(lR);let lT=["snapshot_date","policy_start_year","week_number","chengdu_branch","third_level_organization","customer_category_3","insurance_type","business_type_category","coverage_type","renewal_status","is_new_energy_vehicle","is_transferred_vehicle","vehicle_insurance_grade","highway_risk_grade","large_truck_score","small_truck_score","terminal_source","signed_premium_yuan","matured_premium_yuan","policy_count","claim_case_count","reported_claim_payment_yuan","expense_amount_yuan","commercial_premium_before_discount_yuan","premium_plan_yuan","marginal_contribution_amount_yuan"];function lW(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{filename:s="保险数据_".concat(new Date().toISOString().split("T")[0]),includeHeader:l=!0,fieldOrder:a=lT,fields:r}=t,n=null!=r?r:a;if(0===e.length){alert("没有数据可导出");return}let i=e.map(e=>{let t={};return n.forEach(s=>{let l=e[s];"boolean"==typeof l?t[s]=l?"True":"False":null==l?t[s]="":t[s]="number"==typeof l||"string"==typeof l?l:String(l)}),t});lE(lz().unparse(i,{columns:n,header:l}),"".concat(s,".csv"))}function lE(e,t){let s=new Blob(["\uFEFF"+e],{type:"text/csv;charset=utf-8;"}),l=document.createElement("a"),a=URL.createObjectURL(s);l.setAttribute("href",a),l.setAttribute("download",t),l.style.visibility="hidden",document.body.appendChild(l),l.click(),document.body.removeChild(l),setTimeout(()=>URL.revokeObjectURL(a),100)}var lF=s(7819),lL=s.n(lF);async function lA(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{filename:s="chart-".concat(new Date().toISOString().split("T")[0]),quality:l=.95,backgroundColor:a="#ffffff",scale:r=2,waitBeforeCapture:n=100,format:i="png"}=t;try{let t="string"==typeof e?document.querySelector(e):e;if(!t)throw Error("找不到要导出的图表元素");n>0&&await new Promise(e=>setTimeout(e,n)),(await lL()(t,{backgroundColor:a,scale:r,useCORS:!0,logging:!1,allowTaint:!1,removeContainer:!0,imageTimeout:15e3,foreignObjectRendering:!0})).toBlob(e=>{if(!e)throw Error("图片生成失败");let t=URL.createObjectURL(e),l=document.createElement("a");l.href=t,l.download="".concat(s,".").concat(i),document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(t)},"jpeg"===i?"image/jpeg":"image/png",l)}catch(e){throw console.error("图表导出失败:",e),e}}function lZ(){var e,t,s;let[r,n]=(0,a.useState)(!1),i=(0,h.qr)(e=>e.rawData),c=(0,h.qr)(e=>e.filters),d=ey(),u=s8(),m=i.length>0,x=d.length>0,g=async(e,t)=>{try{let s=document.getElementById(e);if(!s){alert("未找到图表元素: ".concat(e));return}await lA(s,{filename:"".concat(t,"_").concat(new Date().toISOString().split("T")[0]),backgroundColor:"#ffffff",scale:2,format:"png"})}catch(e){console.error("图表导出失败:",e),alert("图表导出失败，请重试")}};return(0,l.jsxs)(sj.Vq,{open:r,onOpenChange:n,children:[(0,l.jsx)(sj.hg,{asChild:!0,children:(0,l.jsxs)(sy.z,{variant:"outline",disabled:!m,className:"flex items-center gap-2",children:[(0,l.jsx)(k.Z,{className:"w-4 h-4"}),"导出数据"]})}),(0,l.jsxs)(sj.cZ,{className:"sm:max-w-md",children:[(0,l.jsxs)(sj.fK,{children:[(0,l.jsxs)(sj.$N,{className:"flex items-center gap-2",children:[(0,l.jsx)(k.Z,{className:"w-5 h-5 text-blue-600"}),"导出数据"]}),(0,l.jsx)(sj.Be,{children:"选择要导出的数据类型。支持导出为CSV格式,可用Excel打开。"})]}),(0,l.jsxs)("div",{className:"space-y-3 pt-4",children:[(0,l.jsxs)("div",{onClick:()=>{lW(i,{filename:"保险数据_全部_".concat(new Date().toISOString().split("T")[0])}),n(!1)},className:"flex items-start gap-3 p-4 border border-slate-200 rounded-lg hover:border-blue-300 hover:bg-blue-50/50 cursor-pointer transition-all group",children:[(0,l.jsx)("div",{className:"mt-1",children:(0,l.jsx)(lP.Z,{className:"w-5 h-5 text-slate-600 group-hover:text-blue-600"})}),(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsx)("h4",{className:"font-medium text-slate-800 group-hover:text-blue-600 transition-colors",children:"导出全部原始数据"}),(0,l.jsxs)("p",{className:"text-sm text-slate-600 mt-1",children:["导出所有已上传的原始数据 (",i.length.toLocaleString()," ","条记录)"]})]})]}),(0,l.jsxs)("div",{onClick:x?()=>{!function(e,t){var s,l,a;let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=[];(null===(s=t.policyYear)||void 0===s?void 0:s.length)&&n.push("年度".concat(t.policyYear.join(","))),(null===(l=t.weekNumber)||void 0===l?void 0:l.length)&&n.push("周".concat(t.weekNumber.join(","))),(null===(a=t.thirdLevelOrganization)||void 0===a?void 0:a.length)&&n.push(t.thirdLevelOrganization.join(","));let i=n.length>0?"_".concat(n.join("_")):"",o=r.filename||"保险数据明细".concat(i,"_").concat(new Date().toISOString().split("T")[0]);lW(e,{...r,filename:o})}(d,{policyYear:c.years,weekNumber:c.weeks,thirdLevelOrganization:c.organizations}),n(!1)}:void 0,className:"flex items-start gap-3 p-4 border rounded-lg transition-all ".concat(x?"border-slate-200 hover:border-blue-300 hover:bg-blue-50/50 cursor-pointer group":"border-slate-100 bg-slate-50 cursor-not-allowed opacity-60"),children:[(0,l.jsx)("div",{className:"mt-1",children:(0,l.jsx)(lP.Z,{className:"w-5 h-5 text-slate-600 group-hover:text-blue-600"})}),(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsx)("h4",{className:"font-medium text-slate-800 group-hover:text-blue-600 transition-colors",children:"导出当前筛选数据"}),(0,l.jsx)("p",{className:"text-sm text-slate-600 mt-1",children:x?"导出应用筛选条件后的数据 (".concat(d.length.toLocaleString()," 条记录)"):"当前无筛选数据可导出"}),x&&(0,l.jsxs)("div",{className:"mt-2 text-xs text-slate-500",children:["当前筛选条件:",(null===(e=c.years)||void 0===e?void 0:e.length)?" 年度(".concat(c.years.join(","),")"):"",(null===(t=c.weeks)||void 0===t?void 0:t.length)?" 周次(".concat(c.weeks.join(","),")"):"",(null===(s=c.organizations)||void 0===s?void 0:s.length)?" 机构(".concat(c.organizations.length,"个)"):""]})]})]}),(0,l.jsxs)("div",{onClick:()=>{if(u){let e={policyYear:c.years,weekNumber:c.weeks,thirdLevelOrganization:c.organizations};!function(e,t){var s,l,a,r;let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=n.filename||"KPI汇总_".concat(new Date().toISOString().split("T")[0]),o=[{指标名称:"满期边际贡献率",数值:e.maturedMarginRate?"".concat(e.maturedMarginRate.toFixed(2),"%"):"-",单位:"%"},{指标名称:"保费达成率",数值:e.premiumAchievementRate?"".concat(e.premiumAchievementRate.toFixed(2),"%"):"-",单位:"%"},{指标名称:"满期赔付率",数值:e.maturedClaimRate?"".concat(e.maturedClaimRate.toFixed(2),"%"):"-",单位:"%"},{指标名称:"费用率",数值:e.expenseRate?"".concat(e.expenseRate.toFixed(2),"%"):"-",单位:"%"},{指标名称:"满期率",数值:e.maturityRate?"".concat(e.maturityRate.toFixed(2),"%"):"-",单位:"%"},{指标名称:"满期出险率",数值:e.maturedClaimFrequency?"".concat(e.maturedClaimFrequency.toFixed(2),"%"):"-",单位:"%"},{指标名称:"变动成本率",数值:e.variableCostRate?"".concat(e.variableCostRate.toFixed(2),"%"):"-",单位:"%"},{指标名称:"商业险自主系数",数值:e.autonomyCoefficient?e.autonomyCoefficient.toFixed(4):"-",单位:"小数"},{指标名称:"签单保费",数值:e.signedPremium?e.signedPremium.toFixed(2):"-",单位:"万元"},{指标名称:"满期保费",数值:e.maturedPremium?e.maturedPremium.toFixed(2):"-",单位:"万元"},{指标名称:"=== 筛选条件 ===",数值:"",单位:""},{指标名称:"保单年度",数值:(null===(s=t.policyYear)||void 0===s?void 0:s.join(", "))||"全部",单位:""},{指标名称:"周序号",数值:(null===(l=t.weekNumber)||void 0===l?void 0:l.join(", "))||"全部",单位:""},{指标名称:"三级机构",数值:(null===(a=t.thirdLevelOrganization)||void 0===a?void 0:a.join(", "))||"全部",单位:""},{指标名称:"保险类型",数值:(null===(r=t.insuranceType)||void 0===r?void 0:r.join(", "))||"全部",单位:""}];lE(lz().unparse(o,{header:!0}),"".concat(i,".csv"))}({maturedMarginRate:u.contribution_margin_ratio,premiumAchievementRate:u.premium_time_progress_achievement_rate,maturedClaimRate:u.loss_ratio,expenseRate:u.expense_ratio,maturityRate:u.maturity_ratio,maturedClaimFrequency:u.matured_claim_ratio,variableCostRate:u.variable_cost_ratio,autonomyCoefficient:u.autonomy_coefficient,signedPremium:u.signed_premium,maturedPremium:u.matured_premium},e)}n(!1)},className:"flex items-start gap-3 p-4 border border-slate-200 rounded-lg hover:border-green-300 hover:bg-green-50/50 cursor-pointer transition-all group",children:[(0,l.jsx)("div",{className:"mt-1",children:(0,l.jsx)(o.Z,{className:"w-5 h-5 text-slate-600 group-hover:text-green-600"})}),(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsx)("h4",{className:"font-medium text-slate-800 group-hover:text-green-600 transition-colors",children:"导出KPI汇总报告"}),(0,l.jsx)("p",{className:"text-sm text-slate-600 mt-1",children:"导出当前筛选条件下的核心KPI指标汇总"}),(0,l.jsx)("div",{className:"mt-2 text-xs text-slate-500",children:"包含: 满期边际贡献率、赔付率、费用率等8个核心指标"})]})]}),(0,l.jsxs)("div",{className:"p-4 border border-slate-200 rounded-lg bg-slate-50",children:[(0,l.jsxs)("div",{className:"flex items-start gap-3 mb-3",children:[(0,l.jsx)("div",{className:"mt-1",children:(0,l.jsx)(lD.Z,{className:"w-5 h-5 text-purple-600"})}),(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsx)("h4",{className:"font-medium text-slate-800",children:"导出图表图片"}),(0,l.jsx)("p",{className:"text-sm text-slate-600 mt-1",children:"将图表导出为高清PNG图片，适合用于PPT和报告"})]})]}),(0,l.jsxs)("div",{className:"space-y-2 pl-8",children:[(0,l.jsx)("button",{onClick:()=>g("trend-chart","趋势分析图"),className:"w-full text-left px-3 py-2 text-sm rounded border border-slate-200 bg-white hover:border-purple-300 hover:bg-purple-50 transition-colors",children:"导出趋势分析图表"}),(0,l.jsx)("button",{onClick:()=>g("organization-chart","机构结构分析图"),className:"w-full text-left px-3 py-2 text-sm rounded border border-slate-200 bg-white hover:border-purple-300 hover:bg-purple-50 transition-colors",children:"导出机构结构分析图"}),(0,l.jsx)("button",{onClick:()=>g("product-chart","产品结构分析图"),className:"w-full text-left px-3 py-2 text-sm rounded border border-slate-200 bg-white hover:border-purple-300 hover:bg-purple-50 transition-colors",children:"导出产品结构分析图"})]})]})]}),(0,l.jsx)("div",{className:"pt-4 border-t mt-4",children:(0,l.jsxs)("p",{className:"text-xs text-slate-500 flex items-start gap-2",children:[(0,l.jsx)("span",{className:"text-blue-600 font-medium",children:"\uD83D\uDCA1"}),(0,l.jsx)("span",{children:"导出的CSV文件采用UTF-8编码,可直接用Excel打开。 如遇乱码问题,请使用Excel的“数据”-“导入文本”功能并选择UTF-8编码。"})]})})]})]})}var lY=s(76682);async function lO(e){let{config:t,kpis:s,filters:l,insights:a}=e,r=new lY.ZP({orientation:"portrait",unit:"mm",format:"a4"}),n=r.internal.pageSize.getWidth(),i=r.internal.pageSize.getHeight(),o=15;r.setFontSize(24),r.setFont("helvetica","bold"),r.text(t.title,n/2,o+30,{align:"center"}),t.subtitle&&(r.setFontSize(14),r.setFont("helvetica","normal"),r.text(t.subtitle,n/2,o+45,{align:"center"}));let c=new Date().toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"});if(r.setFontSize(10),r.text("生成日期：".concat(c),n/2,o+60,{align:"center"}),t.author&&r.text("报告人：".concat(t.author),n/2,o+70,{align:"center"}),r.setDrawColor(59,130,246),r.setLineWidth(.5),r.line(15,o+80,n-15,o+80),l){r.addPage(),o=15,r.setFontSize(16),r.setFont("helvetica","bold"),r.text("筛选条件",15,o),o+=10,r.setFontSize(10),r.setFont("helvetica","normal");let e="single"===l.viewMode?"单周分析":"周趋势分析";if(r.text("分析模式：".concat(e),15,o),o+=6,l.years.length>0||l.weeks.length>0){let e=l.years.length>0?"".concat(l.years.join(", "),"年"):"全部",t=l.weeks.length>0?"第".concat(l.weeks.join(", "),"周"):"全部";r.text("时间范围：".concat(e,"，").concat(t),15,o),o+=6}l.organizations.length>0&&(r.text("机构：".concat(l.organizations.join("、")),15,o),o+=6),l.insuranceTypes.length>0&&(r.text("保险类型：".concat(l.insuranceTypes.join("、")),15,o),o+=6),o+=10}if(t.includeKPI&&s){o>i-100&&(r.addPage(),o=15),r.setFontSize(16),r.setFont("helvetica","bold"),r.text("核心指标概览",15,o),o+=10;let e=[["签单保费",(0,I.xG)(s.signed_premium)],["满期保费",(0,I.xG)(s.matured_premium)],["保单件数","".concat((0,I.uf)(s.policy_count)," 件")],["满期赔付率",null!==s.loss_ratio?(0,I.T3)(s.loss_ratio):"N/A"],["费用率",null!==s.expense_ratio?(0,I.T3)(s.expense_ratio):"N/A"],["满期边际贡献率",null!==s.contribution_margin_ratio?(0,I.T3)(s.contribution_margin_ratio):"N/A"],["单均保费",null!==s.average_premium?"".concat((0,I.uf)(s.average_premium)," 元"):"N/A"],["满期出险率",null!==s.matured_claim_ratio?(0,I.T3)(s.matured_claim_ratio):"N/A"]],t=(n-30)/2;r.setFontSize(10),r.setFont("helvetica","normal"),e.forEach((e,s)=>{let l=o+8*s;r.setDrawColor(200,200,200),r.rect(15,l,t,8),r.rect(15+t,l,t,8),r.setFont("helvetica","bold"),r.text(e[0],18,l+5.5),r.setFont("helvetica","normal"),r.text(e[1],15+t+3,l+5.5)}),o+=8*e.length+10}if(t.includeCharts&&t.chartElements&&t.chartElements.length>0)for(let e of t.chartElements){let t=document.getElementById(e);if(!t){console.warn("Chart element not found: ".concat(e));continue}o>i-120&&(r.addPage(),o=15);try{let e=await lL()(t,{scale:2,backgroundColor:"#ffffff",logging:!1}),s=e.toDataURL("image/png"),l=n-30,a=e.height*l/e.width,i=t.getAttribute("data-chart-title");i&&(r.setFontSize(14),r.setFont("helvetica","bold"),r.text(i,15,o),o+=8),r.addImage(s,"PNG",15,o,l,a),o+=a+10}catch(t){console.error("Failed to export chart ".concat(e,":"),t)}}t.includeInsights&&a&&a.length>0&&(r.addPage(),o=15,r.setFontSize(16),r.setFont("helvetica","bold"),r.text("智能洞察",15,o),o+=10,r.setFontSize(10),r.setFont("helvetica","normal"),a.forEach((e,t)=>{o>i-20&&(r.addPage(),o=15),r.text("".concat(t+1,". ").concat(e),15,o,{maxWidth:n-30}),o+=8}));let d=r.internal.pages.length-1;for(let e=1;e<=d;e++)r.setPage(e),r.setFontSize(8),r.setFont("helvetica","normal"),r.text("第 ".concat(e," 页 / 共 ").concat(d," 页"),n/2,i-10,{align:"center"});let u="".concat(t.title,"_").concat(new Date().toISOString().split("T")[0],".pdf");r.save(u)}function lq(e){let{className:t}=e,s=(0,h.qr)(e=>e.rawData),r=(0,h.qr)(e=>e.filters),n=(0,h.qr)(e=>e.viewMode),i=s8(),{toast:c}=(0,y.pm)(),[d,u]=(0,a.useState)(!1),m=()=>"single"===n?{title:"车险业务分析报告 - 单周表现",subtitle:"".concat(new Date().toLocaleDateString()," 单周详细分析"),author:"",includeKPI:!0,includeCharts:!0,includeInsights:!0,chartElements:["kpi-dashboard","structure-bar-chart","distribution-pie-chart","customer-bubble-chart","expense-heatmap"]}:{title:"车险业务分析报告 - 周趋势分析",subtitle:"".concat(new Date().toLocaleDateString()," 趋势分析"),author:"",includeKPI:!1,includeCharts:!0,includeInsights:!0,chartElements:["trend-chart"]},x=["本周签单保费环比增长12.5%，主要由高新分公司贡献","满期赔付率为64.67%，处于合理区间，同比下降3.2个百分点","费用率为18.3%，建议重点关注达州、资阳两地的费用管控","非营业客车新车业务表现优异，单均保费高且赔付率低","建议加大新能源车业务拓展，该细分市场具有高增长潜力"],g=async()=>{if(0===s.length){c({title:"无法导出",description:"请先上传数据文件",variant:"destructive"});return}u(!0);try{let e=m();await lO({config:e,kpis:i||void 0,filters:r,insights:e.includeInsights?x:void 0}),c({title:"导出成功",description:"PDF报告已成功生成并下载"})}catch(e){console.error("PDF export failed:",e),c({title:"导出失败",description:e instanceof Error?e.message:"未知错误",variant:"destructive"})}finally{u(!1)}};return(0,l.jsx)("button",{onClick:g,disabled:d||0===s.length,className:"flex items-center gap-2 px-4 py-2 text-sm text-slate-600 hover:text-slate-800 border border-slate-300 rounded-lg hover:border-slate-400 transition-colors disabled:opacity-50 disabled:cursor-not-allowed ".concat(t),title:"single"===n?"导出单周分析报告(包含KPI和静态图表)":"导出周趋势分析报告(包含趋势图表)",children:d?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("svg",{className:"animate-spin h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,l.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,l.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"导出中..."]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(o.Z,{className:"w-4 h-4"}),"导出PDF"]})})}var lI=s(11824);let lV=(0,tk.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70");a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,l.jsx)(lI.f,{ref:t,className:(0,f.cn)(lV(),s),...a})}).displayName=lI.f.displayName,a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,l.jsx)("textarea",{className:(0,f.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),ref:t,...a})}).displayName="Textarea",s(79303);var lB=s(57903),lK=JSON.parse('{"年度保费计划":{"四川分公司":431000000,"天府":197300000,"武侯":13500000,"高新":55700000,"青羊":43400000,"新都":35000000,"德阳":12800000,"宜宾":22700000,"泸州":10750000,"乐山":11900000,"自贡":9450000,"资阳":12000000,"达州":6500000,"本部":1000000}}'),lG=s(61950);let lU="insurDash_yearPlanImportHistory";function lX(){let{toast:e}=(0,y.pm)(),t=(0,h.qr)(e=>e.rawData),[s,r]=(0,a.useState)(!1),[n,o]=(0,a.useState)(!1),[c,u]=(0,a.useState)(!1),[m,x]=(0,a.useState)(()=>{let e=localStorage.getItem(lU);return e?JSON.parse(e):[]}),g=(0,a.useMemo)(()=>(0,lB.h3)(),[n]),p=(0,a.useMemo)(()=>(function(e){let t=new Date().getFullYear(),s=lK.年度保费计划,l=Object.values(s).reduce((e,t)=>e+t,0),a=(0,lB.oU)(),r={};return Object.entries(s).forEach(e=>{let[t,s]=e,l=(0,ej.Vd)(t);l&&(r[l]=Math.round(s))}),a.thirdLevelOrganization={entries:r,updatedAt:new Date().toISOString(),versions:[]},{year:t,overall:l,byBusinessType:{},dimensions:a,updatedAt:new Date().toISOString()}})(),[]),b=(0,a.useMemo)(()=>{let e=Object.keys(lK.年度保费计划).map(ej.Vd),s=new Set(t.map(e=>(0,ej.Vd)(e.third_level_organization||"")).filter(Boolean));return{validOrgs:e.filter(e=>s.has(e)),unmatchedOrgs:e.filter(e=>!s.has(e)),hasDataOrgs:Array.from(s)}},[t]),f=(0,a.useMemo)(()=>{var e,t;let s=p.dimensions.thirdLevelOrganization.entries,l=(null===(t=g.dimensions)||void 0===t?void 0:null===(e=t.thirdLevelOrganization)||void 0===e?void 0:e.entries)||{},a=new Set([...Object.keys(s),...Object.keys(l)]),r=[];return a.forEach(e=>{let t=s[e]||0,a=l[e]||0;if(t!==a){let s=t-a;r.push({organization:e,oldValue:a,newValue:t,change:s,changePercent:a>0?s/a*100:100})}}),r.sort((e,t)=>Math.abs(t.change)-Math.abs(e.change))},[p,g]),v=e=>"".concat((e/1e4).toFixed(2)," 万元");return(0,l.jsxs)("div",{className:"space-y-6",children:[b.unmatchedOrgs.length>0&&(0,l.jsxs)(tM.bZ,{variant:"destructive",children:[(0,l.jsx)(sq.Z,{className:"h-4 w-4"}),(0,l.jsx)(tM.Cd,{children:"机构名称验证警告"}),(0,l.jsxs)(tM.X,{children:[(0,l.jsxs)("p",{className:"mb-2",children:["以下 ",b.unmatchedOrgs.length," ","个机构在年度计划中配置，但未在当前数据中找到匹配记录:"]}),(0,l.jsx)("div",{className:"text-xs bg-red-50 p-2 rounded max-h-32 overflow-auto",children:b.unmatchedOrgs.join(", ")}),(0,l.jsx)("p",{className:"mt-2 text-xs",children:"建议: 检查机构名称拼写或先导入对应机构的数据"})]})]}),(0,l.jsxs)(to.Zb,{children:[(0,l.jsx)(to.Ol,{children:(0,l.jsxs)(to.ll,{className:"flex items-center gap-2",children:[(0,l.jsx)(d.Z,{className:"w-5 h-5"}),"年度计划导入"]})}),(0,l.jsxs)(to.aY,{className:"space-y-4",children:[(0,l.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,l.jsxs)("div",{className:"space-y-1",children:[(0,l.jsx)("div",{className:"text-sm text-muted-foreground",children:"年份"}),(0,l.jsx)("div",{className:"text-2xl font-bold",children:p.year})]}),(0,l.jsxs)("div",{className:"space-y-1",children:[(0,l.jsx)("div",{className:"text-sm text-muted-foreground",children:"全公司目标"}),(0,l.jsx)("div",{className:"text-xl font-semibold text-blue-600",children:v(p.overall)})]}),(0,l.jsxs)("div",{className:"space-y-1",children:[(0,l.jsx)("div",{className:"text-sm text-muted-foreground",children:"机构数量"}),(0,l.jsx)("div",{className:"text-2xl font-bold",children:Object.keys(p.dimensions.thirdLevelOrganization.entries).length})]}),(0,l.jsxs)("div",{className:"space-y-1",children:[(0,l.jsx)("div",{className:"text-sm text-muted-foreground",children:"验证通过"}),(0,l.jsxs)("div",{className:"text-2xl font-bold ".concat(b.unmatchedOrgs.length>0?"text-orange-600":"text-green-600"),children:[b.validOrgs.length,"/",b.validOrgs.length+b.unmatchedOrgs.length]})]})]}),(0,l.jsxs)("div",{className:"flex gap-3",children:[(0,l.jsx)(sy.z,{onClick:()=>{r(!0);try{(0,lB.Ws)(p);let t=[{id:"import-".concat(Date.now()),timestamp:new Date().toISOString(),year:p.year,overall:p.overall,organizationCount:Object.keys(p.dimensions.thirdLevelOrganization.entries).length},...m].slice(0,10);x(t),localStorage.setItem(lU,JSON.stringify(t)),e({title:"✅ 导入成功",description:"已导入 ".concat(p.year," 年度计划，全公司目标 ").concat((p.overall/1e4).toFixed(2)," 万元")}),setTimeout(()=>{window.location.reload()},1e3)}catch(t){e({title:"❌ 导入失败",description:t instanceof Error?t.message:"未知错误",variant:"destructive"})}finally{r(!1)}},disabled:s,className:"flex-1",children:s?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(i.Z,{className:"w-4 h-4 mr-2 animate-spin"}),"导入中..."]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(d.Z,{className:"w-4 h-4 mr-2"}),"确认导入"]})}),(0,l.jsxs)(sy.z,{variant:"outline",onClick:()=>o(!n),className:"flex-1",children:[(0,l.jsx)(_.Z,{className:"w-4 h-4 mr-2"}),n?"隐藏":"查看","差异对比"]}),(0,l.jsxs)(sy.z,{variant:"outline",onClick:()=>u(!c),children:[(0,l.jsx)(lG.Z,{className:"w-4 h-4 mr-2"}),"导入历史"]})]})]})]}),n&&(0,l.jsxs)(to.Zb,{children:[(0,l.jsx)(to.Ol,{children:(0,l.jsx)(to.ll,{className:"text-lg",children:"差异对比"})}),(0,l.jsx)(to.aY,{children:0===f.length?(0,l.jsxs)(tM.bZ,{children:[(0,l.jsx)(tP.Z,{className:"h-4 w-4"}),(0,l.jsx)(tM.Cd,{children:"无差异"}),(0,l.jsx)(tM.X,{children:"新的年度计划与当前目标完全一致"})]}):(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsxs)("div",{className:"text-sm text-muted-foreground mb-3",children:["发现 ",f.length," 个机构目标有变化"]}),(0,l.jsx)("div",{className:"max-h-96 overflow-auto space-y-2",children:f.map(e=>(0,l.jsxs)("div",{className:"flex items-center justify-between p-3 bg-slate-50 rounded-lg",children:[(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsx)("div",{className:"font-medium",children:e.organization}),(0,l.jsxs)("div",{className:"text-xs text-muted-foreground",children:[v(e.oldValue)," →"," ",v(e.newValue)]})]}),(0,l.jsxs)("div",{className:"text-right ".concat(e.change>0?"text-green-600":"text-red-600"),children:[(0,l.jsxs)("div",{className:"font-semibold",children:[e.change>0?"+":"",v(Math.abs(e.change))]}),(0,l.jsxs)("div",{className:"text-xs",children:[e.changePercent>0?"+":"",e.changePercent.toFixed(1),"%"]})]})]},e.organization))})]})})]}),c&&(0,l.jsxs)(to.Zb,{children:[(0,l.jsx)(to.Ol,{children:(0,l.jsx)(to.ll,{className:"text-lg",children:"导入历史"})}),(0,l.jsx)(to.aY,{children:0===m.length?(0,l.jsxs)(tM.bZ,{children:[(0,l.jsx)(_.Z,{className:"h-4 w-4"}),(0,l.jsx)(tM.Cd,{children:"暂无历史"}),(0,l.jsx)(tM.X,{children:"尚未进行过年度计划导入"})]}):(0,l.jsx)("div",{className:"space-y-2",children:m.map(e=>(0,l.jsxs)("div",{className:"flex items-center justify-between p-3 bg-slate-50 rounded-lg",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"font-medium",children:[e.year," 年度计划"]}),(0,l.jsx)("div",{className:"text-xs text-muted-foreground",children:new Date(e.timestamp).toLocaleString("zh-CN")})]}),(0,l.jsxs)("div",{className:"text-right",children:[(0,l.jsx)("div",{className:"text-sm font-semibold",children:v(e.overall)}),(0,l.jsxs)("div",{className:"text-xs text-muted-foreground",children:[e.organizationCount," 个机构"]})]})]},e.id))})})]})]})}function lH(){let[e,t]=(0,a.useState)("upload"),{clearPersistedData:s}=lu(),n=(0,h.qr)(e=>e.rawData);return(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between p-6 bg-white rounded-2xl border border-slate-200 shadow-sm",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsx)(r.Z,{className:"w-6 h-6 text-blue-600"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h2",{className:"text-xl font-semibold text-slate-800",children:"数据管理"}),(0,l.jsx)("p",{className:"text-sm text-slate-600 mt-1",children:"管理数据导入和导出"})]})]}),(0,l.jsx)("div",{className:"flex items-center gap-3",children:n.length>0&&(0,l.jsxs)("button",{onClick:()=>{confirm("确定要清空当前数据并重新开始吗?此操作将清除所有缓存的数据。")&&(h.qr.getState().clearData(),s())},className:"flex items-center gap-2 px-4 py-2 text-sm text-white bg-red-600 hover:bg-red-700 rounded-lg transition-colors",children:[(0,l.jsx)(u.Z,{className:"w-4 h-4"}),"清空数据"]})})]}),(0,l.jsx)("div",{className:"bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden",children:(0,l.jsxs)(eT.mQ,{value:e,onValueChange:e=>t(e),children:[(0,l.jsx)("div",{className:"border-b border-slate-200 px-6 pt-4",children:(0,l.jsxs)(eT.dr,{className:"bg-slate-100",children:[(0,l.jsxs)(eT.SP,{value:"upload",className:"gap-2",children:[(0,l.jsx)(r.Z,{className:"w-4 h-4"}),"导入数据"]}),(0,l.jsxs)(eT.SP,{value:"export",className:"gap-2",children:[(0,l.jsx)(k.Z,{className:"w-4 h-4"}),"导出数据"]}),(0,l.jsxs)(eT.SP,{value:"targets",className:"gap-2",children:[(0,l.jsx)(D.Z,{className:"w-4 h-4"}),"年度目标"]}),!1]})}),(0,l.jsx)(eT.nU,{value:"upload",className:"p-6 m-0",children:(0,l.jsx)(q,{})}),(0,l.jsx)(eT.nU,{value:"export",className:"p-6 m-0",children:(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsx)("div",{className:"rounded-xl border border-slate-200 bg-slate-50/60 p-6",children:(0,l.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-slate-800",children:"导出结构化数据"}),(0,l.jsx)("p",{className:"mt-2 text-sm text-slate-600",children:"将当前工作区的数据按需导出为 CSV 文件，支持全部数据或筛选结果。"})]}),(0,l.jsx)("div",{className:"shrink-0",children:(0,l.jsx)(lZ,{})})]})}),(0,l.jsx)("div",{className:"rounded-xl border border-slate-200 bg-slate-50/60 p-6",children:(0,l.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-slate-800",children:"导出可视化报告"}),(0,l.jsx)("p",{className:"mt-2 text-sm text-slate-600",children:"一键生成 PDF 报告，包含看板指标和核心图表，便于团队共享。"})]}),(0,l.jsx)(lq,{className:"shrink-0"})]})})]})}),(0,l.jsx)(eT.nU,{value:"targets",className:"p-6 m-0",children:(0,l.jsx)(lX,{})}),!1]})})]})}var lJ=s(28456),lQ=s(46760);let l$=[{key:"third_level_organization",label:"三级机构",description:"按三级机构进行下钻分析",getValue:e=>e.third_level_organization},{key:"business_type_category",label:"业务类型",description:"按业务类型进行下钻分析",getValue:e=>e.business_type_category},{key:"coverage_type",label:"险别组合",description:"按险别组合进行下钻分析",getValue:e=>e.coverage_type},{key:"terminal_source",label:"终端来源",description:"按终端来源进行下钻分析",getValue:e=>e.terminal_source},{key:"is_new_energy_vehicle",label:"能源类型",description:"按能源类型进行下钻分析",getValue:e=>e.is_new_energy_vehicle},{key:"renewal_status",label:"新转续维度",description:"按续保状态进行下钻分析",getValue:e=>e.renewal_status},{key:"is_transferred_vehicle",label:"是否过户车",description:"按是否过户车进行下钻分析",getValue:e=>e.is_transferred_vehicle},{key:"insurance_type",label:"车险种类",description:"按车险种类进行下钻分析",getValue:e=>e.insurance_type},{key:"week_number",label:"周次",description:"按周次进行下钻分析",getValue:e=>String(e.week_number)}];function l0(e){return!0===e?"是":!1===e?"否":String(e)}function l1(e){var t;let{availableDimensions:s,filteredData:r,onSelectValue:n,className:i}=e,[o,c]=(0,a.useState)(null),d=(0,a.useMemo)(()=>{if(!o||0===r.length)return[];let e=new Map;return r.forEach(t=>{let s=o.getValue(t),l=e.get(s)||0;e.set(s,l+1)}),Array.from(e.entries()).map(e=>{let[t,s]=e;return{value:t,count:s,displayLabel:"boolean"==typeof t?l0(t):String(t)}}).sort((e,t)=>t.count-e.count)},[o,r]),u=()=>{c(null)},m=e=>{if(!o)return;let t="boolean"==typeof e?l0(e):String(e);n(o.key,o.label,e,t),u()};return 0===s.length?(0,l.jsx)("div",{className:(0,f.cn)("rounded-lg border border-slate-200 bg-slate-50/50 p-4 text-center",i),children:(0,l.jsx)("p",{className:"text-sm text-slate-500",children:"所有维度已使用，无法继续下钻"})}):(0,l.jsxs)("div",{className:(0,f.cn)("space-y-3 rounded-lg border border-slate-200 bg-white p-4",i),children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(sv.Z,{className:"h-4 w-4 text-slate-600"}),(0,l.jsx)("h4",{className:"text-sm font-semibold text-slate-700",children:"选择下钻维度"})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("label",{className:"text-xs font-medium text-slate-600",children:"第一步：选择维度"}),(0,l.jsxs)(tm,{value:null!==(t=null==o?void 0:o.key)&&void 0!==t?t:"",onValueChange:e=>{c(s.find(t=>t.key===e)||null)},children:[(0,l.jsx)(th,{className:"w-full",children:(0,l.jsx)(tx,{placeholder:"请选择维度..."})}),(0,l.jsx)(tb,{children:s.map(e=>(0,l.jsx)(tf,{value:e.key,children:(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("span",{className:"font-medium",children:e.label}),e.description&&(0,l.jsx)("span",{className:"text-xs text-slate-500",children:e.description})]})},e.key))})]})]}),o&&d.length>0&&(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsxs)("label",{className:"text-xs font-medium text-slate-600",children:["第二步：选择",o.label,"的具体值"]}),(0,l.jsx)("div",{className:"max-h-60 space-y-1 overflow-y-auto rounded-lg border border-slate-200 bg-slate-50/50 p-2",children:d.map(e=>{let{value:t,count:s,displayLabel:a}=e;return(0,l.jsxs)(sy.z,{variant:"ghost",className:"w-full justify-between hover:bg-blue-50 hover:text-blue-700",onClick:()=>m(t),children:[(0,l.jsx)("span",{className:"font-medium",children:a}),(0,l.jsxs)(tS,{variant:"secondary",className:"ml-2 bg-slate-200 text-slate-700",children:[s.toLocaleString("zh-CN")," 条"]})]},String(t))})})]}),o&&0===d.length&&(0,l.jsx)("div",{className:"rounded-lg border border-amber-200 bg-amber-50/50 p-3",children:(0,l.jsx)("p",{className:"text-xs text-amber-700",children:"当前数据中没有该维度的可选值"})})]})}function l2(){let e=eb(e=>e.steps),t=eb(e=>e.pendingSteps),s=eb(e=>e.addDrillDownStep),r=eb(e=>e.removeDrillDownStepsFrom),n=eb(e=>e.clearDrillDown),i=eb(e=>e.applyDrillDown),o=eb(e=>e.cancelDrillDown),d=(0,h.qr)(e=>e.rawData),u=(0,h.qr)(e=>e.filters),m=null!=t?t:e,x=null!==t,g=(0,a.useMemo)(()=>l$.filter(e=>!m.some(t=>t.dimensionKey===e.key)),[m]),p=(0,a.useMemo)(()=>ef({rawData:d,filters:u,drillDownSteps:m}),[d,u,m]),b=e=>{r(e,x)},v=(e,t)=>e?e.length>t?e.substring(0,t)+"...":e:"",y=e=>v("boolean"==typeof e?l0(e):String(e),6);return(0,l.jsxs)("div",{className:"flex items-center justify-between rounded-xl border border-blue-100 bg-white/90 p-2 shadow-sm backdrop-blur-md transition-all duration-200",children:[(0,l.jsxs)("div",{className:"flex flex-1 items-center gap-2 overflow-x-auto px-2 no-scrollbar",children:[(0,l.jsxs)(sy.z,{variant:"ghost",size:"sm",className:(0,f.cn)("flex items-center gap-1 px-2 text-slate-600 hover:bg-slate-100",0===m.length&&"font-semibold text-blue-600 bg-blue-50"),onClick:()=>b(0),children:[(0,l.jsx)(lJ.Z,{className:"h-4 w-4"}),(0,l.jsx)("span",{children:"全量数据"})]}),m.map((t,s)=>{var a;return(0,l.jsxs)("div",{className:"flex items-center gap-1 animate-in fade-in slide-in-from-left-2 duration-200",children:[(0,l.jsx)(M.Z,{className:"h-4 w-4 text-slate-300"}),(0,l.jsx)(sy.z,{variant:x&&s>=e.length?"secondary":"ghost",size:"sm",className:(0,f.cn)("h-7 px-3 text-sm font-medium transition-colors",x&&(s>=e.length||(null===(a=e[s])||void 0===a?void 0:a.value)!==t.value)?"bg-amber-50 text-amber-700 border border-amber-200 hover:bg-amber-100":"bg-slate-50 text-slate-700 border border-slate-200 hover:bg-slate-100 hover:text-slate-900"),onClick:()=>b(s+1),title:"".concat(t.dimensionLabel,": ").concat("boolean"==typeof t.value?l0(t.value):t.value),children:y(t.value)})]},t.dimensionKey)}),(0,l.jsxs)(sz.J2,{children:[(0,l.jsx)(sz.xo,{asChild:!0,children:(0,l.jsx)(sy.z,{variant:"ghost",size:"sm",className:"ml-1 h-7 w-7 rounded-full border border-dashed border-slate-300 p-0 hover:border-blue-400 hover:bg-blue-50 hover:text-blue-600",title:"添加下钻维度",children:(0,l.jsx)(lQ.Z,{className:"h-4 w-4"})})}),(0,l.jsx)(sz.yk,{align:"start",className:"w-[280px] p-0",children:(0,l.jsx)(l1,{availableDimensions:g,filteredData:p,onSelectValue:(e,t,l,a)=>{s({dimensionKey:e,dimensionLabel:t,value:l,displayLabel:a})}})})]})]}),(0,l.jsx)("div",{className:"flex items-center gap-2 border-l border-slate-200 pl-4",children:x?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"mr-2 flex items-center gap-1.5 text-xs text-amber-600 font-medium",children:[(0,l.jsx)(sq.Z,{className:"h-3.5 w-3.5"}),(0,l.jsx)("span",{children:"待应用变更"})]}),(0,l.jsx)(sy.z,{size:"sm",variant:"outline",onClick:o,className:"h-8 text-slate-600 hover:text-slate-900",children:"取消"}),(0,l.jsxs)(sy.z,{size:"sm",onClick:i,className:"h-8 bg-blue-600 text-white hover:bg-blue-700",children:[(0,l.jsx)(tu.Z,{className:"mr-1.5 h-3.5 w-3.5"}),"确认应用"]})]}):m.length>0&&(0,l.jsxs)(sy.z,{variant:"ghost",size:"sm",onClick:n,className:"h-8 text-slate-500 hover:text-red-600 hover:bg-red-50",children:[(0,l.jsx)(c.Z,{className:"mr-1.5 h-3.5 w-3.5"}),"清空"]})})]})}function l5(e){var t;let{initialData:s}=e,{rawData:i}=(0,s5._V)(),{setViewMode:o,viewMode:c}=(0,su.a)(),d=s8(),{premiumTargets:u}=function(){let e=(0,s4.a)(e=>e.isLoading),t=(0,sn.r)(e=>e.filters),s=function(){let e=(0,s4.a)(e=>e.rawData),t=(0,sn.r)(e=>e.filters),s=eb(e=>e.steps);return(0,a.useMemo)(()=>{let l=s3.D.filter(e,t);return 0===s.length?l:ef({rawData:l,initialData:l,filters:t,drillDownSteps:s})},[e,t,s])}(),l=(0,h.qr)(e=>e.premiumTargets),r=(0,a.useMemo)(()=>{if(!l)return null;let{businessTypes:e,organizations:s,customerCategories:a,insuranceTypes:r}=t;if(e&&e.length>0){let t=e.reduce((e,t)=>{var s;let a=(0,ej.Vd)(t);return e+(null!==(s=l.dimensions.businessType.entries[a])&&void 0!==s?s:0)},0);if(t>0)return t}if(s&&s.length>0){let e=s.reduce((e,t)=>{var s;let a=(0,ej.Vd)(t);return e+(null!==(s=l.dimensions.thirdLevelOrganization.entries[a])&&void 0!==s?s:0)},0);if(e>0)return e}if(a&&a.length>0){let e=a.reduce((e,t)=>{var s;let a=(0,ej.Vd)(t);return e+(null!==(s=l.dimensions.customerCategory.entries[a])&&void 0!==s?s:0)},0);if(e>0)return e}if(r&&r.length>0){let e=r.reduce((e,t)=>{var s;let a=(0,ej.Vd)(t);return e+(null!==(s=l.dimensions.insuranceType.entries[a])&&void 0!==s?s:0)},0);if(e>0)return e}return l.overall>0?l.overall:null},[l,t]);return{currentKpi:(0,a.useMemo)(()=>{if(0===s.length)return null;let e="single"===t.viewMode?t.singleModeWeek:null,l=t.years&&t.years.length>0?(0,j.FT)(t.years):new Date().getFullYear();return s6.calculate(s,{annualTargetYuan:null!=r?r:void 0,mode:t.dataViewType||"current",currentWeekNumber:null!=e?e:void 0,year:l})},[s,r,t]),premiumTargets:l,isLoading:e,hasData:s.length>0}}(),m=null==u?void 0:u.overall,{currentKpi:x,compareKpi:g,previousWeekNumber:p}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{annualTargetYuan:t=null,maxJumpBack:s=5}=e,l=(0,h.qr)(e=>e.rawData),r=(0,h.qr)(e=>e.filters.viewMode),n=(0,h.qr)(e=>e.filters.dataViewType),i=(0,h.qr)(e=>e.filters.singleModeWeek),o=(0,h.qr)(e=>e.filters.trendModeWeeks),c=(0,h.qr)(e=>e.filters.years),d=(0,h.qr)(e=>e.filters.weeks),u=(0,h.qr)(e=>e.filters.organizations),m=(0,h.qr)(e=>e.filters.insuranceTypes),x=(0,h.qr)(e=>e.filters.businessTypes),g=(0,h.qr)(e=>e.filters.coverageTypes),p=(0,h.qr)(e=>e.filters.customerCategories),b=(0,h.qr)(e=>e.filters.vehicleGrades),f=(0,h.qr)(e=>e.filters.terminalSources),v=(0,h.qr)(e=>e.filters.isNewEnergy),y=(0,h.qr)(e=>e.filters.renewalStatuses),j=(0,a.useMemo)(()=>({viewMode:r,dataViewType:n,singleModeWeek:i,trendModeWeeks:o,years:c,weeks:d,organizations:u,insuranceTypes:m,businessTypes:x,coverageTypes:g,customerCategories:p,vehicleGrades:b,terminalSources:f,isNewEnergy:v,renewalStatuses:y}),[r,n,i,o,c,d,u,m,x,g,p,b,f,v,y]),N=(0,a.useMemo)(()=>l.filter(e=>{if(c.length>0&&!c.includes(e.policy_start_year)||d.length>0&&!d.includes(e.week_number)||u.length>0&&!u.includes(e.third_level_organization)||m.length>0&&!m.includes(e.insurance_type))return!1;if(x.length>0){let t=(0,en.gX)(e.business_type_category);if(!x.includes(t))return!1}return(!(g.length>0)||!!g.includes(e.coverage_type))&&(!(p.length>0)||!!p.includes(e.customer_category_3))&&(!(b.length>0)||!e.vehicle_insurance_grade||!!b.includes(e.vehicle_insurance_grade))&&(!(f.length>0)||!!f.includes(e.terminal_source))&&(null===v||e.is_new_energy_vehicle===v)&&(!(y.length>0)||!!y.includes(e.renewal_status))}),[l,c,d,u,m,x,g,p,b,f,v,y]);return(0,a.useMemo)(()=>{let e=performance.now();if(0===N.length)return{currentKpi:null,compareKpi:null,previousWeekNumber:null};let a="single"===r&&i?i:N.length>0?N.reduce((e,t)=>Math.max(e,t.week_number),0):1;console.log("[useSmartComparison] 开始计算环比数据，当前周: ".concat(a,"，数据量: ").concat(N.length," 条"));let o=c.length>0?Math.max(...c):new Date().getFullYear(),d=N.map(e=>X.Rm.fromRawData(e)),u=(0,X.Qt)(d,{annualTargetYuan:t,mode:n||"current",currentWeekNumber:a,year:o}),m=function(e,t,s){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,a=e.filter(e=>(!(s.years.length>0)||!!s.years.includes(e.policy_start_year))&&(!(s.organizations.length>0)||!!s.organizations.includes(e.third_level_organization))&&(!(s.insuranceTypes.length>0)||!!s.insuranceTypes.includes(e.insurance_type))&&(!(s.businessTypes.length>0)||!!s.businessTypes.includes(e.business_type_category))&&(!(s.coverageTypes.length>0)||!!s.coverageTypes.includes(e.coverage_type))&&(!(s.customerCategories.length>0)||!!s.customerCategories.includes(e.customer_category_3))&&(!(s.vehicleGrades.length>0)||!e.vehicle_insurance_grade||!!s.vehicleGrades.includes(e.vehicle_insurance_grade))&&(!(s.terminalSources.length>0)||!!s.terminalSources.includes(e.terminal_source))&&(null===s.isNewEnergy||e.is_new_energy_vehicle===s.isNewEnergy)&&(!(s.renewalStatuses.length>0)||!!s.renewalStatuses.includes(e.renewal_status))),r=Array.from(new Set(a.map(e=>e.week_number))).sort((e,t)=>e-t);if(0===r.length)return null;let n=r.filter(e=>e<t);if(0===n.length)return null;let i=n[n.length-1];if(t-i>l)return console.warn("[useSmartComparison] 前一周 ".concat(i," 距离当前周 ").concat(t," 超过最大跳跃范围 ").concat(l,"，跳过环比")),null;let o=a.filter(e=>e.week_number===i);return o.length>0?(console.log("[useSmartComparison] 找到前一周数据：第 ".concat(i," 周（").concat(o.length," 条记录），当前周：第 ").concat(t," 周")),o):null}(l,a,j,s);if(!m||0===m.length){let t=performance.now()-e;return console.log("[useSmartComparison] 计算完成（无环比数据），耗时: ".concat(t.toFixed(2),"ms")),{currentKpi:u,compareKpi:null,previousWeekNumber:null}}let x=m.length>0?m.reduce((e,t)=>Math.max(e,t.week_number),0):1,h=m.map(e=>X.Rm.fromRawData(e)),g=(0,X.Qt)(h,{annualTargetYuan:t,mode:n||"current",currentWeekNumber:x,year:o}),p=performance.now()-e;return console.log("[useSmartComparison] 计算完成，当前周: ".concat(a,"，对比周: ").concat(x,"，耗时: ").concat(p.toFixed(2),"ms")),{currentKpi:u,compareKpi:g,previousWeekNumber:x}},[N,l,j,t,s,r,i,n,c])}((0,a.useMemo)(()=>({annualTargetYuan:m||null}),[m])),[b,f]=(0,a.useState)(!1),v=(0,lm.useRouter)(),y=(0,lm.useSearchParams)(),N=null!==(t=null==y?void 0:y.get("tab"))&&void 0!==t?t:"kpi",w=["data-management","cockpit","kpi","trend","thematic","multichart","prediction","targets"].includes(N)?N:"kpi",[_,k]=(0,a.useState)("targets"===w?"kpi":w);lu(s),function(){let e=(0,h.qr)(e=>e.filters),t=(0,h.qr)(e=>e.updateFilters);(0,a.useEffect)(()=>{let t={viewMode:e.viewMode,dataViewType:e.dataViewType,years:e.years,weeks:e.weeks,singleModeWeek:e.singleModeWeek,trendModeWeeks:e.trendModeWeeks,organizations:e.organizations,insuranceTypes:e.insuranceTypes,businessTypes:e.businessTypes,coverageTypes:e.coverageTypes,customerCategories:e.customerCategories,vehicleGrades:e.vehicleGrades,terminalSources:e.terminalSources,isNewEnergy:e.isNewEnergy,renewalStatuses:e.renewalStatuses};localStorage.setItem("insurance-analytics-filters",JSON.stringify(t))},[e]),(0,a.useEffect)(()=>{try{let e=localStorage.getItem("insurance-analytics-filters");if(e){let s=JSON.parse(e);t(s)}}catch(e){console.warn("Failed to restore filter state from localStorage:",e)}},[t])}();let C=i.length>0,S=(0,a.useMemo)(()=>{let e=new Date,t=new Date(e.getFullYear(),0,1);return Math.floor((e.getTime()-t.getTime())/864e5)/365*100},[]);return((0,a.useEffect)(()=>{f(!0)},[]),(0,a.useEffect)(()=>{"trend"===w&&(o("trend"),k("trend"))},[]),b)?(0,l.jsxs)("div",{className:"min-h-screen p-8",children:[(0,l.jsx)(sr,{}),(0,l.jsx)("header",{className:"mb-8",children:(0,l.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,l.jsx)("div",{className:"flex items-start justify-between mb-6",children:(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsx)(r.Z,{className:"w-8 h-8 text-blue-600"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h1",{className:"text-3xl font-bold bg-gradient-to-r from-blue-600 to-cyan-600 bg-clip-text text-transparent",children:"车险多维数据分析平台"}),(0,l.jsxs)("div",{className:"flex items-center gap-3 mt-1",children:[(0,l.jsx)("p",{className:"text-sm text-slate-600",children:"数据驱动决策 \xb7 智能洞察业务 \xb7 可视化分析"}),(0,l.jsx)("div",{className:"flex items-center gap-1.5 px-2 py-1 rounded-md bg-slate-100 border border-slate-200",children:(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.Z,{className:"w-3.5 h-3.5 text-blue-600"}),(0,l.jsx)("span",{className:"text-xs font-medium text-blue-700",children:"本地模式"})]})})]})]})]})}),C&&(0,l.jsx)("div",{className:"mb-4",children:(0,l.jsx)(lN.B,{active:_,onChange:e=>{if(eb.getState().resetAll(),"targets"===e){v.push("/targets");return}k(e),"trend"===e?"trend"!==c&&o("trend"):"multichart"===e||"single"!==c&&o("single"),"kpi"===e?v.replace("/",{scroll:!1}):v.replace("/?tab=".concat(e),{scroll:!1})}})}),C&&"data-management"!==_&&(0,l.jsx)("div",{className:"mb-4",children:(0,l.jsx)(sG,{rawCount:i.length,activeTab:_})})]})}),(0,l.jsx)("div",{className:"max-w-7xl mx-auto w-full",children:(0,l.jsx)("div",{className:"aspect-[16/9] w-full overflow-auto rounded-xl",children:(0,l.jsxs)("main",{className:"h-full w-full",children:[C&&("kpi"===_||"trend"===_)&&(0,l.jsx)("div",{className:"sticky top-0 z-40 mb-6 bg-slate-50/95 backdrop-blur supports-[backdrop-filter]:bg-slate-50/60 pb-4 pt-2 -mx-4 px-4 sm:-mx-6 sm:px-6 lg:-mx-8 lg:px-8 border-b border-slate-200/60 transition-all duration-200",children:(0,l.jsx)(l2,{})}),!C&&(0,l.jsx)("div",{className:"space-y-6",children:(0,l.jsx)(q,{})}),C&&(0,l.jsxs)("div",{className:"space-y-8",children:["data-management"===_&&(0,l.jsx)("div",{className:"space-y-6",children:(0,l.jsx)(lH,{})}),"cockpit"===_&&(0,l.jsx)(lj,{}),"kpi"===_&&(0,l.jsx)(J,{kpiData:x||d,compareData:g,compareWeekNumber:p}),"trend"===_&&(0,l.jsx)("div",{className:"space-y-6",children:(0,l.jsx)(e_,{})}),"prediction"===_&&(0,l.jsx)(lM,{}),"thematic"===_&&(0,l.jsxs)("div",{className:"space-y-8",children:[(0,l.jsx)(sl,{currentKpis:d,timeProgress:S,compact:!1}),(0,l.jsx)(tY,{}),(0,l.jsx)(tq,{})]}),"multichart"===_&&(0,l.jsxs)("div",{className:"space-y-8",children:[(0,l.jsx)(tF,{}),(0,l.jsx)(ez,{})]}),(0,l.jsxs)("div",{className:"rounded-2xl border border-slate-200 p-6 bg-white/60 backdrop-blur-sm",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-slate-800 mb-2",children:"数据可视化"}),(0,l.jsx)("p",{className:"text-sm text-slate-600",children:"趋势图表、结构分析，让数据洞察更直观易懂"})]})]})]})})}),(0,l.jsx)(s2,{})]}):null}function l4(){return(0,l.jsx)(a.Suspense,{fallback:(0,l.jsx)("div",{className:"flex items-center justify-center h-screen",children:"加载中..."}),children:(0,l.jsx)(l5,{initialData:[]})})}},79471:function(e,t,s){"use strict";s.d(t,{_v:function(){return d},aJ:function(){return c},pn:function(){return i},u:function(){return o}});var l=s(36059),a=s(90616),r=s(91946),n=s(26992);let i=r.zt,o=r.fC,c=r.xz,d=a.forwardRef((e,t)=>{let{className:s,sideOffset:a=4,...i}=e;return(0,l.jsx)(r.h_,{children:(0,l.jsx)(r.VY,{ref:t,sideOffset:a,className:(0,n.cn)("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...i})})});d.displayName=r.VY.displayName}},function(e){e.O(0,[652,738,599,878,618,511,503,49,88,406,744],function(){return e(e.s=28363)}),_N_E=e.O()}]);